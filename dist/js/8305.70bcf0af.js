"use strict";(self["webpackChunkiov_platform"]=self["webpackChunkiov_platform"]||[]).push([[8305],{40323:function(e,t,o){var a=o(87092);t.Z={excel_to_json(e){return new Promise(((t,o)=>{if(["xlsx","xls"].includes(e.name))return void this.$message({type:"warning",message:"非excel文件！请重新选择"});const l=new FileReader;l.onload=e=>{const o=(0,a.ij)(e.target.result,{type:"binary"}),l=o.SheetNames.map((e=>a.P6.sheet_to_json(o.Sheets[e])));t(l)},l.onerror=e=>{o(e)},l.readAsBinaryString(e.raw)}))},word_to_pdf(){}}},18305:function(e,t,o){o.r(t),o.d(t,{default:function(){return m}});var a=o(63598),l=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{width:"80%","close-on-click-modal":!1,title:"设备入库","append-to-body":!0,"before-close":e.close,"modal-append-to-body":!1,visible:e.show}},[t("el-button-group",{staticClass:"mb-5"},e._l(e.dropdowns.typeCode,(function(o){return t("el-button",{key:o.code_value,attrs:{type:o.code_value===e.typeCode?"primary":""},on:{click:function(t){return e.switchInsertData(o)}}},[e._v("入库"+e._s(o.code_name))])})),1),t(a.Z,{ref:"table",attrs:{loading:e.importTemplauploadteLoading,data:e.tableData,"max-height":"400",size:"mini","row-key":"stakeNon"},scopedSlots:e._u([{key:"left",fn:function(){return[t("el-upload",{ref:"excelFile",attrs:{accept:".xls,.xlsx",action:"","auto-upload":!1,"on-change":e.toJSON,"show-file-list":!1,limit:1}},[t("el-button",{attrs:{size:"small"}},[e._v("EXCEL 导入模板")])],1)]},proxy:!0},{key:"right",fn:function(){return[t("el-button-group",[t("el-button",{attrs:{icon:"el-icon-plus",size:"small",title:"手录设备",disabled:e.importTemplauploadteLoading},on:{click:e.addDeviceInfo}}),t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.tableData.length>0,expression:"tableData.length > 0"}],attrs:{icon:"el-icon-delete",size:"small",title:"清空设备"},on:{click:e.clearnDevice}})],1)]},proxy:!0},{key:"columns",fn:function(){return[t("el-table-column",{attrs:{prop:"stakeName",label:"设备名称",width:"150"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-input",{attrs:{title:o.row.stakeName},model:{value:o.row.stakeName,callback:function(t){e.$set(o.row,"stakeName",t)},expression:"scope.row.stakeName"}})]}}])}),t("el-table-column",{attrs:{prop:"type",label:"设备类型"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-select",{attrs:{filterable:"","default-first-option":"",disabled:""!==e.typeCode,clearable:"",size:"medium",title:o.row.type},model:{value:o.row.type,callback:function(t){e.$set(o.row,"type",t)},expression:"scope.row.type"}},e._l(e.dropdowns.typeCode,(function(e,o){return t("el-option",{key:o,attrs:{label:e.code_name,value:e.code_value}})})),1)]}}])}),["1","2","3"].includes(e.typeCode)?[t("el-table-column",{attrs:{prop:"stakeNo",label:"设备编号",width:"150"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-input",{attrs:{title:o.row.stakeNo},on:{change:function(t){return e.inputMeterId(o.$index,o.row.stakeNo)}},model:{value:o.row.stakeNo,callback:function(t){e.$set(o.row,"stakeNo",t)},expression:"scope.row.stakeNo"}})]}}],null,!1,2921468259)}),t("el-table-column",{attrs:{prop:"modelCode",label:"设备型号"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-select",{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",disabled:""!==e.modelCode,title:o.row.equipModelUuid},model:{value:o.row.equipModelUuid,callback:function(t){e.$set(o.row,"equipModelUuid",t)},expression:"scope.row.equipModelUuid"}},e._l(e.dropdowns.modelCode,(function(e,o){return t("el-option",{key:o,attrs:{label:e.code_name,value:e.code_value}})})),1)]}}],null,!1,3103689047)}),t("el-table-column",{attrs:{prop:"ratedCurrent",label:"额定电流"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-input",{attrs:{title:o.row.ratedCurrent},model:{value:o.row.ratedCurrent,callback:function(t){e.$set(o.row,"ratedCurrent",t)},expression:"scope.row.ratedCurrent"}})]}}],null,!1,3432653603)}),t("el-table-column",{attrs:{prop:"ratedVolt",label:"额定电压"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-input",{attrs:{title:o.row.ratedVolt},model:{value:o.row.ratedVolt,callback:function(t){e.$set(o.row,"ratedVolt",t)},expression:"scope.row.ratedVolt"}})]}}],null,!1,3995347107)}),t("el-table-column",{attrs:{prop:"power",label:"额定功率"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-input",{attrs:{title:o.row.stakeName},model:{value:o.row.power,callback:function(t){e.$set(o.row,"power",t)},expression:"scope.row.power"}})]}}],null,!1,3746259667)}),t("el-table-column",{attrs:{prop:"batch",label:"批次号"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-input",{attrs:{title:o.row.batch},model:{value:o.row.batch,callback:function(t){e.$set(o.row,"batch",t)},expression:"scope.row.batch"}})]}}],null,!1,2889499971)}),t("el-table-column",{attrs:{prop:"firewareVersion",label:"固件版本号"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-input",{attrs:{title:o.row.firewareVersion},model:{value:o.row.firewareVersion,callback:function(t){e.$set(o.row,"firewareVersion",t)},expression:"scope.row.firewareVersion"}})]}}],null,!1,3262128099)}),t("el-table-column",{attrs:{prop:"factoryNo",label:"出厂编号"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-input",{attrs:{title:o.row.factoryNo},model:{value:o.row.factoryNo,callback:function(t){e.$set(o.row,"factoryNo",t)},expression:"scope.row.factoryNo"}})]}}],null,!1,1252580259)}),t("el-table-column",{attrs:{prop:"factoryDate",label:"出厂日期",width:"160"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-date-picker",{attrs:{size:"medium",type:"datetime",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss","picker-options":e.pickerOptions},model:{value:o.row.factoryDate,callback:function(t){e.$set(o.row,"factoryDate",t)},expression:"scope.row.factoryDate"}})]}}],null,!1,3767070944)}),t("el-table-column",{attrs:{prop:"nbCard",label:"NB卡号"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-input",{attrs:{title:o.row.nbCard},model:{value:o.row.nbCard,callback:function(t){e.$set(o.row,"nbCard",t)},expression:"scope.row.nbCard"}})]}}],null,!1,210725315)})]:e._e(),["4","5"].includes(e.typeCode)?["4"===e.typeCode?[t("el-table-column",{attrs:{prop:"carrierWaveId",label:"模块编号"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-input",{attrs:{title:o.row.carrierWaveId},model:{value:o.row.carrierWaveId,callback:function(t){e.$set(o.row,"carrierWaveId",t)},expression:"scope.row.carrierWaveId"}})]}}],null,!1,428390211)}),t("el-table-column",{attrs:{prop:"commAddr",label:"地址码"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-input",{attrs:{title:o.row.commAddr},model:{value:o.row.commAddr,callback:function(t){e.$set(o.row,"commAddr",t)},expression:"scope.row.commAddr"}})]}}],null,!1,4186290979)})]:e._e(),t("el-table-column",{attrs:{prop:"nbCard",label:"NB卡号"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-input",{attrs:{title:o.row.nbCard},model:{value:o.row.nbCard,callback:function(t){e.$set(o.row,"nbCard",t)},expression:"scope.row.nbCard"}})]}}],null,!1,210725315)}),t("el-table-column",{attrs:{prop:"meterId",label:"设备编号"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-input",{attrs:{title:o.row.meterId},on:{change:function(t){return e.inputMeterId(o.$index,o.row.meterId)}},model:{value:o.row.meterId,callback:function(t){e.$set(o.row,"meterId",t)},expression:"scope.row.meterId"}})]}}],null,!1,382199500)}),t("el-table-column",{attrs:{prop:"madeNo",label:"出厂编号"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-input",{attrs:{title:o.row.madeNo},model:{value:o.row.madeNo,callback:function(t){e.$set(o.row,"madeNo",t)},expression:"scope.row.madeNo"}})]}}],null,!1,883988035)}),t("el-table-column",{attrs:{prop:"madeDate",label:"出厂日期",width:"160"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-date-picker",{attrs:{size:"medium",type:"datetime",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss","picker-options":e.pickerOptions,title:o.row.madeDate},model:{value:o.row.madeDate,callback:function(t){e.$set(o.row,"madeDate",t)},expression:"scope.row.madeDate"}})]}}],null,!1,1586344822)}),t("el-table-column",{attrs:{prop:"modelCode",label:"设备型号"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-select",{attrs:{filterable:"",disabled:""!==e.modelCode,"default-first-option":"",clearable:"",size:"medium",title:o.row.modelCode},model:{value:o.row.modelCode,callback:function(t){e.$set(o.row,"modelCode",t)},expression:"scope.row.modelCode"}},e._l(e.dropdowns.modelCode,(function(e,o){return t("el-option",{key:o,attrs:{label:e.code_name,value:e.code_value}})})),1)]}}],null,!1,122340279)})]:e._e(),t("el-table-column",{attrs:{prop:"productKey",label:"产品标识"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-input",{attrs:{title:o.row.productKey},model:{value:o.row.productKey,callback:function(t){e.$set(o.row,"productKey",t)},expression:"scope.row.productKey"}})]}}])}),t("el-table-column",{attrs:{prop:"deviceSecret",label:"设备密钥"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-input",{attrs:{title:o.row.deviceSecret},model:{value:o.row.deviceSecret,callback:function(t){e.$set(o.row,"deviceSecret",t)},expression:"scope.row.deviceSecret"}})]}}])}),t("el-table-column",{attrs:{label:"操作",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-button",{attrs:{plain:"",icon:"el-icon-delete",size:"mini",title:"删除设备",type:"danger"},on:{click:function(t){return e.deleteDeviceInfo(o.$index)}}})]}}])})]},proxy:!0}])}),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{disabled:e.importTemplauploadteLoading,type:"primary"},on:{click:e.dataSplite}},[e._v("入库")]),t("el-button",{on:{click:e.close}},[e._v("取消")])],1)],1)},r=[],s=(o(57658),o(40323)),n=o(74713),d=o(5376),i={name:"",data(){return{pickerOptions:{disabledDate(e){return e.getTime()>Date.now()}},typeCode:"",modelCode:"",importTemplauploadteLoading:!1,dropdowns:{typeCode:[],modelCode:[]},tableData:[]}},props:{show:{type:Boolean,default:!1}},watch:{show(e){e&&this.getDropdowns()}},methods:{switchInsertData(e){this.typeCode=e.code_value,this.clearnDevice()},addDeviceInfo(){try{this.modelCode=this.tableData[0].equipModelUuid||this.tableData[0].modelCode||""}catch(e){}if(this.tableData.length>0&&!this.modelCode)return this.$message.info("请先选择第一条数据的 设备型号");["1","2","3"].includes(this.typeCode)&&this.tableData.unshift({stakeNo:"",macId:"",assetNo:"",productId:"",firewareVersion:"",stakeName:"",stakeCatagory:"",equipModleName:"",ratedCurrent:"",ratedVolt:"",power:"",nbCard:"",batch:"",factoryNo:"",factoryDate:"",productKey:"",deviceSecret:"",equipModelUuid:this.modelCode,type:this.typeCode}),"4"===this.typeCode&&this.tableData.unshift({meterId:"",assetNo:"",stakeName:"",commAddr:"",carrierWaveId:"",typeCode:"",nbCard:"",lotNo:"",madeNo:"",madeDate:"",productKey:"",deviceSecret:"",modelCode:this.modelCode,type:this.typeCode}),"5"===this.typeCode&&this.tableData.unshift({meterId:"",assetNo:"",stakeName:"",typeCode:"",modelCode:this.modelCode,nbCard:"",lotNo:"",madeNo:"",madeDate:"",productKey:"",deviceSecret:"",type:this.typeCode})},clearnDevice(){this.tableData=[],this.modelCode="",this.$refs["excelFile"].clearFiles()},inputMeterId(e,t){this.tableData[e].assetNo=t,["1","2","3"].includes(this.typeCode)&&(this.tableData[e].macId=t)},deleteDeviceInfo(e){this.tableData.splice(e,1)},getDropdowns(){(0,d.Wl)("3004").then((e=>{0===e.code&&(this.dropdowns.typeCode=e.data,this.typeCode=e.data[0].code_value)})),(0,d.Wl)("3005").then((e=>{0===e.code&&(this.dropdowns.modelCode=e.data)}))},toJSON(e){this.importTemplauploadteLoading=!0,s.Z.excel_to_json(e).then((e=>{this.addExcelValidator(e[0])}))},addExcelValidator(e){this.importTemplauploadteLoading=!1;const t=e[0]["设备型号"],o=e[0]["设备类型"];let a;try{a=this.dropdowns.typeCode.find((e=>e.code_name===o)).code_value||""}catch(n){}if(a!==this.typeCode){this.clearnDevice();const e=this.dropdowns.typeCode.find((e=>e.code_value===this.typeCode)).code_name;return this.$message.info(`非${e}的文件`)}const l=e.every((e=>e["设备型号"]===t));if(!l)return this.clearnDevice(),this.$message.info("设备型号不一致");const r=e.every((e=>e["设备类型"]===o));if(!r)return this.clearnDevice(),this.$message.info("设备类型不一致");const s=this.dropdowns.modelCode.find((e=>e.code_name===t));try{this.modelCode=s.code_value||""}catch(n){}if(!s&&!this.modelCode)return this.clearnDevice(),this.$message.info("存在未识别的设备型号");this.transformField(e)},transformField(e){const t=this;this.tableData.push(...e.map((e=>["1","2","3"].includes(this.typeCode)?{stakeNo:e["MAC/ID"]+"",macId:e["MAC/ID"]+"",assetNo:e["MAC/ID"]+"",productId:e["产品序列号"],firewareVersion:e["固件版本号"],stakeName:e["设备名称"],stakeCatagory:t.typeCode,type:t.typeCode,equipModleName:e["设备型号"],equipModelUuid:t.modelCode,ratedCurrent:e["额定电流(A)"],ratedVolt:e["额定电压(V)"],power:e["额定功率(W)"],nbCard:e["NB卡号"],batch:e["批次号"],factoryNo:e["出厂编号"],factoryDate:e["出厂日期"],productKey:e["产品标识"],deviceSecret:e["设备密钥"]}:"4"===this.typeCode?{meterId:e["IMEI(设备编号)"]+"",assetNo:e["IMEI(设备编号)"]+"",stakeName:e["设备名称"],commAddr:e["地址码"]+"",carrierWaveId:e["模块编号"]+"",type:t.typeCode,typeCode:t.typeCode,modelCode:t.modelCode,nbCard:e["NB卡号"],lotNo:e["批次号"],madeNo:e["出厂编号"],madeDate:e["出厂日期"],productKey:e["产品标识"],deviceSecret:e["设备密钥"]}:"5"===this.typeCode?{meterId:e["IMEI(设备编号)"]+"",assetNo:e["IMEI(设备编号)"]+"",stakeName:e["设备名称"],type:t.typeCode,typeCode:t.typeCode,modelCode:t.modelCode,nbCard:e["NB卡号"],lotNo:e["批次号"],madeNo:e["出厂编号"],madeDate:e["出厂日期"],productKey:e["产品标识"],deviceSecret:e["设备密钥"]}:void 0)))},async dataSplite(){if(0===this.tableData.length)return void this.$message.info("无数据上传");const e=200,t=Math.ceil(this.tableData.length/e);for(let o=0;o<t;o++){const a=await this.dataSubmit(this.tableData.slice(o*e,o*e+e));o+1===t&&(this.$message.success(a.msg),this.$emit("success",a.data),this.close())}},dataSubmit(e){return new Promise(((t,o)=>{(0,n.T_)(JSON.stringify(e)).then((e=>{0===e.code?t(e):o(e)})).catch((e=>{o(e)}))}))},close(){this.$emit("close",!1),this.clearnDevice()}}},c=i,u=o(1001),p=(0,u.Z)(c,l,r,!1,null,"743c1e88",null),m=p.exports}}]);