"use strict";(self["webpackChunkiov_platform"]=self["webpackChunkiov_platform"]||[]).push([[2895],{92895:function(e,t,a){a.r(t),a.d(t,{default:function(){return y}});var o=a(63598),i=a(19693),l=a(71377),r=a(75267),s=a(67539),n=function(){var e=this,t=e._self._c;return t("el-card",{staticClass:"billing-templates"},[t(s.Z,{attrs:{loading:e.loading,btnSpan:20,getData:e.getData,queryReset:e.queryReset}},[t("el-col",{attrs:{span:4}},[t(r.Z,{attrs:{clearable:"",size:"medium",placeholder:"模型id"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.id,callback:function(t){e.$set(e.queryForm,"id",t)},expression:"queryForm.id"}})],1),t("el-col",{attrs:{span:4}},[t(r.Z,{attrs:{clearable:"",size:"medium",placeholder:"模型编号"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.modelId,callback:function(t){e.$set(e.queryForm,"modelId",t)},expression:"queryForm.modelId"}})],1),t("el-col",{attrs:{span:4}},[t(r.Z,{attrs:{clearable:"",size:"medium",placeholder:"计费模型名称"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.modelName,callback:function(t){e.$set(e.queryForm,"modelName",t)},expression:"queryForm.modelName"}})],1),t("el-col",{attrs:{span:4}},[t(l["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"使用状态"},on:{change:e.pageReset},model:{value:e.queryForm.runStatus,callback:function(t){e.$set(e.queryForm,"runStatus",t)},expression:"queryForm.runStatus"}},e._l(e.dropdowns.status,(function(e,a){return t("el-option",{key:a,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t(l["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"使用收费类型"},on:{change:e.pageReset},model:{value:e.queryForm.chargeType,callback:function(t){e.$set(e.queryForm,"chargeType",t)},expression:"queryForm.chargeType"}},e._l(e.dropdowns.types,(function(e,a){return t("el-option",{key:a,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t(l["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"供电性质"},on:{change:e.pageReset},model:{value:e.queryForm.powerNature,callback:function(t){e.$set(e.queryForm,"powerNature",t)},expression:"queryForm.powerNature"}},e._l(e.dropdowns.nature,(function(e,a){return t("el-option",{key:a,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t(i.Z,{attrs:{animatLable:"",placeholder:"地址筛选",props:{checkStrictly:!0}},model:{value:e.queryForm.address3,callback:function(t){e.$set(e.queryForm,"address3",t)},expression:"queryForm.address3"}})],1)],1),t("el-divider"),t(o.Z,{ref:"table",attrs:{loading:e.loading,total:e.total,data:e.tableData,height:"550","row-key":"modelId","page-size":e.queryForm.pageSize,"current-page":e.queryForm.pageNum},on:{"selection-change":e.selectingdata,"size-change":e.dataSizeChange,"current-change":e.handleCurrentChange}},[t("template",{slot:"left"},[t("el-button",{attrs:{size:"small",icon:"el-icon-plus"},on:{click:function(t){return e.editing("add")}}},[e._v("新增")]),t("el-button",{attrs:{size:"small",icon:"el-icon-delete"},on:{click:function(t){return e.deleteing("more")}}},[e._v("删除")]),t("el-button",{attrs:{size:"small",icon:"el-icon-finished"},on:{click:function(t){return e.submitBillingModel("more")}}},[e._v("提交")]),t("el-button",{attrs:{size:"small",icon:"el-icon-thumb"},on:{click:e.passBillingModel}},[e._v("通过")])],1),t("template",{slot:"columns"},[t("el-table-column",{attrs:{prop:"id",label:"id","header-align":"center"}}),t("el-table-column",{attrs:{prop:"modelId",label:"模型编号","header-align":"center",width:"180"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"modelName",label:"模型名称","header-align":"center","min-width":"180"}}),t("el-table-column",{attrs:{prop:"powerNature",label:"供电性质","header-align":"center"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"provinceCode",label:"适用区域","header-align":"center","min-width":"180"}}),t("el-table-column",{attrs:{prop:"chargeType",label:"收费类型","header-align":"center"}}),t("el-table-column",{attrs:{prop:"caculateAccount",label:"自动计算","header-align":"center"}}),t("el-table-column",{attrs:{prop:"effectDate",label:"有效期","header-align":"center",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.effectDate)+" 至 "+e._s(t.row.expireDate)+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"使用状态","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.runStatusCode,e.dropdowns.status))+" ")]}}])}),t("el-table-column",{attrs:{label:"操作","min-width":"150","header-align":"center",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{plain:"",size:"mini",type:"primary"},on:{click:function(t){return e.editing("detail",a.row)}}},[e._v("详情")]),"1"===a.row.runStatusCode?t("el-dropdown",{staticClass:"ms-2",attrs:{trigger:"click"},on:{command:function(t){return e.handling(t,a.row)}}},[t("el-button",{attrs:{size:"mini"}},[e._v(" 更多"),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"0"}},[e._v("操作记录")]),t("el-dropdown-item",{attrs:{command:"1",divided:""}},[e._v("删除")]),t("el-dropdown-item",{attrs:{command:"2"}},[e._v("修改")]),t("el-dropdown-item",{attrs:{command:"3"}},[e._v("提交")])],1)],1):e._e(),"2"===a.row.runStatusCode?t("el-dropdown",{staticClass:"ms-2",attrs:{trigger:"click"},on:{command:function(t){return e.checking(t,a.row)}}},[t("el-button",{staticClass:"text-warning",attrs:{plain:"",size:"mini"}},[e._v(" 审核"),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"passBillingModel"}},[e._v("通过")]),t("el-dropdown-item",{attrs:{command:"turnDown"}},[e._v("驳回")])],1)],1):e._e(),"4"===a.row.runStatusCode&&"1"!==a.row.discountType?t("el-dropdown",{staticClass:"ms-2",attrs:{trigger:"click"},on:{command:function(t){return e.binding(t,a.row)}}},[t("el-button",{attrs:{size:"mini"}},[e._v(" 绑定"),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"bindPortsPanel"}},[e._v("绑定电站区域")]),t("el-dropdown-item",{attrs:{command:"queryBind"}},[e._v("查看绑定情况")])],1)],1):e._e()]}}])})],1)],2),t("el-dialog",{staticClass:"edit-billmode-panel",attrs:{"close-on-click-modal":!1,"append-to-body":!0,"modal-append-to-body":!1,title:e.dialogText,visible:e.dialogVisible,"before-close":e.cleanForms}},[t("template-detail",{ref:"template-detail",attrs:{"dialog-text":e.dialogText,data:e.templateForm},on:{submit:e.getFromData}}),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.cleanForms}},[e._v("关 闭")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:"计费模型详情"!==e.dialogText,expression:"dialogText !== '计费模型详情'"}],attrs:{type:"primary"},on:{click:function(t){return e.submitForm()}}},[e._v("确 定")])],1)],1),t("handle-history",{attrs:{show:e.historyVisible,data:e.thisData},on:{close:t=>{e.historyVisible=t,e.thisData={}}}}),t("binded-device",{attrs:{show:e.bindedDeviceDialog,data:e.thisData},on:{close:t=>{e.bindedDeviceDialog=t,e.thisData={}}}}),t("bind-ports",{ref:"BindPorts",attrs:{show:e.showBindPortsPanel,data:e.thisData},on:{close:e.closeBindPortsPanel}})],1)},d=[],c=(a(57658),a(25335)),m=a(5376),u=a(90886),p=a(30741),h={name:"settlement-billing-templates-index",mixins:[p.LI,p.I_,p.oA,p.vd],filters:{transfortext:u.h},components:{"bind-ports":()=>a.e(7633).then(a.bind(a,97633)),"template-detail":()=>a.e(4919).then(a.bind(a,83102)),"binded-device":()=>a.e(8833).then(a.bind(a,18833)),"handle-history":()=>a.e(6870).then(a.bind(a,96870))},data(){return{loading:!1,queryForm:{address3:[],modelId:"",modelName:"",runStatus:"",porType:"",provinceCode:"",cityCode:"",districtCode:"",chargeType:"",powerNature:"",pageSize:this.$tableDataSize,pageNum:1,orderByColumn:"",isAsc:"desc"},dropdowns:{status:[],types:[],nature:[],ports:[]},tableData:[],total:0,moreSelect:[],dialogVisible:!1,dialogText:"",templateForm:{id:"",modelName:"",modelId:"",chargeType:"",portType:[],powerNature:"",provinceCode:"",cityCode:"",districtCode:"",effectDate:"",expireDate:"",address3:[],validityDate:[],comment:""},thisData:{},historyVisible:!1,showBindPortsPanel:!1,bindedDeviceDialog:!1}},created(){this.getDropdowns()},watch:{"queryForm.address3"(e){this.queryForm.provinceCode=e[0]||"",this.queryForm.cityCode=e[1]||"",this.queryForm.districtCode=e[2]||""}},methods:{getDropdowns(){(0,m.Wl)("3011").then((e=>{0===e.code&&(this.dropdowns.status=e.data)})),(0,m.Wl)("3009").then((e=>{0===e.code&&(this.dropdowns.types=e.data)})),(0,m.Wl)("3008").then((e=>{0===e.code&&(this.dropdowns.nature=e.data)}))},getData(){this.tableData=[],this.loading=!0,(0,c.F6)(this.queryForm).then((e=>{this.loading=!1,0===e.code&&(this.total=e.total,this.tableData=e.rows)})).catch((()=>{this.loading=!1}))},selectingdata(e){this.moreSelect=e},editing(e,t){this.dialogVisible=!0,"add"===e&&(this.dialogText="新增计费模型",delete this.templateForm.id,this.templateForm.modelId=""),"modification"===e&&(this.dialogText="修改计费模型",this.templateForm.id=t.id,this.templateForm.modelId=t.modelId),"detail"===e&&(this.dialogText="计费模型详情"),"add"!==e&&(0,c.QO)({id:t.id}).then((e=>{0===e.code&&(this.templateForm=e.data,this.templateForm.validityDate=[e.data.effectDate+" 00:00:00",e.data.expireDate+" 00:00:00"],this.templateForm.address3=[e.data.provinceCode,e.data.cityCode,e.data.districtCode],this.templateForm.portType=e.data.portType.split(","))}))},getFromData(e){this.templateForm=e},cleanForms(){this.dialogVisible=!1,this.$refs["template-detail"].resetFields()},submitForm(){const e=this.$refs["template-detail"].submitForm();e&&this.editingBillingModel()},editingBillingModel(){(0,c.Cq)({...this.templateForm,portType:this.templateForm.portType.join(",")}).then((e=>{0===e.code&&(this.$message.success("添加成功"),this.cleanForms(),this.getData())}))},seeHistory(e){this.historyVisible=!0,this.thisData={...e}},handling(e,t){switch(e){case"0":this.seeHistory(t);break;case"1":this.deleteing("one",t);break;case"2":this.editing("modification",t);break;case"3":this.submitBillingModel("one",t);break}},submitBillingModel(e,t){let a;if("more"===e){if(a="确定提交所选项？",this.moreSelect.length<1)return this.$message.warning("请选择提交项"),!1}else a="确定提交该模型？";this.$confirm(a,"提交提醒").then((()=>{let a=[];if("one"===e)a.push(t.id);else{a=[];for(let e of this.moreSelect)a.push(e.id)}(0,c._c)({ids:a,updateType:2}).then((e=>{0===e.code?(this.$message.success(e.msg),this.getData()):this.$refs.table.clearSelection()}))})).catch((()=>{}))},checking(e,t){this[e](t)},passBillingModel(e){let t;if(e.id)t="确定通过该模型？";else{if(this.moreSelect.length<1)return this.$message.warning("请选择通过项"),!1;t="确定通过所选项？"}this.$confirm(t,"通过提醒").then((()=>{let t=[];if(e.id)t.push(e.id);else{t=[];for(let e of this.moreSelect)t.push(e.id)}(0,c._c)({ids:t,updateType:1}).then((e=>{0===e.code?(this.$message.success(e.msg),this.getData()):this.$refs.table.clearSelection()}))})).catch((()=>{}))},turnDown(e){this.$prompt(`请输入【${e.modelName}】的驳回理由：`,"驳回理由",{confirmButtonText:"驳回",beforeClose:(e,t,a)=>{if("confirm"===t.action){if(null===t.inputValue||""===t.inputValue)return this.$message.error("请输入驳回理由"),!1;if(t.inputValue.length>128)return this.$message.error("字数不得超过128个"),!1;a()}else a()}}).then((t=>{(0,c.IF)({id:e.id,returnReason:t.value}).then((e=>{0===e.code&&(this.$message.success("已驳回"),this.getData())}))})).catch((()=>{}))},deleteing(e,t){if("more"===e&&this.moreSelect.length<1)return this.$message.warning("请选择删除项"),!1;this.$confirm("一旦删除不可恢复，确定删除？","删除提醒").then((()=>{let a=[];if("one"===e)a.push(t.id);else{a=[];for(let e of this.moreSelect)a.push(e.id)}(0,c.we)({ids:a}).then((e=>{0===e.code?(this.$message.success(e.msg),this.getData(),this.moreSelect=[]):this.$refs.table.clearSelection()}))})).catch((()=>{}))},binding(e,t){this[e](t)},bindPortsPanel(e){this.showBindPortsPanel=!0,this.thisData=e},queryBind(e){this.thisData={...e},this.bindedDeviceDialog=!0},closeBindPortsPanel(e){this.showBindPortsPanel=e,this.thisData={}}}},g=h,f=a(1001),b=(0,f.Z)(g,n,d,!1,null,"882215fa",null),y=b.exports}}]);