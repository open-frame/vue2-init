"use strict";(self["webpackChunkiov_platform"]=self["webpackChunkiov_platform"]||[]).push([[4381],{4381:function(e,t,r){r.r(t),r.d(t,{default:function(){return y}});var s={};r.r(s),r.d(s,{y:function(){return h}});var o=r(1985),a=r(1377),l=r(5267),i=r(9413),n=function(){var e=this,t=e._self._c;return t("el-card",{staticClass:"operation"},[t(i.Z,{attrs:{loading:e.loading,btnSpan:24,getData:e.getData,queryReset:e.queryReset}},[t("el-col",{attrs:{span:6}},[t(l.Z,{attrs:{clearable:"",size:"medium",placeholder:"登录账号"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.loginName,callback:function(t){e.$set(e.queryForm,"loginName",t)},expression:"queryForm.loginName"}})],1),t("el-col",{attrs:{span:6}},[t(l.Z,{attrs:{clearable:"",size:"medium",placeholder:"客户姓名"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.userName,callback:function(t){e.$set(e.queryForm,"userName",t)},expression:"queryForm.userName"}})],1),t("el-col",{attrs:{span:6}},[t(l.Z,{attrs:{clearable:"",size:"medium",placeholder:"手机号码"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.phonenumber,callback:function(t){e.$set(e.queryForm,"phonenumber",t)},expression:"queryForm.phonenumber"}})],1),t("el-col",{attrs:{span:6}},[t(a.Z,{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"账号状态"},on:{change:e.pageReset},model:{value:e.queryForm.status,callback:function(t){e.$set(e.queryForm,"status",t)},expression:"queryForm.status"}},e._l(e.dropdowns.status,(function(e){return t("el-option",{key:e.code_value,attrs:{label:e.code_name,value:e.code_value}})})),1)],1)],1),t("el-divider"),t(o.Z,{ref:"table",attrs:{loading:e.loading,total:e.total,data:e.tableData,height:"600","row-key":"userId","page-size":e.queryForm.pageSize,"current-page":e.queryForm.pageNum,derive:e.exporting},on:{"selection-change":e.selectingdata,"size-change":e.dataSizeChange,"current-change":e.handleCurrentChange},scopedSlots:e._u([{key:"left",fn:function(){return[t("el-button",{attrs:{size:"small",icon:"el-icon-plus"},on:{click:function(t){return e.editing("add")}}},[e._v("新增")]),t("el-button",{attrs:{size:"small",icon:"el-icon-delete"},on:{click:function(t){return e.deleteing("more")}}},[e._v("删除")])]},proxy:!0},{key:"columns",fn:function(){return[t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"用户id",prop:"userId"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"登录账号",prop:"loginName"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"客户姓名",prop:"userName"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"sex",label:"客户性别"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.sex,e.dropdowns.sex))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"隶属组织",prop:"deptName"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"联系方式",prop:"phonenumber"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"邮箱",prop:"email"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"status",label:"客户状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.status,e.dropdowns.status))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"加入时间",prop:"createTime"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"账号创建人",prop:"createBy"}}),t("el-table-column",{attrs:{label:"操作",width:"240",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"function_edit",expression:"'function_edit'"}],attrs:{plain:"",size:"mini",type:"primary"},on:{click:function(t){return e.editing("modification",r.row)}}},[e._v("编辑")]),t("el-button",{attrs:{plain:"",size:"mini",type:"danger"},on:{click:function(t){return e.deleteing("one",r.row)}}},[e._v("删除")]),t("el-button",{attrs:{plain:"",size:"mini"},on:{click:function(t){return e.resetPassWord(r.row)}}},[e._v("修改密码")])]}}])})]},proxy:!0}])}),t("el-dialog",{attrs:{"close-on-click-modal":!1,"append-to-body":!0,"modal-append-to-body":!1,title:e.dialogText,visible:e.showEditFormDialogrVisible,"show-close":!1}},[t("el-form",{ref:"submitUserForm",attrs:{model:e.submitUserForm,rules:e.rules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"登陆账号",prop:"loginName"}},[t("el-input",{attrs:{clearable:"",readonly:"新增用户"!==e.dialogText,placeholder:"建议用个人手机号为登录账号"},model:{value:e.submitUserForm.loginName,callback:function(t){e.$set(e.submitUserForm,"loginName",t)},expression:"submitUserForm.loginName"}})],1),t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"新增用户"===e.dialogText,expression:"dialogText === '新增用户'"}],attrs:{label:"登陆密码",prop:"password"}},[t("el-input",{attrs:{clearable:"","show-password":"",autocomplete:"new-password"},model:{value:e.submitUserForm.password,callback:function(t){e.$set(e.submitUserForm,"password",t)},expression:"submitUserForm.password"}})],1),t("el-form-item",{attrs:{label:"姓名",prop:"userName"}},[t("el-input",{attrs:{clearable:""},model:{value:e.submitUserForm.userName,callback:function(t){e.$set(e.submitUserForm,"userName",t)},expression:"submitUserForm.userName"}})],1),t("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[t("el-input",{attrs:{clearable:""},model:{value:e.submitUserForm.email,callback:function(t){e.$set(e.submitUserForm,"email",t)},expression:"submitUserForm.email"}})],1),t("el-form-item",{attrs:{label:"手机号",prop:"phonenumber"}},[t("el-input",{attrs:{clearable:""},model:{value:e.submitUserForm.phonenumber,callback:function(t){e.$set(e.submitUserForm,"phonenumber",t)},expression:"submitUserForm.phonenumber"}})],1),t("el-form-item",{attrs:{label:"性别"}},[t("el-select",{attrs:{filterable:"","default-first-option":"",clearable:"",placeholder:""},model:{value:e.submitUserForm.sex,callback:function(t){e.$set(e.submitUserForm,"sex",t)},expression:"submitUserForm.sex"}},[t("el-option",{attrs:{label:"男",value:"0"}}),t("el-option",{attrs:{label:"女",value:"1"}})],1)],1),t("el-form-item",{attrs:{label:"角色",prop:"roleIds"}},[t("el-select",{attrs:{filterable:"","default-first-option":"",multiple:"",clearable:"",placeholder:""},on:{change:e.selectUserRole},model:{value:e.submitUserForm.roleIds,callback:function(t){e.$set(e.submitUserForm,"roleIds",t)},expression:"submitUserForm.roleIds"}},e._l(e.dropdowns.roles,(function(e){return t("el-option",{key:e.roleId,attrs:{label:e.roleName,value:e.roleId}})})),1)],1),t("el-form-item",{attrs:{label:"状态",prop:"status"}},[t("el-select",{attrs:{filterable:"","default-first-option":"",clearable:"",placeholder:""},model:{value:e.submitUserForm.status,callback:function(t){e.$set(e.submitUserForm,"status",t)},expression:"submitUserForm.status"}},e._l(e.dropdowns.status,(function(e,r){return t("el-option",{key:r,attrs:{label:e.code_name,value:e.code_value}})})),1)],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){return e.closeEditFormVisible("submitUserForm",e.closeEditDialog)}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("submitUserForm",e.dialogText)}}},[e._v("确 定")])],1)],1)],1)},u=[],m=(r(7658),r(2269)),d=r(6867),p=r(886),c=r(5376),b=r(741),g=r(2617);function h(e,t){return g.o.get("/service/demo/operation-users.json",e,t)}var f={name:"management-operation-index",mixins:[b.Q5,b.LI,b.I_,b.oA,b.vd],filters:{transfortext:p.h},directives:{permission:d.rd},data(){return{loading:!1,time:"",queryForm:{userName:"",deptCode:"",loginName:"",phonenumber:"",status:"",pageSize:this.$tableDataSize,pageNum:1},tableData:[],total:0,moreSelect:[],dialogText:"",dropdowns:{sex:[],status:[],roles:[]},submitUserForm:{loginName:"",password:"",deptCode:"",deptName:"",phonenumber:"",userName:"",email:"",sex:"",status:"",roleIds:[]},rules:F}},created(){this.getDropdowns()},methods:{getDropdowns(){(0,c.Wl)("477924").then((e=>{0===e.code&&(this.dropdowns.status=e.data)})),(0,c.Wl)("035927").then((e=>{0===e.code&&(this.dropdowns.sex=e.data)}))},getData(){this.tableData=[],this.loading=!0,h(this.queryForm).then((e=>{this.loading=!1,0===e.code&&(this.total=e.total,this.tableData=e.rows)})).catch((()=>{this.loading=!1}))},organizationsTreeClick(e){this.queryForm.deptCode=e.deptCode,this.getData()},selectingdata(e){this.moreSelect=e},closeEditDialog(){for(let e in this.submitUserForm)this.submitUserForm[e]="";this.submitUserForm.roleIds=[]},editing(e,t){this.showEditFormDialogrVisible=!0,"add"===e?(this.dialogText="新增用户",delete this.submitUserForm.userId,this.rules.password=[{required:!0,message:"密码为必填项！",trigger:"blur"},{pattern:/^[^<|>|(|)|+|-|*|/|%|=|{|}]*$/,message:"禁止< > ( ) + - * / % = { }等特殊字符",trigger:"blur"},{min:4,max:48,message:"长度在 4 到 2048 个字符",trigger:"blur"}],this.addFormValidator()):(this.dialogText="修改用户",this.rules.password=[],this.deleteFormValidator(),(0,s.operationUserDetail)(t.userId).then((e=>{this.submitUserForm.loginName=e.data.user.loginName,this.submitUserForm.password=e.data.user.password,this.submitUserForm.deptCode=e.data.user.deptCode,this.submitUserForm.deptName=e.data.user.deptName,this.submitUserForm.phonenumber=e.data.user.phonenumber,this.submitUserForm.userName=e.data.user.userName,this.submitUserForm.email=e.data.user.email,this.submitUserForm.sex=e.data.user.sex,this.submitUserForm.status=e.data.user.status,this.submitUserForm.roleIds=e.data.role,this.submitUserForm.userId=e.data.user.userId}))),(0,c.hv)().then((e=>{0===e.code&&(this.dropdowns.roles=e.data.roles)}))},addFormValidator(){const e=this;this.$nextTick((()=>{e.$refs["submitUserForm"].rules.loginName.find((e=>e.validator))||e.$refs["submitUserForm"].rules.loginName.push({validator:(e,t,r)=>{(0,s.detectionOperationUserNameExist)({loginName:t,name:t}).then((e=>{1===e?r(new Error("登录账号已存在，请换个账号试试")):r()}))},trigger:"blur"})}))},deleteFormValidator(){const e=this;this.$nextTick((()=>{e.$refs["submitUserForm"].rules.loginName.forEach(((e,t)=>{e.validator&&(e.validator=null)}))}))},selectUserRole(e){this.submitUserForm.roleIds=e},submitForm(e,t){this.$refs[e].validate((e=>{if(e){"修改用户"===t&&delete this.submitUserForm.password,"新增用户"===t&&(this.submitUserForm.password=m.Z.encrypt(this.submitUserForm.password));const e={addOperationUsers:s.addOperationUsers,editOperationUsers:s.editOperationUsers};e["新增用户"===t?"addOperationUsers":"editOperationUsers"](this.submitUserForm).then((e=>{if(0===e.code){if(this.$message.success(e.msg),"修改用户"===t&&this.$store.state.userInfo.loginName===this.submitUserForm.loginName)return void location.reload();this.closeEditFormVisible("submitUserForm",this.closeEditDialog()),this.getData()}}))}}))},deleteing(e,t){if("more"===e&&this.moreSelect.length<1)return this.$message.warning("请选择删除项"),!1;this.$confirm("一旦删除不可恢复，确定删除？","删除提醒",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"放弃"}).then((()=>{let r;if("one"===e)r=t.userId;else{r=[];for(let e of this.moreSelect)r.push(e.userId);r=r.join()}(0,s.deleteOperationUsers)({ids:r}).then((e=>{0===e.code&&(this.$message.success("删除成功"),this.getData(),this.moreSelect=[])}))})).catch((()=>{}))},resetPassWord(e){const t=this;this.$prompt(`请【${e.userName}】输入新密码：`,"修改密码",{confirmButtonText:"重置",cancelButtonText:"取消"}).then((r=>{(0,s.operationUsersResetPassWord)({userId:e.userId,loginName:e.loginName,password:m.Z.encrypt(r.value)}).then((e=>{0===e.code&&t.$message.success("修改成功")}))})).catch((()=>{}))},async exporting(e){let t={...this.queryForm};"2"===e&&(t.pageSize=this.total,t.pageNum=1);const r=await h(t);if(0===r.code){const e=this.$refs.table.getColumns(),t=r.rows.map((t=>{let r=e.map((e=>[e.label,`${(0,p.h)(t[e.prop],this.dropdowns[e.prop])}`]));return Object.fromEntries(r)}));return t}}}};const F={loginName:[{required:!0,message:"登录账号为必填项！",trigger:"blur"},{pattern:/^[A-Za-z0-9]+$/,message:"只能为数字、字母",trigger:"blur"},{min:2,max:48,message:"长度在 2 到 48 个字符",trigger:"blur"}],deptCode:[{required:!0,message:"组织为必选项！"}],userName:[{required:!0,message:"客户姓名为必填项！",trigger:"blur"},{pattern:/^[\u4e00-\u9fa5]*$/,message:"只能为中文名字",trigger:"blur"},{min:2,max:12,message:"长度在 2 到 12 个字符",trigger:"blur"}],phonenumber:[{required:!0,message:"联系方式为必填项！",trigger:"blur"},{pattern:/^[0-9]+$/,message:"只能为数字",trigger:"blur"},{min:7,max:16,message:"长度在 7 到 16 个字符",trigger:"blur"}],email:[{required:!0,message:"邮箱为必填项！",trigger:"blur"},{pattern:/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,message:"规则错误",trigger:"blur"},{min:5,max:48,message:"长度在 5 到 48 个字符",trigger:"blur"}],roleIds:[{type:"array",required:!0,message:"至少选择一个用户赋予的角色",trigger:"change"}],status:[{required:!0,message:"账号的状态必选！",trigger:"change"}]};var w=f,v=r(1001),U=(0,v.Z)(w,n,u,!1,null,"4dbf4dc4",null),y=U.exports}}]);