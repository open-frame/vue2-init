"use strict";(self["webpackChunkiov_platform"]=self["webpackChunkiov_platform"]||[]).push([[8652],{18652:function(e,t,o){o.r(t),o.d(t,{default:function(){return q}});var a=o(63598),s=o(1985),r=o(75267),l=o(71377),i=o(12025),n=o(66654),u=o(67539),c=function(){var e=this,t=e._self._c;return t("el-card",{staticClass:"equipment content"},[t(u.Z,{attrs:{loading:e.loading,btnSpan:12,getData:e.getData,queryReset:e.queryReset}},[t("el-col",{attrs:{span:4}},[t(r.Z,{attrs:{clearable:"",size:"medium",placeholder:"设备编号"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.stakeNo,callback:function(t){e.$set(e.queryForm,"stakeNo",t)},expression:"queryForm.stakeNo"}})],1),t("el-col",{attrs:{span:4}},[t(r.Z,{attrs:{clearable:"",size:"medium",placeholder:"设备名称"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.stakeName,callback:function(t){e.$set(e.queryForm,"stakeName",t)},expression:"queryForm.stakeName"}})],1),t("el-col",{attrs:{span:4}},[t(n.Z,{attrs:{animatLable:""},on:{change:e.pageReset},model:{value:e.queryForm.constructionUuid,callback:function(t){e.$set(e.queryForm,"constructionUuid",t)},expression:"queryForm.constructionUuid"}})],1),t("el-col",{attrs:{span:4}},[t(i.Z,{attrs:{animatLable:""},on:{change:e.pageReset},model:{value:e.queryForm.stationNo,callback:function(t){e.$set(e.queryForm,"stationNo",t)},expression:"queryForm.stationNo"}})],1),t("el-col",{attrs:{span:4}},[t(l["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"设备类型"},on:{change:e.pageReset},model:{value:e.queryForm.stakeCatagory,callback:function(t){e.$set(e.queryForm,"stakeCatagory",t)},expression:"queryForm.stakeCatagory"}},e._l(e.dropdowns.stakeCatagory,(function(e,o){return t("el-option",{key:o,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t(l["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"设备型号"},on:{change:e.pageReset},model:{value:e.queryForm.equipModelUuid,callback:function(t){e.$set(e.queryForm,"equipModelUuid",t)},expression:"queryForm.equipModelUuid"}},e._l(e.dropdowns.equipModelUuid,(function(e,o){return t("el-option",{key:o,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t(l["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"设备状态"},on:{change:e.pageReset},model:{value:e.queryForm.stakeStatus,callback:function(t){e.$set(e.queryForm,"stakeStatus",t)},expression:"queryForm.stakeStatus"}},e._l(e.dropdowns.stakeStatus,(function(e,o){return t("el-option",{key:o,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t(r.Z,{attrs:{clearable:"",size:"medium",placeholder:"安装地址"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.deviceAddr,callback:function(t){e.$set(e.queryForm,"deviceAddr",t)},expression:"queryForm.deviceAddr"}})],1),t("el-col",{attrs:{span:4}},[t(s.Z,{attrs:{animatLable:"","collapse-tags":""},model:{value:e.queryForm.deptCode,callback:function(t){e.$set(e.queryForm,"deptCode",t)},expression:"queryForm.deptCode"}})],1)],1),t("el-divider"),t(a.Z,{ref:"table",attrs:{loading:e.loading,total:e.total,data:e.tableData,height:"550","row-key":"stakeNo","page-size":e.queryForm.pageSize,"current-page":e.queryForm.pageNum,derive:e.exporting},on:{"selection-change":e.selectingData,"size-change":e.dataSizeChange,"current-change":e.handleCurrentChange,"cell-click":e.cellClick},scopedSlots:e._u([{key:"left",fn:function(){return[t("el-button",{attrs:{size:"small",icon:"el-icon-plus"},on:{click:function(t){return e.editing("add")}}},[e._v("新增")]),t("el-button",{attrs:{size:"small",icon:"el-icon-delete"},on:{click:function(t){return e.deteleing("more")}}},[e._v(" 删除 ")]),t("el-button",{attrs:{size:"small"},on:{click:function(t){return e.openUpdataVersionDialog("more")}}},[e._v(" 版本升级 ")]),t("el-button",{attrs:{size:"small"},on:{click:function(t){return e.billModelLssue("more")}}},[e._v(" 计费模型下发 ")])]},proxy:!0},{key:"columns",fn:function(){return[t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"所属站",prop:"stationName"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"隶属区域",prop:"constructionUuid"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.constructionUuid,e.dropdowns.constructionUuid,{name:"construction",value:"uuid"}))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"设备编号",prop:"stakeNo"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"设备名称",prop:"stakeName"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"版本号",prop:"firewareVersion"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"设备类型",prop:"stakeCatagory"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.stakeCatagory,e.dropdowns.stakeCatagory))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"设备型号",prop:"equipModelUuid"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.equipModelUuid,e.dropdowns.equipModelUuid))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"额定电流(A)",prop:"ratedCurrent"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"额定电压(V)",prop:"ratedVolt"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"额定功率(W)",prop:"power"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"二维码",width:"70"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-button",{staticClass:"text-warmgray",attrs:{size:"mini",title:"查看二维码",icon:"i-fa:qrcode",type:"text"},on:{click:function(t){return e.seeQRcode(o.row)}}})]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"状态",prop:"stakeStatus"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.stakeStatus+"",e.dropdowns.stakeStatus))+" ")]}}])}),t("el-table-column",{attrs:{label:"操作",width:"170",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"function_edit",expression:"'function_edit'"}],attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.editing("modification",o.row)}}},[e._v(" 查看 ")]),t("el-dropdown",{staticClass:"ms-2",on:{command:function(t){return e.moreHandler(t,o.row)}}},[t("el-button",{attrs:{size:"mini"}},[e._v(" 更多"),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"1",title:"点击"+(1===o.row.stakeStatus?"停用":"启用")}},[e._v(e._s(1===o.row.stakeStatus?"停用":"启用"))]),t("el-dropdown-item",{attrs:{command:"2"}},[e._v("维修")]),t("el-dropdown-item",{attrs:{command:"3"}},[e._v("删除")]),t("el-dropdown-item",{attrs:{command:"4"}},[e._v("升级")]),t("el-dropdown-item",{attrs:{command:"5",divided:""}},[e._v("计费模型下发")])],1)],1)]}}])})]},proxy:!0}])}),t("form-dialog",{attrs:{title:e.equipmentFormTitle,show:e.showFormDialogrVisible,data:e.equipmentForm},on:{success:e.getData,close:e.closeFormDialogrVisible}}),t("updata-version-dialog",{attrs:{show:e.showUpdataVersionDialog,data:{stationNo:e.equipmentForm.stationNo,stake:e.selectedData}},on:{success:e.updataVersiongetSuccess,close:e.closeUpdataVersionDialog}})],1)},d=[],p=(o(57658),o(74713)),m=o(5376),h=o(86867),f=o(90886),g=o(24779),k=o(30741),b={name:"property-equipment-index",mixins:[k.LI,k.I_,k.oA,k.vd],filters:{transfortext:f.h},components:{"form-dialog":()=>Promise.all([o.e(5335),o.e(5030),o.e(5017)]).then(o.bind(o,25030)),"updata-version-dialog":()=>o.e(2884).then(o.bind(o,72884))},directives:{permission:h.rd},data(){return{loading:!1,queryForm:{stakeNo:"",stakeName:"",constructionUuid:"",stakeCatagory:"",equipModelUuid:"",deviceAddr:"",stakeStatus:"",pageSize:this.$tableDataSize,pageNum:1,orderByColumn:"",isAsc:"desc",deptCode:""},dropdowns:{stakeCatagory:[],equipModelUuid:[],stakeStatus:[],constructionUuid:[]},selectedData:[],tableData:[],total:0,showFormDialogrVisible:!1,equipmentFormTitle:"",equipmentForm:{},importTemplateVisible:!1,showUpdataVersionDialog:!1}},created(){this.getDropdowns()},methods:{selectingData(e){this.selectedData=e},getDropdowns(){(0,m.Wl)("3004").then((e=>{0===e.code&&(this.dropdowns.stakeCatagory=e.data)})),(0,m.Wl)("3005").then((e=>{0===e.code&&(this.dropdowns.equipModelUuid=e.data)})),(0,m.Wl)("3006").then((e=>{0===e.code&&(this.dropdowns.stakeStatus=e.data)})),(0,g.ao)({}).then((e=>{0===e.code&&(this.dropdowns.constructionUuid=e.rows)}))},getData(){this.loading=!0,this.equipmentForm={},this.tableData=[],(0,p.Js)(this.queryForm).then((e=>{0===e.code&&(this.total=e.total,this.tableData=e.rows)})).finally((()=>{this.loading=!1}))},cellClick(e,t,o,a){"stakeNo"===t.property&&this.$router.push({name:"orders-order-manage-index",params:{stakeNo:e.stakeNo}})},downloadTemplate(){(0,p.NW)()},closeFormDialogrVisible(e){this.showFormDialogrVisible=e,this.equipmentForm={}},closeImportTemplateDialog(e){this.importTemplateVisible=e},closeUpdataVersionDialog(e){this.showUpdataVersionDialog=e,this.clearTableSelection(),this.equipmentForm={}},editing(e,t){this.showFormDialogrVisible=!0,"add"===e?(this.equipmentFormTitle="新增",this.equipmentForm={}):(this.equipmentFormTitle="修改",this.equipmentForm={...t})},moreHandler(e,t){switch(e){case"1":this.handle("status",t);break;case"2":this.handle("maintain",t);break;case"3":this.deteleing("one",t);break;case"4":this.openUpdataVersionDialog("one",t);break;case"5":this.billModelLssue("one",t);break}},openUpdataVersionDialog(e,t){if("one"===e){if("7"!==t.stakeCatagory)return this.$message.info("只能是岸电设备升级");this.selectedData=[t],this.equipmentForm.stationNo=t.stationNo}else{if(this.selectedData.length<1)return this.$message.warning("请选择升级的设备"),!1;const e=this.selectedData[0].stationNo,t=this.selectedData.some((t=>t.stationNo!==e));if(t)return this.$message.info("非同一个站");const o=this.selectedData.some((e=>"7"!==e.stakeCatagory));if(o)return this.$message.info("只能是岸电设备升级");this.equipmentForm.stationNo=e}this.showUpdataVersionDialog=!0},billModelLssue(e,t){const o=["2","3"];let a=[];if("one"===e){if(!o.includes(t.stakeCatagory))return this.$message.info("只能是充电桩");a=[t.stakeNo]}else{if(this.selectedData.length<1)return this.$message.warning("请选择需要下发的设备"),!1;const e=this.selectedData.every((e=>o.includes(e.stakeCatagory)));if(!e)return this.$message.info("只能是充电桩");a=this.selectedData.map((e=>e.stakeNo))}(0,p._c)(a).then((e=>{0===e.code?(this.$message.success(e.msg),this.getData(),this.clearTableSelection()):e.eternal.map((e=>{for(let t of this.selectedData)e===t.stakeNo&&this.$refs["table"].toggleRowSelection(t)}))}))},handle(e,t){let o;o="maintain"===e?3:2===t.stakeStatus?1:2,(0,p.K6)({uuid:t.uuid,stakeStatus:o}).then((e=>{0===e.code&&(this.$message.success(e.msg),this.getData())}))},deteleing(e,t){if("more"===e&&this.selectedData.length<1)return this.$message.warning("请选择删除项"),!1;this.$confirm("一旦删除不可恢复，确定删除？","删除提醒",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"放弃"}).then((()=>{let o=[];if("one"===e)o.push(t.uuid);else for(let e of this.selectedData)o.push(e.uuid);(0,p.zS)({uuid:o}).then((e=>{0===e.code&&(this.$message.success("删除成功"),this.getData(),this.clearTableSelection())}))})).catch((()=>{}))},clearTableSelection(){this.selectedData=[],this.$refs["table"].clearSelection()},updataVersiongetSuccess(){this.getData(),this.clearTableSelection()},seeQRcode(e){const t="https://api.qrtool.cn/",o=`?text=https://www.edo-iot.com/escar/weixincode/program?scene=${e.stakeNo}`;window.open(t+o,"_blank","location=no, status=no, menubar=no")},async exporting(e){let t={...this.queryForm};"2"===e&&(t.pageSize=this.total,t.pageNum=1);const o=await(0,p.Js)(t);if(0===o.code){const e=this.$refs.table.getColumns(),t=o.rows.map((t=>{let o=e.map((e=>{let o;return"constructionUuid"===e.prop&&(o={name:"construction",value:"uuid"}),[e.label,`${(0,f.h)(t[e.prop],this.dropdowns[e.prop],o)}`]}));return Object.fromEntries(o)}));return t}}}},w=b,y=o(1001),v=(0,y.Z)(w,c,d,!1,null,"5f53f2ac",null),q=v.exports}}]);