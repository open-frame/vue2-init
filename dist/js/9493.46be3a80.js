"use strict";(self["webpackChunkiov_platform"]=self["webpackChunkiov_platform"]||[]).push([[9493],{59493:function(e,t,o){o.r(t),o.d(t,{default:function(){return b}});var s=o(63598),a=o(81018),r=o(71377),l=o(67539),n=function(){var e=this,t=e._self._c;return t("el-card",{},[t(l.Z,{attrs:{loading:e.loading,btnSpan:16,getData:e.getData,queryReset:e.queryReset}},[t("el-col",{attrs:{span:4}},[t(r["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"是否显示最新"},on:{change:e.pageReset},model:{value:e.queryForm.latest,callback:function(t){e.$set(e.queryForm,"latest",t)},expression:"queryForm.latest"}},e._l(e.dropdowns.yesORno,(function(e,o){return t("el-option",{key:o,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t(a.Z,{attrs:{animatLable:""},on:{change:e.pageReset},model:{value:e.queryForm.processDefinitionKey,callback:function(t){e.$set(e.queryForm,"processDefinitionKey",t)},expression:"queryForm.processDefinitionKey"}})],1)],1),t("el-divider"),t(s.Z,{ref:"table",attrs:{loading:e.loading,total:e.total,data:e.tableData,height:"560","row-key":"orderId","page-size":e.queryForm.pageSize,"current-page":e.queryForm.pageNum,derive:e.exporting},on:{"current-change":e.handleCurrentChange,"size-change":e.dataSizeChange},scopedSlots:e._u([{key:"columns",fn:function(){return[t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"deploymentId",label:"流程部署id"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"name",label:"流程部署名称"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"processKey",label:"流程名称"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"id",label:"流程定义id"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"version",label:"版本"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"ended",label:"是否挂起"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.suspended,e.dropdowns.yesORno))+" ")]}}])}),t("el-table-column",{attrs:{label:"操作",width:"170"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-popover",{ref:`el-popover_${o.$index}`,attrs:{placement:"top"}},[t("el-date-picker",{attrs:{align:"right",type:"datetime",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"定时执行时间","picker-options":e.pickerOptions},model:{value:e.deployStatusDate,callback:function(t){e.deployStatusDate=t},expression:"deployStatusDate"}}),t("div",{staticClass:"text-end mt-3"},[t("el-button",{staticClass:"text-warmgray",attrs:{type:"text",size:"mini"},on:{click:function(t){e.$refs[`el-popover_${o.$index}`].doClose()}}},[e._v("关闭")]),t("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.deployStatus(o)}}},[e._v(" "+e._s(o.row.suspended?"激活":"挂起")+" ")])],1),o.row.suspended?t("el-button",{staticClass:"me-2",attrs:{slot:"reference",size:"mini",plain:"",type:"success"},slot:"reference"},[e._v(" 激活 ")]):t("el-button",{staticClass:"me-2",attrs:{slot:"reference",size:"mini",plain:""},slot:"reference"},[e._v(" 挂起 ")])],1),t("el-button",{attrs:{plain:"",type:"primary"},on:{click:function(t){return e.openProsess(o.row)}}},[e._v("流程图")])]}}])})]},proxy:!0}])}),t("el-dialog",{attrs:{"close-on-click-modal":!1,"append-to-body":!0,"modal-append-to-body":!1,visible:""!==e.processImg,"show-close":!1}},[t("img",{attrs:{src:e.processImg,alt:"流程图",srcset:""}}),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.closeProsess}},[e._v("关闭")])],1)])],1)},i=[],p=o(83693),c=o(5376),d=o(90886),u=o(30741),m={name:"process-deploy-index",filters:{transfortext:d.h},mixins:[u.I_,u.LI,u.oA,u.vd],data(){return{pickerOptions:{disabledDate(e){return e.getTime()<Date.now()-864e5}},dropdowns:{yesORno:[]},loading:!1,queryForm:{latest:"1",processDefinitionKey:"",pageSize:this.$tableDataSize,pageNum:1},tableData:[],total:0,processImg:"",deployStatusDate:""}},created(){this.getDropdowns()},methods:{getDropdowns(){(0,c.Wl)("1036").then((e=>{0===e.code&&(this.dropdowns.yesORno=e.data)}))},getData(){this.loading=!0,this.tableData=[],(0,p.lB)({...this.queryForm,latest:"1"===this.queryForm.latest}).then((e=>{this.loading=!1,0===e.code&&e.rows&&(this.total=e.total,this.tableData=e.rows,this.deployStatusDate="")})).catch((()=>{this.loading=!1}))},openProsess(e){(0,p.IR)({pdid:e.id}).then((e=>{const t=new Blob([e]);this.processImg=URL.createObjectURL(t)}))},closeProsess(){URL.revokeObjectURL(this.processImg),this.processImg=""},deployStatus(e){(0,p.Db)({date:this.deployStatusDate,type:e.row.suspended?"0":"1",pdid:e.row.id}).then((t=>{0===t.code&&(this.$message.success(t.msg),this.getData()),this.$refs[`el-popover_${e.$index}`].doClose()}))},async exporting(e){let t={...this.queryForm};"2"===e&&(t.pageSize=this.total,t.pageNum=1);const o=await(0,p.lB)(t);if(0===o.code){const e=this.$refs.table.getColumns(),t=o.rows.map((t=>{let o=e.map((e=>[e.label,`${(0,d.h)(t[e.prop],this.dropdowns[e.prop])}`]));return Object.fromEntries(o)}));return t}}}},f=m,y=o(1001),h=(0,y.Z)(f,n,i,!1,null,"0fcf40cb",null),b=h.exports}}]);