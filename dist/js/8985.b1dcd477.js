"use strict";(self["webpackChunkiov_platform"]=self["webpackChunkiov_platform"]||[]).push([[8985],{18985:function(e,t,r){r.r(t),r.d(t,{default:function(){return g}});var a=r(66654),m=r(12025),o=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{"close-on-click-modal":!1,title:e.dialogText,"append-to-body":!0,"modal-append-to-body":!1,visible:e.show,"show-close":!1}},[t("el-form",{ref:"ammeter-form",attrs:{model:e.ammeterForm,rules:e.ammeterFormRules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"设备编号",prop:"deviceName"}},[t("el-input",{attrs:{readonly:"修改空开"===e.dialogText},model:{value:e.ammeterForm.deviceName,callback:function(t){e.$set(e.ammeterForm,"deviceName",t)},expression:"ammeterForm.deviceName"}})],1),t("el-form-item",{attrs:{label:"设备型号",prop:"typeCategory"}},[t("el-select",{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:""},model:{value:e.ammeterForm.typeCategory,callback:function(t){e.$set(e.ammeterForm,"typeCategory",t)},expression:"ammeterForm.typeCategory"}},e._l(e.dropdowns.typeCategory,(function(e,r){return t("el-option",{key:r,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-form-item",{attrs:{label:"SIM卡号",prop:"deviceNb"}},[t("el-input",{attrs:{clearable:""},model:{value:e.ammeterForm.deviceNb,callback:function(t){e.$set(e.ammeterForm,"deviceNb",t)},expression:"ammeterForm.deviceNb"}})],1),t("el-form-item",{attrs:{label:"固件版本",prop:"version"}},[t("el-input",{attrs:{clearable:""},model:{value:e.ammeterForm.version,callback:function(t){e.$set(e.ammeterForm,"version",t)},expression:"ammeterForm.version"}})],1),t("el-form-item",{attrs:{label:"所属站",prop:"deviceStationNo"}},[t(m.Z,{attrs:{placeholder:""},model:{value:e.ammeterForm.deviceStationNo,callback:function(t){e.$set(e.ammeterForm,"deviceStationNo",t)},expression:"ammeterForm.deviceStationNo"}})],1),t("el-form-item",{attrs:{label:"归属区域",prop:"deviceAddr"}},[t(a.Z,{attrs:{placeholder:""},model:{value:e.ammeterForm.deviceAddr,callback:function(t){e.$set(e.ammeterForm,"deviceAddr",t)},expression:"ammeterForm.deviceAddr"}})],1),t("el-form-item",{attrs:{label:"详细地址",prop:"deviceAddrDetail"}},[t("el-input",{attrs:{clearable:""},model:{value:e.ammeterForm.deviceAddrDetail,callback:function(t){e.$set(e.ammeterForm,"deviceAddrDetail",t)},expression:"ammeterForm.deviceAddrDetail"}})],1),t("el-form-item",{attrs:{label:"ProductKey",prop:"deviceProductKey"}},[t("el-input",{attrs:{clearable:""},model:{value:e.ammeterForm.deviceProductKey,callback:function(t){e.$set(e.ammeterForm,"deviceProductKey",t)},expression:"ammeterForm.deviceProductKey"}})],1),t("el-form-item",{attrs:{label:"备注",prop:"content"}},[t("el-input",{attrs:{clearable:"",type:"textarea"},model:{value:e.ammeterForm.content,callback:function(t){e.$set(e.ammeterForm,"content",t)},expression:"ammeterForm.content"}})],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.close}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitAmmeterForm("ammeterForm")}}},[e._v("提交")])],1)],1)},i=[],s=(r(57658),r(74713)),d=r(5376),l={name:"",props:{show:{type:Boolean,default:!1},data:{type:Object,default(){return{}}}},watch:{show(e){e&&(this.getDropdowns(),this.data.deviceName?(this.dialogText="修改空开",this.deleteFormValidator(),this.getDetail(this.data.deviceName)):(this.dialogText="添加空开",this.addFormValidator()))}},data(){return this.ammeterFormRules=c,{dialogText:"",dropdowns:{typeCategory:[]},ammeterForm:{deviceName:"",typeCategory:"",deviceNb:"",version:"",deviceStationNo:"",deviceAddr:"",content:"",deviceAddrDetail:"",deviceProductKey:""}}},methods:{getDropdowns(){(0,d.Wl)("3005").then((e=>{0===e.code&&(this.dropdowns.typeCategory=e.data)}))},getDetail(e){this.$nextTick((()=>{for(let e in this.ammeterForm)for(let t in this.data)e===t&&(this.ammeterForm[e]=this.data[e])})),(0,s.dT)({deviceName:e}).then((e=>{this.ammeterForm.deviceName=e.data[0].deviceName,this.ammeterForm.typeCategory=e.data[0].typeCategory,this.ammeterForm.version=e.data[0].version,this.ammeterForm.deviceStationNo=e.data[0].deviceStationNo,this.ammeterForm.deviceAddr=e.data[0].deviceAddr,this.ammeterForm.deviceProductKey=e.data[0].deviceProductKey,this.ammeterForm.content=e.data[0].content,this.ammeterForm.deviceAddrDetail=e.data[0].deviceAddrDetail,this.ammeterForm.deviceNb=e.data[0].deviceNb}))},addFormValidator(){const e=this;this.$nextTick((()=>{e.$refs["ammeter-form"].rules.deviceName.find((e=>e.validator))||e.$refs["ammeter-form"].rules.deviceName.push({validator:(e,t,r)=>{(0,s.VP)({deviceName:t}).then((e=>{500===e.code?r(new Error("设备编号已存在")):r()}))},trigger:"blur"})}))},deleteFormValidator(){const e=this;this.$nextTick((()=>{e.$refs["ammeter-form"].rules.deviceName.forEach(((e,t)=>{e.validator&&(e.validator=null)}))}))},submitAmmeterForm(){this.$refs["ammeter-form"].validate((e=>{if(!e)return!1;const t={addAssetSwitch:s.no,assetStakeUpdate:s.Mk};t["添加空开"===this.dialogText?"addAssetSwitch":"assetStakeUpdate"](this.ammeterForm).then((e=>{0===e.code&&(this.$message.success(e.msg),this.$emit("success"),this.close())}))}))},close(){this.$refs["ammeter-form"].resetFields(),this.$emit("close",!1)}}};const c={deviceName:[{required:!0,message:"请输入设备编号",trigger:"blur"},{pattern:/^[^<|>|(|)|+|-|*|/|%|=|{|}]*$/,message:"禁止< > ( ) + - * / % = { }等特殊字符",trigger:"blur"},{min:2,max:24,message:"长度在 2 到 24 个字符",trigger:"blur"}],deviceNb:[{required:!0,message:"请输入SIM卡号",trigger:"blur"},{pattern:/^[^<|>|(|)|+|-|*|/|%|=|{|}]*$/,message:"禁止< > ( ) + - * / % = { }等特殊字符",trigger:"blur"},{min:2,max:24,message:"长度在 2 到 24 个字符",trigger:"blur"}],version:[{required:!0,message:"请输入固件版本",trigger:"blur"},{pattern:/^[^<|>|(|)|+|-|*|/|%|=|{|}]*$/,message:"禁止< > ( ) + - * / % = { }等特殊字符",trigger:"blur"},{min:2,max:48,message:"长度在 2 到 24 个字符",trigger:"blur"}],deviceAddrDetail:[{required:!0,message:"请输入详细地址",trigger:"blur"},{pattern:/^[^<|>|(|)|+|-|*|/|%|=|{|}]*$/,message:"禁止< > ( ) + - * / % = { }等特殊字符",trigger:"blur"},{min:2,max:48,message:"长度在 2 到 48 个字符",trigger:"blur"}],deviceProductKey:[{required:!0,message:"请输入PK",trigger:"blur"},{pattern:/^[^<|>|(|)|+|-|*|/|%|=|{|}]*$/,message:"禁止< > ( ) + - * / % = { }等特殊字符",trigger:"blur"},{min:2,max:48,message:"长度在 2 到 48 个字符",trigger:"blur"}],deviceStationNo:[{required:!0,message:"请选择设备所属站",trigger:"change"}],typeCategory:[{required:!0,message:"请选择设备型号",trigger:"change"}],deviceAddr:[{required:!0,message:"请选择设备的归属区域",trigger:"change"}]};var n=l,u=r(1001),v=(0,u.Z)(n,o,i,!1,null,"54c9d35a",null),g=v.exports}}]);