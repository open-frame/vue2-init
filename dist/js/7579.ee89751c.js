"use strict";(self["webpackChunkiov_platform"]=self["webpackChunkiov_platform"]||[]).push([[7579],{67579:function(e,t,l){l.r(t),l.d(t,{default:function(){return b}});var o=l(63598),a=function(){var e=this,t=e._self._c;return t("el-dialog",{staticClass:"watch-import-dialog",attrs:{"close-on-click-modal":!1,"append-to-body":!0,"modal-append-to-body":!1,title:"空开导入",visible:e.show,"show-close":!1}},[t("el-form",{ref:"equipment-form",attrs:{model:e.form,rules:e.formRules}},[t(o.Z,{ref:"table",attrs:{data:e.form.tableData,height:"530","row-key":"device_name"},scopedSlots:e._u([{key:"left",fn:function(){return[t("el-button",{attrs:{size:"small",icon:"el-icon-download"},on:{click:e.downloadTemplate}},[e._v(" 空开模板下载 ")]),t("el-upload",{ref:"excel-file",attrs:{limit:1,accept:".xls,.xlsx",action:"","auto-upload":!1,"on-change":e.selectSwitchTemplate,"show-file-list":!1}},[t("el-button",{attrs:{icon:"el-icon-notebook-2",size:"small"}},[e._v("EXCEL 批量导入")])],1)]},proxy:!0},{key:"right",fn:function(){return[t("el-button",{attrs:{icon:"el-icon-plus",size:"small"},on:{click:e.addForm}}),t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.form.tableData.length>0,expression:"form.tableData.length > 0"}],attrs:{icon:"el-icon-delete",size:"small",title:"清空设备"},on:{click:e.clearnDevice}})]},proxy:!0},{key:"columns",fn:function(){return[t("el-table-column",{attrs:{label:"设备编号"},scopedSlots:e._u([{key:"default",fn:function(l){return[t("el-form-item",{staticClass:"m-0",attrs:{rules:e.formRules.deviceName,prop:`tableData.${l.$index}.deviceName`}},[t("el-input",{attrs:{clearable:"",size:"mini"},model:{value:l.row.deviceName,callback:function(t){e.$set(l.row,"deviceName",t)},expression:"scope.row.deviceName"}})],1)]}}])}),t("el-table-column",{attrs:{label:"设备型号"},scopedSlots:e._u([{key:"default",fn:function(l){return[t("el-form-item",{staticClass:"m-0",attrs:{rules:e.formRules.typeCategory,prop:`tableData.${l.$index}.typeCategory`}},[t("el-select",{staticStyle:{width:"100px"},attrs:{size:"mini",clearable:"",filterable:"","default-first-option":"",placeholder:""},model:{value:l.row.typeCategory,callback:function(t){e.$set(l.row,"typeCategory",t)},expression:"scope.row.typeCategory"}},e._l(e.dropdowns.typeCategory,(function(e,l){return t("el-option",{key:l,attrs:{label:e.code_name,value:e.code_value}})})),1)],1)]}}])}),t("el-table-column",{attrs:{label:"SIM卡号"},scopedSlots:e._u([{key:"default",fn:function(l){return[t("el-form-item",{staticClass:"m-0",attrs:{rules:e.formRules.deviceNb,prop:`tableData.${l.$index}.deviceNb`}},[t("el-input",{attrs:{clearable:"",size:"mini"},model:{value:l.row.deviceNb,callback:function(t){e.$set(l.row,"deviceNb",t)},expression:"scope.row.deviceNb"}})],1)]}}])}),t("el-table-column",{attrs:{label:"固件版本"},scopedSlots:e._u([{key:"default",fn:function(l){return[t("el-form-item",{staticClass:"m-0",attrs:{rules:e.formRules.version,prop:`tableData.${l.$index}.version`}},[t("el-input",{attrs:{clearable:"",size:"mini"},model:{value:l.row.version,callback:function(t){e.$set(l.row,"version",t)},expression:"scope.row.version"}})],1)]}}])}),t("el-table-column",{attrs:{label:"产品密钥"},scopedSlots:e._u([{key:"default",fn:function(l){return[t("el-form-item",{staticClass:"m-0",attrs:{rules:e.formRules.deviceProductKey,prop:`tableData.${l.$index}.deviceProductKey`}},[t("el-input",{attrs:{clearable:"",size:"mini"},model:{value:l.row.deviceProductKey,callback:function(t){e.$set(l.row,"deviceProductKey",t)},expression:"scope.row.deviceProductKey"}})],1)]}}])}),t("el-table-column",{attrs:{label:"操作",width:"140",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(l){return[t("el-button",{attrs:{icon:"el-icon-delete",type:"primary",size:"mini"},on:{click:function(t){return e.deleteIt(l)}}})]}}])})]},proxy:!0}])})],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.close}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",disabled:0===e.form.tableData.length},on:{click:e.submitAmmeterForm}},[e._v("增 加")])],1)],1)},r=[],s=l(40323),i=l(74713),n=l(1161),c=l(5376),u={name:"",props:{show:{type:Boolean,default:!1}},watch:{show(e){e&&this.getDropdowns()}},data(){return this.formRules=d,{dropdowns:{typeCategory:[]},form:{tableData:[]}}},methods:{getDropdowns(){(0,c.Wl)("3005").then((e=>{0===e.code&&(this.dropdowns.typeCategory=e.data)}))},deleteIt(e){this.form.tableData.splice(e.$index,1)},clearnDevice(){this.form.tableData=[],this.$refs["excel-file"].clearFiles()},addForm(){this.form.tableData.unshift({deviceName:"",typeCategory:"",deviceNb:"",version:"",deviceAddr:"",content:"",deviceAddrDetail:"",deviceProductKey:""})},downloadTemplate(){(0,n.rD)({"IMEI(设备编号)":"86482351111","设备名称":"03112","设备类型":"空开","设备型号":"ML-200","NB卡号":"3213213213","批次号":"1111111","出厂编号":"4213215431","出厂日期":"2020-01-22 12:44:10","产品标识":"7665323144642124","设备密钥":"cc76w454321a2674j3g65"},"空开填写模板"),this.$message.info("使用前请将模板中的示例数据删掉")},selectSwitchTemplate(e){["xlsx","xls"].includes(e.name)?this.$message({type:"warning",message:"非excel文件！请重新选择"}):s.Z.excel_to_json(e).then((e=>{this.form.tableData=e[0]}))},submitAmmeterForm(){this.$refs["equipment-form"].validate((e=>{if(!e)return!1;this.form.tableData.map(((e,t)=>{(0,i.no)(e).then((e=>{this.form.tableData.length===t+1&&0===e.code&&(this.$message.success(e.msg),this.$emit("success"),this.close())}))}))}))},close(){this.$refs["equipment-form"].resetFields(),this.form.tableData=[],this.$emit("close",!1)}}};const d={deviceName:[{required:!0,message:" ",trigger:"blur"}],typeCategory:[{required:!0,message:" ",trigger:"blur"}],deviceNb:[{required:!0,message:" ",trigger:"blur"}],version:[{required:!0,message:" ",trigger:"blur"}],deviceProductKey:[{required:!0,message:" ",trigger:"blur"}]};var m=u,f=l(1001),p=(0,f.Z)(m,a,r,!1,null,"5894637d",null),b=p.exports}}]);