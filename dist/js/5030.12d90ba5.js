"use strict";(self["webpackChunkiov_platform"]=self["webpackChunkiov_platform"]||[]).push([[5030],{25030:function(e,t,r){r.r(t),r.d(t,{default:function(){return $}});var o=r(63598),a=r(71377),l=r(75267),i=function(){var e=this,t=e._self._c;return t("el-dialog",{staticClass:"bind-billing-model",attrs:{"close-on-click-modal":!1,"append-to-body":!0,"modal-append-to-body":!1,"before-close":e.close,title:"选择计费模型","tooltip-effect":"dark",visible:e.show}},[t("el-row",{staticClass:"filters",attrs:{gutter:30}},[t("el-col",{attrs:{span:4}},[t(l.Z,{attrs:{clearable:"",size:"mini",placeholder:"计费模型id"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.id,callback:function(t){e.$set(e.queryForm,"id",t)},expression:"queryForm.id"}})],1),t("el-col",{attrs:{span:4}},[t(l.Z,{attrs:{clearable:"",size:"mini",placeholder:"计费模型编号"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.modelId,callback:function(t){e.$set(e.queryForm,"modelId",t)},expression:"queryForm.modelId"}})],1),t("el-col",{attrs:{span:4}},[t(l.Z,{attrs:{clearable:"",size:"mini",placeholder:"计费模型名称"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.modelName,callback:function(t){e.$set(e.queryForm,"modelName",t)},expression:"queryForm.modelName"}})],1),t("el-col",{attrs:{span:4}},[t(a["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"mini",placeholder:"使用状态"},on:{change:e.pageReset},model:{value:e.queryForm.runStatus,callback:function(t){e.$set(e.queryForm,"runStatus",t)},expression:"queryForm.runStatus"}},e._l(e.dropdowns.status,(function(e,r){return t("el-option",{key:r,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t(a["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"mini",placeholder:"收费类型"},on:{change:e.pageReset},model:{value:e.queryForm.chargeType,callback:function(t){e.$set(e.queryForm,"chargeType",t)},expression:"queryForm.chargeType"}},e._l(e.dropdowns.types,(function(e,r){return t("el-option",{key:r,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t(a["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"mini",placeholder:"供电性质"},on:{change:e.pageReset},model:{value:e.queryForm.powerNature,callback:function(t){e.$set(e.queryForm,"powerNature",t)},expression:"queryForm.powerNature"}},e._l(e.dropdowns.nature,(function(e,r){return t("el-option",{key:r,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t(a["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"mini",placeholder:"端口类型"},on:{change:e.pageReset},model:{value:e.queryForm.portType,callback:function(t){e.$set(e.queryForm,"portType",t)},expression:"queryForm.portType"}},e._l(e.dropdowns.ports,(function(e,r){return t("el-option",{key:r,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}}),t("el-col",{staticClass:"text-end",attrs:{span:16}},[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.getData}},[e._v("搜索")]),t("el-button",{attrs:{size:"mini"},on:{click:e.queryReset}},[e._v("重置")])],1)],1),t("el-divider",{staticClass:"mt-1"}),t(o.Z,{ref:"station-table",attrs:{loading:e.loading,total:e.total,data:e.tableData,height:"340",size:"mini","row-key":"stationNo","page-size":e.queryForm.pageSize,"current-page":e.queryForm.pageNum},on:{"row-click":e.selectingData,"size-change":e.dataSizeChange,"current-change":e.handleCurrentChange},scopedSlots:e._u([{key:"columns",fn:function(){return[t("el-table-column",{attrs:{label:"基本信息","header-align":"center"}},[t("el-table-column",{attrs:{prop:"id",label:"id"}}),t("el-table-column",{attrs:{prop:"modelId",label:"模型编号",width:"180"}}),t("el-table-column",{attrs:{prop:"modelName",label:"模型名称",width:"200","show-overflow-tooltip":!0}}),t("el-table-column",{attrs:{prop:"chargeType",label:"收费类型"}}),t("el-table-column",{attrs:{prop:"powerNature",label:"供电性质"}}),t("el-table-column",{attrs:{prop:"provinceCode",label:"适用区域",width:"200","show-overflow-tooltip":!0}}),t("el-table-column",{attrs:{prop:"chargeType",label:"端口类型"}})],1),t("el-table-column",{attrs:{prop:"hourPrice",label:"收费标准(元/小时)",width:"120"}}),t("el-table-column",{attrs:{label:"有效期","header-align":"center"}},[t("el-table-column",{attrs:{prop:"effectDate",label:"生效日期",width:"160"}}),t("el-table-column",{attrs:{prop:"expireDate",label:"失效日期",width:"160"}})],1),t("el-table-column",{attrs:{prop:"useStatus",label:"应用状态"}})]},proxy:!0}])}),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.close}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.select}},[e._v("确 定")])],1)],1)},s=[],n=r(5376),u=r(25335),m=r(30741),p={name:"BindBillingModel",mixins:[m.I_,m.LI,m.oA],data(){return{loading:!0,total:0,tableData:[],selectData:{},dropdowns:{status:[],types:[],nature:[],ports:[]},queryForm:{address3:[],modelId:"",modelName:"",runStatus:"4",portType:"",provinceCode:"",cityCode:"",districtCode:"",chargeType:"",powerNature:"",pageSize:this.$tableDataSize,pageNum:1}}},watch:{show(e,t){e&&(this.getDropdowns(),this.getData())},"queryForm.address3"(e){this.queryForm.provinceCode=e[0]||"",this.queryForm.cityCode=e[1]||"",this.queryForm.districtCode=e[2]||""}},props:{show:{type:Boolean,default:!1}},methods:{getDropdowns(){(0,n.Wl)("3011").then((e=>{0===e.code&&(this.dropdowns.status=e.data)})),(0,n.Wl)("3009").then((e=>{0===e.code&&(this.dropdowns.types=e.data)})),(0,n.Wl)("3008").then((e=>{0===e.code&&(this.dropdowns.nature=e.data)})),(0,n.Wl)("3010").then((e=>{0===e.code&&(this.dropdowns.ports=e.data)}))},getData(){this.tableData=[],this.loading=!0,(0,u.F6)(this.queryForm).then((e=>{this.loading=!1,0===e.code&&(this.tableData=e.rows,this.total=e.total)}))},selectingData(e,t,r){this.selectData=e},select(){this.$emit("select",this.selectData),this.close()},close(){this.$emit("close",!1),this.$data.queryForm=this.$options.data().queryForm}}},d=p,c=r(1001),b=(0,c.Z)(d,i,s,!1,null,"76cc5eed",null),f=b.exports,g=function(){var e=this,t=e._self._c;return t("div",[t("el-dialog",{attrs:{"close-on-click-modal":!1,"append-to-body":!0,"modal-append-to-body":!1,title:e.formTitle+"设备",visible:e.show,"show-close":!1}},[t("el-form",{ref:"equipment-form",attrs:{model:e.equipmentForm,rules:e.equipmentFormRules,"label-width":"120px"}},[t("el-form-item",{attrs:{label:"所属站",prop:"stationUuid"}},[t("el-select",{attrs:{clearable:"",filterable:"","default-first-option":"",placeholder:""},model:{value:e.equipmentForm.stationUuid,callback:function(t){e.$set(e.equipmentForm,"stationUuid",t)},expression:"equipmentForm.stationUuid"}},e._l(e.dropdowns.allPowerStation,(function(e,r){return t("el-option",{key:r,attrs:{label:e.stationName,value:e.uuid}})})),1)],1),t("el-form-item",{attrs:{label:"设备类型",prop:"stakeCatagory"}},[t("el-select",{attrs:{clearable:"",filterable:"","default-first-option":"",placeholder:""},model:{value:e.equipmentForm.stakeCatagory,callback:function(t){e.$set(e.equipmentForm,"stakeCatagory",t)},expression:"equipmentForm.stakeCatagory"}},e._l(e.dropdowns.category,(function(e,r){return t("el-option",{key:r,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-form-item",{attrs:{label:"设备型号",prop:"equipModelUuid"}},[t("el-select",{attrs:{clearable:"",filterable:"","default-first-option":"",placeholder:""},model:{value:e.equipmentForm.equipModelUuid,callback:function(t){e.$set(e.equipmentForm,"equipModelUuid",t)},expression:"equipmentForm.equipModelUuid"}},e._l(e.dropdowns.type,(function(e,r){return t("el-option",{key:r,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-form-item",{attrs:{label:"设备名称",prop:"stakeName"}},[t("el-input",{attrs:{clearable:""},model:{value:e.equipmentForm.stakeName,callback:function(t){e.$set(e.equipmentForm,"stakeName",t)},expression:"equipmentForm.stakeName"}})],1),t("el-form-item",{attrs:{label:"MAC/ID",prop:"macId"}},[t("el-input",{attrs:{clearable:"",readonly:"修改"===e.formTitle},model:{value:e.equipmentForm.macId,callback:function(t){e.$set(e.equipmentForm,"macId",t)},expression:"equipmentForm.macId"}})],1),t("el-form-item",{attrs:{label:"产品序列号",prop:"productId"}},[t("el-input",{attrs:{clearable:""},model:{value:e.equipmentForm.productId,callback:function(t){e.$set(e.equipmentForm,"productId",t)},expression:"equipmentForm.productId"}})],1),t("el-form-item",{attrs:{label:"固件版本号",prop:"firewareVersion"}},[t("el-input",{attrs:{clearable:""},model:{value:e.equipmentForm.firewareVersion,callback:function(t){e.$set(e.equipmentForm,"firewareVersion",t)},expression:"equipmentForm.firewareVersion"}})],1),t("el-form-item",{attrs:{label:"NB卡号",prop:"nbCard"}},[t("el-input",{attrs:{clearable:""},model:{value:e.equipmentForm.nbCard,callback:function(t){e.$set(e.equipmentForm,"nbCard",t)},expression:"equipmentForm.nbCard"}})],1),t("el-form-item",{attrs:{label:"批次号",prop:"batch"}},[t("el-input",{attrs:{clearable:""},model:{value:e.equipmentForm.batch,callback:function(t){e.$set(e.equipmentForm,"batch",t)},expression:"equipmentForm.batch"}})],1),t("el-form-item",{attrs:{label:"出厂编号",prop:"factoryNo"}},[t("el-input",{attrs:{clearable:""},model:{value:e.equipmentForm.factoryNo,callback:function(t){e.$set(e.equipmentForm,"factoryNo",t)},expression:"equipmentForm.factoryNo"}})],1),t("el-form-item",{attrs:{label:"出厂日期",prop:"factoryDate"}},[t("el-date-picker",{attrs:{clearable:"",type:"date",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",placeholder:"选择日期","picker-options":e.pickerOptions},model:{value:e.equipmentForm.factoryDate,callback:function(t){e.$set(e.equipmentForm,"factoryDate",t)},expression:"equipmentForm.factoryDate"}})],1),t("el-form-item",{attrs:{label:"额定电流(A)",prop:"ratedCurrent"}},[t("el-input",{attrs:{clearable:""},model:{value:e.equipmentForm.ratedCurrent,callback:function(t){e.$set(e.equipmentForm,"ratedCurrent",t)},expression:"equipmentForm.ratedCurrent"}})],1),t("el-form-item",{attrs:{label:"额定电压(V)",prop:"ratedVolt"}},[t("el-input",{attrs:{clearable:""},model:{value:e.equipmentForm.ratedVolt,callback:function(t){e.$set(e.equipmentForm,"ratedVolt",t)},expression:"equipmentForm.ratedVolt"}})],1),t("el-form-item",{attrs:{label:"额定功率(W)",prop:"power"}},[t("el-input",{attrs:{clearable:""},model:{value:e.equipmentForm.power,callback:function(t){e.$set(e.equipmentForm,"power",t)},expression:"equipmentForm.power"}})],1),t("el-form-item",{attrs:{label:"描述"}},[t("el-input",{attrs:{clearable:"",type:"textarea"},model:{value:e.equipmentForm.msgDetail,callback:function(t){e.$set(e.equipmentForm,"msgDetail",t)},expression:"equipmentForm.msgDetail"}})],1),t("el-divider",[e._v(" 端口计费 ")]),t("div",{staticClass:"text-end"},[t("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:e.addPortBillForm}},[e._v("添加端口计费")])],1),t(o.Z,{attrs:{size:"mini",data:e.equipmentForm.assetPortVoList},scopedSlots:e._u([{key:"columns",fn:function(){return[t("el-table-column",{attrs:{label:"端口型号"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-form-item",{staticClass:"m-0",attrs:{rules:e.equipmentFormRules.chargerNo,prop:`assetPortVoList.${r.$index}.chargerNo`}},[t("el-select",{staticStyle:{width:"100px"},attrs:{size:"mini",clearable:"",filterable:"","default-first-option":"",placeholder:""},model:{value:r.row.chargerNo,callback:function(t){e.$set(r.row,"chargerNo",t)},expression:"scope.row.chargerNo"}},e._l(e.dropdowns.ports,(function(e,r){return t("el-option",{key:r,attrs:{label:e.code_name,value:e.code_value}})})),1)],1)]}}])}),t("el-table-column",{attrs:{label:"最大电流(A)"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-form-item",{staticClass:"m-0",attrs:{rules:e.equipmentFormRules.portCurrent,prop:`assetPortVoList.${r.$index}.portCurrent`}},[t("el-input",{attrs:{clearable:"",size:"mini"},model:{value:r.row.portCurrent,callback:function(t){e.$set(r.row,"portCurrent",t)},expression:"scope.row.portCurrent"}})],1)]}}])}),t("el-table-column",{attrs:{label:"额定电压(V)"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-form-item",{staticClass:"m-0",attrs:{rules:e.equipmentFormRules.portRatedVolt,prop:`assetPortVoList.${r.$index}.portRatedVolt`}},[t("el-input",{attrs:{clearable:"",size:"mini"},model:{value:r.row.portRatedVolt,callback:function(t){e.$set(r.row,"portRatedVolt",t)},expression:"scope.row.portRatedVolt"}})],1)]}}])}),t("el-table-column",{attrs:{label:"额定功率(W)"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-form-item",{staticClass:"m-0",attrs:{rules:e.equipmentFormRules.portPower,prop:`assetPortVoList.${r.$index}.portPower`}},[t("el-input",{attrs:{clearable:"",size:"mini"},model:{value:r.row.portPower,callback:function(t){e.$set(r.row,"portPower",t)},expression:"scope.row.portPower"}})],1)]}}])}),t("el-table-column",{attrs:{label:"计费模型"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-form-item",{staticClass:"m-0",attrs:{rules:e.equipmentFormRules.modelIdr,prop:`assetPortVoList.${r.$index}.modelIdr`}},[t("el-input",{attrs:{clearable:"",size:"mini"},on:{focus:function(t){return e.openBillingModel(r)}},model:{value:r.row.modelIdr,callback:function(t){e.$set(r.row,"modelIdr",t)},expression:"scope.row.modelIdr"}})],1)]}}])}),t("el-table-column",{attrs:{label:"备注","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-input",{attrs:{clearable:"",size:"mini"},model:{value:r.row.portMsgDetail,callback:function(t){e.$set(r.row,"portMsgDetail",t)},expression:"scope.row.portMsgDetail"}})]}}])}),t("el-table-column",{attrs:{label:"删除"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-delete",title:"删除"},on:{click:function(t){return e.deletePortBill(r.$index)}}})]}}])})]},proxy:!0}])})],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.close}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("确 定")])],1)],1),t(f,{attrs:{show:e.billingModelVisible},on:{select:e.bindBillingModel,close:e.closeBillingModel}})],1)},h=[],y=(r(57658),r(74713)),q={name:"",props:{show:{type:Boolean,default:!1},data:{type:Object,default(){return{}}}},watch:{show(e){e&&(this.getDropdowns(),this.formTitle=this.data.uuid?"修改":"新增",this.data.uuid?(this.formTitle="修改",this.deleteMacidValidator(),this.getDetail()):(this.addMacidValidator(),this.$refs["equipment-form"].resetFields()))}},data(){return this.equipmentFormRules=w,{pickerOptions:{disabledDate(e){return e.getTime()>Date.now()}},dropdowns:{category:[],type:[],status:[],allPowerStation:[],ports:[]},equipmentForm:F,formTitle:"",billingModelVisible:!1,editIndex:null}},methods:{getDropdowns(){(0,n.Wl)("3004").then((e=>{0===e.code&&(this.dropdowns.category=e.data)})),(0,n.Wl)("3005").then((e=>{0===e.code&&(this.dropdowns.type=e.data)})),(0,n.Wl)("3006").then((e=>{0===e.code&&(this.dropdowns.status=e.data)})),(0,n.Wl)("3010").then((e=>{0===e.code&&(this.dropdowns.ports=e.data)})),(0,y.NK)({s:""}).then((e=>{0===e.code&&(this.dropdowns.allPowerStation=e.data)}))},getDetail(){(0,y.e4)({uuid:this.data["uuid"]}).then((e=>{0===e.code&&(this.equipmentForm={...this.data,assetPortVoList:e.data.ports})}))},addMacidValidator(){const e=this;this.$nextTick((()=>{e.$refs["equipment-form"].rules.macId.find((e=>e.validator))||e.$refs["equipment-form"].rules.macId.push({validator:(e,t,r)=>{(0,y.JK)({macId:t}).then((e=>{e.data?r():r(new Error("mac/ID 设备编号重复"))}))},trigger:"blur"})}))},deleteMacidValidator(){const e=this;this.$nextTick((()=>{e.$refs["equipment-form"].rules.macId.forEach(((e,t)=>{e.validator&&(e.validator=null)}))}))},addPortBillForm(){if(""===this.equipmentForm.stationUuid)return this.$message.error("请先选择所属站");this.equipmentForm.assetPortVoList.push({chargerNo:"",portCurrent:"",portPower:"",portRatedVolt:"",portMsgDetail:"",frequency:"50",rate:"1",modelIdr:""})},deletePortBill(e){this.equipmentForm.assetPortVoList.splice(e,1)},openBillingModel(e){this.billingModelVisible=!0,this.editIndex=e.$index},closeBillingModel(e){this.billingModelVisible=e},bindBillingModel(e){this.equipmentForm.assetPortVoList[this.editIndex].modelIdr=e.id},submitForm(){this.$refs["equipment-form"].validate((e=>{if(e){const e={addEquipment:y.ag,modificationEquipment:y.sx};e["新增"===this.formTitle?"addEquipment":"modificationEquipment"](this.equipmentForm).then((e=>{0===e.code&&(this.$message.success(e.msg),this.close(),this.$emit("success"))}))}}))},close(){this.$refs["equipment-form"].resetFields();for(let e in this.equipmentForm)this.equipmentForm[e]="assetPortVoList"===e?[]:"";this.$emit("close",!1)}}};const F={stationUuid:"",stakeNo:"",stakeName:"",stationNo:"",stakeCatagory:"",equipModelUuid:"",macId:"",productId:"",firewareVersion:"",nbCard:"",batch:"",factoryNo:"",factoryDate:"",ratedCurrent:"",ratedVolt:"",power:"",msgDetail:"",assetPortVoList:[]},w={stationUuid:[{required:!0,message:"请选择所属站",trigger:"change"}],stakeCatagory:[{required:!0,message:"请选择设备类型",trigger:"change"}],equipModelUuid:[{required:!0,message:"请选择设备型号",trigger:"change"}],stakeName:[{required:!0,message:"请输入设备名称",trigger:"blur"},{pattern:/^[^<|>|(|)|+|-|*|/|%|=|{|}]*$/,message:"禁止< > ( ) + - * / % = { }等特殊字符",trigger:"blur"},{min:2,max:24,message:"长度在 2 到 5 个字24",trigger:"blur"}],nbCard:[{pattern:/^[^<|>|(|)|+|-|*|/|%|=|{|}]*$/,message:"禁止< > ( ) + - * / % = { }等特殊字符",trigger:"blur"},{min:3,max:48,message:"长度在 3 到 48 个字符",trigger:"blur"}],batch:[{required:!0,message:"请输入批次号",trigger:"blur"},{pattern:/^[^<|>|(|)|+|-|*|/|%|=|{|}]*$/,message:"禁止< > ( ) + - * / % = { }等特殊字符",trigger:"blur"},{min:3,max:48,message:"长度在 3 到 48 个字符",trigger:"blur"}],factoryNo:[{required:!0,message:"请输入出厂编号",trigger:"blur"},{pattern:/^[^<|>|(|)|+|-|*|/|%|=|{|}]*$/,message:"禁止< > ( ) + - * / % = { }等特殊字符",trigger:"blur"},{min:3,max:48,message:"长度在 3 到 48 个字符",trigger:"blur"}],productId:[{required:!0,message:"请输入产品ID",trigger:"blur"},{pattern:/^[^<|>|(|)|+|-|*|/|%|=|{|}]*$/,message:"禁止< > ( ) + - * / % = { }等特殊字符",trigger:"blur"},{min:3,max:64,message:"长度在 3 到 64 个字符",trigger:"blur"}],firewareVersion:[{required:!0,message:"请输入固件版本号",trigger:"blur"},{pattern:/^[^<|>|(|)|+|-|*|/|%|=|{|}]*$/,message:"禁止< > ( ) + - * / % = { }等特殊字符",trigger:"blur"},{min:3,max:64,message:"长度在 3 到 64 个字符",trigger:"blur"}],macId:[{required:!0,message:"请输入MAC/ID",trigger:"blur"},{pattern:/^[^<|>|(|)|+|-|*|/|%|=|{|}]*$/,message:"禁止< > ( ) + - * / % = { }等特殊字符",trigger:"blur"},{min:3,max:48,message:"长度在 3 到 48 个字符",trigger:"blur"}],factoryDate:[{required:!0,message:"请选择出厂日期",trigger:"change"}],chargerNo:[{required:!0,message:" ",trigger:"change"}],portCurrent:[{required:!0,message:" ",trigger:"blur"}],portRatedVolt:[{required:!0,message:" ",trigger:"blur"}],portPower:[{required:!0,message:" ",trigger:"blur"}]};var k=q,v=(0,c.Z)(k,g,h,!1,null,"799e7e0c",null),$=v.exports}}]);