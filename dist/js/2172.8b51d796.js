"use strict";(self["webpackChunkiov_platform"]=self["webpackChunkiov_platform"]||[]).push([[2172],{52172:function(e,t,a){a.r(t),a.d(t,{default:function(){return _}});var o=a(63598),i=a(71377),l=a(12025),s=a(66654),r=a(75267),n=a(67539),c=function(){var e=this,t=e._self._c;return t("el-card",{staticClass:"ammeter"},[t(n.Z,{attrs:{loading:e.loading,btnSpan:20,getData:e.getData,queryReset:e.queryReset}},[t("el-col",{attrs:{span:4}},[t(r.Z,{attrs:{clearable:"",size:"medium",placeholder:"设备编号"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.deviceName,callback:function(t){e.$set(e.queryForm,"deviceName",t)},expression:"queryForm.deviceName"}})],1),t("el-col",{attrs:{span:4}},[t(r.Z,{attrs:{clearable:"",size:"medium",placeholder:"SIM卡号"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.deviceNb,callback:function(t){e.$set(e.queryForm,"deviceNb",t)},expression:"queryForm.deviceNb"}})],1),t("el-col",{attrs:{span:4}},[t(s.Z,{attrs:{animatLable:"",placeholder:"归属区域"},on:{change:e.pageReset},model:{value:e.queryForm.deviceAddr,callback:function(t){e.$set(e.queryForm,"deviceAddr",t)},expression:"queryForm.deviceAddr"}})],1),t("el-col",{attrs:{span:4}},[t(l.Z,{attrs:{animatLable:""},model:{value:e.queryForm.deviceStationNo,callback:function(t){e.$set(e.queryForm,"deviceStationNo",t)},expression:"queryForm.deviceStationNo"}})],1),t("el-col",{attrs:{span:4}},[t(i["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"设备状态"},on:{change:e.pageReset},model:{value:e.queryForm.deviceStatus,callback:function(t){e.$set(e.queryForm,"deviceStatus",t)},expression:"queryForm.deviceStatus"}},e._l(e.dropdowns.deviceStatus,(function(e,a){return t("el-option",{key:a,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t(i["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"在线状态"},on:{change:e.pageReset},model:{value:e.queryForm.deviceLineStatus,callback:function(t){e.$set(e.queryForm,"deviceLineStatus",t)},expression:"queryForm.deviceLineStatus"}},e._l(e.dropdowns.deviceLineStatus,(function(e,a){return t("el-option",{key:a,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t(i["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"开关状态"},on:{change:e.pageReset},model:{value:e.queryForm.deviceState,callback:function(t){e.$set(e.queryForm,"deviceState",t)},expression:"queryForm.deviceState"}},e._l(e.dropdowns.deviceState,(function(e,a){return t("el-option",{key:a,attrs:{label:e.code_name,value:e.code_value}})})),1)],1)],1),t("el-divider"),t(o.Z,{ref:"table",attrs:{loading:e.loading,total:e.total,data:e.tableData,height:"530","row-key":"device_name","page-size":e.queryForm.pageSize,"current-page":e.queryForm.pageNum,derive:e.exporting},on:{"size-change":e.dataSizeChange,"current-change":e.handleCurrentChange},scopedSlots:e._u([{key:"left",fn:function(){return[t("el-button",{attrs:{size:"small",icon:"el-icon-plus"},on:{click:function(t){return e.editing("add")}}},[e._v("新增")]),t("el-button",{attrs:{size:"small",icon:"el-icon-refresh",title:"同步所有空开"},on:{click:e.asyncing}},[e._v("同步")]),t("el-button",{attrs:{size:"small",icon:"el-icon-download"},on:{click:e.downloadTemplate}},[e._v(" 空开模板下载 ")]),t("el-button",{attrs:{size:"small",icon:"el-icon-document-checked"},on:{click:function(t){e.importTemplateVisible=!0}}},[e._v(" 空开数据导入 ")])]},proxy:!0},{key:"columns",fn:function(){return[t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"设备编号",prop:"deviceName"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"设备型号",prop:"typeCategory"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"SIM卡号",prop:"deviceNb"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"固件版本",prop:"version"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"所属站",prop:"deviceStationName"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"deviceAddr",label:"归属区域"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.deviceAddr,e.dropdowns.deviceAddr,{name:"construction",value:"uuid"}))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"详细地址",prop:"deviceAddrDetail"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"deviceStatus",label:"运行状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.deviceStatus,e.dropdowns.deviceStatus))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"deviceLineStatus",label:"在线情况"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.deviceLineStatus,e.dropdowns.deviceLineStatus))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"deviceState",label:"开关状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.deviceState,e.dropdowns.deviceState))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"同步时间",prop:"deviceUpdateTime"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.deviceUpdateTime.slice(5))+" ")]}}])}),t("el-table-column",{attrs:{label:"操作",width:"160",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"function_edit",expression:"'function_edit'"}],attrs:{plain:"",type:"primary",size:"mini"},on:{click:function(t){return e.editing("modification",a.row)}}},[e._v(" 详情 ")]),t("el-dropdown",{staticClass:"ms-2",on:{command:function(t){return e.moreHandles(t,a.row)}}},[t("el-button",{attrs:{plain:"",size:"mini"}},[e._v(" 更多"),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[""===a.row.deviceState||"0"===a.row.deviceState?t("el-dropdown-item",{attrs:{command:"0"}},[e._v("合闸")]):e._e(),"1"===a.row.deviceState?t("el-dropdown-item",{attrs:{command:"1"}},[e._v("分闸")]):e._e(),t("el-dropdown-item",{attrs:{command:"2",divided:""}},[e._v(" "+e._s("正常"===a.row.deviceStatus?"停用":"启用")+" ")])],1)],1)]}}])})]},proxy:!0}])}),t("switch-detail",{attrs:{show:e.showEditFormDialogrVisible,data:e.ammeterForm},on:{close:e.clsoeEditFormDialogr,success:e.getData}}),t("el-dialog",{staticClass:"watch-import-dialog",attrs:{"close-on-click-modal":!1,"append-to-body":!0,"modal-append-to-body":!1,title:"空开导入",visible:e.importTemplateVisible,"show-close":!1}},[t("el-upload",{ref:"importTemplate",staticStyle:{"text-align":"center"},attrs:{drag:"",limit:1,"auto-upload":!1,headers:e.importTemplateHeaders,action:"",accept:"application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","on-change":e.selectSwitchTemplate}},[t("i",{staticClass:"el-icon-upload"}),t("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),t("em",[e._v("选择文件")])]),t("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v(" excel请按照模板提供的格式填写上传，下载的模板请先删除示例数据，再填写 ")])]),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.importTemplateVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.importTemplate}},[e._v("上 传")])],1)],1)],1)},d=[],u=a(74713),m=a(5376),p=a(24779),v=a(1161),h=a(86867),f=a(90886),g=a(30741),w={name:"property-air-switch-index",mixins:[g.Q5,g.LI,g.I_,g.oA,g.vd],filters:{transfortext:f.h},components:{"switch-detail":()=>a.e(8985).then(a.bind(a,18985))},directives:{permission:h.rd},data(){return{loading:!1,dropdowns:{status:[],deviceName:[],category:[],deviceAddr:[],deviceAddrDetail:[],deviceLineStatus:[],deviceState:[]},queryForm:{deviceName:"",deviceNb:"",deviceAddr:"",deviceStationNo:"",deviceStatus:"",deviceState:"",deviceLineStatus:"",pageSize:this.$tableDataSize,pageNum:1},tableData:[],total:0,showVelationshipStatonVisible:!1,ammeterBindStationForm:{stationNo:[],names:[]},ammeterForm:{},importTemplateVisible:!1,importTemplateHeaders:{Authorization:`Bearer ${localStorage.getItem("token")}`},importTemplateURL:"",importTemplateLoading:null}},created(){this.importTemplateURL="https://clw.edo-iot.com/yscar/assetStake/switch/importData",this.getDropdowns()},methods:{getDropdowns(){(0,m.Wl)("3004").then((e=>{0===e.code&&(this.dropdowns.deviceName=e.data)})),(0,m.Wl)("3006").then((e=>{0===e.code&&(this.dropdowns.deviceStatus=e.data)})),(0,m.Wl)("45260").then((e=>{0===e.code&&(this.dropdowns.deviceLineStatus=e.data)})),(0,m.Wl)("45262").then((e=>{0===e.code&&(this.dropdowns.deviceState=e.data)})),(0,p.ao)({}).then((e=>{0===e.code&&(this.dropdowns.deviceAddr=e.rows)}))},getData(){this.loading=!0,this.tableData=[],(0,u.F0)(this.queryForm).then((e=>{this.loading=!1,0===e.code&&(this.total=e.total,this.tableData=e.rows)})).catch((()=>{this.loading=!1}))},editing(e,t){this.showEditFormDialogrVisible=!0,this.ammeterForm="add"===this.type?{}:{...t}},asyncing(){(0,u.J6)({}).then((e=>{0===e.code&&(this.$message.success("同步成功"),this.getData())}))},moreHandles(e,t){switch(e){case"0":if("离线"===t.deviceLineStatus){this.$message.warning("离线设备不允许合闸！");break}this.switchOn({deviceName:t.deviceName,productKey:t.deviceProductKey});break;case"1":if("离线"===t.deviceLineStatus){this.$message.warning("离线设备不允许分闸！");break}this.switchOut({deviceName:t.deviceName,productKey:t.deviceProductKey});break;case"2":this.handelAmmeter({deviceName:t.deviceName,deviceStatus:"正常"===t.deviceStatus?"2":"1"});break}},switchOut(e){this.$confirm("是否确定分闸？","分闸提醒",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"放弃"}).then((()=>{(0,u.cf)(e).then((e=>{0===e.code&&(this.$message.success(e.msg),this.getData())}))}))},switchOn(e){(0,u.l8)(e).then((e=>{0===e.code&&(this.$message.success(e.msg),this.getData())}))},handelAmmeter(e){(0,u.ib)(e).then((e=>{0===e.code&&(this.$message.success(e.msg),this.getData())}))},downloadTemplate(){const e=[{"IMEI(设备编号)":"86482351111","设备名称":name+"03112","设备类型":name,"设备型号":"ML-200","NB卡号":"3213213213","批次号":"1111111","出厂编号":"4213215431","出厂日期":"2020-01-22 12:44:10","产品标识":"7665323144642124","设备密钥":"cc76w454321a2674j3g65"}];(0,v.rD)(e,"空开填写模板"),this.$message.info("使用前请将模板中的示例数据删掉")},importTemplate(){this.$refs.importTemplate.submit(),this.importTemplateLoading=this.$loading({target:".watch-import-dialog .el-dialog__body",lock:!0,text:"识别中",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.55)"})},selectSwitchTemplate(e){["xlsx","xls"].includes(e.name)&&this.$message({type:"warning",message:"非excel文件！请重新选择"})},clsoeEditFormDialogr(e){this.showEditFormDialogrVisible=e,this.ammeterForm={}},async exporting(e){let t={...this.queryForm};"2"===e&&(t.pageSize=this.total,t.pageNum=1);const a=await(0,u.F0)(t);if(0===a.code){const e=this.$refs.table.getColumns(),t=a.rows.map((t=>{let a=e.map((e=>[e.label,`${(0,f.h)(t[e.prop],this.dropdowns[e.prop])}`]));return Object.fromEntries(a)}));return t}}}},b=w,y=a(1001),S=(0,y.Z)(b,c,d,!1,null,"39ed91f6",null),_=S.exports}}]);