"use strict";(self["webpackChunkiov_platform"]=self["webpackChunkiov_platform"]||[]).push([[849],{80849:function(e,t,a){a.r(t),a.d(t,{default:function(){return v}});var o=a(63598),l=a(1985),r=a(66654),s=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:e.editTypeTransText,"append-to-body":!0,"modal-append-to-body":!1,"close-on-click-modal":!1,visible:e.show,"before-close":e.close}},[t("el-tabs",{attrs:{type:"card"},model:{value:e.nowTab,callback:function(t){e.nowTab=t},expression:"nowTab"}},[t("el-tab-pane",{attrs:{label:"清分配置",name:"1"}},[t("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules,"label-width":"130px"}},[t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.form.id,expression:"form.id"}],attrs:{label:"清分编号",prop:"ruleNo"}},[t("el-input",{attrs:{disabled:""},model:{value:e.form.ruleNo,callback:function(t){e.$set(e.form,"ruleNo",t)},expression:"form.ruleNo"}})],1),t("el-form-item",{attrs:{label:"选择商户",prop:"merchantNo"}},[t(l.Z,{attrs:{placeholder:""},on:{input:e.selectMerchant},model:{value:e.form.merchantNo,callback:function(t){e.$set(e.form,"merchantNo",t)},expression:"form.merchantNo"}})],1),t("el-form-item",{attrs:{label:"清分类型",prop:"clearType"}},[t("el-select",{attrs:{filterable:"",clearable:"","default-first-option":"",placeholder:""},model:{value:e.form.clearType,callback:function(t){e.$set(e.form,"clearType",t)},expression:"form.clearType"}},e._l(e.dropdowns.clearType,(function(e,a){return t("el-option",{key:a,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),"1"===e.form.clearType?t("el-form-item",{attrs:{label:"清分商户",prop:"openid"}},[t("el-input",{attrs:{clearable:""},model:{value:e.form.openid,callback:function(t){e.$set(e.form,"openid",t)},expression:"form.openid"}})],1):t("el-form-item",{attrs:{label:"清分周期",prop:"clearCycle"}},[t("el-select",{attrs:{filterable:"",clearable:"","default-first-option":"",placeholder:""},model:{value:e.form.clearCycle,callback:function(t){e.$set(e.form,"clearCycle",t)},expression:"form.clearCycle"}},e._l(31,(function(e){return t("el-option",{key:e+"",attrs:{label:"每月 "+e+" 日",value:e+""}})})),1)],1),t("el-form-item",{attrs:{label:"清分原则",prop:"clearRule"}},[t("el-select",{attrs:{filterable:"",clearable:"","default-first-option":"",placeholder:""},model:{value:e.form.clearRule,callback:function(t){e.$set(e.form,"clearRule",t)},expression:"form.clearRule"}},e._l(e.dropdowns.clearRule,(function(e,a){return t("el-option",{key:a,attrs:{label:e.code_name,value:e.code_value}})})),1),t("el-card",{directives:[{name:"show",rawName:"v-show",value:""!==e.form.clearRule,expression:"form.clearRule !== ''"}]},[t("clear-rule",{ref:"clear-rule",attrs:{show:""!==e.form.clearRule,"rule-code":e.form.clearRule,data:e.form},on:{submit:e.submitClearRule}})],1)],1),t("el-form-item",{attrs:{label:"清分模式",prop:"merchantCode"}},[t("el-select",{attrs:{filterable:"",clearable:"","default-first-option":"",placeholder:""},model:{value:e.form.merchantCode,callback:function(t){e.$set(e.form,"merchantCode",t)},expression:"form.merchantCode"}},e._l(e.dropdowns.merchantCode,(function(e,a){return t("el-option",{key:a,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-form-item",{attrs:{label:"失效时间",prop:"endTime"}},[t("el-date-picker",{attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"","picker-options":e.pickerOptions},model:{value:e.form.endTime,callback:function(t){e.$set(e.form,"endTime",t)},expression:"form.endTime"}})],1)],1)],1),t("el-tab-pane",{attrs:{label:"清分范围",name:"2"}},[t("el-row",{staticClass:"m-0 filters",attrs:{gutter:20}},[t("el-col",{attrs:{span:4}},[t("el-input",{attrs:{clearable:"",size:"small",placeholder:"站编号"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.stationNo,callback:function(t){e.$set(e.queryForm,"stationNo",t)},expression:"queryForm.stationNo"}})],1),t("el-col",{attrs:{span:4}},[t("el-input",{attrs:{clearable:"",size:"small",placeholder:"站名称"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.stationName,callback:function(t){e.$set(e.queryForm,"stationName",t)},expression:"queryForm.stationName"}})],1),t("el-col",{attrs:{span:4}},[t(r.Z,{attrs:{size:"small"},on:{change:e.pageReset},model:{value:e.queryForm.constructionUuid,callback:function(t){e.$set(e.queryForm,"constructionUuid",t)},expression:"queryForm.constructionUuid"}})],1),t("el-col",{attrs:{span:4}},[t("el-input",{attrs:{clearable:"",size:"small",placeholder:"站负责人"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.leader,callback:function(t){e.$set(e.queryForm,"leader",t)},expression:"queryForm.leader"}})],1),t("el-col",{attrs:{span:4}},[t(l.Z,{attrs:{size:"small",placeholder:"筛选商户"},model:{value:e.queryForm.merchantNo,callback:function(t){e.$set(e.queryForm,"merchantNo",t)},expression:"queryForm.merchantNo"}})],1),t("el-col",{attrs:{span:4}},[t("el-select",{attrs:{filterable:"","default-first-option":"",clearable:"",size:"small",placeholder:"站类别"},on:{change:e.pageReset},model:{value:e.queryForm.stationCatagory,callback:function(t){e.$set(e.queryForm,"stationCatagory",t)},expression:"queryForm.stationCatagory"}},e._l(e.dropdowns.category,(function(e,a){return t("el-option",{key:a,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t("el-select",{attrs:{filterable:"","default-first-option":"",clearable:"",size:"small",placeholder:"使用状态"},on:{change:e.pageReset},model:{value:e.queryForm.stationStatus,callback:function(t){e.$set(e.queryForm,"stationStatus",t)},expression:"queryForm.stationStatus"}},e._l(e.dropdowns.stationStatus,(function(e,a){return t("el-option",{key:a,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{staticClass:"text-end",attrs:{span:20}},[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.getData}},[e._v("搜索")]),t("el-button",{attrs:{size:"small"},on:{click:e.queryReset}},[e._v("重置")])],1)],1),t(o.Z,{ref:"table",staticClass:"mt-3",attrs:{loading:e.loading,total:e.total,data:e.tableData,height:"350","row-key":"stationNo"},on:{"selection-change":e.selectingData},scopedSlots:e._u([{key:"left",fn:function(){return[t("el-button",{attrs:{size:"small"},on:{click:e.selectAll}},[e._v("全选")]),t("el-button",{attrs:{size:"small"},on:{click:e.clearSelection}},[e._v("清空选择")])]},proxy:!0},{key:"columns",fn:function(){return[t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"站编号",prop:"stationNo"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"站名称",prop:"stationName"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"站地址",prop:"address"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"隶属区域",prop:"constructionUuid"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.constructionUuid,e.dropdowns.constructionUuid,{name:"construction",value:"uuid"}))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"运营时间",prop:"operationTime"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"负责人",prop:"leader"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"联系方式",prop:"phone"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"站类别"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.stationCatagory,e.dropdowns.category))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"供电性质"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.powerType,e.dropdowns.nature))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"状态",prop:"stationStatus"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.stationStatus,e.dropdowns.stationStatus))+" ")]}}])})]},proxy:!0}])})],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.validate}},[e._v("提交")]),t("el-button",{on:{click:e.close}},[e._v("关闭")])],1)],1)},n=[],i=a(25335),c=a(5376),u=a(24779),m=a(74713),d=a(90886),p=a(30741),f={name:"",mixins:[p.I_,p.LI],components:{"clear-rule":()=>a.e(277).then(a.bind(a,80277))},filters:{transfortext:d.h},props:{show:{type:Boolean},data:{type:Object}},watch:{show(e,t){e&&(this.getDropdowns(),this.nowTab="1",this.queryForm.merchantNo=this.data.merchantNo||"",this.getData())},data(e,t){e.id&&this.getDetail()}},data(){return this.rules=b,{nowTab:"1",pickerOptions:{disabledDate(e){return e.getTime()<Date.now()}},form:h,dropdowns:{clearType:[],clearRule:[],merchantCode:[],organization:[],category:[],stationStatus:[],nature:[],constructionUuid:[]},loading:!1,queryForm:{stationNo:"",stationName:"",constructionUuid:"",leader:"",merchantNo:"",stationCatagory:"",stationStatus:""},tableData:[],total:0}},computed:{editTypeTransText(){switch(this.type){case"0":return"新增清分配置";case"1":return`${this.form.merchantName}的清分配置`;default:return"清分配置"}}},methods:{getDropdowns(){(0,c.Wl)("357131").then((e=>{0===e.code&&(this.dropdowns.clearType=e.data)})),(0,c.Wl)("758195").then((e=>{0===e.code&&(this.dropdowns.clearRule=e.data)})),(0,c.Wl)("978251").then((e=>{0===e.code&&(this.dropdowns.merchantCode=e.data)})),(0,c.eL)().then((e=>{this.dropdowns.organization=e})),(0,c.Wl)("3000").then((e=>{0===e.code&&(this.dropdowns.category=e.data)})),(0,c.Wl)("3001").then((e=>{0===e.code&&(this.dropdowns.stationStatus=e.data)})),(0,c.Wl)("3008").then((e=>{0===e.code&&(this.dropdowns.nature=e.data)})),(0,u.ao)({}).then((e=>{0===e.code&&(this.dropdowns.constructionUuid=e.rows)}))},getData(){this.loading=!0,(0,m.cV)({...this.queryForm,pageSize:999999999,pageNum:1}).then((e=>{0===e.code&&(this.loading=!1,this.tableData=e.rows)})).catch((()=>{this.loading=!1}))},getDetail(){(0,i.Jy)({id:this.data.id}).then((e=>{0===e.code&&(this.form=e.data,this.form.stationList.length>0&&this.tableData.length>0&&this.$nextTick((()=>{for(let e of this.form.stationList)for(let t of this.tableData)e===t.stationNo&&this.$refs["table"].toggleRowSelection(t)})))}))},reset(){this.clearParmas(),this.getData()},clearParmas(){for(let e in this.queryForm)this.queryForm[e]=""},selectingData(e){this.form.stationList=e.map((e=>e.stationNo))},clearSelection(){this.$refs["table"].clearSelection()},selectAll(){this.$refs["table"].toggleAllSelection()},selectMerchant(e){this.form.merchantName=this.dropdowns.organization.find((t=>e===t.deptCode)).label},submitClearRule(e){this.form.clearingRuleItemList=e.clearingRuleItemList},validate(){this.$refs["ruleForm"].validate((e=>{const t=this.$refs["clear-rule"].submitForm();e&&t&&(this.form.id&&"0"!==this.form.approvalStatus?this.$alert("保存将会生成新的清分配置","提醒",{callback:e=>{"confirm"===e&&this.submit()}}):this.submit())}))},submit(){const e={updateClearRule:i.xt,addClearRule:i.pF};let t=this.form.id&&"0"===this.form.approvalStatus?"updateClearRule":"addClearRule";e[t](this.form).then((e=>{0===e.code&&(this.$emit("success"),this.close())}))},close(){this.clearSelection(),this.$refs.ruleForm.resetFields(),this.$refs["clear-rule"].resetFields(),this.$emit("close",!1),this.form=h}}};const h={clearRule:"",clearCycle:"",clearType:"",openid:"",endTime:"",beginTime:"",merchantNo:"",merchantName:"",ruleName:"",ruleNo:"",merchantCode:"",stationList:[],clearingRuleItemList:[]},b={merchantNo:[{required:!0,message:"请选择配置的商户",trigger:"change"}],stationList:[{required:!0,message:"请选择商户清分绑定的电站",trigger:"change"}],clearRule:[{required:!0,message:"请选择清分规则",trigger:"change"}],openid:[{required:!0,message:"请输入微信商户的转账openid",trigger:"change"}],clearCycle:[{required:!0,message:"请选择清分周期",trigger:"change"}],clearType:[{required:!0,message:"请选择结算类型",trigger:"change"}],merchantCode:[{required:!0,message:"请选择清分模式",trigger:"change"}],endTime:[{required:!0,message:"请选择失效时间",trigger:"change"}]};var y=f,g=a(1001),w=(0,g.Z)(y,s,n,!1,null,"51fbf7ab",null),v=w.exports}}]);