"use strict";(self["webpackChunkiov_platform"]=self["webpackChunkiov_platform"]||[]).push([[9642],{29642:function(t,e,a){a.r(e),a.d(e,{default:function(){return b}});var s=a(63598),o=a(71377),r=a(75267),l=a(67539),i=function(){var t=this,e=t._self._c;return e("el-card",{staticClass:"withdraw content"},[e(l.Z,{attrs:{loading:t.loading,getData:t.getData,queryReset:t.queryReset}},[e("el-col",{attrs:{span:4}},[e(r.Z,{attrs:{clearable:"",size:"medium",placeholder:"提现单号"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.getData.apply(null,arguments)}},model:{value:t.queryForm.refundOrder,callback:function(e){t.$set(t.queryForm,"refundOrder",e)},expression:"queryForm.refundOrder"}})],1),e("el-col",{attrs:{span:4}},[e(r.Z,{attrs:{clearable:"",size:"medium",placeholder:"提现人账号"},on:{change:t.pageReset},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.getData.apply(null,arguments)}},model:{value:t.queryForm.userId,callback:function(e){t.$set(t.queryForm,"userId",e)},expression:"queryForm.userId"}})],1),e("el-col",{attrs:{span:4}},[e(r.Z,{attrs:{clearable:"",size:"medium",placeholder:"手机号"},on:{change:t.pageReset},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.getData.apply(null,arguments)}},model:{value:t.queryForm.phoneNumber,callback:function(e){t.$set(t.queryForm,"phoneNumber",e)},expression:"queryForm.phoneNumber"}})],1),e("el-col",{attrs:{span:4}},[e(o["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"提现审核状态"},on:{change:t.pageReset},model:{value:t.queryForm.appStatus,callback:function(e){t.$set(t.queryForm,"appStatus",e)},expression:"queryForm.appStatus"}},t._l(t.dropdowns.approveStatus,(function(t,a){return e("el-option",{key:a,attrs:{label:t.code_name,value:t.code_value}})})),1)],1),e("el-col",{attrs:{span:4}},[e(o["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"退款结果"},on:{change:t.pageReset},model:{value:t.queryForm.status,callback:function(e){t.$set(t.queryForm,"status",e)},expression:"queryForm.status"}},t._l(t.dropdowns.refundStatus,(function(t,a){return e("el-option",{key:a,attrs:{label:t.code_name,value:t.code_value}})})),1)],1)],1),e("el-divider"),e(s.Z,{ref:"table",attrs:{loading:t.loading,total:t.total,data:t.tableData,height:"540","row-key":"refundOrder","page-size":t.queryForm.pageSize,"current-page":t.queryForm.pageNum,selecteisDisabled:t.showCheckbox,derive:t.exporting},on:{"selection-change":t.selectData,"size-change":t.dataSizeChange,"current-change":t.handleCurrentChange},scopedSlots:t._u([{key:"left",fn:function(){return[e("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"function_refund",expression:"'function_refund'"}],attrs:{size:"small"},on:{click:t.applyForRefund}},[t._v("退款")])]},proxy:!0},{key:"columns",fn:function(){return[e("el-table-column",{attrs:{prop:"userId",label:"申请人",width:"160","show-overflow-tooltip":!0}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"phoneNumber",label:"手机号",width:"110"}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"payTime",label:"支付时间",width:"165"}}),e("el-table-column",{attrs:{prop:"refundOrder",label:"提现单号",width:"160","show-overflow-tooltip":!0}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"createTime",label:"申请时间",width:"165"}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"hopeTime",label:"兑现时间",width:"165"}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"backMoney",label:"申请提现额",width:"100"}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"type",label:"提现理由"}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"reason",label:"具体原因"}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"approveStatus",label:"提现状态",width:"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("transfortext")(e.row.approveStatus,t.dropdowns.approveStatus))+" ")]}}])}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"审核情况",width:"340","class-name":"audit-class"},scopedSlots:t._u([{key:"default",fn:function(a){return[t._l(t.dropdowns.approveStatus,(function(s,o){return[a.row["examStatus"+o]?e("div",{key:s.code_value,staticStyle:{"white-space":"normal"},attrs:{title:s.code_name}},[e("div",[e("span",[t._v("审核角色：")]),e("span",{staticClass:"text-warmgray"},[t._v(t._s(s.code_name))])]),e("div",[e("span",[t._v("审核人：")]),e("span",{staticClass:"text-warmgray"},[t._v(" "+t._s(a.row["approver"+o]))])]),e("div",[e("span",[t._v("审核状态：")]),e("span",{staticClass:"text-warmgray"},[t._v(t._s(t._f("transfortext")(a.row["examStatus"+o],t.dropdowns.status)))])]),e("div",[e("span",[t._v("审核时间：")]),e("span",{staticClass:"text-warmgray"},[t._v(" "+t._s(a.row["examineTime"+o]))])]),e("div",[e("span",[t._v(" 审核内容：")]),e("span",{staticClass:"text-warmgray"},[t._v(" "+t._s(a.row["content"+o]))])])]):t._e()]}))]}}])}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"退款结果"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("transfortext")(e.row.status,t.dropdowns.refundStatus))+" ")]}}])}),e("el-table-column",{attrs:{prop:"refundTransaction",label:"退款成功交易号",width:"160","show-overflow-tooltip":!0}}),e("el-table-column",{attrs:{label:"操作",fixed:"right",width:"160"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{plain:"",type:"primary",size:"mini"},on:{click:function(e){return t.detail(a.row)}}},[t._v("详情")]),e("el-dropdown",{staticClass:"ms-2",attrs:{trigger:"click"},on:{command:function(e){return t.handling(e,a.row)}}},[e("el-button",{attrs:{size:"mini"}},[t._v(" 更多"),e("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},["1"!==a.row.status?e("el-dropdown-item",{directives:[{name:"permission",rawName:"v-permission",value:"function_audit",expression:"'function_audit'"}],attrs:{command:"approvaling"}},[t._v("审核")]):t._e(),"1"!==a.row.examStatus1&&"1"!==a.row.examStatus2&&"1"!==a.row.examStatus3||"1"===a.row.status?t._e():e("el-dropdown-item",{directives:[{name:"permission",rawName:"v-permission",value:"function_refund",expression:"'function_refund'"}],attrs:{command:"applyForRefund"}},[t._v("退款")])],1)],1)]}}])})]},proxy:!0}])}),e("el-dialog",{staticClass:"withdraw-detail-dialog",attrs:{"close-on-click-modal":!1,"append-to-body":!0,"modal-append-to-body":!1,title:"提现详情",visible:t.showDetailVisible,"show-close":!1,width:"600px"}},[e("div",{staticClass:"title"},[t._v(" ￥ "),e("span",{staticClass:"money"},[t._v(t._s(t.withdrawDetail.backMoney))]),t._v(" 元 ")]),"1"===t.withdrawDetail.approveStatus?e("el-alert",{staticClass:"mt-5 mb-5",attrs:{center:"",type:"warning",title:"待审核",closable:!1}}):e("el-steps",{staticClass:"mt-5 mb-5",attrs:{active:parseInt(t.withdrawDetail.approveStatus)-1,"align-center":""}},t._l(t.dropdowns.approveStatus,(function(a,s){return e("el-step",{key:a.code_value,attrs:{title:a.code_name},scopedSlots:t._u([{key:"description",fn:function(){return[0!==s?e("span",[t._v(" "+t._s(t._f("transfortext")(t.withdrawDetail["status"+s],t.dropdowns.status))+" ")]):t._e()]},proxy:!0}],null,!0)})})),1),e("div",{staticClass:"detail"},[e("div",{staticClass:"item"},[e("div",{staticClass:"title"},[t._v("账号")]),e("div",[t._v(t._s(t.withdrawDetail.userId))])]),e("div",{staticClass:"item"},[e("div",{staticClass:"title"},[t._v("手机号")]),e("div",[t._v(t._s(t.withdrawDetail.phoneNumber))])]),e("div",{staticClass:"item"},[e("div",{staticClass:"title"},[t._v("申请时间")]),e("div",[t._v(t._s(t.withdrawDetail.createTime))])]),e("div",{staticClass:"item"},[e("div",{staticClass:"title"},[t._v("兑现时间")]),e("div",[t._v(t._s(t.withdrawDetail.hopeTime))])]),e("div",{staticClass:"item"},[e("div",{staticClass:"title"},[t._v("提现单号")]),e("div",[t._v(t._s(t.withdrawDetail.refundOrder))])]),e("div",{staticClass:"item"},[e("div",{staticClass:"title"},[t._v("账户余额")]),e("div",[t._v(t._s(t.withdrawDetail.balance))])]),e("div",{staticClass:"item"},[e("div",{staticClass:"title"},[t._v("微信交易号")]),e("div",[t._v(t._s(t.withdrawDetail.transactionId))])]),t.withdrawDetail.refundTime?e("div",{staticClass:"item"},[e("div",{staticClass:"title"},[t._v("退款时间")]),e("div",[t._v(t._s(t.withdrawDetail.refundTime))])]):t._e(),t.withdrawDetail.refundTransaction?e("div",{staticClass:"item"},[e("div",{staticClass:"title"},[t._v("交易号")]),e("div",[t._v(t._s(t.withdrawDetail.refundTransaction))])]):t._e(),e("div",{staticClass:"item"},[e("div",{staticClass:"title"},[t._v("支付状态")]),"0"===t.withdrawDetail.payStatus?e("div",[t._v("未操作")]):t._e(),"1"===t.withdrawDetail.payStatus?e("div",[t._v("已支付")]):t._e(),"2"===t.withdrawDetail.payStatus?e("div",[t._v("未支付")]):t._e()]),e("div",{staticClass:"item"},[e("div",{staticClass:"title"},[t._v("支付号")]),e("div",[t._v(t._s(t.withdrawDetail.payNo))])])]),e("span",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:function(e){t.showDetailVisible=!1}}},[t._v("知道了")])],1)],1),e("el-dialog",{attrs:{"close-on-click-modal":!1,"append-to-body":!0,"modal-append-to-body":!1,title:"账户变动记录",visible:t.showAccountLogsVisible,"show-close":!1}},[e(s.Z,{ref:"invoiceByOrders-table",attrs:{"max-height":"450",size:"mini",data:t.accountLogsTableData},scopedSlots:t._u([{key:"columns",fn:function(){return[e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"date",label:"单号",width:"180"}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"name",label:"交易额",width:"180"}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"address",label:"时间"}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"address",label:"支付方式"}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"address",label:"业务类型"}})]},proxy:!0}])}),e("span",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:function(e){t.showAccountLogsVisible=!1}}},[t._v("知道了")])],1)],1),e("el-dialog",{attrs:{"close-on-click-modal":!1,"append-to-body":!0,"modal-append-to-body":!1,title:"审核",visible:t.showAuditVisible,"show-close":!1}},[e("el-form",{attrs:{model:t.auditForm,"label-width":"100px"}},[e("el-form-item",{attrs:{label:"处理状态：",prop:"status"}},[e("el-select",{attrs:{filterable:"","default-first-option":"",clearable:"",placeholder:"请选择审核状态"},model:{value:t.auditForm.status,callback:function(e){t.$set(t.auditForm,"status",e)},expression:"auditForm.status"}},t._l(t.dropdowns.status,(function(t){return e("el-option",{key:t.code_value,attrs:{label:t.code_name,value:t.code_value}})})),1)],1),e("el-form-item",{attrs:{label:"处理描述："}},[e("el-input",{attrs:{clearable:"",placeholder:"请输入处理描述"},model:{value:t.auditForm.content,callback:function(e){t.$set(t.auditForm,"content",e)},expression:"auditForm.content"}})],1)],1),e("span",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.showAuditVisible=!1}}},[t._v("关闭")]),e("el-button",{attrs:{type:"primary"},on:{click:t.submitAudit}},[t._v("确定")])],1)],1)],1)},n=[],d=(a(57658),a(25335)),u=a(5376),c=a(86867),p=a(90886),m=a(30741),w={name:"settlement-user-account-withdraw",mixins:[m.LI,m.I_,m.oA,m.vd],directives:{permission:c.rd},filters:{transfortext:p.h},data(){return{loading:!1,dropdowns:{refundStatus:[],approveStatus:[],status:[]},queryForm:{pageNum:1,pageSize:this.$tableDataSize,refundOrder:"",appStatus:"",phoneNumber:"",userId:"",userName:"",status:""},tableData:[],total:0,showDetailVisible:!1,withdrawDetail:{},showAccountLogsVisible:!1,accountLogsTableData:[],showAuditVisible:!1,auditForm:{status:"",content:"",refundOrder:""},moreSelectData:[]}},created(){this.getDropdowns()},methods:{getDropdowns(){(0,u.Wl)("3038").then((t=>{0===t.code&&(this.dropdowns.refundStatus=t.data)})),(0,u.Wl)("3039").then((t=>{0===t.code&&(this.dropdowns.approveStatus=t.data)})),(0,u.Wl)("401007").then((t=>{0===t.code&&(this.dropdowns.status=t.data)}))},showCheckbox(t){return("1"===t.examStatus1||"1"===t.examStatus2||"1"===t.examStatus3)&&"1"!==t.status},getData(){this.tableData=[],this.loading=!0,(0,d.wn)(this.queryForm).then((t=>{this.loading=!1,0===t.code&&(this.tableData=t.rows,this.total=t.total)})).catch((()=>{this.loading=!1}))},handling(t,e){this[t](e)},approvaling(t){this.auditForm={status:"",content:"",refundOrder:t.refundOrder},this.showAuditVisible=!0},selectData(t){this.moreSelectData=t},applyForRefund(t){if(t.refundOrder)this.refund({refundOrder:t.refundOrder,userId:t.userId,orderId:t.orderId,balance:t.receiveMoney,amount:t.backMoney,refundNo:t.refundOrder,backType:t.backType,transactionId:t.transactionId,totalMoney:t.receiveMoney,refundMoney:t.backMoney});else{if(this.moreSelectData.length<1)return this.$message.warning("请选择退款项"),!1;for(let t of this.moreSelectData)this.refund({refundOrder:t.refundOrder,userId:t.userId,orderId:t.orderId,balance:t.receiveMoney,amount:t.backMoney,refundNo:t.refundOrder,backType:t.backType,transactionId:t.transactionId,totalMoney:t.receiveMoney,refundMoney:t.backMoney})}},refund(t){(0,d.Q2)(t).then((t=>{if(0===t.code){let t;clearTimeout(t),t=setTimeout((()=>{this.$message({showClose:!0,message:"执行成功。结果稍有延迟，稍后请手动查询列表",type:"success",duration:6e3})}),500)}}))},detail(t){this.showDetailVisible=!0,(0,d.eL)({refundOrder:t.refundOrder}).then((t=>{0===t.code&&(this.withdrawDetail=t.data)}))},submitAudit(){if(""===this.auditForm.status)return this.$message.warning("请选择审核状态"),!1;(0,d.Us)(this.auditForm).then((t=>{0===t.code&&(this.showAuditVisible=!1,this.$message.success(t.msg),this.getData())}))},async exporting(t){let e={...this.queryForm};"2"===t&&(e.pageSize=this.total,e.pageNum=1);const a=await(0,d.wn)(e);if(0===a.code){const t=a.rows.map((t=>{let e=[];return this.dropdowns.approveStatus.filter(((a,s)=>{t["examStatus"+s]&&e.push({"审核角色":a.code_name,"审核人":t["approver"+s],"审核状态":`${(0,p.h)(t["examStatus"+s],this.dropdowns.status)}`,"审核时间":t["examineTime"+s],"审核内容":t["content"+s]})})),{"申请人账号":t.userId,"手机号":t.phoneNumber,"支付时间":t.payTime,"提现单号":t.refundOrder,"申请时间":t.createTime,"兑现时间":t.hopeTime,"申请提现额":t.backMoney,"提现原因":t.reason,"提现状态":`${(0,p.h)(t.approveStatus,this.dropdowns.approveStatus)}`,"审核情况":JSON.stringify(e),"退款结果":`${(0,p.h)(t.status,this.dropdowns.refundStatus)}`,"退款成功交易号":t.refundTransaction}}));return t}}}},v=w,h=a(1001),f=(0,h.Z)(v,i,n,!1,null,"83d0d210",null),b=f.exports}}]);