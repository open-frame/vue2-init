"use strict";(self["webpackChunkiov_platform"]=self["webpackChunkiov_platform"]||[]).push([[7280],{86867:function(e,t,o){o.d(t,{JG:function(){return i},rd:function(){return s}});var r=o(30153),a=o.n(r),l=o(72219);function s(e,t){const o=[...l.Z.state.permissionButtons,...l.Z.state.permissionRouters];o.includes(t.value)||e.parentNode&&e.parentNode.removeChild(e)}function i(e,t){e.onclick=function(){if(!t.value&&!e.innerText)return;let o=document.createElement("textarea");o.readOnly="readonly",o.value=t.value||e.innerText,e.appendChild(o),o.select();const r=document.execCommand("Copy");r?a().success({duration:1800,title:"复制成功",message:o.value,type:"success"}):a().error({title:"错误",message:"复制失败"}),e.removeChild(o)}}},17280:function(e,t,o){o.r(t),o.d(t,{default:function(){return q}});var r=o(63598),a=o(71377),l=o(12025),s=o(66654),i=o(75267),n=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{"close-on-click-modal":!1,title:"选择电表","append-to-body":!0,"modal-append-to-body":!1,visible:e.show,"show-close":!1}},[t("el-row",{staticClass:"filters",attrs:{gutter:40}},[t("el-col",{attrs:{span:4}},[t(i.Z,{attrs:{clearable:"",size:"medium",placeholder:"电表编号"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.deviceName,callback:function(t){e.$set(e.queryForm,"deviceName",t)},expression:"queryForm.deviceName"}})],1),t("el-col",{attrs:{span:4}},[t(i.Z,{attrs:{clearable:"",size:"medium",placeholder:"地址编码"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.deviceAddrNo,callback:function(t){e.$set(e.queryForm,"deviceAddrNo",t)},expression:"queryForm.deviceAddrNo"}})],1),t("el-col",{attrs:{span:4}},[t(i.Z,{attrs:{clearable:"",size:"medium",placeholder:"SIM卡号"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.deviceNb,callback:function(t){e.$set(e.queryForm,"deviceNb",t)},expression:"queryForm.deviceNb"}})],1),t("el-col",{attrs:{span:4}},[t(s.Z,{attrs:{animatLable:"",placeholder:"归属区域"},on:{change:e.pageReset},model:{value:e.queryForm.deviceAddr,callback:function(t){e.$set(e.queryForm,"deviceAddr",t)},expression:"queryForm.deviceAddr"}})],1),t("el-col",{attrs:{span:4}},[t(l.Z,{attrs:{animatLable:""},model:{value:e.queryForm.stationNo,callback:function(t){e.$set(e.queryForm,"stationNo",t)},expression:"queryForm.stationNo"}})],1),t("el-col",{attrs:{span:4}},[t(a["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"使用状态"},on:{change:e.pageReset},model:{value:e.queryForm.device_status,callback:function(t){e.$set(e.queryForm,"device_status",t)},expression:"queryForm.device_status"}},e._l(e.dropdowns.status,(function(e,o){return t("el-option",{key:o,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t(a["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"在线状态"},on:{change:e.pageReset},model:{value:e.queryForm.device_line_status,callback:function(t){e.$set(e.queryForm,"device_line_status",t)},expression:"queryForm.device_line_status"}},e._l(e.dropdowns.device_line_status,(function(e,o){return t("el-option",{key:o,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{staticClass:"text-end",attrs:{span:20}},[t("el-button",{attrs:{size:"medium",type:"primary"},on:{click:e.getData}},[e._v("搜索")]),t("el-button",{attrs:{size:"medium"},on:{click:e.queryReset}},[e._v("重置")])],1)],1),t("el-divider"),t(r.Z,{ref:"table",attrs:{size:"mini",loading:e.loading,total:e.total,data:e.tableData,height:"530","row-key":"device_name","page-size":e.queryForm.pageSize,"current-page":e.queryForm.pageNum},on:{"selection-change":e.selectingData,"size-change":e.dataSizeChange,"current-change":e.handleCurrentChange},scopedSlots:e._u([{key:"columns",fn:function(){return[t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"电表编号",prop:"device_name"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"示数",prop:"papR"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"地址编码",prop:"device_addr_no"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"模块编号",prop:"device_model"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"归属区域"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.device_addr,e.dropdowns.constructionUuid,{name:"construction",value:"uuid"}))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"所属站"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.device_station_no,e.dropdowns.device_station_no,{name:"stationName",value:"stationNo"}))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"详细地址",prop:"device_addr_detail"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"设备类型",prop:"type"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"设备状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.device_status,e.dropdowns.status))+" ")]}}])}),t("el-table-column",{attrs:{label:"在线情况"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.device_line_status,e.dropdowns.device_line_status))+" ")]}}])}),t("el-table-column",{attrs:{label:"创建时间",prop:"device_create_time"}})]},proxy:!0}])}),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("确定")]),t("el-button",{on:{click:e.close}},[e._v("取消")])],1)],1)},m=[],d=o(74713),c=o(5376),u=o(24779),p=o(90886),f=o(86867),h=o(30741),v={name:"ammeter-table",mixins:[h.LI,h.I_,h.oA,h.vd],filters:{transfortext:p.h},directives:{permission:f.rd},props:{show:{type:Boolean,default:!1}},data(){return{loading:!1,dropdowns:{status:[],deviceName:[],category:[],constructionUuid:[],deviceAddrDetail:[],device_station_no:[],device_line_status:[]},queryForm:{deviceName:"",deviceAddrNo:"",stationNo:"",deviceNb:"",deviceAddr:"",device_status:"",device_line_status:"",pageSize:this.$tableDataSize,pageNum:1},tableData:[],total:0,selectedAmmeterData:[]}},watch:{show(e){e&&this.getDropdowns()}},methods:{getDropdowns(){(0,c.Wl)("3004").then((e=>{0===e.code&&(this.dropdowns.deviceName=e.data)})),(0,c.Wl)("3005").then((e=>{0===e.code&&(this.dropdowns.category=e.data)})),(0,c.Wl)("3006").then((e=>{0===e.code&&(this.dropdowns.status=e.data)})),(0,c.Wl)("1038").then((e=>{0===e.code&&(this.dropdowns.device_line_status=e.data)})),(0,u.ao)({}).then((e=>{0===e.code&&(this.dropdowns.constructionUuid=e.rows)})),(0,c.iS)().then((e=>{0===e.code&&(this.dropdowns.device_station_no=e.data)}))},getData(){this.tableData=[],this.loading=!0,(0,d.GM)(this.queryForm).then((e=>{this.loading=!1,0===e.code&&(this.total=e.total,this.tableData=e.rows)}))},selectingData(e){this.selectedAmmeterData=e},submit(){this.$emit("submit",this.selectedAmmeterData),this.close()},close(){this.$emit("close",!1),this.$refs.table.clearSelection()}}},b=v,_=o(1001),y=(0,_.Z)(b,n,m,!1,null,"9368ce98",null),g=y.exports,w=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{"close-on-click-modal":!1,title:e.dialogTitle,"append-to-body":!0,"modal-append-to-body":!1,visible:e.show,"show-close":!1}},[t("el-form",{ref:"ammeter-form",attrs:{model:e.ammeterForm,rules:e.ammeterFormRules,"label-width":"130px"}},[t("el-form-item",{attrs:{label:"预付费电表编号",prop:"prepaidMeterNo"}},[t("el-input",{model:{value:e.ammeterForm.prepaidMeterNo,callback:function(t){e.$set(e.ammeterForm,"prepaidMeterNo",t)},expression:"ammeterForm.prepaidMeterNo"}})],1),t("el-form-item",{attrs:{label:"预付费电表名称",prop:"prepaidMeterName"}},[t("el-input",{model:{value:e.ammeterForm.prepaidMeterName,callback:function(t){e.$set(e.ammeterForm,"prepaidMeterName",t)},expression:"ammeterForm.prepaidMeterName"}})],1),t("el-form-item",{attrs:{label:"电单价",prop:"unitPrice"}},[t("el-input",{attrs:{type:"number",clearable:""},model:{value:e.ammeterForm.unitPrice,callback:function(t){e.$set(e.ammeterForm,"unitPrice",t)},expression:"ammeterForm.unitPrice"}},[t("template",{slot:"append"},[e._v("元")])],2)],1),t("el-form-item",{attrs:{label:"收款单位",prop:"construction"}},[t("el-input",{attrs:{clearable:""},model:{value:e.ammeterForm.construction,callback:function(t){e.$set(e.ammeterForm,"construction",t)},expression:"ammeterForm.construction"}})],1),t("el-form-item",{attrs:{label:"备注",prop:"remarks"}},[t("el-input",{attrs:{clearable:""},model:{value:e.ammeterForm.remarks,callback:function(t){e.$set(e.ammeterForm,"remarks",t)},expression:"ammeterForm.remarks"}})],1),t("el-form-item",{attrs:{label:"绑定电表",prop:"meterList"}},[t(r.Z,{ref:"table",attrs:{size:"mini",showIndex:"",data:e.ammeterForm.meterList},scopedSlots:e._u([{key:"right",fn:function(){return[t("el-button",{attrs:{size:"small"},on:{click:function(t){e.tableAmmetersDialog=!0}}},[e._v("选择电表")]),t(g,{attrs:{show:e.tableAmmetersDialog},on:{submit:e.getAmmeterData,close:function(t){e.tableAmmetersDialog=!1}}})]},proxy:!0},{key:"columns",fn:function(){return[t("el-table-column",{attrs:{label:"电表编号",prop:"device_name","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"模块编号",prop:"device_model","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"隶属电站",prop:"stationName","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"详细地址",prop:"device_addr_detail","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"设备类型",prop:"type","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"删除","min-width":"90"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-button",{attrs:{plain:"",type:"danger",icon:"el-icon-delete"},on:{click:function(t){return e.deleteAmmeter(o)}}})]}}])})]},proxy:!0}])})],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("提交")]),t("el-button",{on:{click:e.close}},[e._v("取消")])],1)],1)},F=[],k=(o(57658),{name:"",filters:{transfortext:p.h},props:{show:{type:Boolean,default:!1},data:{type:Object,default(){return{}}}},data(){return this.ammeterFormRules=N,{dialogTitle:"新增电表",dropdowns:{typeCategory:[]},ammeterForm:{prepaidMeterName:"",prepaidMeterNo:"",unitPrice:"",construction:"",remarks:"",meterList:[]},tableAmmetersDialog:!1}},watch:{show(e){e&&this.getDropdowns()},data(e){if(e.prepaidMeterId){this.dialogTitle=`查看${e.prepaidMeterId}`;for(let t in this.ammeterForm)this.ammeterForm[t]=e[t];this.getDetail()}else this.$data["ammeterForm"]=this.$options.data()["ammeterForm"],this.dialogTitle="新增电表"}},methods:{getDropdowns(){},getDetail(){(0,d.vl)({prepaidMeterId:this.data.prepaidMeterId}).then((e=>{0===e.code&&(this.ammeterForm=e.data,this.getAmmeters())}))},getAmmeters(){0!==this.ammeterForm.meterList.length&&(0,d.GM)({meterList:this.ammeterForm.meterList,pageSize:99999999,pageNum:1}).then((e=>{0===e.code&&(this.ammeterForm.meterList=e.rows)}))},getAmmeterData(e){this.ammeterForm.meterList.push(...e),this.tableAmmetersDialog=!1},deleteAmmeter(e){this.ammeterForm.meterList.splice(e.$index,1)},submitForm(){this.$refs["ammeter-form"].validate((e=>{if(!e)return!1;const t={addRecordAmmeter:d.J2,editRecordAmmeter:d.IX};t[this.data.prepaidMeterId?"editRecordAmmeter":"addRecordAmmeter"]({...this.ammeterForm,meterList:this.ammeterForm.meterList.map((e=>e.device_name))}).then((e=>{0===e.code&&(this.$message.success(e.msg),this.$emit("success"),this.close())}))}))},close(){this.$refs["ammeter-form"].resetFields(),this.$emit("close",!1)}}});const N={prepaidMeterName:[{required:!0,message:"请输入预付费电表名称",trigger:"blur"}],meterList:[{required:!0,message:"请输选择电表",trigger:"change"}]};var x=k,D=(0,_.Z)(x,w,F,!1,null,"bc712866",null),q=D.exports}}]);