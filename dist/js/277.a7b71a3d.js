"use strict";(self["webpackChunkiov_platform"]=self["webpackChunkiov_platform"]||[]).push([[277],{80277:function(e,t,a){a.r(t),a.d(t,{default:function(){return c}});var i=a(63598),r=function(){var e=this,t=e._self._c;return t("el-form",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],ref:"ruleForm",attrs:{inline:!0,model:e.formData,rules:e.ruleFormRules}},[t("div",{staticClass:"text-end"},[e.disabled?e._e():t("el-button",{attrs:{title:"添加配置",type:"text",icon:"el-icon-circle-plus-outline"},on:{click:e.addLadderConfig}})],1),t(i.Z,{class:[e.validate?"border border-2 border-danger":""],attrs:{size:"mini","empty-text":"请添加配置","tooltip-effect":"true",data:e.formData.clearingRuleItemList},scopedSlots:e._u([{key:"columns",fn:function(){return[t("el-table-column",{attrs:{label:"清分项目"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-form-item",{staticClass:"m-0",attrs:{rules:e.ruleFormRules.itemName,prop:`clearingRuleItemList.${a.$index}.itemName`}},[t("el-select",{attrs:{disabled:e.disabled||e.formData.clearingRuleItemList[a.$index].disabled,size:"mini",filterable:"",clearable:"","default-first-option":"",placeholder:""},on:{change:function(t){return e.disabledItemName(t,a.$index)}},model:{value:a.row.itemName,callback:function(t){e.$set(a.row,"itemName",t)},expression:"scope.row.itemName"}},e._l(e.dropdowns.itemName,(function(e,a){return t("el-option",{key:a,attrs:{label:e.code_name,value:e.code_value,disabled:e.disabled}})})),1)],1)]}}])}),"1"===e.ruleCode?[t("el-table-column",{attrs:{label:"平台占比",prop:"mainRatio"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-form-item",{staticClass:"m-0",attrs:{rules:e.ruleFormRules.mainRatio,prop:`clearingRuleItemList.${a.$index}.mainRatio`}},[t("el-input-number",{attrs:{precision:4,step:.01,min:0,max:e.maxRatio,clearable:"",disabled:e.disabled,size:"mini"},on:{change:function(t){return e.changeRatio(a)}},model:{value:a.row.mainRatio,callback:function(t){e.$set(a.row,"mainRatio",t)},expression:"scope.row.mainRatio"}})],1)]}}],null,!1,3089541789)}),t("el-table-column",{attrs:{label:"商户占比",prop:"merchantRatio"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-form-item",{staticClass:"m-0",attrs:{rules:e.ruleFormRules.merchantRatio,prop:`clearingRuleItemList.${a.$index}.merchantRatio`}},[t("el-input-number",{attrs:{precision:4,step:.01,min:0,max:e.maxRatio,clearable:"",disabled:e.disabled,size:"mini"},on:{change:function(t){return e.changeRatio(a)}},model:{value:a.row.merchantRatio,callback:function(t){e.$set(a.row,"merchantRatio",t)},expression:"scope.row.merchantRatio"}})],1)]}}],null,!1,2928649500)})]:e._e(),"2"===e.ruleCode?[t("el-table-column",{attrs:{label:"收费类别"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-form-item",{staticClass:"m-0",attrs:{rules:e.ruleFormRules.chargeCategory,prop:`clearingRuleItemList.${a.$index}.chargeCategory`}},[t("el-input",{attrs:{clearable:"",disabled:e.disabled,size:"mini"},model:{value:a.row.chargeCategory,callback:function(t){e.$set(a.row,"chargeCategory",t)},expression:"scope.row.chargeCategory"}})],1)]}}],null,!1,199550913)}),t("el-table-column",{attrs:{label:"收费金额"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-form-item",{staticClass:"m-0",attrs:{rules:e.formData.chargeAmount,prop:`clearingRuleItemList.${a.$index}.chargeAmount`}},[t("el-input-number",{attrs:{min:0,precision:2,clearable:"",disabled:e.disabled,size:"mini",type:"number"},model:{value:a.row.chargeAmount,callback:function(t){e.$set(a.row,"chargeAmount",t)},expression:"scope.row.chargeAmount"}})],1)]}}],null,!1,4120710755)})]:e._e(),e.disabled?e._e():t("el-table-column",{attrs:{label:"删除",width:"50"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-delete",title:"删除"},on:{click:function(t){return e.deleteIt(a)}}})]}}],null,!1,2882946455)})]},proxy:!0}])})],1)},l=[],s=(a(57658),a(5376)),o={name:"",data(){return this.ruleFormRules=n,{maxRatio:1,dropdowns:{itemName:[]},formData:{clearingRuleItemList:[]},validate:!1}},props:{show:{type:Boolean,default:!1},ruleCode:{type:String,required:!0},disabled:{type:Boolean,default:!1},data:{type:Object,default:()=>({})}},watch:{show(e){e&&(this.validate=!1,this.formData.clearingRuleItemList=[])},data(e,t){e.id&&(this.formData=e)},ruleCode(e,t){e||this.resetFields()}},created(){this.getDropdowns()},methods:{getDropdowns(){(0,s.Wl)("605052").then((e=>{0===e.code&&(this.dropdowns.itemName=e.data.map((e=>({...e,disabled:!1}))))}))},disabledItemName(e,t){let a;this.dropdowns.itemName.find(((t,i)=>{e===t.code_value&&(a=i)})),this.dropdowns.itemName[a].disabled=""!==e,this.formData.clearingRuleItemList[t].disabled=""!==e},addLadderConfig(){const e=this.dropdowns.itemName.length,t=this.formData.clearingRuleItemList.length;t<e?(this.formData.clearingRuleItemList.push({mainRatio:"",merchantRatio:"",itemName:"",chargeCategory:"",chargeAmount:"",disabled:!1}),this.itemNameValidate()):this.$message.info(`最多可增加${e}项`)},deleteIt(e){let t;this.formData.clearingRuleItemList.splice(e.$index,1),this.dropdowns.itemName.find(((a,i)=>{e.row.itemName===a.code_value&&(t=i)})),this.dropdowns.itemName[t].disabled=!1,0===this.formData.clearingRuleItemList.length&&this.resetItemName(),this.itemNameValidate()},changeRatio(e){const t=e.row.mainRatio,a=e.row.merchantRatio;"mainRatio"===e.column.property&&(this.formData.clearingRuleItemList[e.$index].merchantRatio=this.maxRatio-t),"merchantRatio"===e.column.property&&(this.formData.clearingRuleItemList[e.$index].mainRatio=this.maxRatio-a)},submitForm(){let e=!1;return this.itemNameValidate(),this.$refs["ruleForm"].validate((t=>{t&&!this.validate&&(this.$emit("submit",this.formData),e=!0)})),e},itemNameValidate(){this.validate=0===this.formData.clearingRuleItemList.length},resetFields(){this.$refs["ruleForm"].resetFields(),this.resetItemName()},resetItemName(){for(let e=0;e<this.dropdowns.itemName.length;e++)this.dropdowns.itemName[e].disabled=!1}}};const n={itemName:[{required:!0,message:"",trigger:"change"}],mainRatio:[{required:!0,message:"",trigger:"blur"},{type:"number",min:0,max:1,message:"",trigger:"blur"}],merchantRatio:[{required:!0,message:"",trigger:"blur"},{type:"number",min:0,max:1,message:"",trigger:"blur"}],chargeCategory:[{required:!0,message:"",trigger:"blur"}],chargeAmount:[{required:!0,message:"",trigger:"blur"},{type:"number",min:.01,message:"",trigger:"blur"}]};var m=o,u=a(1001),d=(0,u.Z)(m,r,l,!1,null,"0e96bf17",null),c=d.exports}}]);