"use strict";(self["webpackChunkiov_platform"]=self["webpackChunkiov_platform"]||[]).push([[7811],{97811:function(e,t,s){s.r(t),s.d(t,{default:function(){return b}});var o=s(63598),a=s(1985),r=function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"addUser-queryForm",attrs:{rules:e.addUserQueryRules,inline:"",model:e.queryForm}},[t("el-form-item",{staticClass:"w-full me-0",attrs:{prop:"deptCode"}},[t(a.Z,{model:{value:e.queryForm.deptCode,callback:function(t){e.$set(e.queryForm,"deptCode",t)},expression:"queryForm.deptCode"}})],1)],1),t(o.Z,{ref:"table",attrs:{loading:e.userTableLoading,data:e.tableData,height:"350","row-key":"userId"},scopedSlots:e._u([{key:"left",fn:function(){return[t("el-upload",{ref:"upload",attrs:{accept:".xls,.xlsx",action:"","auto-upload":!1,"on-change":e.toJSON,"show-file-list":!1}},[t("el-button",{attrs:{size:"small"}},[e._v("导入")])],1),t("el-button",{attrs:{size:"small"},on:{click:e.downloadCompanyUserTemplate}},[e._v("下载企业用户填写模版")])]},proxy:!0},{key:"right",fn:function(){return[t("el-button",{attrs:{icon:"el-icon-plus",size:"small",title:"手录用户"},on:{click:e.addUserForm}}),t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.tableData.length>0,expression:"tableData.length > 0"}],attrs:{icon:"el-icon-delete",size:"small",title:"清空用户"},on:{click:function(t){e.tableData=[]}}})]},proxy:!0},{key:"columns",fn:function(){return[t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"姓名",prop:"chineseName"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-input",{attrs:{clearable:"",size:"mini",placeholder:"必填"},model:{value:s.row.chineseName,callback:function(t){e.$set(s.row,"chineseName",t)},expression:"scope.row.chineseName"}})]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"手机号",prop:"phonenumber"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-input",{attrs:{clearable:"",size:"mini",placeholder:"必填"},model:{value:s.row.phonenumber,callback:function(t){e.$set(s.row,"phonenumber",t)},expression:"scope.row.phonenumber"}})]}}])}),t("el-table-column",{attrs:{label:"操作",fixed:"right",width:"90"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{plain:"",icon:"el-icon-delete",size:"mini",title:"删除用户",type:"danger"},on:{click:function(t){return e.deleteUserForm(s.$index)}}})]}}])})]},proxy:!0}])})],1)},l=[],n=s(40323),i=s(1161),u=s(97589),d=s(30741),c={name:"",mixins:[d.oA],data(){return{queryForm:{deptCode:this.$store.state.userInfo.deptCode},userTableLoading:!1,addUserQueryRules:m,tableData:[]}},methods:{downloadCompanyUserTemplate(){const e=[{"序号":"1","姓名":"案例 - 名字","手机号":"案例 - 133123456789"}];(0,i.rD)(e,"企业用户填写模版"),this.$message.info("请勿修改表头字段。请删除案例数据")},toJSON(e){n.Z.excel_to_json(e).then((e=>{const t=Object.keys(e[0][0]);return t.includes("姓名")?t.includes("手机号")?void(this.tableData=e[0].map((e=>({chineseName:e["姓名"],phonenumber:e["手机号"]+"",deptCode:this.queryForm.deptCode})))):this.$message.error("表头没有【手机号】栏"):this.$message.error("表头没有【姓名】栏")}))},addUserForm(){this.tableData.unshift({chineseName:"",phonenumber:"",deptCode:this.queryForm.deptCode})},deleteUserForm(e){this.tableData.splice(e,1)},async addUser(){let e=!0;try{await this.$refs["addUser-queryForm"].validate((t=>{e=t}))}catch(o){}if(!e)return;if(0===this.tableData.length)return this.$message.warning("请导入用户");const t=this.tableData.some((e=>""===e.chineseName||""===e.phonenumber));if(t)return this.$message.warning("存在未填写的用户表单");const s=this.tableData.map((e=>({...e,deptCode:this.queryForm.deptCode})));(0,u.mQ)(s).then((e=>{501===e.code&&(this.tableData=e.eternal),0===e.code&&(this.$emit("success"),this.$message.success("绑定成功"),this.close())}))},close(){this.tableData=[];try{this.$refs["addUser-queryForm"].resetFields()}catch(e){}}}};const m={deptCode:[{required:!0,message:"请选择隶属组织",trigger:"change"}]};var p=c,h=s(1001),f=(0,h.Z)(p,r,l,!1,null,"82d818d8",null),b=f.exports}}]);