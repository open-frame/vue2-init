"use strict";(self["webpackChunkiov_platform"]=self["webpackChunkiov_platform"]||[]).push([[8894],{68894:function(e,t,o){o.r(t),o.d(t,{default:function(){return b}});var i=o(63598),r=o(75267),n=o(67539),a=function(){var e=this,t=e._self._c;return t("el-card",[t(n.Z,{attrs:{loading:e.tableLoading,btnSpan:12,getData:e.getData,queryReset:e.queryReset}},[t("el-col",{attrs:{span:4}},[t(r.Z,{attrs:{clearable:"",size:"medium",placeholder:"手机号"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.phonenumber,callback:function(t){e.$set(e.queryForm,"phonenumber",t)},expression:"queryForm.phonenumber"}})],1),t("el-col",{attrs:{span:4}},[t(r.Z,{attrs:{clearable:"",size:"medium",placeholder:"用户id"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.userId,callback:function(t){e.$set(e.queryForm,"userId",t)},expression:"queryForm.userId"}})],1),t("el-col",{attrs:{span:4}},[t(r.Z,{attrs:{clearable:"",size:"medium",placeholder:"申请编号"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.applyNo,callback:function(t){e.$set(e.queryForm,"applyNo",t)},expression:"queryForm.applyNo"}})],1)],1),t("el-divider"),t(i.Z,{ref:"table",attrs:{loading:e.tableLoading,total:e.total,data:e.tableData,height:"500","row-key":"applyNo","page-size":e.queryForm.pageSize,"current-page":e.queryForm.pageNum,derive:e.exporting},on:{"size-change":e.dataSizeChange,"current-change":e.handleCurrentChange},scopedSlots:e._u([{key:"columns",fn:function(){return[t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"userId",label:"开票人账号"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"phonenumber",label:"手机号"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("router-link",{staticClass:"text-black",attrs:{to:{name:"management-use-electric-index",params:{phonenumber:o.row.phonenumber}}}},[e._v(" "+e._s(o.row.phonenumber)+" ")])]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"applyNo",label:"开票编号"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"amount",label:"开票金额"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"applyTime",label:"开票时间"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"invoiceType",label:"发票类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.invoiceType,e.dropdowns.invoiceType))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"titleType",label:"发票抬头类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.titleType,e.dropdowns.titleType))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"invoiceStatus",label:"开票状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.invoiceStatus,e.dropdowns.invoiceStatus))+" ")]}}])}),t("el-table-column",{attrs:{label:"操作",width:"220"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:function(t){return e.seeDetail(o.row)}}},[e._v("详情")]),"2"!==o.row.invoiceStatus?t("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"function_create-invoice",expression:"'function_create-invoice'"}],attrs:{plain:"",size:"mini"},on:{click:function(t){return e.changeInvoiceDataStatus("2",o.row)}}},[e._v("开票")]):e._e()]}}])})]},proxy:!0}])}),t("el-dialog",{attrs:{"close-on-click-modal":!1,title:"开票信息详情","append-to-body":!0,"modal-append-to-body":!1,visible:e.dialogVisible,"before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-descriptions",{attrs:{border:""}},[t("el-descriptions-item",{attrs:{label:"开票状态"}},[e._v(" "+e._s(e._f("transfortext")(e.invoiceInfo.invoiceStatus,e.dropdowns.invoiceStatus))+" ")]),t("el-descriptions-item",{attrs:{label:"发票编号"}},[e._v(" "+e._s(e.invoiceInfo.applyNo)+" ")]),t("el-descriptions-item",{attrs:{label:"申请时间"}},[e._v(" "+e._s(e.invoiceInfo.applyTime)+" ")]),t("el-descriptions-item",{attrs:{label:"发票类型"}},[e._v(" "+e._s(e._f("transfortext")(e.invoiceInfo.invoiceType,e.dropdowns.invoiceType))+" ")]),t("el-descriptions-item",{attrs:{label:"发票内容"}},[e._v(" "+e._s(e._f("transfortext")(e.invoiceInfo.invoiceContent,e.dropdowns.invoiceContent))+" ")]),t("el-descriptions-item",{attrs:{label:"抬头类型"}},[e._v(" "+e._s(e._f("transfortext")(e.invoiceInfo.titleType,e.dropdowns.titleType))+" ")]),t("el-descriptions-item",{attrs:{label:"抬头名称"}},[e._v(" "+e._s(e.invoiceInfo.titleName)+" ")]),t("el-descriptions-item",{attrs:{label:"单位税号"}},[e._v(" "+e._s(e.invoiceInfo.tariffNumber)+" ")]),t("el-descriptions-item",{attrs:{label:"注册地址"}},[e._v(" "+e._s(e.invoiceInfo.registeredAddress)+" ")]),t("el-descriptions-item",{attrs:{label:"注册电话"}},[e._v(" "+e._s(e.invoiceInfo.registeredPhone)+" ")]),t("el-descriptions-item",{attrs:{label:"开户银行"}},[e._v(" "+e._s(e.invoiceInfo.depositBank)+" ")]),t("el-descriptions-item",{attrs:{label:"银行账号"}},[e._v(" "+e._s(e.invoiceInfo.bankAccount)+" ")]),t("el-descriptions-item",{attrs:{label:"收票人"}},[e._v(" "+e._s(e.invoiceInfo.receiverName)+" ")]),t("el-descriptions-item",{attrs:{label:"邮箱"}},[e._v(" "+e._s(e.invoiceInfo.email)+" ")]),t("el-descriptions-item",{attrs:{label:"联系方式"}},[e._v(" "+e._s(e.invoiceInfo.phone)+" ")]),t("el-descriptions-item",{attrs:{label:"邮寄地址"}},[e._v(" "+e._s(e.invoiceInfo.detailAddress)+" ")])],1),t(i.Z,{ref:"invoiceByOrders-table",staticClass:"mt-5",attrs:{size:"mini",data:e.invoiceByOrders,total:e.invoiceByOrdersTotal,"page-size":e.invoiceByOrdersPageSize,"current-page":1,derive:e.exportInvoiceByOrders},on:{"size-change":e.invoiceByOrdersSizeChange,"current-change":e.ainvoiceByOrdersCurrentChange},scopedSlots:e._u([{key:"columns",fn:function(){return[t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"orderId",label:"订单"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("router-link",{staticClass:"text-black",attrs:{to:{name:"orders-order-manage-index",params:{orderId:o.row.orderId}}}},[e._v(" "+e._s(o.row.orderId)+" ")])]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"createTime",label:"开始时间"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"endTime",label:"结束时间"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"amount",label:"订单金额"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"balance",label:"实付"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"payMode",label:"支付方式"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"payTime",label:"支付时间"}})]},proxy:!0}])})],1)],1)},s=[],l=(o(57658),o(89176)),p=o(5376),c=o(86867),d=o(90886),u=o(30741),v={name:"operational-invoices-index",mixins:[u.LI,u.I_,u.oA,u.vd],directives:{permission:c.rd},filters:{transfortext:d.h},data(){return{tableLoading:!1,queryForm:{userId:"",userName:"",phonenumber:"",applyNo:"",pageSize:this.$tableDataSize,pageNum:1},dropdowns:{titleType:[],invoiceStatus:[],invoiceType:[],invoiceContent:[]},tableData:[],total:0,dialogVisible:!1,invoiceInfo:{},invoiceByOrders:[],invoiceByOrdersTotal:0,invoiceByOrdersPageNum:1,invoiceByOrdersPageSize:10}},created(){this.getDropdowns()},methods:{getDropdowns(){(0,p.Wl)("3014").then((e=>{0===e.code&&(this.dropdowns.invoiceStatus=e.data)})),(0,p.Wl)("3046").then((e=>{0===e.code&&(this.dropdowns.titleType=e.data)})),(0,p.Wl)("3045").then((e=>{0===e.code&&(this.dropdowns.invoiceType=e.data)})),(0,p.Wl)("999998").then((e=>{0===e.code&&(this.dropdowns.invoiceContent=e.data)}))},getData(){this.tableData=[],this.tableLoading=!0,(0,l.Ef)(this.queryForm).then((e=>{this.tableLoading=!1,0===e.code&&(this.tableData=e.rows,this.total=e.total)})).catch((()=>{this.tableLoading=!1}))},seeDetail(e){this.dialogVisible=!0,this.invoiceInfo={...e},(0,l.ye)({userId:e.userId,id:e.configId}).then((e=>{0===e.code&&(this.invoiceInfo=Object.assign(this.invoiceInfo,e.data[0]))})),this.seeSpecific(e)},seeSpecific(e){this.invoiceByOrders=[],(0,l.GS)({applyNo:e.applyNo}).then((e=>{0===e.code&&(this.invoiceByOrders=e.rows,this.invoiceByOrdersTotal=e.total)}))},handleClose(e){e()},invoiceByOrdersSizeChange(e){this.invoiceByOrdersPageSize=e,this.seeSpecific()},ainvoiceByOrdersCurrentChange(e){this.invoiceByOrdersPageNum=e,this.seeSpecific()},changeInvoiceDataStatus(e,t){let o=[];o.push(t.applyNo);const i=this;this.$prompt(`请输入【${t.userName}】开票的二维码地址：`,"二维码地址",{inputPattern:/^[^<|>|(|)|,|+|*|{|}]*$/}).then((t=>{(0,l.XA)({url:t.value,applyNo:o,operStatus:e}).then((e=>{0===e.code&&(i.$message.success(e.msg),i.getData())}))})).catch((()=>{}))},async exporting(e){let t={...this.queryForm};"2"===e&&(t.pageSize=this.total,t.pageNum=1);const o=await(0,l.Ef)(t);if(0===o.code){const e=this.$refs.table.getColumns(),t=o.rows.map((t=>{let o=e.map((e=>[e.label,`${(0,d.h)(t[e.prop],this.dropdowns[e.prop])}`]));return Object.fromEntries(o)}));return t}},async exportInvoiceByOrders(e){let t={...this.queryForm};"2"===e&&(t.pageSize=this.total,t.pageNum=1);const o=await(0,l.Ef)(t);if(0===o.code){const e=this.$refs["invoiceByOrders-table"].getColumns(),t=o.rows.map((t=>{let o=e.map((e=>[e.label,`${(0,d.h)(t[e.prop],this.dropdowns[e.prop])}`]));return Object.fromEntries(o)}));return t}}}},m=v,f=o(1001),h=(0,f.Z)(m,a,s,!1,null,"76c36d67",null),b=h.exports}}]);