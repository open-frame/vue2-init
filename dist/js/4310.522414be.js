"use strict";(self["webpackChunkiov_platform"]=self["webpackChunkiov_platform"]||[]).push([[4310],{97589:function(e,t,a){a.d(t,{I4:function(){return d},K$:function(){return l},PR:function(){return s},QH:function(){return c},Ve:function(){return y},_c:function(){return o},cn:function(){return n},eo:function(){return p},jV:function(){return h},kX:function(){return u},mQ:function(){return i},oG:function(){return m},yJ:function(){return f}});var r=a(92617);function o(e,t){return r.o.post("/system/vipUser/getListByPage",e,t)}function l(e,t){return r.o.post("/system/elecuser/getUserIdByCar",e,t)}function s(e,t){return r.o.post("/system/vipUser/getUserByPhone",e,t)}function n(e,t){return r.o.post("/system/vipUser/addVip",e,t)}function i(e,t){return r.o.post("/system/vipUser/importVip",e,t)}function u(e,t){return r.o.post("/system/vipUser/removeVip",e,t)}function c(e,t){return r.o.post("/system/vipUser/queryVipStation",e,t)}function d(e,t){return r.o.post("/system/vipUser/binding",e,t)}function p(e,t){return r.o.post("/enterprise/Recharge/selectList",e,t)}function m(e,t){return r.o.post("/cloud/charging/chargingElecOrder/vipList",e,t)}function y(e,t){return r.o.post("/enterprise/Recharge/getUserById",e,t)}function h(e,t){return r.o.post("/enterprise/Recharge/updateDept",e,t)}function f(e,t){return r.o.post("/enterprise/Recharge/updateRecharge",e,t)}},74310:function(e,t,a){a.r(t),a.d(t,{default:function(){return S}});var r=a(63598),o=a(90649),l=a(71377),s=a(75267),n=a(1985),i=a(12025),u=a(66654),c=a(67539),d=function(){var e=this,t=e._self._c;return t("el-card",{staticClass:"order-manage"},[t(c.Z,{attrs:{loading:e.loading,getData:e.getData,queryReset:e.queryReset}},[t("el-col",{attrs:{span:4}},[t(s.Z,{attrs:{clearable:"",size:"medium",placeholder:"用户手机号"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.phoneNumber,callback:function(t){e.$set(e.queryForm,"phoneNumber",t)},expression:"queryForm.phoneNumber"}})],1),t("el-col",{attrs:{span:4}},[t(s.Z,{attrs:{clearable:"",size:"medium",placeholder:"设备名称"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.stakeName,callback:function(t){e.$set(e.queryForm,"stakeName",t)},expression:"queryForm.stakeName"}})],1),t("el-col",{attrs:{span:4}},[t(s.Z,{attrs:{clearable:"",size:"medium",placeholder:"订单编号"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.orderId,callback:function(t){e.$set(e.queryForm,"orderId",t)},expression:"queryForm.orderId"}})],1),t("el-col",{attrs:{span:4}},[t(u.Z,{attrs:{animatLable:"",placeholder:"隶属区域"},on:{change:e.pageReset},model:{value:e.queryForm.constructionUuid,callback:function(t){e.$set(e.queryForm,"constructionUuid",t)},expression:"queryForm.constructionUuid"}})],1),t("el-col",{attrs:{span:4}},[t(i.Z,{attrs:{animatLable:"",placeholder:"归属电站"},on:{change:e.pageReset},model:{value:e.queryForm.stationId,callback:function(t){e.$set(e.queryForm,"stationId",t)},expression:"queryForm.stationId"}})],1),t("el-col",{attrs:{span:4}},[t(l["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"订单数据筛查"},on:{change:e.pageReset},model:{value:e.queryForm.dataType,callback:function(t){e.$set(e.queryForm,"dataType",t)},expression:"queryForm.dataType"}},[t("el-option",{attrs:{label:"0元订单",value:"0"}}),t("el-option",{attrs:{label:"正常订单",value:"1"}})],1)],1),e.expertQuery?[t("el-col",{attrs:{span:4}},[t(n.Z,{attrs:{animatLable:"",placeholder:"筛选商户"},on:{change:e.pageReset},model:{value:e.queryForm.deptCode,callback:function(t){e.$set(e.queryForm,"deptCode",t)},expression:"queryForm.deptCode"}})],1),t("el-col",{attrs:{span:4}},[t(s.Z,{attrs:{clearable:"",size:"medium",placeholder:"用户账号"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.userId,callback:function(t){e.$set(e.queryForm,"userId",t)},expression:"queryForm.userId"}})],1),t("el-col",{attrs:{span:4}},[t(s.Z,{attrs:{clearable:"",size:"medium",placeholder:"用户名称"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.userName,callback:function(t){e.$set(e.queryForm,"userName",t)},expression:"queryForm.userName"}})],1),t("el-col",{attrs:{span:4}},[t(s.Z,{attrs:{clearable:"",size:"medium",placeholder:"设备编号"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.stakeNo,callback:function(t){e.$set(e.queryForm,"stakeNo",t)},expression:"queryForm.stakeNo"}})],1),t("el-col",{attrs:{span:4}},[t(s.Z,{attrs:{clearable:"",size:"medium",placeholder:"电站名称"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.stationName,callback:function(t){e.$set(e.queryForm,"stationName",t)},expression:"queryForm.stationName"}})],1),t("el-col",{attrs:{span:4}},[t(s.Z,{attrs:{clearable:"",size:"medium",placeholder:"交易号"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.tradeRecordId,callback:function(t){e.$set(e.queryForm,"tradeRecordId",t)},expression:"queryForm.tradeRecordId"}})],1),t("el-col",{attrs:{span:4}},[t(l["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"订单状态"},on:{change:e.pageReset},model:{value:e.queryForm.orderStatus,callback:function(t){e.$set(e.queryForm,"orderStatus",t)},expression:"queryForm.orderStatus"}},e._l(e.dropdowns.orderStatusCode,(function(e,a){return t("el-option",{key:a,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t(l["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"设备类型"},on:{change:e.pageReset},model:{value:e.queryForm.boatName,callback:function(t){e.$set(e.queryForm,"boatName",t)},expression:"queryForm.boatName"}},e._l(e.dropdowns.boatName,(function(e,a){return t("el-option",{key:a,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t(l["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"发票状态"},on:{change:e.pageReset},model:{value:e.queryForm.billStatus,callback:function(t){e.$set(e.queryForm,"billStatus",t)},expression:"queryForm.billStatus"}},e._l(e.dropdowns.invoiceStatus,(function(e,a){return t("el-option",{key:a,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t(l["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"清分状态"},on:{change:e.pageReset},model:{value:e.queryForm.clearStatus,callback:function(t){e.$set(e.queryForm,"clearStatus",t)},expression:"queryForm.clearStatus"}},e._l(e.dropdowns.clearIntegral,(function(e,a){return t("el-option",{key:a,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t(l["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"清分结算状态"},on:{change:e.pageReset},model:{value:e.queryForm.settleStatus,callback:function(t){e.$set(e.queryForm,"settleStatus",t)},expression:"queryForm.settleStatus"}},e._l(e.dropdowns.settleAccounts,(function(e,a){return t("el-option",{key:a,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t(l["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"用电结账状态"},on:{change:e.pageReset},model:{value:e.queryForm.payStatus,callback:function(t){e.$set(e.queryForm,"payStatus",t)},expression:"queryForm.payStatus"}},e._l(e.dropdowns.payStatus,(function(e,a){return t("el-option",{key:a,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t(o.Z,{attrs:{size:"medium",type:"datetimerange",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"订单开始时间段","picker-options":e.pickerOptions},on:{change:e.pageReset},model:{value:e.queryForm.startTimeSection,callback:function(t){e.$set(e.queryForm,"startTimeSection",t)},expression:"queryForm.startTimeSection"}})],1),t("el-col",{attrs:{span:4}},[t(o.Z,{attrs:{size:"medium",type:"datetimerange",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"订单结束时间段","picker-options":e.pickerOptions},on:{change:e.pageReset},model:{value:e.queryForm.endTimeSection,callback:function(t){e.$set(e.queryForm,"endTimeSection",t)},expression:"queryForm.endTimeSection"}})],1),t("el-col",{attrs:{span:4}},[t(o.Z,{attrs:{size:"medium",type:"datetimerange",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"订单支付时间段","picker-options":e.pickerOptions},on:{change:e.pageReset},model:{value:e.queryForm.payTimeSection,callback:function(t){e.$set(e.queryForm,"payTimeSection",t)},expression:"queryForm.payTimeSection"}})],1)]:e._e(),t("el-col",{staticClass:"text-end mt-3",attrs:{span:e.expertQuery?8:20}},[t("el-button",{staticClass:"text-warmgray",attrs:{size:"medium",type:"text"},on:{click:function(t){e.expertQuery=!e.expertQuery}}},[e._v(" "+e._s(e.expertQuery?"折叠":"展开")+"高级查询 ")])],1)],2),t("el-divider"),t(r.Z,{ref:"table",attrs:{loading:e.loading,total:e.total,data:e.tableData,height:"560","row-key":"orderId","page-size":e.queryForm.pageSize,"current-page":e.queryForm.pageNum,derive:e.exporting},on:{"current-change":e.handleCurrentChange,"size-change":e.dataSizeChange,"selection-change":e.selectingData,printing:e.printing},scopedSlots:e._u([{key:"left",fn:function(){return[t("el-button",{attrs:{size:"small"},on:{click:e.orderTotal}},[e._v("总计")])]},proxy:!0},{key:"columns",fn:function(){return[t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"orderId",label:"订单编号"},scopedSlots:e._u([{key:"default",fn:function(a){return t("span",{directives:[{name:"copy",rawName:"v-copy",value:a.row.orderId,expression:"scope.row.orderId"}]},[e._v(" "+e._s(a.row.orderId)+" ")])}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"userName",label:"用户"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"userId",label:"账号"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"phoneNumber",label:"手机号",width:"120"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("router-link",{staticClass:"text-black",attrs:{to:{name:"management-use-electric-index",params:{phonenumber:a.row.phoneNumber}}}},[e._v(" "+e._s(a.row.phoneNumber)+" ")])]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"stationName",label:"所属站"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"stationId",label:"站编号"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"construction",label:"隶属区域"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"stakeName",label:"设备名称"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"boatName",label:"设备类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.boatName,e.dropdowns.boatName))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"stakeNo",label:"设备编号"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("router-link",{staticClass:"text-black",attrs:{to:{name:"operational-runing-index",params:{stakeNo:a.row.stakeNo}}}},[e._v(" "+e._s(a.row.stakeNo)+" ")])]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"djAccount",label:"预付金额"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"createTime",label:"开始时间",width:"165"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"endTime",label:"结束时间",width:"165"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"payTime",label:"支付时间",width:"165"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"duration",label:"实充用时"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"djTime",label:"预充时长"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"totalElectric",label:"耗电"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"rated",label:"核定功率"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"kdAmount",label:"电费单价"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"amount",label:"订单总额"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"balance",label:"实收"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"orderStatusCode",label:"订单状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.orderStatusCode,e.dropdowns.orderStatusCode))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"payStatus",label:"支付状态"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{effect:"plain",type:"已付"===a.row.payStatus?"success":"danger"}},[e._v(" "+e._s(a.row.payStatus)+" ")])]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"tranStatus",label:"结账方式",width:"110"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.tranStatus,e.dropdowns.tranStatus))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"tradeRecordId",label:"交易号",width:"180"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"chargePort",label:"端口",width:"90"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.chargePort,e.dropdowns.chargePort))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"refundType",label:"退款情况",width:"110"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.refundType,e.dropdowns.refundType))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"stopElecReason",label:"停电原因"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"billStatus",label:"发票状态"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"clearStatus",label:"清分状态"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"settleStatus",label:"结算状态"}}),t("el-table-column",{attrs:{label:"操作",width:"260",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.seeOrderDetail(a.row)}}},[e._v("详情")]),t("el-button",{attrs:{size:"mini",plain:"",type:"primary"},on:{click:function(t){return e.seeBillingTemplate(a.row)}}},[e._v("计费模型")]),"1"===a.row.boatName?t("el-button",{attrs:{plain:"",type:"success",size:"mini"},on:{click:function(t){return e.seePowerDetail(a.row)}}},[e._v("功率明细")]):e._e(),["2","3"].includes(a.row.boatName)?t("el-popover",{staticClass:"ms-2",attrs:{"popper-class":"cost-detail",placement:"left",width:"200"}},[t("el-button",{attrs:{slot:"reference",plain:"",type:"success",size:"mini"},slot:"reference"},[e._v("费用明细")]),t("div",{staticClass:"item"},[t("span",{staticClass:"text-warmgray text-end title"},[e._v("尖电量：")]),t("span",[e._v(e._s(a.row.spotElectric)+"度")])]),t("div",{staticClass:"item"},[t("span",{staticClass:"text-warmgray text-end title"},[e._v("峰电量：")]),t("span",[e._v(e._s(a.row.peakElectric)+"度")])]),t("div",{staticClass:"item"},[t("span",{staticClass:"text-warmgray text-end title"},[e._v("平电量：")]),t("span",[e._v(e._s(a.row.flatElectric)+"度")])]),t("div",{staticClass:"item"},[t("span",{staticClass:"text-warmgray text-end title"},[e._v("谷电量：")]),t("span",[e._v(e._s(a.row.valleyElectric)+"度")])]),t("hr",{staticClass:"mt-1 mb-1"}),t("div",{staticClass:"item"},[t("span",{staticClass:"text-warmgray text-end title"},[e._v("尖电费：")]),t("span",[e._v(e._s(a.row.spotAmountElectric)+"元")])]),t("div",{staticClass:"item"},[t("span",{staticClass:"text-warmgray text-end title"},[e._v("峰电费：")]),t("span",[e._v(e._s(a.row.peakAmountElectric)+"元")])]),t("div",{staticClass:"item"},[t("span",{staticClass:"text-warmgray text-end title"},[e._v("平电费：")]),t("span",[e._v(e._s(a.row.flatAmountElectric)+"元")])]),t("div",{staticClass:"item"},[t("span",{staticClass:"text-warmgray text-end title"},[e._v("谷电费：")]),t("span",[e._v(e._s(a.row.valleyAmountElectric)+"元")])]),t("hr",{staticClass:"mt-1 mb-1"}),t("div",{staticClass:"item"},[t("span",{staticClass:"text-warmgray text-end title"},[e._v("尖服务费：")]),t("span",[e._v(e._s(a.row.spotAmountService)+"元")])]),t("div",{staticClass:"item"},[t("span",{staticClass:"text-warmgray text-end title"},[e._v("峰服务费：")]),t("span",[e._v(e._s(a.row.peakAmountService)+"元")])]),t("div",{staticClass:"item"},[t("span",{staticClass:"text-warmgray text-end title"},[e._v("平服务费：")]),t("span",[e._v(e._s(a.row.flatAmountService)+"元")])]),t("div",{staticClass:"item"},[t("span",{staticClass:"text-warmgray text-end title"},[e._v("谷服务费：")]),t("span",[e._v(e._s(a.row.valleyAmountService)+"元")])]),t("hr"),t("div",{staticClass:"item"},[t("span",{staticClass:"text-warmgray text-end title"},[e._v("电费合计：")]),t("span",[e._v(e._s(a.row.consAmountElectric)+"元")])]),t("div",{staticClass:"item"},[t("span",{staticClass:"text-warmgray text-end title"},[e._v("服务费合计：")]),t("span",[e._v(e._s(a.row.conslAmountService)+"元")])])],1):e._e()]}}])})]},proxy:!0}])}),t("total-drawer",{attrs:{show:e.totalDrawer,data:e.orderTotals},on:{close:e.closeTotalDrawer}}),t("PowerDetail",{attrs:{show:e.powerDetailDialog,data:e.powerDetailTableData},on:{close:e.closePowerDetailTableData}}),t("RefundRecord",{attrs:{show:e.refundDetailDialog,data:e.refundDetailTableData},on:{close:e.closeRefundDetailTableData}}),t("OrderDetail",{attrs:{show:e.orderDetailDialog,data:e.orderDetail},on:{close:e.closeOrderDetail}}),t("billing-template",{attrs:{show:e.billingTemplateDialog,orderDetail:e.orderDetail},on:{close:e.closeBillingTemplateDialog}})],1)},p=[],m=a(19596),y=a(25335),h=a(5376),f=a(30741),b=a(90886),g=a(86867),w=a(97589),v={name:"orders-order-manage-index",mixins:[f.I_,f.LI,f.oA,f.vd],filters:{transfortext:b.h},directives:{copy:g.JG},components:{PowerDetail:()=>a.e(4001).then(a.bind(a,44001)),RefundRecord:()=>a.e(8318).then(a.bind(a,70664)),OrderDetail:()=>Promise.all([a.e(142),a.e(6450)]).then(a.bind(a,90142)),"total-drawer":()=>a.e(7888).then(a.bind(a,43893)),"billing-template":()=>a.e(3757).then(a.bind(a,73059))},data(){return{pickerOptions:{disabledDate(e){return e.getTime()>Date.now()}},expertQuery:!1,loading:!1,dropdowns:{orderStatusCode:[],invoiceStatus:[],clearIntegral:[],settleAccounts:[],payStatus:[],tranStatus:[],chargePort:[],refundType:[],boatName:[]},queryForm:{deptCode:"",dataType:"",startTimeSection:[],endTimeSection:[],payTimeSection:[],userName:"",userId:"",stakeName:"",phoneNumber:"",boatName:"",orderId:"",stationName:"",tradeRecordId:"",constructionUuid:"",stakeNo:"",stationId:"",stopElecReason:"",startTimeSerach:"",endTimeSerach:"",orderStatus:"",billStatus:"",clearStatus:"",settleStatus:"",payStatus:"",pageSize:this.$tableDataSize,pageNum:1,orderByColumn:"createtime",isAsc:"desc"},tableData:[],orderTotals:{},total:0,selectedDate:[],totalDrawer:!1,powerDetailDialog:!1,powerDetailTableData:[],refundDetailDialog:!1,refundDetailTableData:[],orderDetailDialog:!1,orderDetail:{},billingTemplateDialog:!1}},created(){this.getDropdowns()},watch:{"queryForm.startTimeSection"(e){e?(this.queryForm.startTimeSerach=e[0],this.queryForm.endTimeSerach=e[1]):(this.queryForm.startTimeSerach="",this.queryForm.endTimeSerach="")},"queryForm.endTimeSection"(e){e?(this.queryForm.endTimeStart=e[0],this.queryForm.endTimeStop=e[1]):(this.queryForm.endTimeStart="",this.queryForm.endTimeStop="")},"queryForm.payTimeSection"(e){e?(this.queryForm.payTimeStart=e[0],this.queryForm.payTimeStop=e[1]):(this.queryForm.payTimeStart="",this.queryForm.payTimeStop="")}},methods:{getDropdowns(){(0,h.Wl)("1001").then((e=>{0===e.code&&(this.dropdowns.orderStatusCode=e.data)})),(0,h.Wl)("3004").then((e=>{0===e.code&&(this.dropdowns.boatName=e.data)})),(0,h.Wl)("3010").then((e=>{0===e.code&&(this.dropdowns.chargePort=e.data)})),(0,h.Wl)("3014").then((e=>{0===e.code&&(this.dropdowns.invoiceStatus=e.data)})),(0,h.Wl)("3015").then((e=>{0===e.code&&(this.dropdowns.clearIntegral=e.data)})),(0,h.Wl)("3016").then((e=>{0===e.code&&(this.dropdowns.settleAccounts=e.data)})),(0,h.Wl)("1004").then((e=>{0===e.code&&(this.dropdowns.payStatus=e.data)})),(0,h.Wl)("852616").then((e=>{0===e.code&&(this.dropdowns.tranStatus=e.data)})),(0,h.Wl)("004788").then((e=>{0===e.code&&(this.dropdowns.refundType=e.data)}))},getData(){this.tableData=[],this.loading=!0,(0,w.oG)(this.queryForm).then((e=>{this.loading=!1,0===e.code&&(this.total=e.total,this.tableData=e.rows)})).catch((()=>{this.loading=!1}))},selectingData(e){this.selectedDate=e},orderTotal(){(0,m.tu)({startTimeSerach:this.queryForm.startTimeSerach,endTimeSerach:this.queryForm.endTimeSerach}).then((e=>{0===e.code&&(this.totalDrawer=!0,this.orderTotals=e.data[0])}))},seePowerDetail(e){this.powerDetailDialog=!0,(0,m.HX)({orderId:e.orderId}).then((e=>{0===e.code&&(this.powerDetailTableData=e.rows)}))},refundHistory(e){this.refundDetailDialog=!0,(0,y.lN)({userId:e.userId,orderId:e.orderId}).then((e=>{0===e.code&&(this.refundDetailTableData=e.rows)}))},seeOrderDetail(e){this.orderDetail=e,this.orderDetailDialog=!0},moreHandles(e,t){switch(e){case"0":break;case"1":this.refund(t);break;case"2":this.refundHistory(t);break;case"3":this.userPaying(t,"handel");break;case"4":this.offPayCredit(t);break;case"5":this.modifyOderAmount(t);break;case"6":this.noPayUrged("one",t);break;case"7":this.closeOrder(t);break}},seeBillingTemplate(e){this.orderDetail=e,this.billingTemplateDialog=!0},offPayCredit(e,t){(0,m.V3)({orderId:e.orderId}).then((a=>{0===a.code&&(this.$message.success("取消成功"),t||this.userPaying(e.orderId))}))},modifyOderAmount(e){const t=this;this.$prompt("","修改支付分订单金额",{confirmButtonText:"修改",cancelButtonText:"取消",inputType:"number",inputValue:0,beforeClose(a,r,o){if("confirm"===a){if("2"===e.payStatus&&parseFloat(r.inputValue)>e.balance)return t.$message.error("退款额超出"),!1;if("未付"===e.payStatus&&parseFloat(r.inputValue)>e.amount)return t.$message.error("退款额超出"),!1;if(parseFloat(r.inputValue)<.01)return t.$message.error("退款额错误"),!1}o()}}).then((t=>{(0,m.WO)({orderId:e.orderId,modifyAmount:t.value}).then((e=>{0===e.code&&(this.$message.success("修改成功"),this.getData())}))})).catch((()=>{}))},noPayUrged(e,t){if("more"===e&&this.selectedDate.length<1)return this.$message.warning("请选择催收项"),!1;const a=this.selectedDate.every((e=>"未付"===e.payStatus));if(!a)return this.$message.warning("所选项存在非未付订单");const r=this.selectedDate.every((e=>"结束"===e.orderStatus));if(!r)return this.$message.warning("所选项存在未结束的订单");let o;o="one"===e?[t.orderId]:this.selectedDate.map((e=>e.orderId)),(0,m.td)({orderIds:o}).then((e=>{0===e.code&&(this.$message.success("催款成功"),this.getData(),this.selectedDate=[],this.$refs["table"].clearSelection())}))},userPaying(e,t){(0,m.NI)({orderId:e.orderId}).then((a=>{0===a.code&&(this.$message.success("设置成功"),"handel"===t&&this.offPayCredit(e,"handel"),this.getData())}))},closeTotalDrawer(e){this.totalDrawer=e},refund(e){const t=this;this.$prompt("","退款金额",{confirmButtonText:"退款",cancelButtonText:"取消",inputType:"number",inputValue:e.balance,beforeClose(a,r,o){if("confirm"===a){if(Number(r.inputValue)>e.balance)return t.$message.error("退款额超出"),!1;if(Number(r.inputValue)<.01)return t.$message.error("退款额错误"),!1}o()}}).then((a=>{(0,y.U4)({orderId:e.orderId,userId:e.userId,phoneNumber:e.phoneNumber,receiveMoney:e.balance,backMoney:a.value,transactionId:e.tradeRecordId,dataResource:"1"}).then((e=>{0===e.code&&(t.$message.success("申请提交"),t.getData())}))})).catch((()=>{}))},closeOrder(e){(0,m.Dm)({orderId:e.orderId}).then((e=>{0===e.code&&(this.$message.success(e.msg),this.getData())}))},closePowerDetailTableData(e){this.powerDetailDialog=e,this.powerDetailTableData=[]},closeRefundDetailTableData(e){this.refundDetailDialog=e,this.refundDetailTableData=[]},closeOrderDetail(e){this.orderDetailDialog=e,this.orderDetail={}},closeBillingTemplateDialog(e){this.billingTemplateDialog=e,this.orderDetail={}},async exporting(e){let t={...this.queryForm};"2"===e&&(t.pageSize=this.total,t.pageNum=1);const a=await(0,w.oG)(t);if(0===a.code){const e=this.$refs.table.getColumns(),t=a.rows.map((t=>{let a=e.map((e=>[e.label,`${(0,b.h)(t[e.prop],this.dropdowns[e.prop])}`]));return Object.fromEntries(a)}));return t}},printing(e){let t={...this.queryForm};"2"===e&&(t.pageSize=this.total,t.pageNum=1);const r=this.$refs.table.getColumns().map((e=>({field:e.prop,displayName:e.label}))),o=a(36801);(0,w.oG)(t).then((e=>{o({type:"json",printable:e.rows,scanStyles:!0,header:'<h2 style="text-align: center">订单列表</h2>',properties:r,style:"@media print{@page {size:landscape}}",gridHeaderStyle:"border: 1px solid #000;text-align:center",gridStyle:"border: 1px solid #000;text-align:center"})}))}}},k=v,_=a(1001),D=(0,_.Z)(k,d,p,!1,null,"be5041f4",null),S=D.exports}}]);