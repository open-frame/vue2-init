"use strict";(self["webpackChunkiov_platform"]=self["webpackChunkiov_platform"]||[]).push([[4050],{94050:function(e,t,o){o.r(t),o.d(t,{default:function(){return w}});var l=o(63598),a=o(71377),s=o(1985),n=o(66654),r=o(75267),i=o(67539),d=function(){var e=this,t=e._self._c;return t("el-card",{staticClass:"use-electric"},[t(i.Z,{attrs:{loading:e.loading,btnSpan:16,getData:e.getData,queryReset:e.queryReset}},[t("el-col",{attrs:{span:4}},[t(r.Z,{attrs:{clearable:"",size:"medium",placeholder:"账号"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.userId,callback:function(t){e.$set(e.queryForm,"userId",t)},expression:"queryForm.userId"}})],1),t("el-col",{attrs:{span:4}},[t(r.Z,{attrs:{clearable:"",size:"medium",placeholder:"昵称"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.userName,callback:function(t){e.$set(e.queryForm,"userName",t)},expression:"queryForm.userName"}})],1),t("el-col",{attrs:{span:4}},[t(r.Z,{attrs:{clearable:"",size:"medium",placeholder:"姓名"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.chineseName,callback:function(t){e.$set(e.queryForm,"chineseName",t)},expression:"queryForm.chineseName"}})],1),t("el-col",{attrs:{span:4}},[t(r.Z,{attrs:{clearable:"",size:"medium",placeholder:"VIN"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.vinCode,callback:function(t){e.$set(e.queryForm,"vinCode",t)},expression:"queryForm.vinCode"}})],1),t("el-col",{attrs:{span:4}},[t(r.Z,{attrs:{clearable:"",size:"medium",placeholder:"手机号"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.phonenumber,callback:function(t){e.$set(e.queryForm,"phonenumber",t)},expression:"queryForm.phonenumber"}})],1),t("el-col",{attrs:{span:4}},[t(n.Z,{attrs:{animatLable:""},on:{change:e.pageReset},model:{value:e.queryForm.constructionUuid,callback:function(t){e.$set(e.queryForm,"constructionUuid",t)},expression:"queryForm.constructionUuid"}})],1),t("el-col",{attrs:{span:4}},[t(s.Z,{attrs:{animatLable:""},on:{change:e.pageReset},model:{value:e.queryForm.deptCode,callback:function(t){e.$set(e.queryForm,"deptCode",t)},expression:"queryForm.deptCode"}})],1),t("el-col",{attrs:{span:4}},[t(a["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"用户状态"},on:{change:e.pageReset},model:{value:e.queryForm.runStatus,callback:function(t){e.$set(e.queryForm,"runStatus",t)},expression:"queryForm.runStatus"}},e._l(e.dropdowns.runStatus,(function(e,o){return t("el-option",{key:o,attrs:{label:e.code_name,value:e.code_value}})})),1)],1)],1),t("el-divider"),t(l.Z,{ref:"table",class:["discount-users",e.disabledSelectionAll],attrs:{loading:e.loading,total:e.total,data:e.tableData,height:"550","row-key":"userId",selecteisDisabled:e.selecteisDisabled,"page-size":e.queryForm.pageSize,"current-page":e.queryForm.pageNum,derive:e.exporting},on:{select:e.selectingData,"select-all":e.selectAll,"size-change":e.dataSizeChange,"current-change":e.handleCurrentChange},scopedSlots:e._u([{key:"left",fn:function(){return[t("el-button",{attrs:{size:"small"},on:{click:function(t){e.addUserDialog=!0}}},[e._v("添加")]),t("el-button",{attrs:{size:"small"},on:{click:function(t){return e.openBindBillModel("more")}}},[e._v("批量绑定计费模型")])]},proxy:!0},{key:"columns",fn:function(){return[t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"chineseName",label:"姓名"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"runStatus",label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.runStatus,e.dropdowns.runStatus))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"账号",prop:"userId"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"隶属组织",prop:"deptCode"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.deptCode,e.dropdowns.deptCode,{name:"label",value:"deptCode"}))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"手机号",prop:"phonenumber"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"计费模型",prop:"modelId"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-button",{class:o.row.modelId?"":"text-danger",attrs:{type:"text"},on:{click:function(t){return e.openBindBillModel("one",o.row)}}},[e._v(e._s(o.row.modelId?"查看":"未绑定"))])]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"VIN",prop:"vinCode"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"余额",prop:"balance"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"积分",prop:"integral"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"加入时间",prop:"operationTime"}}),t("el-table-column",{attrs:{label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-button",{attrs:{type:"danger",plain:"",size:"mini"},on:{click:function(t){return e.removeUser(o.row)}}},[e._v("移除")])]}}])})]},proxy:!0}])}),t("add-user-dialog",{attrs:{show:e.addUserDialog},on:{success:e.getData,close:e.closeAddUserDialog}}),t("bind-bill-model",{attrs:{data:e.thisData,type:e.showBindBillModelType,show:e.showBindBillModel},on:{success:e.getData,close:e.closeBindBillModel}})],1)},u=[],c=o(97589),p=o(5376),h=o(90886),m=o(30741),y={name:"company-user-user-manage-index",mixins:[m.LI,m.I_,m.oA,m.vd],components:{"add-user-dialog":()=>o.e(2993).then(o.bind(o,62993)),"bind-bill-model":()=>Promise.all([o.e(5335),o.e(2025),o.e(2333)]).then(o.bind(o,82333))},filters:{transfortext:h.h},data(){return{loading:!1,dropdowns:{runStatus:[],deptCode:[]},queryForm:{userId:"",deptCode:"",userName:"",chineseName:"",phonenumber:"",runStatus:"",vinCode:"",constructionUuid:"",pageSize:this.$tableDataSize,pageNum:1},tableData:[],total:0,addUserDialog:!1,showBindBillModel:!1,showBindBillModelType:"",thisData:{userId:[],deptCode:""},selectedData:[]}},created(){this.getDropdowns()},computed:{disabledSelectionAll(){if(this.tableData.length>0){const e=this.tableData[0].deptCode,t=this.tableData.every((t=>t.deptCode===e));return t?"":"disabled-selection-all"}return""}},methods:{getDropdowns(){(0,p.Wl)("3018").then((e=>{0===e.code&&(this.dropdowns.runStatus=e.data)})),(0,p.eL)().then((e=>{this.dropdowns.deptCode=e}))},getData(){this.tableData=[],this.loading=!0,this.selectedData=[],(0,c._c)(this.queryForm).then((e=>{this.loading=!1,0===e.code&&(this.total=e.total,this.tableData=e.rows)})).catch((()=>{this.loading=!1}))},closeAddUserDialog(e){this.addUserDialog=e},removeUser(e){this.$confirm("确定删除？","提示").then((()=>{(0,c.kX)({userId:e.userId}).then((e=>{0===e.code&&(this.$message.success("移除成功"),this.getData())})).catch((()=>{}))}))},openBindBillModel(e,t){if("more"===e){if(0===this.selectedData.length)return this.$message.info("请勾选要绑定的用电用户");this.showBindBillModelType="",this.thisData={userId:this.selectedData.map((e=>e.userId)),deptCode:this.thisData.deptCode}}else this.showBindBillModelType=t.modelId?"detail":"",this.thisData={...t,userId:[t.userId],deptCode:t.deptCode};this.showBindBillModel=!0},closeBindBillModel(e){this.showBindBillModel=e,this.selectedData=[],this.$refs["table"].clearSelection(),this.thisData.userId=[],this.thisData.deptCode="",this.showBindBillModelType=""},selectingData(e,t){const o=e.some((e=>e.userId===t.userId));this.thisData.deptCode=o?t.deptCode:"",this.selectedData=e},selectAll(e){this.thisData.deptCode=e[0].deptCode,this.selectedData=e},selecteisDisabled(e){return!this.thisData.deptCode||e.deptCode===this.thisData.deptCode},async exporting(e){let t={...this.queryForm};"2"===e&&(t.pageSize=this.total,t.pageNum=1);const o=await(0,c._c)(t);if(0===o.code){const e=this.$refs.table.getColumns(),t=o.rows.map((t=>{let o=e.map((e=>[e.label,`${(0,h.h)(t[e.prop],this.dropdowns[e.prop])}`]));return Object.fromEntries(o)}));return t}}}},b=y,f=o(1001),g=(0,f.Z)(b,d,u,!1,null,"eb45b50c",null),w=g.exports}}]);