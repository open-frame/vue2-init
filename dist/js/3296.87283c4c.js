"use strict";(self["webpackChunkiov_platform"]=self["webpackChunkiov_platform"]||[]).push([[3296],{43296:function(e,t,o){o.r(t),o.d(t,{default:function(){return k}});var r=o(48103),a=o(42355),i=o(66654),l=o(63598),n=o(71377),s=o(75267),u=o(67539),m=function(){var e=this,t=e._self._c;return t("el-card",{staticClass:"event"},[t(u.Z,{attrs:{loading:e.loading,btnSpan:10,getData:e.getData,queryReset:e.queryReset}},[t("el-col",{attrs:{span:6}},[t(s.Z,{attrs:{clearable:"",size:"medium",placeholder:"活动名称"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.eventName,callback:function(t){e.$set(e.queryForm,"eventName",t)},expression:"queryForm.eventName"}})],1),t("el-col",{attrs:{span:4}},[t(s.Z,{attrs:{clearable:"",size:"medium",placeholder:"活动编号"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.eventNo,callback:function(t){e.$set(e.queryForm,"eventNo",t)},expression:"queryForm.eventNo"}})],1),t("el-col",{attrs:{span:4}},[t(n["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"活动状态"},model:{value:e.queryForm.eventStatus,callback:function(t){e.$set(e.queryForm,"eventStatus",t)},expression:"queryForm.eventStatus"}},e._l(e.dropdowns.eventStatus,(function(e,o){return t("el-option",{key:o,attrs:{label:e.code_name,value:e.code_value}})})),1)],1)],1),t("el-divider"),t(l.Z,{ref:"table",attrs:{loading:e.loading,total:e.total,data:e.tableData,height:"600","row-key":"eventNo","page-size":e.queryForm.pageSize,"current-page":e.queryForm.pageNum},on:{"size-change":e.dataSizeChange,"current-change":e.handleCurrentChange},scopedSlots:e._u([{key:"left",fn:function(){return[t("el-button",{attrs:{size:"small",icon:"el-icon-edit"},on:{click:function(t){return e.openEditEventsDialog("add")}}},[e._v("发布")])]},proxy:!0},{key:"columns",fn:function(){return[t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"活动名称",prop:"eventName"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"活动编号",prop:"eventNo"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"活动类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.promoType,e.dropdowns.promoType))+" ")]}}])}),t("el-table-column",{attrs:{label:"首页推送图例",prop:"pop"},scopedSlots:e._u([{key:"default",fn:function(o){return[o.row.pop?t("div",[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.seePictrue(o.row.pop)}}},[e._v("查看")]),"1"===o.row.eventStatus?t("el-button",{staticClass:"ms-3 text-primary",attrs:{type:"text"},on:{click:function(t){return e.openFullScreenDialog(o)}}},[e._v("换图")]):e._e()],1):e._e(),o.row.pop||"1"!==o.row.eventStatus?e._e():t("el-button",{staticClass:"text-danger",attrs:{type:"text",title:"在此上传的图片会显示在用户首页的banner处"},on:{click:function(t){return e.openFullScreenDialog(o)}}},[e._v("未上传")])]}}])}),t("el-table-column",{attrs:{label:"活动封面图例",prop:"pop1"},scopedSlots:e._u([{key:"default",fn:function(o){return[o.row.pop1?t("div",[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.seePictrue(o.row.pop1)}}},[e._v("查看")]),"1"===o.row.eventStatus?t("el-button",{staticClass:"ms-3 text-primary",attrs:{type:"text",title:"在此上传的图片会显示在用户活动列表的封面"},on:{click:function(t){return e.openFullScreenDialog(o)}}},[e._v("换图")]):e._e()],1):e._e(),o.row.pop1||"1"!==o.row.eventStatus?e._e():t("el-button",{staticClass:"text-danger",attrs:{type:"text"},on:{click:function(t){return e.openFullScreenDialog(o)}}},[e._v("未上传")])]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"有效期",prop:"beginTime",width:"290"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.beginTime)+" 至 "+e._s(t.row.endTime)+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"活动主体"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.eventMain,e.dropdowns.eventMain))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.eventStatus,e.dropdowns.eventStatus))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"发布时间",prop:"operationTime",width:"180"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"发布人",prop:"operatorName"}}),t("el-table-column",{attrs:{label:"操作",width:"150",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-button",{attrs:{size:"mini",plain:"",type:"primary"},on:{click:function(t){return e.openEditEventsDialog("detail",o.row)}}},[e._v("详情")]),"1"===o.row.eventStatus?t("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.endEvent(o.row)}}},[e._v("结束")]):e._e()]}}])})]},proxy:!0}])}),t("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.submitLoading,expression:"submitLoading"}],staticClass:"edit-events-dialog",attrs:{"close-on-click-modal":!1,"append-to-body":!0,"modal-append-to-body":!1,title:e.dialogText,visible:e.dialogVisible,"before-close":e.closeEditEventsDialog,"element-loading-text":"正在提交","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"}},[t("el-form",{ref:"ruleForm",attrs:{model:e.submiteForm,rules:e.rules,"label-width":"130px"}},[t("el-form-item",{attrs:{label:"活动编号",prop:"eventNo"}},[t("el-input",{attrs:{clearable:""},model:{value:e.submiteForm.eventNo,callback:function(t){e.$set(e.submiteForm,"eventNo",t)},expression:"submiteForm.eventNo"}})],1),t("el-form-item",{attrs:{label:"活动名称",prop:"eventName"}},[t("el-input",{attrs:{clearable:"",maxlength:12},model:{value:e.submiteForm.eventName,callback:function(t){e.$set(e.submiteForm,"eventName",t)},expression:"submiteForm.eventName"}})],1),t("el-form-item",{attrs:{label:"活动类型",prop:"promoType"}},[t("el-select",{attrs:{filterable:"","default-first-option":"",clearable:"",placeholder:""},on:{change:e.selectPromoType,focus:e.focusCouponFormDrawer},model:{value:e.submiteForm.promoType,callback:function(t){e.$set(e.submiteForm,"promoType",t)},expression:"submiteForm.promoType"}},e._l(e.dropdowns.promoType,(function(e,o){return t("el-option",{key:o,attrs:{label:e.code_name,value:e.code_value}})})),1),t("CouponForm",{ref:"CouponForm",attrs:{show:e.showCouponFormDrawer,data:e.submiteForm.eventSetings},on:{"before-close":e.closeCouponFormDrawer,submit:e.submitCouponForm}})],1),t("el-form-item",{attrs:{label:"有效期",required:""}},[t("el-col",{attrs:{span:11}},[t("el-form-item",{attrs:{prop:"beginTime"}},[t("el-date-picker",{attrs:{type:"datetime",placeholder:"开始时间",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss","picker-options":e.pickerOptions},model:{value:e.submiteForm.beginTime,callback:function(t){e.$set(e.submiteForm,"beginTime",t)},expression:"submiteForm.beginTime"}})],1)],1),t("el-col",{staticClass:"text-center",attrs:{span:2}},[e._v("至")]),t("el-col",{attrs:{span:11}},[t("el-form-item",{attrs:{prop:"endTime"}},[t("el-date-picker",{attrs:{type:"datetime",placeholder:"结束时间",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss","picker-options":e.pickerOptions},model:{value:e.submiteForm.endTime,callback:function(t){e.$set(e.submiteForm,"endTime",t)},expression:"submiteForm.endTime"}})],1)],1)],1),t("el-form-item",{attrs:{label:"发布主体",prop:"eventMain"}},[t("el-select",{attrs:{filterable:"","default-first-option":"",clearable:"",placeholder:""},model:{value:e.submiteForm.eventMain,callback:function(t){e.$set(e.submiteForm,"eventMain",t)},expression:"submiteForm.eventMain"}},e._l(e.dropdowns.eventMain,(function(e,o){return t("el-option",{key:o,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-form-item",{attrs:{label:"生效片区",prop:"eventPublishSetings"}},[t(i.Z,{ref:"custom-area-select",attrs:{showSelectAll:!0,multiple:!0,placeholder:""},model:{value:e.submiteForm.eventPublishSetings,callback:function(t){e.$set(e.submiteForm,"eventPublishSetings",t)},expression:"submiteForm.eventPublishSetings"}})],1),t("el-form-item",{attrs:{label:"活动总额",prop:"eventMoney"}},[t("el-input-number",{attrs:{precision:2,"controls-position":"right",step:100},model:{value:e.submiteForm.eventMoney,callback:function(t){e.$set(e.submiteForm,"eventMoney",t)},expression:"submiteForm.eventMoney"}})],1),t("el-form-item",{attrs:{label:"优惠券限额类别",prop:"limitType"}},[t("el-select",{attrs:{filterable:"","default-first-option":"",clearable:"",placeholder:""},model:{value:e.submiteForm.limitType,callback:function(t){e.$set(e.submiteForm,"limitType",t)},expression:"submiteForm.limitType"}},e._l(e.dropdowns.limitType,(function(e,o){return t("el-option",{key:o,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-form-item",{attrs:{label:"发布状态",prop:"eventStatus"}},[t("el-select",{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:""},model:{value:e.submiteForm.eventStatus,callback:function(t){e.$set(e.submiteForm,"eventStatus",t)},expression:"submiteForm.eventStatus"}},e._l(e.dropdowns.eventStatus,(function(e,o){return t("el-option",{key:o,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-form-item",{attrs:{label:"参与限制",prop:"limitNumber"}},[e._v(" 活动期内每个用户可参与 "),t("el-input-number",{staticClass:"event-join",attrs:{precision:0,"controls-position":"right",step:1},model:{value:e.submiteForm.limitNumber,callback:function(t){e.$set(e.submiteForm,"limitNumber",t)},expression:"submiteForm.limitNumber"}}),e._v(" 次 ")],1),t("el-form-item",{staticClass:"editor-form-item",attrs:{label:"活动说明",prop:"eventRemark"}},[t(a["default"],{model:{value:e.submiteForm.eventRemark,callback:function(t){e.$set(e.submiteForm,"eventRemark",t)},expression:"submiteForm.eventRemark"}})],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},["添加活动"===e.dialogText?t("el-button",{attrs:{type:"primary",loading:e.submitLoading,disabled:e.submitLoading},on:{click:function(t){return e.submitingForm("ruleForm")}}},[e._v("提 交")]):e._e(),t("el-button",{on:{click:e.closeEditEventsDialog}},[e._v("关 闭")])],1)],1),t(r.Z,{attrs:{data:e.thisData,title:e.uploadPictrueTitle,url:e.uploadPictruePath,show:e.showUploadPictrueDialog,placeholder:""},on:{success:e.getData,"before-close":e.closeUploadPictrueDialog}})],1)},p=[],c=(o(57658),o(89176)),d=o(5376),b=o(37662),g=o(90886),v=o(30741),h={name:"operational-events-index",mixins:[v.LI,v.I_,v.oA,v.vd],filters:{transfortext:g.h},components:{articleEditor:()=>Promise.resolve().then(o.bind(o,42355)),CouponForm:()=>o.e(3207).then(o.bind(o,13207))},data(){return{loading:!1,dropdowns:{eventStatus:[],eventMain:[],promoType:[],range:[],limitType:[]},queryForm:{eventName:"",eventNo:"",eventStatus:"",pageSize:this.$tableDataSize,pageNum:1},tableData:[],total:0,dialogText:"",dialogVisible:!1,couponValidityTime:"",showUploadPictrueDialog:!1,uploadPictruePath:"",uploadPictrueTitle:"",thisData:{},showCouponFormDrawer:!1,pickerOptions:{disabledDate(e){return e.getTime()<Date.now()-864e5}},submiteForm:{eventNo:"",eventName:"",eventMain:"",eventLimit:"",people:"",beginTime:"",endTime:"",promoType:"",eventStatus:"",eventMoney:null,limitNumber:null,limitType:"",eventSetings:[],eventPublishSetings:[],eventRemark:""},rules:f,submitLoading:!1}},created(){this.getDropdowns()},methods:{getData(){this.tableData=[],this.loading=!0,(0,c.U3)(this.queryForm).then((e=>{this.loading=!1,0===e.code&&(this.tableData=e.rows,this.total=e.total)})).catch((()=>{this.loading=!1}))},getDropdowns(){(0,d.Wl)("3035").then((e=>{0===e.code&&(this.dropdowns.eventStatus=e.data)})),(0,d.Wl)("3034").then((e=>{0===e.code&&(this.dropdowns.promoType=e.data)})),(0,d.Wl)("3032").then((e=>{0===e.code&&(this.dropdowns.eventMain=e.data)})),(0,d.Wl)("3047").then((e=>{0===e.code&&(this.dropdowns.limitType=e.data)}))},openEditEventsDialog(e,t){this.dialogVisible=!0,this.$nextTick((()=>{this.$refs["ruleForm"].resetFields(),"add"===e?(this.dialogText="添加活动",this.addFormValidator(),this.submiteForm.eventNo=(0,b.at)()):(this.dialogText="活动详情",this.eventDetail(t),this.deleteFormValidator())}))},addFormValidator(){const e=this;this.$nextTick((()=>{e.$refs["ruleForm"].rules.eventNo.find((e=>e.validator))||e.$refs["ruleForm"].rules.eventNo.push({validator:(e,t,o)=>{(0,c.mH)({eventNo:t}).then((e=>{1===e.data?o(new Error("活动编号已存在")):o()}))},trigger:"blur"})}))},deleteFormValidator(){const e=this;this.$nextTick((()=>{e.$refs["ruleForm"].rules.eventNo.forEach(((e,t)=>{e.validator&&(e.validator=null)}))}))},eventDetail(e){(0,c.Co)({eventNo:e.eventNo}).then((e=>{this.showCouponFormDrawer=!0,this.submiteForm=e.data}))},closeEditEventsDialog(){this.dialogVisible=!1,this.$refs["ruleForm"].resetFields(),this.$refs.CouponForm.clearnEditEventTable(),this.$refs.CouponForm.close()},focusCouponFormDrawer(){this.submiteForm.promoType&&(this.showCouponFormDrawer=!0)},selectPromoType(e){this.$refs.CouponForm.clearnEditEventTable(),this.showCouponFormDrawer=!0},submitingForm(e){this.$refs[e].validate((e=>{e&&("添加活动"===this.dialogText?this.add():this.modification())}))},add(){this.submitLoading=!0,this.$refs.CouponForm.ok(),(0,c.vP)(this.submiteForm).then((e=>{0===e.code&&(this.$message.success("发布成功"),this.closeEditEventsDialog(),this.getData()),this.submitLoading=!1}))},endEvent(e){(0,c.EF)({eventNo:e.eventNo,eventStatus:"2"}).then((e=>{0===e.code&&(this.$message.success("已结束"),this.getData())}))},seePictrue(e){window.open("https://edo-iot.oss-cn-wulanchabu.aliyuncs.com/"+e,"_blank","location=no, status=no, menubar=no")},openFullScreenDialog(e){"pop"===e.column.property&&(this.uploadPictrueTitle="上传开屏活动图例",this.uploadPictruePath="/model/activity/uploadImage"),"pop1"===e.column.property&&(this.uploadPictrueTitle="上传活动封面图",this.uploadPictruePath="/model/activity/uploadEventImage"),this.thisData={eventNo:e.row.eventNo},this.showUploadPictrueDialog=!0},closeUploadPictrueDialog(e){this.showUploadPictrueDialog=e,this.uploadPictruePath=""},closeCouponFormDrawer(e){this.showCouponFormDrawer=e},submitCouponForm(e){this.submiteForm.eventSetings=e.eventSetings}}};const f={eventNo:[{required:!0,message:"请输入活动编号",trigger:"blur"},{pattern:/^[^<|>|(|)|+|-|*|/|%|=|{|}]*$/,message:"禁止< > ( ) + - * / % = { }等特殊字符",trigger:"blur"},{min:3,max:48,message:"长度在 3 到 48 个字符",trigger:"blur"}],eventName:[{required:!0,message:"请输入活动名称",trigger:"blur"},{pattern:/^[^<|>|(|)|+|-|*|/|%|=|{|}]*$/,message:"禁止< > ( ) + - * / % = { }等特殊字符",trigger:"blur"},{min:3,max:18,message:"长度在 3 到 18 个字符",trigger:"blur"}],beginTime:[{required:!0,message:"请选择活动开始时间",trigger:"blur"}],endTime:[{required:!0,message:"请选择活动结束时间",trigger:"blur"}],eventMoney:[{required:!0,message:"请输入活动总额",trigger:"blur"},{type:"number",min:.01,max:99999999,message:"活动总额在0.01-99999999元之间",trigger:"blur"}],limitNumber:[{required:!0,message:"请输入用户的参与限制次数",trigger:"change"},{type:"number",min:1,max:999,message:"每位用户可参与1-999次",trigger:"blur"}],eventMain:[{required:!0,message:"请选择活动主体",trigger:"change"}],eventLimit:[{required:!0,message:"请选择活动范围电站",trigger:"change"}],people:[{required:!0,message:"请选择活动范围人群",trigger:"change"}],promoType:[{required:!0,message:"请选择优惠类型",trigger:"change"}],limitType:[{required:!0,message:"请选择限额类别",trigger:"change"}],eventStatus:[{required:!0,message:"请选择发布状态",trigger:"change"}],eventPublishSetings:[{required:!0,message:"请至少选择一个生效的电站片区",trigger:"change"}],eventRemark:[{required:!0,message:"请输入活动说明",trigger:"blur"},{min:3,max:9999999999,message:"长度在 3 到 9999999999 个字符",trigger:"blur"}]};var y=h,F=o(1001),w=(0,F.Z)(y,m,p,!1,null,"118e04ea",null),k=w.exports}}]);