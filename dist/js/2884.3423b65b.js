"use strict";(self["webpackChunkiov_platform"]=self["webpackChunkiov_platform"]||[]).push([[2884],{72884:function(e,t,s){s.r(t),s.d(t,{default:function(){return u}});var a=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{"close-on-click-modal":!1,"append-to-body":!0,"modal-append-to-body":!1,title:e.forms.stationNo+"设备版本升级",visible:e.show,"show-close":!1}},[t("el-form",{ref:"undata-form",attrs:{model:e.forms,rules:e.rules,"label-width":"120px"}},[t("el-form-item",{attrs:{label:"新版本号",prop:"taskVersion"}},[t("el-input",{attrs:{clearable:""},model:{value:e.forms.taskVersion,callback:function(t){e.$set(e.forms,"taskVersion",t)},expression:"forms.taskVersion"}})],1),t("el-form-item",{attrs:{label:"升级文件",prop:"file"}},[t("el-upload",{ref:"upload-file",attrs:{accept:".bin",action:e.updataFileURL,headers:e.uploadHeaders,"auto-upload":!1,data:e.parms,"on-success":e.updataSuccess,"on-error":e.onLoadingClose,limit:1,"on-change":e.selectFile,"on-remove":e.selectFile,"file-list":e.forms.file}},[t("el-button",{attrs:{slot:"trigger",type:"text"},slot:"trigger"},[e._v("请选择.bin文件")])],1)],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.close}},[e._v("关闭")]),t("el-button",{attrs:{type:"primary",loading:e.updataLoading},on:{click:e.submitForm}},[e._v("确定")])],1)],1)},o=[],r={name:"",props:{show:{type:Boolean,default:!1},data:{type:Object,required:!0}},watch:{data(e){e.stationNo&&(this.parms.stakeInfo.stationNo=e.stationNo,this.parms.stakeInfo.stake=e.stake.map((e=>({stakeNo:e.stakeNo,firewareVersion:e.firewareVersion}))))},"forms.taskVersion"(e){this.parms.stakeInfo.taskVersion=e}},data(){return this.rules=i,{updataFileURL:"",uploadHeaders:{Authorization:`Bearer ${localStorage.getItem("token")}`},forms:{taskVersion:"",file:[]},parms:{stakeInfo:{}},updataLoading:null}},created(){this.updataFileURL="https://clw.edo-iot.com/yscar/asset/version/updateVersion"},methods:{selectFile(e,t){this.forms.file=t},submitForm(){this.$refs["undata-form"].validate((e=>{e&&(this.parms.stakeInfo=JSON.stringify(this.parms.stakeInfo),this.$refs["upload-file"].submit(),this.updataLoading=this.$loading({target:".el-dialog__body",lock:!0,text:"数据提交中",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.55)"}))}))},updataSuccess(e,t,s){if(this.onLoadingClose(),2001===e.code)return this.$store.commit("logout","1");0===e.code?(this.$message.success(e.msg),this.close(),this.$emit("success")):this.$message({type:"error",duration:4e3,message:e.msg})},onLoadingClose(){this.updataLoading.close(),this.updataLoading=null},close(){this.$refs["undata-form"].resetFields(),this.$refs["upload-file"].clearFiles(),this.$emit("close",!1),null!==this.updataLoading&&this.$refs["upload-file"].abort()}}};const i={taskVersion:[{required:!0,message:"请输入设备版本号",trigger:"blur"},{pattern:/^[^<|>|(|)|+|-|*|/|%|=|{|}]*$/,message:"禁止< > ( ) + - * / % = { }等特殊字符",trigger:"blur"},{min:1,max:24,message:"长度在 1 到 5 个字24",trigger:"blur"}],file:[{required:!0,message:"请选择升级的设备",trigger:"change"}]};var l=r,n=s(1001),d=(0,n.Z)(l,a,o,!1,null,"c0939b32",null),u=d.exports}}]);