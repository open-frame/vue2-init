"use strict";(self["webpackChunkedo_project"]=self["webpackChunkedo_project"]||[]).push([[798,9844],{798:function(e,t,s){s.r(t),s.d(t,{default:function(){return v}});var r=function(){var e=this,t=e._self._c;return t("el-card",{staticClass:"operation"},[t("el-row",{staticClass:"filters",attrs:{gutter:20}},[t("el-col",{attrs:{span:4}},[t("el-input",{attrs:{clearable:"",size:"medium",placeholder:"登录账号"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.loginName,callback:function(t){e.$set(e.queryForm,"loginName",t)},expression:"queryForm.loginName"}})],1),t("el-col",{attrs:{span:4}},[t("el-input",{attrs:{clearable:"",size:"medium",placeholder:"手机号码"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.phonenumber,callback:function(t){e.$set(e.queryForm,"phonenumber",t)},expression:"queryForm.phonenumber"}})],1),t("el-col",{attrs:{span:4}},[t("el-select",{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"账号状态"},on:{change:e.pageReset},model:{value:e.queryForm.status,callback:function(t){e.$set(e.queryForm,"status",t)},expression:"queryForm.status"}},e._l(e.dropdowns.status,(function(e){return t("el-option",{key:e.code_value,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{staticClass:"text-end",attrs:{span:12}},[t("el-button",{attrs:{size:"medium",type:"primary"},on:{click:e.getData}},[e._v("搜索")]),t("el-button",{attrs:{size:"medium"},on:{click:e.reset}},[e._v("重置")])],1)],1),t("el-divider"),t("edo-table",{attrs:{loading:e.loading,total:e.total,data:e.tableData,height:"600","row-key":"userId","page-size":e.queryForm.pageSize,"current-page":e.queryForm.pageNum},on:{"selection-change":e.selectingdata,"size-change":e.dataSizeChange,"current-change":e.handleCurrentChange,exporting:e.exporting},scopedSlots:e._u([{key:"left",fn:function(){return[t("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"function_edit",expression:"'function_edit'"}],attrs:{size:"small",icon:"el-icon-plus"},on:{click:function(t){return e.editing("add")}}},[e._v("新增")]),t("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"function_delete",expression:"'function_delete'"}],attrs:{size:"small",icon:"el-icon-delete"},on:{click:function(t){return e.deleteing("more")}}},[e._v("删除")])]},proxy:!0},{key:"columns",fn:function(){return[t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"用户id",prop:"userId"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"登录账号",prop:"loginName"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"客户姓名",prop:"userName"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"客户性别"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("CodeTransforText")(t.row.sex,e.dropdowns.sex))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"隶属组织",prop:"deptName"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"联系方式",prop:"phonenumber"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"邮箱",prop:"email"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"客户状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("CodeTransforText")(t.row.status,e.dropdowns.status,{name:"code_name",value:"code_value"}))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"加入时间",prop:"createTime"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"操作",width:"280",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"function_edit",expression:"'function_edit'"}],attrs:{plain:"",type:"primary",size:"mini"},on:{click:function(t){return e.editing("modification",s.row)}}},[e._v("编辑")]),t("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"function_delete",expression:"'function_delete'"}],attrs:{plain:"",type:"danger",size:"mini"},on:{click:function(t){return e.deleteing("one",s.row)}}},[e._v("删除")]),t("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"function_password",expression:"'function_password'"}],attrs:{plain:"",size:"mini"},on:{click:function(t){return e.resetPassWord(s.row)}}},[e._v("修改密码")])]}}])})]},proxy:!0}])}),t("el-dialog",{attrs:{"close-on-click-modal":!1,"append-to-body":!0,"modal-append-to-body":!1,title:e.dialogText,visible:e.showEditFormDialogrVisible,"show-close":!1}},[t("el-form",{ref:"submitUserForm",attrs:{model:e.submitUserForm,rules:e.rules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"登陆账号",prop:"loginName"}},[t("el-input",{attrs:{clearable:"",readonly:"新增用户"!==e.dialogText,placeholder:"建议用个人手机号为登录账号"},model:{value:e.submitUserForm.loginName,callback:function(t){e.$set(e.submitUserForm,"loginName",t)},expression:"submitUserForm.loginName"}})],1),t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"新增用户"===e.dialogText,expression:"dialogText === '新增用户'"}],attrs:{label:"登陆密码",prop:"password"}},[t("el-input",{attrs:{clearable:"","show-password":"",autocomplete:"new-password"},model:{value:e.submitUserForm.password,callback:function(t){e.$set(e.submitUserForm,"password",t)},expression:"submitUserForm.password"}})],1),t("el-form-item",{attrs:{label:"姓名",prop:"userName"}},[t("el-input",{attrs:{clearable:""},model:{value:e.submitUserForm.userName,callback:function(t){e.$set(e.submitUserForm,"userName",t)},expression:"submitUserForm.userName"}})],1),t("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[t("el-input",{attrs:{clearable:""},model:{value:e.submitUserForm.email,callback:function(t){e.$set(e.submitUserForm,"email",t)},expression:"submitUserForm.email"}})],1),t("el-form-item",{attrs:{label:"手机号",prop:"phonenumber"}},[t("el-input",{attrs:{clearable:""},model:{value:e.submitUserForm.phonenumber,callback:function(t){e.$set(e.submitUserForm,"phonenumber",t)},expression:"submitUserForm.phonenumber"}})],1),t("el-form-item",{attrs:{label:"性别"}},[t("el-select",{attrs:{filterable:"","default-first-option":"",clearable:"",placeholder:""},model:{value:e.submitUserForm.sex,callback:function(t){e.$set(e.submitUserForm,"sex",t)},expression:"submitUserForm.sex"}},[t("el-option",{attrs:{label:"男",value:"0"}}),t("el-option",{attrs:{label:"女",value:"1"}})],1)],1),t("el-form-item",{attrs:{label:"角色",prop:"roleIds"}},[t("el-select",{attrs:{filterable:"","default-first-option":"",multiple:"",clearable:"",placeholder:""},on:{change:e.selectUserRole},model:{value:e.submitUserForm.roleIds,callback:function(t){e.$set(e.submitUserForm,"roleIds",t)},expression:"submitUserForm.roleIds"}},e._l(e.dropdowns.roles,(function(e){return t("el-option",{key:e.roleId,attrs:{label:e.roleName,value:e.roleId.toString()}})})),1)],1),t("el-form-item",{attrs:{label:"状态",prop:"status"}},[t("el-select",{attrs:{filterable:"","default-first-option":"",clearable:"",placeholder:""},model:{value:e.submitUserForm.status,callback:function(t){e.$set(e.submitUserForm,"status",t)},expression:"submitUserForm.status"}},e._l(e.dropdowns.status,(function(e,s){return t("el-option",{key:s,attrs:{label:e.code_name,value:e.code_value}})})),1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.showEditFormDialogrVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.showEditFormDialogrVisible=!1}}},[e._v("确 定")])],1)],1)],1)},o=[],a=(s(7658),s(6342)),i=s(1182),l=s(6795),n=s(9844),u=s(4287),m=s(4116),d=s(4996),c=s(2503),p={name:"management-operation-index",mixins:[m.Z,d.Z,c.Z],directives:{permission:n.r},filters:{CodeTransforText:u.C},data(){return{showEditFormDialogrVisible:!1,loading:!1,time:"",queryForm:{deptCode:"",parentCode:"",loginName:"",phonenumber:"",status:"",beginTime:"",endTime:"",pageSize:this.$tableDataSize,pageNum:1,orderByColumn:"",isAsc:"asc"},tableData:[],total:0,moreSelect:[],dialogText:"",dropdowns:{sex:[{name:"男",value:"0"},{name:"女",value:"1"}],status:[{code_name:"正常",code_value:"1"},{code_name:"冻结",code_value:"0"}],roles:[]},submitUserForm:{loginName:"",password:"",deptCode:"",deptName:"",phonenumber:"",userName:"",email:"",sex:"",status:"",roleIds:[]},rules:b}},created(){this.getData()},methods:{getDropdowns(){l.Z.dropdowns("477924").then((e=>{0===e.code&&(this.dropdowns.status=e.data)})),l.Z.dropdowns("035927").then((e=>{0===e.code&&(this.dropdowns.sex=e.data)}))},selectTime(e){this.queryForm.pageNum=1,null===e?(this.queryForm.beginTime="",this.queryForm.endTime=""):(this.queryForm.beginTime=e[0],this.queryForm.endTime=e[1])},getData(){this.loading=!0,a.Z.operationUsers(this.queryForm).then((e=>{this.loading=!1,0===e.code&&(this.total=e.total,this.tableData=e.rows)}))},selectingdata(e){this.moreSelect=e},closeEditDialog(){for(let e in this.submitUserForm)this.submitUserForm[e]="";this.submitUserForm.roleIds=[]},editing(e,t){this.showEditFormDialogrVisible=!0,"add"===e?(this.dialogText="新增用户",delete this.submitUserForm.userId,this.rules.password=[{required:!0,message:"密码为必填项！",trigger:"blur"},{pattern:/^[^<|>|(|)|+|-|*|/|%|=|{|}]*$/,message:"禁止< > ( ) + - * / % = { }等特殊字符",trigger:"blur"},{min:4,max:48,message:"长度在 4 到 2048 个字符",trigger:"blur"}]):(this.dialogText="修改用户",this.rules.password=[],this.deleteFormValidator(),a.Z.operationUserDetail(t.userId).then((e=>{this.submitUserForm.loginName=e.data.user.loginName,this.submitUserForm.password=e.data.user.password,this.submitUserForm.deptCode=e.data.user.deptCode,this.submitUserForm.deptName=e.data.user.deptName,this.submitUserForm.phonenumber=e.data.user.phonenumber,this.submitUserForm.userName=e.data.user.userName,this.submitUserForm.email=e.data.user.email,this.submitUserForm.sex=e.data.user.sex,this.submitUserForm.status=e.data.user.status,this.submitUserForm.roleIds=e.data.role,this.submitUserForm.userId=e.data.user.userId}))),l.Z.allRoles().then((e=>{0===e.code&&(this.dropdowns.roles=e.data.roles)}))},deleteFormValidator(){const e=this;this.$nextTick((()=>{e.$refs["submitUserForm"].rules.loginName.forEach(((e,t)=>{e.validator&&(e.validator=null)}))}))},selectUserRole(e){this.submitUserForm.roleIds=e},submitForm(e,t){this.$refs[e].validate((e=>{e&&("修改用户"===t&&delete this.submitUserForm.password,a.Z["新增用户"===t?"addOperationUsers":"editOperationUsers"](this.submitUserForm).then((e=>{if(0===e.code){if(this.$message.success(e.msg),"修改用户"===t&&this.$store.state.userInfo.loginName===this.submitUserForm.loginName)return void location.reload();this.closeEditFormVisible("submitUserForm",this.closeEditDialog()),this.getData()}})))}))},deleteing(e,t){if("more"===e&&this.moreSelect.length<1)return this.$message.warning("请选择删除项"),!1;this.$confirm("一旦删除不可恢复，确定删除？","删除提醒",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"放弃"}).then((()=>{let s;if("one"===e)s=t.userId;else{s=[];for(let e of this.moreSelect)s.push(e.userId);s=s.join()}a.Z.deleteOperationUsers({ids:s}).then((e=>{0===e.code&&(this.$message.success("删除成功"),this.getData(),this.moreSelect=[])}))})).catch((()=>{}))},resetPassWord(e){const t=this;this.$prompt(`请【${e.userName}】输入新密码：`,"修改密码",{confirmButtonText:"重置",cancelButtonText:"取消"}).then((s=>{a.Z.operationUsersResetPassWord({userId:e.userId,loginName:e.loginName,password:s.value}).then((()=>{t.$message.success("修改成功")}))})).catch((()=>{}))},exporting(e){if(this.tableData.length<1)return this.$message.warning("无数据可导"),!1;const t=this.$loading({lock:!0,text:"正在获取数据...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});let s={...this.queryForm};"2"===e&&(s.pageSize=this.total,s.pageNum=1),a.Z.operationUsers(s).then((e=>{if(0===e.code){t.text="正在下载...";const s=e.rows.map((e=>({"用户ID":e.userId,"登陆账号":e.loginName,"昵称":e.userName,"隶属组织":e.deptName,"联系方式":e.phonenumber,"使用状态":`${this.$options.filters.CodeTransforText(e.status,this.dropdowns.status)}`,"创建时间":e.createTime})));i.Z.excel(s,"运营用户列表")}})).finally((()=>{t.close()}))}}};const b={loginName:[{required:!0,message:"登录账号为必填项！",trigger:"blur"},{pattern:/^[A-Za-z0-9]+$/,message:"只能为数字、字母",trigger:"blur"},{min:2,max:48,message:"长度在 2 到 48 个字符",trigger:"blur"}],deptCode:[{required:!0,message:"组织为必选项！"}],userName:[{required:!0,message:"客户姓名为必填项！",trigger:"blur"},{pattern:/^[\u4e00-\u9fa5]*$/,message:"只能为中文名字",trigger:"blur"},{min:2,max:12,message:"长度在 2 到 12 个字符",trigger:"blur"}],phonenumber:[{required:!0,message:"联系方式为必填项！",trigger:"blur"},{pattern:/^[0-9]+$/,message:"只能为数字",trigger:"blur"},{min:7,max:16,message:"长度在 7 到 16 个字符",trigger:"blur"}],email:[{required:!0,message:"邮箱为必填项！",trigger:"blur"},{pattern:/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,message:"规则错误",trigger:"blur"},{min:5,max:48,message:"长度在 5 到 48 个字符",trigger:"blur"}],roleIds:[{type:"array",required:!0,message:"至少选择一个用户赋予的角色",trigger:"change"}],status:[{required:!0,message:"账号的状态必选！",trigger:"change"}]};var g=p,h=s(1001),f=(0,h.Z)(g,r,o,!1,null,"484f9606",null),v=f.exports},9844:function(e,t,s){s.d(t,{J:function(){return i},r:function(){return a}});var r=s(8854),o=s(5114);const a={bind(e,t,s,r){},inserted(e,t,s,o){const a=[...r.Z.state.permissionPublic,...r.Z.state.permissionButtons];a.includes(t.value)||e.parentNode&&e.parentNode.removeChild(e)},update(e,t,s,r){},componentUpdated(e,t,s,r){},unbind(e,t,s,r){}};function i(e,t){e.onclick=function(){if(!t.value&&!e.innerText)return;let s=document.createElement("textarea");s.readOnly="readonly",s.value=t.value||e.innerText,e.appendChild(s),s.select();const r=document.execCommand("Copy");r?o.Notification.success({duration:1800,title:"复制成功",message:s.value,type:"success"}):o.Notification.error({title:"错误",message:"复制失败"}),e.removeChild(s)}}}}]);