"use strict";(self["webpackChunkedo_project"]=self["webpackChunkedo_project"]||[]).push([[5298],{5298:function(e,t,r){r.r(t),r.d(t,{default:function(){return b}});var o=function(){var e=this,t=e._self._c;return t("el-card",{staticClass:"role"},[t("el-row",{attrs:{gutter:40}},[t("el-col",{attrs:{span:4}},[t("el-input",{attrs:{clearable:"",size:"medium",placeholder:"角色名称"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.roleName,callback:function(t){e.$set(e.queryForm,"roleName",t)},expression:"queryForm.roleName"}})],1),t("el-col",{attrs:{span:4}},[t("el-input",{attrs:{clearable:"",size:"medium",placeholder:"权限字符"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.roleKey,callback:function(t){e.$set(e.queryForm,"roleKey",t)},expression:"queryForm.roleKey"}})],1),t("el-col",{attrs:{span:4}},[t("el-select",{attrs:{clearable:"",size:"medium",placeholder:"角色状态"},on:{change:e.pageReset},model:{value:e.queryForm.status,callback:function(t){e.$set(e.queryForm,"status",t)},expression:"queryForm.status"}},e._l(e.dropdowns.status,(function(e,r){return t("el-option",{key:r,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{staticClass:"text-end",attrs:{span:12}},[t("el-button",{attrs:{type:"primary"},on:{click:e.getData}},[e._v("搜索")]),t("el-button",{on:{click:e.reset}},[e._v("重置")])],1)],1),t("el-divider"),t("edo-table",{attrs:{loading:e.loading,total:e.total,data:e.tableData,height:"550","row-key":"roleId","page-size":e.queryForm.pageSize,"current-page":e.queryForm.pageNum},on:{"selection-change":e.selectedDate,"size-change":e.dataSizeChange,"current-change":e.handleCurrentChange,exporting:e.exporting,printing:e.printing},scopedSlots:e._u([{key:"left",fn:function(){return[t("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"function_edit",expression:"'function_edit'"}],attrs:{size:"small",icon:"el-icon-plus"},on:{click:function(t){return e.editing("add")}}},[e._v("新增")]),t("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"function_delete",expression:"'function_delete'"}],attrs:{size:"small",icon:"el-icon-delete"},on:{click:function(t){return e.deleteing("more")}}},[e._v("删除")])]},proxy:!0},{key:"columns",fn:function(){return[t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"角色id",prop:"roleId"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"角色名称",prop:"roleName"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"权限字符",prop:"roleKey"},scopedSlots:e._u([{key:"default",fn:function(r){return t("span",{directives:[{name:"copy",rawName:"v-copy"}]},[e._v(" "+e._s(r.row.roleKey)+" ")])}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"角色状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("CodeTransforText")(t.row.status,e.dropdowns.status,{name:"code_name",value:"code_value"}))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"操作时间",prop:"createTime"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"操作",width:"240",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"function_edit",expression:"'function_edit'"}],attrs:{plain:"",type:"primary",size:"small"},on:{click:function(t){return e.editing("modification",r.row)}}},[e._v("编辑")]),t("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"function_delete",expression:"'function_delete'"}],attrs:{plain:"",type:"danger",size:"small"},on:{click:function(t){return e.deleteing("one",r.row)}}},[e._v("删除")])]}}])})]},proxy:!0}])}),t("el-dialog",{attrs:{"close-on-click-modal":!1,"append-to-body":!0,"modal-append-to-body":!1,title:e.dialogText+"角色",visible:e.dialogVisible,"before-close":e.closeSeeDetail}},[t("el-form",{ref:"roleForm",attrs:{model:e.roleForm,rules:e.rules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"角色名称：",prop:"roleName"}},[t("el-input",{attrs:{clearable:""},model:{value:e.roleForm.roleName,callback:function(t){e.$set(e.roleForm,"roleName",t)},expression:"roleForm.roleName"}})],1),t("el-form-item",{attrs:{label:"权限字符：",prop:"roleKey"}},[t("el-input",{attrs:{clearable:"",readonly:"修改"===e.dialogText},model:{value:e.roleForm.roleKey,callback:function(t){e.$set(e.roleForm,"roleKey",t)},expression:"roleForm.roleKey"}})],1),t("el-form-item",{attrs:{label:"状态：",prop:"status"}},[t("el-select",{attrs:{filterable:"",clearable:"",size:"medium",placeholder:""},model:{value:e.roleForm.status,callback:function(t){e.$set(e.roleForm,"status",t)},expression:"roleForm.status"}},e._l(e.dropdowns.status,(function(e,r){return t("el-option",{key:r,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-form-item",{attrs:{label:"备注：",prop:"remark"}},[t("el-input",{attrs:{clearable:""},model:{value:e.roleForm.remark,callback:function(t){e.$set(e.roleForm,"remark",t)},expression:"roleForm.remark"}})],1),t("el-form-item",{attrs:{label:"分配权限：",prop:"menuIds"}},[t("el-input",{attrs:{clearable:"",placeholder:"输入关键字过滤"},model:{value:e.filterMenuTree,callback:function(t){e.filterMenuTree=t},expression:"filterMenuTree"}}),t("el-tree",{ref:"menuTree",attrs:{"show-checkbox":"","check-strictly":!0,"node-key":"menuId","default-checked-keys":e.roleForm.menuIds,"highlight-current":"",data:e.jurisdictionTreeData,props:{label:"menuName"},"filter-node-method":e.filterMenu},on:{check:e.checkMenu}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("roleForm")}}},[e._v("确 定")]),t("el-button",{on:{click:function(t){return e.closeSeeDetail("roleForm")}}},[e._v("取 消")])],1)],1)],1)},l=[],a=(r(7658),r(6342)),s=r(6795),i=r(1182),n=r(9844),u=r(4287),d=r(4116),c=r(4996),m=r(2503),p={name:"system-role-index",mixins:[d.Z,c.Z,m.Z],directives:{permission:n.r,copy:n.J},filters:{CodeTransforText:u.C},data(){return{loading:!1,queryForm:{roleName:"",roleKey:"",status:"",beginTime:"",endTime:"",pageSize:this.$tableDataSize,pageNum:1,orderByColumn:"",isAsc:"asc"},dropdowns:{status:[{code_name:"启用",code_value:"1"},{code_name:"禁用",code_value:"0"}]},time:"",tableData:[],total:0,filterMenuTree:"",moreSelect:[],dialogVisible:!1,dialogText:"",roleForm:{roleName:"",roleKey:"",status:"",remark:"",menuIds:[]},jurisdictionTreeData:[],rules:g}},created(){this.getData()},watch:{filterMenuTree(e){this.$refs.menuTree.filter(e)},jurisdictionTreeData(e){e.length&&(this.roleForm.menuIds=[e.find((e=>"home/index"===e.perms)).menuId])}},methods:{getDropdowns(){s.Z.dropdowns("626988").then((e=>{0===e.code&&(this.dropdowns.status=e.data)}))},selectedDate(e){this.moreSelect=e},editing(e,t){this.getMenuResource(),this.dialogVisible=!0;const r=this;"add"===e?(this.dialogText="添加",delete this.roleForm.roleId):(this.dialogText="修改",this.$nextTick((()=>{a.Z.roleDetail(t.roleId).then((e=>{0===e.code&&(r.roleForm.roleId=e.data.roleId,r.roleForm.roleName=e.data.roleName,r.roleForm.roleKey=e.data.roleKey,r.roleForm.status=e.data.status,r.roleForm.remark=e.data.remark,r.roleForm.menuIds=e.data.menuIds)}))})))},getMenuResource(){a.Z.menuResource({}).then((e=>{0===e.code&&(this.jurisdictionTreeData=e.data.menuList.map((e=>({...e,disabled:"home/index"===e.perms}))))}))},filterMenu(e,t){return!e||-1!==t.menuName.indexOf(e)},closeSeeDetail(e){this.dialogVisible=!1,this.$refs["roleForm"].resetFields()},getData(){this.loading=!0,a.Z.roleList(this.queryForm).then((e=>{this.loading=!1,0===e.code&&(this.total=e.total,this.tableData=e.rows)}))},checkMenu(e,t){this.roleForm.menuIds=t.checkedKeys},submitForm(e){this.$refs[e].validate((e=>{e&&a.Z["添加"===this.dialogText?"addRole":"editRole"](this.roleForm).then((e=>{0===e.code&&("添加"===this.dialogText?(this.$message.success("添加成功"),this.closeSeeDetail(),this.getData()):location.reload())}))}))},deleteing(e,t){if("more"===e&&this.moreSelect.length<1)return this.$message.warning("请选择删除项"),!1;this.$confirm("一旦删除不可恢复，确定删除？","删除提醒",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"放弃"}).then((()=>{let r=[];if("one"===e)r.push(t.roleId);else for(let e of this.moreSelect)r.push(e.roleId);a.Z.deleteRole({ids:r}).then((e=>{0===e.code&&(this.$message.success(e.msg),this.getData(),this.moreSelect=[])}))})).catch((e=>{}))},exporting(e){if(this.tableData.length<1)return this.$message.warning("无数据可导"),!1;const t=this.$loading({lock:!0,text:"正在获取数据...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});let r={...this.queryForm};"2"===e&&(r.pageSize=this.total,r.pageNum=1),a.Z.roleList(r).then((e=>{if(0===e.code){t.text="正在下载...";const r=e.rows.map((e=>({"角色id":e.roleId,"角色名称":e.roleName,"权限字符":e.roleKey,"角色状态":`${this.$options.filters.CodeTransforText(e.status,this.dropdowns.status)}`})));i.Z.excel(r,"运营用户列表")}})).finally((()=>{t.close()}))},printing(e){let t={...this.queryForm};"2"===e&&(t.pageSize=this.total,t.pageNum=1);const r=[{field:"roleId",displayName:"角色id"},{field:"roleName",displayName:"角色名称"},{field:"roleKey",displayName:"权限字符"}];a.Z.roleList(t).then((e=>{printJS({type:"json",printable:e.rows,scanStyles:!0,header:'<h2 style="text-align: center">运营用户列表</h2>',properties:r,style:"@media print{@page {size:landscape}}",gridHeaderStyle:"border: 1px solid #000;text-align:center",gridStyle:"border: 1px solid #000;text-align:center"})}))}}};const g={roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"},{min:2,max:12,message:"长度在 2 到 12 个字符",trigger:"blur"}],roleKey:[{required:!0,message:"请输入权限字符",trigger:"blur"},{pattern:/^[A-Za-z0-9-_]+$/,message:"只能为数字、字母、下划线",trigger:"blur"},{min:4,max:128,message:"长度在 4 到 128 个字符",trigger:"blur"}],status:[{required:!0,message:"请选择角色状态",trigger:"change"}],menuIds:[{type:"array",required:!0,message:"至少首页看盘应该赋予给该角色",trigger:"change"}]};var h=p,f=r(1001),y=(0,f.Z)(h,o,l,!1,null,"e1c12ba0",null),b=y.exports}}]);