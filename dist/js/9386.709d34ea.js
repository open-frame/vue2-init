"use strict";(self["webpackChunkiov_platform"]=self["webpackChunkiov_platform"]||[]).push([[9386],{89386:function(e,t,o){o.r(t),o.d(t,{default:function(){return y}});var r=o(19693),a=o(1985),i=o(63598),s=o(71377),l=o(75267),n=o(67539),m=function(){var e=this,t=e._self._c;return t("el-card",{staticClass:"organization"},[t(n.Z,{attrs:{loading:e.loading,btnSpan:16,getData:e.getData,queryReset:e.queryReset}},[t("el-col",{attrs:{span:4}},[t(l.Z,{attrs:{clearable:"",size:"medium",placeholder:"组织名称"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.deptName,callback:function(t){e.$set(e.queryForm,"deptName",t)},expression:"queryForm.deptName"}})],1),t("el-col",{attrs:{span:4}},[t(s["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"组织状态"},model:{value:e.queryForm.status,callback:function(t){e.$set(e.queryForm,"status",t)},expression:"queryForm.status"}},e._l(e.dropdowns.status,(function(e,o){return t("el-option",{key:o,attrs:{label:e.code_name,value:e.code_value}})})),1)],1)],1),t("el-divider"),t(i.Z,{ref:"table",attrs:{loading:e.loading,data:e.tableData,height:"600","row-key":"deptCode"},scopedSlots:e._u([{key:"left",fn:function(){return[t("el-button",{attrs:{size:"small",icon:"el-icon-plus"},on:{click:function(t){return e.editing("add")}}},[e._v("新增")])]},proxy:!0},{key:"columns",fn:function(){return[t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"组织名称",prop:"deptName"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"组织编号",prop:"deptCode"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"负责人",prop:"leader"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"手机号",prop:"phone"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"邮箱",prop:"email"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"组织状态",prop:"status"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.status,e.dropdowns.status))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"创建人",prop:"createBy"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"创建时间",prop:"createTime"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"发票类别",prop:"invoiceType"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.invoiceType,e.dropdowns.invoiceType))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"发票类型",prop:"invoiceContent"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"税率",prop:"taxRate"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.taxRate||"- ")+"% ")]}}])}),t("el-table-column",{attrs:{label:"操作",width:"210",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"function_edit",expression:"'function_edit'"}],attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.editing("add",o.row)}}},[e._v("新增")]),t("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"function_edit",expression:"'function_edit'"}],attrs:{size:"mini"},on:{click:function(t){return e.editing("modification",o.row)}}},[e._v("编辑")]),t("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"function_delete",expression:"'function_delete'"}],attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.deletOrganization(o.row)}}},[e._v("删除")])]}}])})]},proxy:!0}])}),t("el-dialog",{attrs:{"close-on-click-modal":!1,"append-to-body":!0,"modal-append-to-body":!1,title:e.dialogText,visible:e.showEditFormDialogrVisible,"show-close":!1},on:{"update:visible":function(t){e.showEditFormDialogrVisible=t}}},[t("el-form",{ref:"submitForm",attrs:{model:e.submitForm,rules:e.rules,"label-width":"160px"}},[t("el-form-item",{attrs:{label:"上级组织"}},[t(a.Z,{ref:"organizations-select",attrs:{placeholder:""},model:{value:e.submitForm.parentCode,callback:function(t){e.$set(e.submitForm,"parentCode",t)},expression:"submitForm.parentCode"}})],1),t("el-form-item",{attrs:{label:"组织名称",prop:"deptName"}},[t("el-input",{attrs:{clearable:""},model:{value:e.submitForm.deptName,callback:function(t){e.$set(e.submitForm,"deptName",t)},expression:"submitForm.deptName"}})],1),t("el-form-item",{attrs:{label:"组织类型",prop:"deptType"}},[t("el-select",{attrs:{filterable:"",clearable:"","default-first-option":"",placeholder:""},model:{value:e.submitForm.deptType,callback:function(t){e.$set(e.submitForm,"deptType",t)},expression:"submitForm.deptType"}},e._l(e.dropdowns.deptType,(function(e,o){return t("el-option",{key:o,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-form-item",{attrs:{label:"显示排序",prop:"orderNum"}},[t("el-input",{attrs:{clearable:""},model:{value:e.submitForm.orderNum,callback:function(t){e.$set(e.submitForm,"orderNum",t)},expression:"submitForm.orderNum"}})],1),t("el-form-item",{attrs:{label:"负责人",prop:"leader"}},[t("el-input",{attrs:{clearable:""},model:{value:e.submitForm.leader,callback:function(t){e.$set(e.submitForm,"leader",t)},expression:"submitForm.leader"}})],1),t("el-form-item",{attrs:{label:"联系电话",prop:"phone"}},[t("el-input",{attrs:{clearable:""},model:{value:e.submitForm.phone,callback:function(t){e.$set(e.submitForm,"phone",t)},expression:"submitForm.phone"}})],1),t("el-form-item",{attrs:{label:"组织状态",prop:"status"}},[t("el-select",{attrs:{filterable:"","default-first-option":"",clearable:"",placeholder:""},model:{value:e.submitForm.status,callback:function(t){e.$set(e.submitForm,"status",t)},expression:"submitForm.status"}},e._l(e.dropdowns.status,(function(e,o){return t("el-option",{key:o,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-form-item",{attrs:{label:"地址",prop:"address3"}},[t(r.Z,{model:{value:e.submitForm.address3,callback:function(t){e.$set(e.submitForm,"address3",t)},expression:"submitForm.address3"}})],1),t("el-divider",{attrs:{"content-position":"right"},on:{click:function(t){e.moreForm=!e.moreForm}}},[t("el-button",{attrs:{type:"text"}},[e._v(e._s(e.moreForm?"折叠":"展开"))])],1),t("div",{directives:[{name:"show",rawName:"v-show",value:e.moreForm,expression:"moreForm"}]},[t("el-form-item",{attrs:{label:"联系邮箱"}},[t("el-input",{attrs:{clearable:""},model:{value:e.submitForm.email,callback:function(t){e.$set(e.submitForm,"email",t)},expression:"submitForm.email"}})],1),t("el-form-item",{attrs:{label:"发票类别"}},[t("el-select",{attrs:{filterable:"","default-first-option":"",clearable:"",placeholder:""},model:{value:e.submitForm.invoiceType,callback:function(t){e.$set(e.submitForm,"invoiceType",t)},expression:"submitForm.invoiceType"}},e._l(e.dropdowns.invoiceType,(function(e,o){return t("el-option",{key:o,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-form-item",{attrs:{label:"发票类型"}},[t("el-input",{attrs:{clearable:""},model:{value:e.submitForm.invoiceContent,callback:function(t){e.$set(e.submitForm,"invoiceContent",t)},expression:"submitForm.invoiceContent"}})],1),t("el-form-item",{attrs:{label:"税率"}},[t("el-input-number",{attrs:{precision:2,"controls-position":"right",min:0,max:100},model:{value:e.submitForm.taxRate,callback:function(t){e.$set(e.submitForm,"taxRate",t)},expression:"submitForm.taxRate"}})],1),t("el-form-item",{attrs:{label:"银行账号"}},[t("el-input",{attrs:{clearable:""},model:{value:e.submitForm.bankAccount,callback:function(t){e.$set(e.submitForm,"bankAccount",t)},expression:"submitForm.bankAccount"}})],1),t("el-form-item",{attrs:{label:"开户银行"}},[t("el-select",{attrs:{filterable:"","default-first-option":"",clearable:"",placeholder:""},model:{value:e.submitForm.depositBank,callback:function(t){e.$set(e.submitForm,"depositBank",t)},expression:"submitForm.depositBank"}},e._l(e.dropdowns.banks,(function(e,o){return t("el-option",{key:o,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-form-item",{attrs:{label:"开户支行"}},[t("el-input",{attrs:{clearable:""},model:{value:e.submitForm.subBranch,callback:function(t){e.$set(e.submitForm,"subBranch",t)},expression:"submitForm.subBranch"}})],1),t("el-form-item",{attrs:{label:"收款方名称"}},[t("el-input",{attrs:{clearable:""},model:{value:e.submitForm.payee,callback:function(t){e.$set(e.submitForm,"payee",t)},expression:"submitForm.payee"}})],1),t("el-form-item",{attrs:{label:"收款人联系方式"}},[t("el-input",{attrs:{clearable:""},model:{value:e.submitForm.payeePhone,callback:function(t){e.$set(e.submitForm,"payeePhone",t)},expression:"submitForm.payeePhone"}})],1),t("el-form-item",{attrs:{label:"收款方地址"}},[t("el-input",{attrs:{clearable:""},model:{value:e.submitForm.msgDetail,callback:function(t){e.$set(e.submitForm,"msgDetail",t)},expression:"submitForm.msgDetail"}})],1),t("el-form-item",{attrs:{label:"联行号"}},[t("el-input",{attrs:{clearable:""},model:{value:e.submitForm.interBankNumber,callback:function(t){e.$set(e.submitForm,"interBankNumber",t)},expression:"submitForm.interBankNumber"}})],1),t("el-form-item",{attrs:{label:"工单超时时间(小时)"}},[t("el-input",{attrs:{clearable:""},model:{value:e.submitForm.workOvertime,callback:function(t){e.$set(e.submitForm,"workOvertime",t)},expression:"submitForm.workOvertime"}})],1)],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){return e.closeEditFormVisible("submitForm",e.closeSeeDetail)}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitingForm("submitForm")}}},[e._v("确 定")])],1)],1)],1)},u=[],d=o(24779),c=o(5376),p=o(90886),b=o(86867),f=o(30741),h={name:"management-organization-index",mixins:[f.Q5,f.LI,f.I_,f.vd],filters:{transfortext:p.h},directives:{permission:b.rd},data(){return this.rules=v,{loading:!1,tableData:[],expandRow:[],queryForm:{deptName:"",status:"",pageSize:this.$tableDataSize,pageNum:1},dialogText:"",dropdowns:{status:[],deptType:[],provinces:[],invoiceType:[],city:[],towns:[],banks:[]},submitForm:{parentCode:"3",deptCode:"",deptName:"",orderNum:"",leader:"",phone:"",taxRate:"",invoiceContent:"",invoiceType:"",email:"",address3:[],deptType:"",provinceCode:"",cityCode:"",districtCode:"",msgDetail:"",bankAccount:"",depositBank:"",subBranch:"",payee:"",payeePhone:"",interBankNumber:"",workOvertime:"",status:""},moreForm:!1}},created(){this.getDropdowns()},watch:{"submitForm.address3"(e){this.submitForm.provinceCode=e[0]||"",this.submitForm.cityCode=e[1]||"",this.submitForm.districtCode=e[2]||""}},methods:{getData(){this.tableData=[],this.loading=!0,(0,d.mf)(this.queryForm).then((e=>{this.loading=!1,this.tableData=e,this.expandRow=[this.tableData[0].deptCode]})).catch((()=>{this.loading=!1}))},closeSeeDetail(e){for(let t in this.submitForm)this.submitForm[t]=""},getDropdowns(){0===this.dropdowns.banks.length&&(0,c.Wl)("3027").then((e=>{0===e.code&&(this.dropdowns.banks=e.data)})),(0,c.Wl)("033021").then((e=>{0===e.code&&(this.dropdowns.status=e.data)})),0===this.dropdowns.deptType.length&&(0,c.Wl)("3017").then((e=>{0===e.code&&(this.dropdowns.deptType=e.data)})),0===this.dropdowns.invoiceType.length&&(0,c.Wl)("3045").then((e=>{0===e.code&&(this.dropdowns.invoiceType=e.data)}))},editing(e,t){this.showEditFormDialogrVisible=!0,"add"===e?(this.dialogText="新增组织",t&&(this.submitForm.parentCode=t.deptCode)):(this.dialogText="修改组织",this.$nextTick((()=>{this.submitForm={...t},this.submitForm.address3=[t.provinceCode,t.cityCode,t.districtCode]})))},submitingForm(e){this.$refs[e].validate((e=>{if(e){const e={addOrganizations:d.wr,editOrganization:d.o9};e["新增组织"===this.dialogText?"addOrganizations":"editOrganization"](this.submitForm).then((e=>{0===e.code&&(this.$message.success(e.msg),this.closeEditFormVisible("submitForm",this.closeSeeDetail),this.getData(),this.$refs["organizations-select"].getData())}))}}))},deletOrganization(e){this.$confirm("删除不可恢复，确认删除？").then((()=>{(0,d.qn)({deptCode:e.deptCode}).then((e=>{0===e.code&&(this.$message.success("删除成功"),this.getData(),this.$refs["organizations-select"].getData())}))})).catch((()=>{}))}}};const v={deptName:[{required:!0,message:"请输入组织名称",trigger:"blur"},{min:3,max:25,message:"长度在 3 到 25 个字符",trigger:"blur"}],orderNum:[{required:!0,message:"请输入显示排序",trigger:"blur"},{min:1,max:5,message:"长度在 1 到 5 个字符",trigger:"blur"}],leader:[{required:!0,message:"请输入负责人",trigger:"blur"},{min:2,max:15,message:"长度在 2 到 15 个字符",trigger:"blur"}],phone:[{required:!0,message:"请输入联系电话",trigger:"blur"},{min:7,max:18,message:"长度在 7 到 18 个字符",trigger:"blur"}],address3:[{required:!0,message:"请选择电站地址",trigger:"change"}],deptType:[{required:!0,message:"请选择组织类型",trigger:"change"}],status:[{required:!0,message:"请选择组织状态",trigger:"change"}]};var g=h,F=o(1001),k=(0,F.Z)(g,m,u,!1,null,"78852ece",null),y=k.exports}}]);