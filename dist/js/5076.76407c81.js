"use strict";(self["webpackChunkiov_platform"]=self["webpackChunkiov_platform"]||[]).push([[5076],{85076:function(e,t,a){a.r(t),a.d(t,{default:function(){return _}});var o=a(63598),r=a(66654),s=a(12025),i=a(71377),l=a(75267),n=a(67539),d=function(){var e=this,t=e._self._c;return t("el-card",{staticClass:"refunds content"},[t(n.Z,{attrs:{loading:e.tableLoading,btnSpan:16,getData:e.getData,queryReset:e.queryReset}},[t("el-col",{attrs:{span:4}},[t(l.Z,{attrs:{clearable:"",size:"medium",placeholder:"退款人账号"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.userId,callback:function(t){e.$set(e.queryForm,"userId",t)},expression:"queryForm.userId"}})],1),t("el-col",{attrs:{span:4}},[t(l.Z,{attrs:{clearable:"",size:"medium",placeholder:"退款人手机号"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.phoneNumber,callback:function(t){e.$set(e.queryForm,"phoneNumber",t)},expression:"queryForm.phoneNumber"}})],1),t("el-col",{attrs:{span:4}},[t(l.Z,{attrs:{clearable:"",size:"medium",placeholder:"订单号"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.orderId,callback:function(t){e.$set(e.queryForm,"orderId",t)},expression:"queryForm.orderId"}})],1),t("el-col",{attrs:{span:4}},[t(i["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"退款来源"},on:{change:e.pageReset},model:{value:e.queryForm.dataResource,callback:function(t){e.$set(e.queryForm,"dataResource",t)},expression:"queryForm.dataResource"}},e._l(e.dropdowns.dataResource,(function(e){return t("el-option",{key:e.code_value,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t(i["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"退款结果"},on:{change:e.pageReset},model:{value:e.queryForm.status,callback:function(t){e.$set(e.queryForm,"status",t)},expression:"queryForm.status"}},e._l(e.dropdowns.refundStatus,(function(e,a){return t("el-option",{key:a,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t(i["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"退款审核状态"},on:{change:e.pageReset},model:{value:e.queryForm.appStatus,callback:function(t){e.$set(e.queryForm,"appStatus",t)},expression:"queryForm.appStatus"}},e._l(e.dropdowns.approveStatus,(function(e,a){return t("el-option",{key:a,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t(s.Z,{attrs:{animatLable:""},on:{change:e.pageReset},model:{value:e.queryForm.stationId,callback:function(t){e.$set(e.queryForm,"stationId",t)},expression:"queryForm.stationId"}})],1),t("el-col",{attrs:{span:4}},[t(r.Z,{attrs:{animatLable:"",multiple:!0},on:{change:e.pageReset},model:{value:e.queryForm.constructions,callback:function(t){e.$set(e.queryForm,"constructions",t)},expression:"queryForm.constructions"}})],1)],1),t("el-divider"),t(o.Z,{ref:"table",attrs:{loading:e.tableLoading,total:e.total,data:e.tableData,height:"496","row-key":"orderId","page-size":e.queryForm.pageSize,"current-page":e.queryForm.pageNum,derive:e.exporting,selecteisDisabled:e.showCheckbox},on:{"size-change":e.dataSizeChange,"current-change":e.handleCurrentChange,"selection-change":e.selectData},scopedSlots:e._u([{key:"left",fn:function(){return[t("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"function_refund",expression:"'function_refund'"}],attrs:{size:"small"},on:{click:e.applyForRefund}},[e._v("退款")])]},proxy:!0},{key:"columns",fn:function(){return[t("el-table-column",{attrs:{prop:"userId",label:"退款申请人",width:"160","show-overflow-tooltip":!0}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"手机号",prop:"phoneNumber",width:"110"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("router-link",{staticClass:"text-black",attrs:{to:{name:"management-use-electric-index",params:{phonenumber:a.row.phoneNumber}}}},[e._v(" "+e._s(a.row.phoneNumber)+" ")])]}}])}),t("el-table-column",{attrs:{prop:"refundOrder",label:"退款单号",width:"160","show-overflow-tooltip":!0}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"dataResource",label:"发起来源",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.dataResource,e.dropdowns.dataResource))+" ")]}}])}),t("el-table-column",{attrs:{label:"订单编号",prop:"orderId",width:"160","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(a){return[t("router-link",{staticClass:"text-black",attrs:{to:{name:"orders-order-manage-index",params:{orderId:a.row.orderId}}}},[e._v(" "+e._s(a.row.orderId)+" ")])]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"createTime",label:"申请时间",width:"165"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"backMoney",label:"申请金额"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"receiveAmount",label:"实付金额"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"type",label:"退款理由"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"reason",label:"具体原因"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"payMode",label:"支付方式"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.payMode,e.dropdowns.payMode))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"approveStatus",label:"退款状态",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.approveStatus,e.dropdowns.approveStatus))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"userId",label:"审核情况",width:"340","class-name":"audit-class"},scopedSlots:e._u([{key:"default",fn:function(a){return[e._l(e.dropdowns.approveStatus,(function(o,r){return[a.row["examStatus"+r]?t("div",{key:o.code_value,class:[r>1?"border-top mt-1 pt-1":""],staticStyle:{"white-space":"normal"}},[t("div",[t("span",[e._v("审核角色：")]),t("span",{staticClass:"text-warmgray"},[e._v(e._s(o.code_name))])]),t("div",[t("span",[e._v("审核人：")]),t("span",{staticClass:"text-warmgray"},[e._v(" "+e._s(a.row["approver"+r]))])]),t("div",[t("span",[e._v("审核状态：")]),t("span",{staticClass:"text-warmgray"},[e._v(e._s(e._f("transfortext")(a.row["examStatus"+r],e.dropdowns.status)))])]),t("div",[t("span",[e._v("审核时间：")]),t("span",{staticClass:"text-warmgray"},[e._v(" "+e._s(a.row["examineTime"+r]))])]),t("div",[t("span",[e._v("审核内容：")]),t("span",{staticClass:"text-warmgray"},[e._v(" "+e._s(a.row["content"+r]))])])]):e._e()]}))]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"payTime",label:"支付时间",width:"165"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"refundTime",label:"退款时间",width:"165"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"退款结果"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.status,e.dropdowns.refundStatus))+" ")]}}])}),t("el-table-column",{attrs:{prop:"payNo",label:"退款成功交易号",width:"160","show-overflow-tooltip":!0}}),t("el-table-column",{attrs:{label:"操作",width:"160",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{plain:"",type:"primary",size:"mini"},on:{click:function(t){return e.detail(a.row)}}},[e._v("详情")]),t("el-dropdown",{staticClass:"ms-2",attrs:{trigger:"click"},on:{command:function(t){return e.handling(t,a.row)}}},[t("el-button",{attrs:{size:"mini"}},[e._v(" 更多"),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},["1"!==a.row.status?t("el-dropdown-item",{directives:[{name:"permission",rawName:"v-permission",value:"function_audit",expression:"'function_audit'"}],attrs:{command:"approvaling"}},[e._v("审核")]):e._e(),"1"!==a.row.examStatus1&&"1"!==a.row.examStatus2&&"1"!==a.row.examStatus3||"1"===a.row.status||!a.row.receiveAmount?e._e():t("el-dropdown-item",{directives:[{name:"permission",rawName:"v-permission",value:"function_refund",expression:"'function_refund'"}],attrs:{command:"applyForRefund"}},[e._v("退款")])],1)],1)]}}])})]},proxy:!0}])}),t("el-dialog",{attrs:{"close-on-click-modal":!1,"append-to-body":!0,"modal-append-to-body":!1,title:"审核",visible:e.showAuditVisible,"show-close":!1}},[t("el-form",{attrs:{model:e.auditForm,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"处理状态：",prop:"status"}},[t("el-select",{attrs:{filterable:"","default-first-option":"",clearable:"",placeholder:"请选择审核状态"},model:{value:e.auditForm.status,callback:function(t){e.$set(e.auditForm,"status",t)},expression:"auditForm.status"}},e._l(e.dropdowns.status,(function(e){return t("el-option",{key:e.code_value,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-form-item",{attrs:{label:"处理说明："}},[t("el-input",{attrs:{clearable:""},model:{value:e.auditForm.content,callback:function(t){e.$set(e.auditForm,"content",t)},expression:"auditForm.content"}})],1),t("el-form-item",{attrs:{label:"申请金额："}},[t("el-input",{attrs:{clearable:"",type:"number",readonly:""},model:{value:e.auditForm.backMoney,callback:function(t){e.$set(e.auditForm,"backMoney",t)},expression:"auditForm.backMoney"}})],1),t("el-form-item",{attrs:{label:"审退金额："}},[t("el-input",{attrs:{clearable:"",type:"number",min:0},model:{value:e.auditForm.reviewMoney,callback:function(t){e.$set(e.auditForm,"reviewMoney",t)},expression:"auditForm.reviewMoney"}})],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.showAuditVisible=!1}}},[e._v("关闭")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitAudit}},[e._v("确定")])],1)],1),t("el-dialog",{staticClass:"refund-detail-dialog",attrs:{"close-on-click-modal":!1,"append-to-body":!0,"modal-append-to-body":!1,title:"退款详情",visible:e.showDetailVisible,"show-close":!1,width:"600px"}},[t("div",{staticClass:"title"},[e._v(" ￥ "),t("span",{staticClass:"money"},[e._v(e._s(e.withdrawDetail.backMoney))]),e._v(" 元 ")]),"1"===e.withdrawDetail.approveStatus?t("el-alert",{staticClass:"mt-5 mb-5",attrs:{center:"",type:"warning",title:"待审核",closable:!1}}):t("el-steps",{staticClass:"mt-5 mb-5",attrs:{active:parseInt(e.withdrawDetail.approveStatus)-1,"align-center":""}},e._l(e.dropdowns.approveStatus,(function(a,o){return t("el-step",{key:a.code_value,attrs:{title:a.code_name},scopedSlots:e._u([{key:"description",fn:function(){return[0!==o?t("span",[e._v(" "+e._s(e._f("transfortext")(e.withdrawDetail["status"+o],e.dropdowns.status))+" ")]):e._e()]},proxy:!0}],null,!0)})})),1),t("div",{staticClass:"detail"},[t("div",{staticClass:"item"},[t("div",{staticClass:"title"},[e._v("账号")]),t("div",[e._v(e._s(e.withdrawDetail.userId))])]),t("div",{staticClass:"item"},[t("div",{staticClass:"title"},[e._v("手机号")]),t("div",[e._v(e._s(e.withdrawDetail.phoneNumber))])]),t("div",{staticClass:"item"},[t("div",{staticClass:"title"},[e._v("申请时间")]),t("div",[e._v(e._s(e.withdrawDetail.createTime))])]),t("div",{staticClass:"item"},[t("div",{staticClass:"title"},[e._v("兑现时间")]),t("div",[e._v(e._s(e.withdrawDetail.hopeTime))])]),t("div",{staticClass:"item"},[t("div",{staticClass:"title"},[e._v("退款单号")]),t("div",[e._v(e._s(e.withdrawDetail.refundOrder))])]),t("div",{staticClass:"item"},[t("div",{staticClass:"title"},[e._v("账户余额")]),t("div",[e._v(e._s(e.withdrawDetail.balance))])]),e.withdrawDetail.transactionId?t("div",{staticClass:"item"},[t("div",{staticClass:"title"},[e._v("微信交易号")]),t("div",[e._v(e._s(e.withdrawDetail.transactionId))])]):e._e(),e.withdrawDetail.refundTime?t("div",{staticClass:"item"},[t("div",{staticClass:"title"},[e._v("退款时间")]),t("div",[e._v(e._s(e.withdrawDetail.refundTime))])]):e._e(),e.withdrawDetail.refundTransaction?t("div",{staticClass:"item"},[t("div",{staticClass:"title"},[e._v("交易号")]),t("div",[e._v(e._s(e.withdrawDetail.refundTransaction))])]):e._e(),t("div",{staticClass:"item"},[t("div",{staticClass:"title"},[e._v("支付状态")]),"0"===e.withdrawDetail.payStatus?t("div",[e._v("未操作")]):e._e(),"1"===e.withdrawDetail.payStatus?t("div",[e._v("已支付")]):e._e(),"2"===e.withdrawDetail.payStatus?t("div",[e._v("未支付")]):e._e()]),e.withdrawDetail.payNo?t("div",{staticClass:"item"},[t("div",{staticClass:"title"},[e._v("支付号")]),t("div",[e._v(e._s(e.withdrawDetail.payNo))])]):e._e()]),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.showDetailVisible=!1}}},[e._v("知道了")])],1)],1)],1)},u=[],c=(a(57658),a(25335)),p=a(5376),m=a(86867),v=a(90886),w=a(30741),f={name:"settlement-user-account-refund",mixins:[w.LI,w.I_,w.oA,w.vd],directives:{permission:m.rd},filters:{transfortext:v.h},data(){return{timer:"",tableLoading:!1,dropdowns:{payMode:[],approveStatus:[],dataResource:[],refundStatus:[],status:[]},queryForm:{userName:"",userId:"",orderId:"",phoneNumber:"",appStatus:"",stationId:"",constructions:[],reason:"",dataResource:"",status:"",pageSize:this.$tableDataSize,pageNum:1,orderByColumn:"payTime",isAsc:"desc"},tableData:[],total:0,showAuditVisible:!1,showDetailVisible:!1,withdrawDetail:{},auditForm:{status:"",content:"",refundOrder:"",backMoney:"",reviewMoney:""},moreSelectData:[]}},created(){this.getDrapdowns()},methods:{getDrapdowns(){(0,p.Wl)("3038").then((e=>{0===e.code&&(this.dropdowns.refundStatus=e.data)})),(0,p.Wl)("3025").then((e=>{0===e.code&&(this.dropdowns.payMode=e.data)})),(0,p.Wl)("3039").then((e=>{0===e.code&&(this.dropdowns.approveStatus=e.data)})),(0,p.Wl)("831189").then((e=>{0===e.code&&(this.dropdowns.dataResource=e.data)})),(0,p.Wl)("401007").then((e=>{0===e.code&&(this.dropdowns.status=e.data)}))},showCheckbox(e){return!("1"!==e.examStatus1&&"1"!==e.examStatus2&&"1"!==e.examStatus3||"1"===e.status||!e.receiveAmount)},getData(){this.tableLoading=!0,this.tableData=[],(0,c.lN)(this.queryForm).then((e=>{this.tableLoading=!1,0===e.code&&(this.total=e.total,this.tableData=e.rows)})).catch((()=>{this.tableLoading=!1}))},handling(e,t){this[e](t)},approvaling(e){if(e.receiveAmount<=0)return this.$message.warning("沒有实付金额");this.auditForm={status:"",content:"",refundOrder:e.refundOrder,backMoney:e.backMoney,reviewMoney:e.backMoney,receiveAmount:e.receiveAmount},this.showAuditVisible=!0},submitAudit(){return""===this.auditForm.status?(this.$message.warning("请选择审核状态"),!1):this.auditForm.reviewMoney>this.auditForm.receiveAmount?(this.$message.warning("退款额超出"),!1):this.auditForm.reviewMoney<.01?(this.$message.warning("退款额过小"),!1):void(0,c.Us)(this.auditForm).then((e=>{0===e.code&&(this.showAuditVisible=!1,this.$message.success(e.msg),this.getData())}))},selectData(e){this.moreSelectData=e},applyForRefund(e){if(e.refundOrder)this.refund({refundOrder:e.refundOrder,userId:e.userId,orderId:e.orderId,balance:e.receiveMoney,amount:e.backMoney,refundNo:e.refundOrder,backType:e.backType,transactionId:e.transactionId,totalMoney:this.totalMoney(e),refundMoney:e.backMoney});else{if(this.moreSelectData.length<1)return this.$message.warning("请选择退款项"),!1;for(let e of this.moreSelectData)this.refund({refundOrder:e.refundOrder,userId:e.userId,orderId:e.orderId,balance:e.receiveMoney,amount:e.backMoney,refundNo:e.refundOrder,backType:e.backType,transactionId:e.transactionId,totalMoney:this.totalMoney(e),refundMoney:e.backMoney})}},totalMoney(e){const t={1:e.receiveMoney,2:e.djAccount,3:e.djAccount,7:e.receiveMoney};return t[e.boatName]},refund(e){(0,c.Q2)(e).then((e=>{if(0===e.code){let e;clearTimeout(e),e=setTimeout((()=>{this.$message({showClose:!0,message:"执行成功。结果稍有延迟，稍后请手动查询列表",type:"success",duration:6e3})}),500)}}))},detail(e){this.showDetailVisible=!0,(0,c.eL)({refundOrder:e.refundOrder}).then((e=>{0===e.code&&(this.withdrawDetail=e.data)}))},async exporting(e){let t={...this.queryForm};"2"===e&&(t.pageSize=this.total,t.pageNum=1);const a=await(0,c.lN)(t);if(0===a.code){const e=a.rows.map((e=>{let t=[];return this.dropdowns.approveStatus.filter(((a,o)=>{e["examStatus"+o]&&t.push({"审核角色":a.code_name,"审核人":e["approver"+o],"审核状态":`${(0,v.h)(e["examStatus"+o],this.dropdowns.status)}`,"审核时间":e["examineTime"+o],"审核内容":e["content"+o]})})),{"申请人账号":e.userId,"手机号":e.phoneNumber,"支付时间":e.payTime,"退款单号":e.refundOrder,"申请时间":e.createTime,"兑现时间":e.hopeTime,"申请退款额":e.backMoney,"退款原因":e.reason,"退款状态":`${(0,v.h)(e.approveStatus,this.dropdowns.approveStatus)}`,"审核情况":JSON.stringify(t),"退款结果":`${(0,v.h)(e.status,this.dropdowns.refundStatus)}`,"退款成功交易号":e.refundTransaction}}));return e}}}},h=f,b=a(1001),y=(0,b.Z)(h,d,u,!1,null,"08ad22d3",null),_=y.exports}}]);