"use strict";(self["webpackChunkiov_platform"]=self["webpackChunkiov_platform"]||[]).push([[43],{60043:function(e,t,a){a.r(t),a.d(t,{default:function(){return w}});var o=a(66654),r=a(12025),i=a(63598),s=a(71377),l=a(75267),n=a(67539),d=function(){var e=this,t=e._self._c;return t("el-card",{staticClass:"ammeter"},[t(n.Z,{attrs:{loading:e.loading,btnSpan:20,getData:e.getData,queryReset:e.queryReset}},[t("el-col",{attrs:{span:4}},[t(l.Z,{attrs:{clearable:"",size:"medium",placeholder:"电表编号"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.deviceName,callback:function(t){e.$set(e.queryForm,"deviceName",t)},expression:"queryForm.deviceName"}})],1),t("el-col",{attrs:{span:4}},[t(l.Z,{attrs:{clearable:"",size:"medium",placeholder:"地址编码"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.deviceAddrNo,callback:function(t){e.$set(e.queryForm,"deviceAddrNo",t)},expression:"queryForm.deviceAddrNo"}})],1),t("el-col",{attrs:{span:4}},[t(l.Z,{attrs:{clearable:"",size:"medium",placeholder:"SIM卡号"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.deviceNb,callback:function(t){e.$set(e.queryForm,"deviceNb",t)},expression:"queryForm.deviceNb"}})],1),t("el-col",{attrs:{span:4}},[t(o.Z,{attrs:{animatLable:"",placeholder:"归属区域"},on:{change:e.pageReset},model:{value:e.queryForm.deviceAddr,callback:function(t){e.$set(e.queryForm,"deviceAddr",t)},expression:"queryForm.deviceAddr"}})],1),t("el-col",{attrs:{span:4}},[t(r.Z,{attrs:{animatLable:""},model:{value:e.queryForm.stationNo,callback:function(t){e.$set(e.queryForm,"stationNo",t)},expression:"queryForm.stationNo"}})],1),t("el-col",{attrs:{span:4}},[t(s["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"使用状态"},on:{change:e.pageReset},model:{value:e.queryForm.device_status,callback:function(t){e.$set(e.queryForm,"device_status",t)},expression:"queryForm.device_status"}},e._l(e.dropdowns.device_status,(function(e,a){return t("el-option",{key:a,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t(s["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"在线状态"},on:{change:e.pageReset},model:{value:e.queryForm.device_line_status,callback:function(t){e.$set(e.queryForm,"device_line_status",t)},expression:"queryForm.device_line_status"}},e._l(e.dropdowns.device_line_status,(function(e,a){return t("el-option",{key:a,attrs:{label:e.code_name,value:e.code_value}})})),1)],1)],1),t("el-divider"),t(i.Z,{ref:"table",attrs:{loading:e.loading,total:e.total,data:e.tableData,height:"530","row-key":"device_name","page-size":e.queryForm.pageSize,"current-page":e.queryForm.pageNum,derive:e.exporting},on:{"selection-change":e.selectingData,"size-change":e.dataSizeChange,"current-change":e.handleCurrentChange},scopedSlots:e._u([{key:"left",fn:function(){return[t("el-button",{attrs:{size:"small",icon:"el-icon-plus"},on:{click:function(t){return e.editing("add")}}},[e._v("新增")]),t("el-button",{attrs:{size:"small",icon:"el-icon-link"},on:{click:function(t){return e.openVelationshipStatonVisible("more")}}},[e._v(" 关联电站 ")])]},proxy:!0},{key:"columns",fn:function(){return[t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"电表编号",prop:"device_name"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"示数",prop:"papR"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"地址编码",prop:"device_addr_no"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"模块编号",prop:"device_model"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"归属区域",prop:"device_addr"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.device_addr,e.dropdowns.device_addr,{name:"construction",value:"uuid"}))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"所属站",prop:"device_station_no"},scopedSlots:e._u([{key:"default",fn:function(a){return t("span",{staticClass:"cursor-pointer text-xs",on:{click:function(t){return e.openVelationshipStatonVisible("one",a.row)}}},[a.row.device_station_no?[e._v(" "+e._s(e._f("transfortext")(a.row.device_station_no,e.dropdowns.device_station_no,{name:"stationName",value:"stationNo"}))+" ")]:[e._v("待关联")]],2)}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"详细地址",prop:"device_addr_detail"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"设备类型",prop:"type"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"设备状态",prop:"device_status"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.device_status,e.dropdowns.device_status))+" ")]}}])}),t("el-table-column",{attrs:{label:"在线情况"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.device_line_status,e.dropdowns.device_line_status))+" ")]}}])}),t("el-table-column",{attrs:{label:"创建时间",prop:"device_create_time"}}),t("el-table-column",{attrs:{label:"操作",width:"160",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"function_edit",expression:"'function_edit'"}],attrs:{plain:"",type:"primary",size:"mini"},on:{click:function(t){return e.editing("modification",a.row)}}},[e._v(" 详情 ")]),t("el-dropdown",{staticClass:"ms-2",on:{command:function(t){return e.moreHandles(t,a.row)}}},[t("el-button",{attrs:{size:"mini"}},[e._v(" 更多"),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[""===a.row.device_state||"0"===a.row.device_state?t("el-dropdown-item",{staticClass:"text-info",attrs:{command:"0"}},[e._v("拉闸")]):e._e(),"1"===a.row.device_state?t("el-dropdown-item",{staticClass:"text-primary",attrs:{command:"1"}},[e._v("合闸")]):e._e(),t("el-dropdown-item",{class:"1"===a.row.device_status?"text-danger":"",attrs:{command:"2",divided:""}},[e._v(" "+e._s("1"===a.row.device_status?"停用":"启用")+" ")]),"3"!==a.row.device_status?t("el-dropdown-item",{staticClass:"text-warning",attrs:{command:"3"}},[e._v("维修")]):e._e()],1)],1)]}}])})]},proxy:!0}])}),t("el-dialog",{attrs:{"close-on-click-modal":!1,title:"电表关联站","append-to-body":!0,"modal-append-to-body":!1,visible:e.showVelationshipStatonVisible,"before-close":e.closeVelationshipStatonVisible}},[t("el-form",{ref:"ammeterBindStationForm",attrs:{model:e.ammeterBindStationForm,"label-position":"top"}},[t("el-form-item",{attrs:{label:"请选择设备的归属区域：",prop:"stationNo",rules:[{type:"array",required:!0,message:"请选择设备的归属区域",trigger:"change"}]}},[t(r.Z,{attrs:{multiple:!0,showSelectAll:!0,placeholder:"请选择设备的归属区域"},model:{value:e.ammeterBindStationForm.stationNo,callback:function(t){e.$set(e.ammeterBindStationForm,"stationNo",t)},expression:"ammeterBindStationForm.stationNo"}})],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.relationshipStaton}},[e._v("关 联")]),t("el-button",{on:{click:e.closeVelationshipStatonVisible}},[e._v("取 消")])],1)],1),t("el-dialog",{attrs:{"close-on-click-modal":!1,title:e.dialogText,"append-to-body":!0,"modal-append-to-body":!1,visible:e.showEditFormDialogrVisible,"show-close":!1}},[t("el-form",{ref:"ammeterForm",attrs:{model:e.ammeterForm,rules:e.ammeterFormRules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"电表名称",prop:"deviceName"}},[t("el-input",{attrs:{readonly:"修改电表"===e.dialogText},model:{value:e.ammeterForm.deviceName,callback:function(t){e.$set(e.ammeterForm,"deviceName",t)},expression:"ammeterForm.deviceName"}})],1),t("el-form-item",{attrs:{label:"地址编码",prop:"deviceAddrNo"}},[t("el-input",{attrs:{clearable:""},model:{value:e.ammeterForm.deviceAddrNo,callback:function(t){e.$set(e.ammeterForm,"deviceAddrNo",t)},expression:"ammeterForm.deviceAddrNo"}})],1),t("el-form-item",{attrs:{label:"模块编码",prop:"deviceModel"}},[t("el-input",{attrs:{clearable:""},model:{value:e.ammeterForm.deviceModel,callback:function(t){e.$set(e.ammeterForm,"deviceModel",t)},expression:"ammeterForm.deviceModel"}})],1),t("el-form-item",{attrs:{label:"NB卡号",prop:"deviceNb"}},[t("el-input",{attrs:{clearable:""},model:{value:e.ammeterForm.deviceNb,callback:function(t){e.$set(e.ammeterForm,"deviceNb",t)},expression:"ammeterForm.deviceNb"}})],1),t("el-form-item",{attrs:{label:"设备类型",prop:"name"}},[t("el-select",{attrs:{filterable:"","default-first-option":"",placeholder:""},model:{value:e.ammeterForm.name,callback:function(t){e.$set(e.ammeterForm,"name",t)},expression:"ammeterForm.name"}},e._l(e.dropdowns.deviceName,(function(e,a){return t("el-option",{key:a,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-form-item",{attrs:{label:"设备型号",prop:"type"}},[t("el-select",{attrs:{filterable:"","default-first-option":"",placeholder:""},model:{value:e.ammeterForm.type,callback:function(t){e.$set(e.ammeterForm,"type",t)},expression:"ammeterForm.type"}},e._l(e.dropdowns.category,(function(e,a){return t("el-option",{key:a,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-form-item",{attrs:{label:"归属区域",prop:"deviceAddr"}},[t(o.Z,{attrs:{placeholder:""},model:{value:e.ammeterForm.deviceAddr,callback:function(t){e.$set(e.ammeterForm,"deviceAddr",t)},expression:"ammeterForm.deviceAddr"}})],1),t("el-form-item",{attrs:{label:"详细地址",prop:"deviceAddrDetail"}},[t("el-input",{attrs:{clearable:""},model:{value:e.ammeterForm.deviceAddrDetail,callback:function(t){e.$set(e.ammeterForm,"deviceAddrDetail",t)},expression:"ammeterForm.deviceAddrDetail"}})],1),t("el-form-item",{attrs:{label:"备注",prop:"content"}},[t("el-input",{attrs:{clearable:"",type:"textarea"},model:{value:e.ammeterForm.content,callback:function(t){e.$set(e.ammeterForm,"content",t)},expression:"ammeterForm.content"}})],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){return e.closeEditFormVisible("ammeterForm")}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitAmmeterForm("ammeterForm")}}},[e._v("提交")])],1)],1)],1)},m=[],c=(a(57658),a(74713)),u=a(5376),p=a(24779),v=a(90886),h=a(86867),g=a(30741),b={name:"property-ammeter-index",mixins:[g.Q5,g.LI,g.I_,g.oA,g.vd],filters:{transfortext:v.h},directives:{permission:h.rd},data(){return{loading:!1,dropdowns:{device_status:[],deviceName:[],category:[],device_addr:[],deviceAddrDetail:[],device_station_no:[],device_line_status:[]},queryForm:{deviceName:"",deviceAddrNo:"",stationNo:"",deviceNb:"",deviceAddr:"",device_status:"",device_line_status:"",pageSize:this.$tableDataSize,pageNum:1},tableData:[],total:0,selectedAmmeterData:[],showVelationshipStatonVisible:!1,ammeterBindStationForm:{stationNo:[],names:[]},dialogText:"",ammeterForm:{deviceName:"",deviceAddrNo:"",deviceModel:"",deviceNb:"",deviceAddr:"",deviceAddrDetail:"",content:"",name:"",type:""},ammeterFormRules:f}},created(){this.getDropdowns()},methods:{getDropdowns(){(0,u.Wl)("3004").then((e=>{0===e.code&&(this.dropdowns.deviceName=e.data)})),(0,u.Wl)("3005").then((e=>{0===e.code&&(this.dropdowns.category=e.data)})),(0,u.Wl)("3006").then((e=>{0===e.code&&(this.dropdowns.device_status=e.data)})),(0,u.Wl)("1038").then((e=>{0===e.code&&(this.dropdowns.device_line_status=e.data)})),(0,p.ao)({}).then((e=>{0===e.code&&(this.dropdowns.device_addr=e.rows)})),(0,u.iS)().then((e=>{0===e.code&&(this.dropdowns.device_station_no=e.data)}))},getData(){this.loading=!0,this.tableData=[],(0,c.GM)(this.queryForm).then((e=>{this.loading=!1,0===e.code&&(this.total=e.total,this.tableData=e.rows)})).catch((()=>{this.loading=!1}))},selectingData(e){this.selectedAmmeterData=e.map((e=>e.device_name))},openVelationshipStatonVisible(e,t){if("more"===e&&0===this.selectedAmmeterData.length)return this.$message.warning("请选择要关联的电表"),!1;this.showVelationshipStatonVisible=!0,this.$nextTick((()=>{"one"===e&&t.device_station_no&&(this.ammeterBindStationForm.stationNo=t.device_station_no.split(",")),this.ammeterBindStationForm.names="one"===e?[t.device_name]:this.selectedAmmeterData}))},relationshipStaton(){this.$refs["ammeterBindStationForm"].validate((e=>{e&&(0,c.h7)({...this.ammeterBindStationForm,stationNo:this.ammeterBindStationForm.stationNo.join(",")}).then((e=>{0===e.code&&(this.$message.success("关联成功"),this.closeVelationshipStatonVisible(),this.getData())}))}))},closeVelationshipStatonVisible(){this.showVelationshipStatonVisible=!1,this.$refs["ammeterBindStationForm"].resetFields(),this.$refs.table.clearSelection(),this.ammeterBindStationForm.names=[],this.ammeterBindStationForm.stationNo=[]},editing(e,t){this.showEditFormDialogrVisible=!0,"add"===e?(this.dialogText="添加电表",this.addFormValidator()):(this.dialogText="修改电表",this.deleteFormValidator(),(0,c.kL)({deviceName:t.device_name}).then((e=>{this.ammeterForm.deviceName=e.data.device_name,this.ammeterForm.deviceAddrNo=e.data.device_addr_no,this.ammeterForm.deviceModel=e.data.device_model,this.ammeterForm.deviceNb=e.data.device_nb,this.ammeterForm.deviceAddr=e.data.device_addr,this.ammeterForm.deviceAddrDetail=e.data.device_addr_detail,this.ammeterForm.content=e.data.content,this.ammeterForm.name=e.data.name_category,this.ammeterForm.type=e.data.type_category})))},addFormValidator(){const e=this;this.$nextTick((()=>{e.$refs["ammeterForm"].rules.deviceName.find((e=>e.validator))||e.$refs["ammeterForm"].rules.deviceName.push({validator:(e,t,a)=>{(0,c._d)({deviceName:t}).then((e=>{500===e.code?a(new Error("电表名称已存在")):a()}))},trigger:"blur"})}))},deleteFormValidator(){const e=this;this.$nextTick((()=>{e.$refs["ammeterForm"].rules.deviceName.forEach(((e,t)=>{e.validator&&(e.validator=null)}))}))},submitAmmeterForm(e){this.$refs[e].validate((e=>{if(!e)return!1;const t={addAmmeter:c.Nq,editAmmeter:c.G7};t["添加电表"===this.dialogText?"addAmmeter":"editAmmeter"](this.ammeterForm).then((e=>{0===e.code&&(this.$message.success(e.msg),this.getData(),this.closeEditFormVisible("ammeterForm"))}))}))},deteleing(e,t){if("one"===e&&this.selectingData([t]),0===this.selectedAmmeterData.length)return this.$message.warning("请选择要删除的电表"),!1;this.$confirm("一旦删除不可恢复，确定删除？","删除提醒",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"放弃"}).then((()=>{(0,c.VI)({deviceName:this.selectedAmmeterData}).then((e=>{0===e.code&&(this.$refs.table.clearSelection(),this.$message.success("删除成功"),this.getData())}))}))},moreHandles(e,t){switch(e){case"0":this.switchOut({deviceName:t.device_name,type:"1"});break;case"1":this.switchOn({deviceName:t.device_name});break;case"2":this.handelAmmeter({deviceName:t.device_name,deviceStatus:"1"===t.device_status?"2":"1"});break;case"3":this.handelAmmeter({deviceName:t.device_name,deviceStatus:"3"});break;case"4":this.deteleing("one",t);break}},switchOut(e){(0,c.pH)(e).then((t=>{t.data&&t.data>0?this.$confirm(`该站当前存在用户使用，有${t.data}个订单，请确认是否执行?`,"⁉警示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"danger"}).then((()=>{this.changeAmmeterStatus(e)})).catch((()=>{})):(this.$message.success(t.msg),this.changeAmmeterStatus(e))}))},switchOn(e){(0,c.Mz)(e).then((t=>{0===t.code&&(this.changeAmmeterStatus(e),this.$message.success(t.msg),this.getData())}))},changeAmmeterStatus(e){(0,c.MV)({deviceName:e.deviceName}).then((e=>{0===e.code&&this.getData()}))},handelAmmeter(e){(0,c.Eo)(e).then((e=>{0===e.code&&(this.$message.success(e.msg),this.getData())}))},async exporting(e){let t={...this.queryForm};"2"===e&&(t.pageSize=this.total,t.pageNum=1);const a=await(0,c.GM)(t);if(0===a.code){const e=this.$refs.table.getColumns(),t=a.rows.map((t=>{let a=e.map((e=>[e.label,`${(0,v.h)(t[e.prop],this.dropdowns[e.prop])}`]));return Object.fromEntries(a)}));return t}}}};const f={deviceName:[{required:!0,message:"请输入电表名称",trigger:"blur"},{pattern:/^[^<|>|(|)|+|-|*|/|%|=|{|}]*$/,message:"禁止< > ( ) + - * / % = { }等特殊字符",trigger:"blur"},{min:2,max:24,message:"长度在 2 到 24 个字符",trigger:"blur"}],deviceAddrNo:[{required:!0,message:"请输入地址编码",trigger:"blur"},{pattern:/^[^<|>|(|)|+|-|*|/|%|=|{|}]*$/,message:"禁止< > ( ) + - * / % = { }等特殊字符",trigger:"blur"},{min:2,max:24,message:"长度在 2 到 24 个字符",trigger:"blur"}],deviceModel:[{required:!0,message:"请输入模块编码",trigger:"blur"},{pattern:/^[^<|>|(|)|+|-|*|/|%|=|{|}]*$/,message:"禁止< > ( ) + - * / % = { }等特殊字符",trigger:"blur"},{min:2,max:48,message:"长度在 2 到 48 个字符",trigger:"blur"}],deviceNb:[{required:!0,message:"请输入NB卡号",trigger:"blur"},{pattern:/^[^<|>|(|)|+|-|*|/|%|=|{|}]*$/,message:"禁止< > ( ) + - * / % = { }等特殊字符",trigger:"blur"},{min:2,max:24,message:"长度在 2 到 24 个字符",trigger:"blur"}],name:[{required:!0,message:"请选择设备类型",trigger:"change"}],type:[{required:!0,message:"请选择设备型号",trigger:"change"}],deviceAddr:[{required:!0,message:"请选择设备的归属区域",trigger:"change"}]};var _=b,F=a(1001),y=(0,F.Z)(_,d,m,!1,null,"640b8fa0",null),w=y.exports}}]);