"use strict";(self["webpackChunkiov_platform"]=self["webpackChunkiov_platform"]||[]).push([[3313],{43313:function(e,t,o){o.r(t),o.d(t,{default:function(){return $}});var r=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{"close-on-click-modal":!1,"append-to-body":!0,"modal-append-to-body":!1,title:"地图",visible:e.show,"before-close":e.close}},[t("el-autocomplete",{staticClass:"w-full",attrs:{autofocus:"","prefix-icon":"el-icon-search","trigger-on-focus":!1,placeholder:"输入关键字查询地址","fetch-suggestions":e.searchTips},on:{select:e.selectQueryResult},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}},[t("template",{slot:"append"},[t("el-button",{on:{click:e.searching}},[e._v("搜 索")])],1)],2),t("div",{attrs:{id:"amap"}}),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.close}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.ok}},[e._v("确 定")])],1)],1)},a=[],i={name:"edo-amap",props:{show:{type:Boolean,default:!1}},data(){return{map:null,searchText:"",data:{longitude:"",latitude:""},listener:null}},watch:{show(e,t){e&&this.$nextTick((()=>{this.amap()}))}},methods:{amap(){const e=this;this.map=new AMap.Map("amap"),this.map.on("click",(function(t){e.$confirm(`选中纬度${t.lnglat.lng}，经度${t.lnglat.lat}吗？`,"位置提示").then((()=>{e.data={longitude:t.lnglat.lat,latitude:t.lnglat.lng},e.ok()})).catch((()=>{}))}))},searchTips(e,t){if(e.trim()){const o=this;AMap.plugin(["AMap.AutoComplete"],(function(){setTimeout((()=>{(new AMap.Autocomplete).search(e.trim(),(function(e,r){if(r.tips){let e=r.tips;t(e.map((e=>({value:`【${e.name}】${e.district}${e.address}`}))))}else o.$message.warning("尝试换个关键字看看")}))}),1200)}))}},selectQueryResult(e){this.searchText=e.value,this.searching()},searching(){const e=this;AMap.plugin(["AMap.PlaceSearch"],(function(){let t=new AMap.PlaceSearch({map:e.map});t.search(e.searchText,(function(t,o){let r=o.poiList.pois;for(let a=0;a<r.length;a++){let t=r[a],o=[];o[a]=new AMap.Marker({position:t.location,title:t.name}),e.map.add(o[a])}e.map.setFitView()})),e.addListener(t)}))},addListener(e){const t=this;this.listener=AMap.Event.addListener(e,"markerClick",(function(e){t.$confirm(`确定选中【${e.data.name}】，纬度${e.data.location.lng}，经度${e.data.location.lat}吗？`,"位置提示").then((()=>{t.data={longitude:e.data.location.lat,latitude:e.data.location.lng},t.ok()})).catch((()=>{}))}))},close(){this.$emit("close",!1),this.searchText="";try{AMap.event.removeListener(this.listener)}catch(e){}},ok(){this.$emit("ok",this.data),this.close()}}},s=i,n=o(1001),l=(0,n.Z)(s,r,a,!1,null,"d5663428",null),m=l.exports,u=o(19693),c=o(1985),d=o(66654),p=function(){var e=this,t=e._self._c;return t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"ruleForm",attrs:{model:e.submitForm,rules:e.rules,"label-width":"120px"}},[t("el-col",{attrs:{span:13}},[t("el-col",{attrs:{span:12}},[e.$route.query.stationNo?t("el-form-item",{attrs:{label:"站编号",prop:"stationNo"}},[t("el-input",{staticClass:"border-none",attrs:{readonly:"",size:"mini"},model:{value:e.submitForm.stationNo,callback:function(t){e.$set(e.submitForm,"stationNo",t)},expression:"submitForm.stationNo"}})],1):e._e(),t("el-form-item",{attrs:{label:"站名称",prop:"stationName"}},[t("el-input",{attrs:{size:"mini",clearable:""},model:{value:e.submitForm.stationName,callback:function(t){e.$set(e.submitForm,"stationName",t)},expression:"submitForm.stationName"}})],1),t("el-form-item",{attrs:{label:"站类别",prop:"stationCatagory"}},[t("el-select",{attrs:{size:"mini",filterable:"","default-first-option":"",clearable:"",placeholder:""},model:{value:e.submitForm.stationCatagory,callback:function(t){e.$set(e.submitForm,"stationCatagory",t)},expression:"submitForm.stationCatagory"}},e._l(e.dropdowns.category,(function(e,o){return t("el-option",{key:o,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-form-item",{attrs:{label:"归属商户",prop:"merchantUuid"}},[t(c.Z,{attrs:{size:"mini",multiple:"",placeholder:""},model:{value:e.submitForm.merchantUuid,callback:function(t){e.$set(e.submitForm,"merchantUuid",t)},expression:"submitForm.merchantUuid"}})],1),t("el-form-item",{attrs:{label:"归属区域",prop:"constructionUuid"}},[t(d.Z,{attrs:{size:"mini",placeholder:""},model:{value:e.submitForm.constructionUuid,callback:function(t){e.$set(e.submitForm,"constructionUuid",t)},expression:"submitForm.constructionUuid"}})],1),t("el-form-item",{attrs:{label:"归属社区",prop:"community"}},[t("el-input",{attrs:{size:"mini",clearable:""},model:{value:e.submitForm.community,callback:function(t){e.$set(e.submitForm,"community",t)},expression:"submitForm.community"}})],1),t("el-form-item",{attrs:{label:"购电单价",prop:"kwhPrc"}},[t("el-input-number",{attrs:{size:"mini",clearable:"",precision:2,"controls-position":"right"},model:{value:e.submitForm.kwhPrc,callback:function(t){e.$set(e.submitForm,"kwhPrc",t)},expression:"submitForm.kwhPrc"}})],1),t("el-form-item",{attrs:{label:"运维班组",prop:"managerOrgCode"}},[t(c.Z,{attrs:{size:"mini",placeholder:""},model:{value:e.submitForm.managerOrgCode,callback:function(t){e.$set(e.submitForm,"managerOrgCode",t)},expression:"submitForm.managerOrgCode"}})],1),t("el-form-item",{attrs:{label:"供电性质",prop:"powerType"}},[t("el-select",{attrs:{size:"mini",filterable:"","default-first-option":"",clearable:"",placeholder:""},model:{value:e.submitForm.powerType,callback:function(t){e.$set(e.submitForm,"powerType",t)},expression:"submitForm.powerType"}},e._l(e.dropdowns.nature,(function(e,o){return t("el-option",{key:o,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-form-item",{attrs:{label:"站负责人",prop:"leader"}},[t("el-input",{attrs:{size:"mini",clearable:""},model:{value:e.submitForm.leader,callback:function(t){e.$set(e.submitForm,"leader",t)},expression:"submitForm.leader"}})],1),t("el-form-item",{attrs:{label:"联系方式",prop:"phone"}},[t("el-input",{attrs:{size:"mini",clearable:"",type:"number"},model:{value:e.submitForm.phone,callback:function(t){e.$set(e.submitForm,"phone",t)},expression:"submitForm.phone"}})],1),t("el-form-item",{attrs:{label:"运营时间",prop:"operationTime"}},[t("el-time-picker",{attrs:{size:"mini","is-range":"","arrow-control":"",clearable:!1,"value-format":"HH:mm",format:"HH:mm","start-placeholder":"开始时间","end-placeholder":"结束时间"},model:{value:e.submitForm.operationTime,callback:function(t){e.$set(e.submitForm,"operationTime",t)},expression:"submitForm.operationTime"}})],1),t("el-form-item",{attrs:{label:"站坐标",prop:"latAndLng"}},[t("el-input",{attrs:{size:"mini",clearable:""},on:{focus:function(t){e.showAmap=!0}},model:{value:e.submitForm.latAndLng,callback:function(t){e.$set(e.submitForm,"latAndLng",t)},expression:"submitForm.latAndLng"}})],1),t("el-form-item",{attrs:{label:"地址",prop:"address3"}},[t(u.Z,{attrs:{size:"mini"},model:{value:e.submitForm.address3,callback:function(t){e.$set(e.submitForm,"address3",t)},expression:"submitForm.address3"}})],1),t("el-form-item",{attrs:{label:"详细地址",prop:"address"}},[t("el-input",{attrs:{size:"mini",clearable:""},model:{value:e.submitForm.address,callback:function(t){e.$set(e.submitForm,"address",t)},expression:"submitForm.address"}})],1),t("el-form-item",{attrs:{label:"描述"}},[t("el-input",{attrs:{size:"mini",clearable:"",rows:4,type:"textarea"},model:{value:e.submitForm.msgDetail,callback:function(t){e.$set(e.submitForm,"msgDetail",t)},expression:"submitForm.msgDetail"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"电源点位置",prop:"stationPower"}},[e.submitForm.stationPower?[t("el-button",{attrs:{type:"text"},on:{click:e.seePictrue}},[e._v("查看图片")]),t("el-button",{attrs:{type:"text"},on:{click:e.uploadPowerPictrueRemove}},[e._v("删除图片")])]:t("el-upload",{ref:"upload",attrs:{w:"",accept:"image/*",action:e.uploadPowerPictrueURL,"show-file-list":!1,headers:e.uploadPowerPictrueHeaders,"before-upload":e.beforeUpload,"on-success":e.uploadPowerPictrueSuccess,"on-error":e.uploadPowerPictrueError}},[t("el-button",{attrs:{size:"small"}},[e._v("上传图片")])],1)],2),t("el-form-item",{attrs:{label:"是否装电表",prop:"ynMeter"}},[t("el-select",{attrs:{size:"mini",filterable:"","default-first-option":"",clearable:"",placeholder:""},model:{value:e.submitForm.ynMeter,callback:function(t){e.$set(e.submitForm,"ynMeter",t)},expression:"submitForm.ynMeter"}},e._l(e.dropdowns.yesORno,(function(e,o){return t("el-option",{key:o,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-form-item",{attrs:{label:"是否装空开",prop:"ynSwitch"}},[t("el-select",{attrs:{size:"mini",filterable:"","default-first-option":"",clearable:"",placeholder:""},model:{value:e.submitForm.ynSwitch,callback:function(t){e.$set(e.submitForm,"ynSwitch",t)},expression:"submitForm.ynSwitch"}},e._l(e.dropdowns.yesORno,(function(e,o){return t("el-option",{key:o,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-form-item",{attrs:{label:"有无车棚",prop:"ynShed"}},[t("el-select",{attrs:{size:"mini",filterable:"","default-first-option":"",clearable:"",placeholder:""},model:{value:e.submitForm.ynShed,callback:function(t){e.$set(e.submitForm,"ynShed",t)},expression:"submitForm.ynShed"}},e._l(e.dropdowns.hasORnone,(function(e,o){return t("el-option",{key:o,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-form-item",{attrs:{label:"有无防雨盒",prop:"ynBox"}},[t("el-select",{attrs:{size:"mini",filterable:"","default-first-option":"",clearable:"",placeholder:""},model:{value:e.submitForm.ynBox,callback:function(t){e.$set(e.submitForm,"ynBox",t)},expression:"submitForm.ynBox"}},e._l(e.dropdowns.hasORnone,(function(e,o){return t("el-option",{key:o,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-form-item",{attrs:{label:"是否贴墙",prop:"ynWall"}},[t("el-select",{attrs:{size:"mini",filterable:"","default-first-option":"",clearable:"",placeholder:""},model:{value:e.submitForm.ynWall,callback:function(t){e.$set(e.submitForm,"ynWall",t)},expression:"submitForm.ynWall"}},e._l(e.dropdowns.yesORno,(function(e,o){return t("el-option",{key:o,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-form-item",{attrs:{label:"主线直径(mm)",prop:"mainLine"}},[t("el-input-number",{attrs:{size:"mini",precision:4,"controls-position":"right"},model:{value:e.submitForm.mainLine,callback:function(t){e.$set(e.submitForm,"mainLine",t)},expression:"submitForm.mainLine"}})],1),t("el-form-item",{attrs:{label:"辅线直径(mm)",prop:"auxLine"}},[t("el-input-number",{attrs:{size:"mini",precision:4,"controls-position":"right"},model:{value:e.submitForm.auxLine,callback:function(t){e.$set(e.submitForm,"auxLine",t)},expression:"submitForm.auxLine"}})],1),t("el-form-item",{attrs:{label:"报装容量(kva)",prop:"maxPower"}},[t("el-input-number",{attrs:{size:"mini",precision:4,"controls-position":"right"},model:{value:e.submitForm.maxPower,callback:function(t){e.$set(e.submitForm,"maxPower",t)},expression:"submitForm.maxPower"}})],1),t("el-form-item",{attrs:{label:"安装数量",prop:"stakeNumber"}},[t("el-input-number",{attrs:{size:"mini","controls-position":"right"},model:{value:e.submitForm.stakeNumber,callback:function(t){e.$set(e.submitForm,"stakeNumber",t)},expression:"submitForm.stakeNumber"}})],1),e.$route.query.stationNo?[t("el-form-item",{attrs:{label:"建站人",prop:"creatorName"}},[t("el-input",{staticClass:"border-none",attrs:{readonly:"",size:"mini"},nativeOn:{click:function(t){return e.goPage(e.submitForm.creatorName)}},model:{value:e.submitForm.creatorName,callback:function(t){e.$set(e.submitForm,"creatorName",t)},expression:"submitForm.creatorName"}})],1),t("el-form-item",{attrs:{label:"建站时间",prop:"createdAt"}},[t("el-input",{staticClass:"border-none",attrs:{readonly:"",size:"mini"},model:{value:e.submitForm.createdAt,callback:function(t){e.$set(e.submitForm,"createdAt",t)},expression:"submitForm.createdAt"}})],1),t("el-form-item",{attrs:{label:"修改人",prop:"updaterName"}},[t("el-input",{staticClass:"border-none",attrs:{readonly:"",size:"mini"},nativeOn:{click:function(t){return e.goPage(e.submitForm.updaterName)}},model:{value:e.submitForm.updaterName,callback:function(t){e.$set(e.submitForm,"updaterName",t)},expression:"submitForm.updaterName"}})],1),t("el-form-item",{attrs:{label:"修改时间",prop:"updatedAt"}},[t("el-input",{staticClass:"border-none",attrs:{readonly:"",size:"mini"},model:{value:e.submitForm.updatedAt,callback:function(t){e.$set(e.submitForm,"updatedAt",t)},expression:"submitForm.updatedAt"}})],1)]:e._e()],2),t(m,{attrs:{show:e.showAmap},on:{ok:e.okCoord,close:function(t){e.showAmap=!1}}}),t("el-col",{staticClass:"text-end p-5",attrs:{span:24}},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitingForm("ruleForm")}}},[e._v("保 存")]),t("el-button",{on:{click:e.close}},[e._v("返 回")])],1)],1)],1)},b=[],g=(o(57658),o(74713)),h=o(5376),f=o(57758),F=o.n(f);const w="https://clw.edo-iot.com/yscar/assetStation/uploadStationPower";var y={name:"",data(){return this.rules=k,{loading:!1,uploadPowerPictrueURL:w,uploadPowerPictrueHeaders:{Authorization:`Bearer ${localStorage.getItem("token")}`},dropdowns:{yesORno:[],hasORnone:[],category:[],status:[],nature:[]},showAmap:!1,submitForm:{stationNo:"",stationName:"",address3:[],address:"",provinceCode:"",cityCode:"",districtCode:"",managerOrgCode:"",phone:"",construction:"",constructionUuid:"",leader:"",merchantUuid:[],stationCatagory:"",operationTime:["00:00","23:59"],operationBeginTime:"00:00",operationEndTime:"23:59",latAndLng:"",powerType:"",community:"",stationContacts:"",stationContactsTel:"",kwhPrc:"",stationPower:"",ynMeter:"",ynSwitch:"",ynShed:"",ynBox:"",ynWall:"",mainLine:"",auxLine:"",maxPower:"",stakeNumber:"",meterNo:"",switchNo:"",routerNo:"",msgDetail:""}}},created(){this.getDropdowns(),this.getData()},activated(){this.$route.query.stationNo?this.getData():(this.$store.state.openedPages.find(((e,t)=>{e.meta.menuIdStr===this.$route.meta.menuIdStr&&(this.$store.state.openedPages[t].fullPath=e.path)})),this.clearForm())},watch:{"submitForm.address3"(e){this.submitForm.provinceCode=e[0]||"",this.submitForm.cityCode=e[1]||"",this.submitForm.districtCode=e[2]||""},"submitForm.operationTime"(e){this.submitForm.operationBeginTime=e[0],this.submitForm.operationEndTime=e[1]}},methods:{getData(){this.$route.query?.stationNo&&this.$nextTick((()=>{this.clearForm(),this.loading=!0,(0,g.cV)({pageSize:1,pageNum:1,stationNo:this.$route.query.stationNo}).then((e=>{this.loading=!1,e.total>0?(this.submitForm=e.rows[0],this.submitForm.operationTime=e.rows[0].operationTime.split("-"),this.submitForm.address3=[e.rows[0].provinceCode,e.rows[0].cityCode,e.rows[0].districtCode]):(this.$message.warning("未查询到该站"),this.close())})).catch((()=>{this.loading=!1}))}))},getDropdowns(){(0,h.Wl)("3000").then((e=>{0===e.code&&(this.dropdowns.category=e.data)})),(0,h.Wl)("3001").then((e=>{0===e.code&&(this.dropdowns.status=e.data)})),(0,h.Wl)("3008").then((e=>{0===e.code&&(this.dropdowns.nature=e.data)})),(0,h.Wl)("1036").then((e=>{0===e.code&&(this.dropdowns.yesORno=e.data)})),(0,h.Wl)("884225").then((e=>{0===e.code&&(this.dropdowns.hasORnone=e.data)}))},beforeUpload(e){const t="image/png"===e.type||"image/jpeg";return t?new Promise(((t,o)=>{new(F())(e,{success(e){t(e)}})})):this.$message.error("只能上传图片")},okCoord(e){this.submitForm.latAndLng=`${e.latitude},${e.longitude}`},uploadPowerPictrueSuccess(e){0===e.code&&(this.submitForm.stationPower=e.data)},uploadPowerPictrueError(e){this.$message.error(e.msg),2001===e.code&&this.$store.commit("logout","1")},uploadPowerPictrueRemove(){(0,g.X1)({stationPower:this.submitForm.stationPower}),this.submitForm.stationPower=""},seePictrue(){window.open("https://edo-iot.oss-cn-wulanchabu.aliyuncs.com/"+this.submitForm.stationPower,"_blank","location=no, status=no, menubar=no")},close(){const e=this.$route.meta.menuIdStr;this.$store.commit("closeThisOpenedPages",e)},clearForm(){this.$refs["ruleForm"].resetFields(),this.$data["submitForm"]=this.$options.data()["submitForm"]},submitingForm(e){this.$refs[e].validate((e=>{if(e){const e={addPowerStationInfo:g.yP,updataPowerStationInfo:g.VO};e[this.submitForm.stationNo?"updataPowerStationInfo":"addPowerStationInfo"](this.submitForm).then((e=>{0===e.code&&(this.$message.success("提交成功"),!this.$route.query.data&&e.data&&(0,g.cV)({pageSize:1,pageNum:1,stationNo:e.data}).then((e=>{0===e.code&&(this.submitForm=e.rows[0],this.submitForm.operationTime=e.rows[0].operationTime.split("-"),this.submitForm.address3=[e.rows[0].provinceCode,e.rows[0].cityCode,e.rows[0].districtCode],this.$router.replace({path:"/property/power-stations/detail",query:this.submitForm}))})))}))}}))},goPage(e){this.$router.push({name:"management-operation-index",params:{loginName:e}})}}};const k={stationName:[{required:!0,message:"请输入电站名称",trigger:"blur"},{pattern:/^[^<|>|(|)|+|-|*|/|%|=|{|}]*$/,message:"禁止< > ( ) + - * / % = { }等特殊字符",trigger:"blur"},{min:2,max:24,message:"长度在 2 到 24 个字符",trigger:"blur"}],stationCatagory:[{required:!0,message:"请选择电站类别",trigger:"change"}],powerType:[{required:!0,message:"请选择供电性质",trigger:"change"}],merchantUuid:[{required:!0,message:"请选择归属商户",trigger:"change"}],operationTime:[{required:!0,message:"请选择站运营时间",trigger:"change"}],leader:[{required:!0,message:"请输入站的负责人",trigger:"blur"},{pattern:/^[^<|>|(|)|+|-|*|/|%|=|{|}]*$/,message:"禁止< > ( ) + - * / % = { }等特殊字符",trigger:"blur"},{min:2,max:24,message:"长度在 2 到 24 个字符",trigger:"blur"}],phone:[{required:!0,message:"请输入站负责人的联系方式",trigger:"blur"},{pattern:/^[0-9]+$/,message:"只能为数字",trigger:"blur"},{min:2,max:24,message:"长度在 2 到 24 个字符",trigger:"blur"}],latAndLng:[{required:!0,message:"请选择站的坐标值",trigger:"change"},{min:2,max:128,message:"长度在 2 到 128 个字符",trigger:"blur"}],address3:[{required:!0,message:"请选择电站地址",trigger:"change"}],address:[{required:!0,message:"请输入详细地址",trigger:"blur"},{pattern:/^[^<|>|(|)|+|-|*|/|%|=|{|}]*$/,message:"禁止< > ( ) + - * / % = { }等特殊字符",trigger:"blur"},{min:2,max:128,message:"长度在 2 到 128 个字符",trigger:"blur"}],community:[{required:!0,message:"请选择归属的物业",trigger:"change"},{min:2,max:128,message:"长度在 2 到 128 个字符",trigger:"blur"}],constructionUuid:[{required:!0,message:"请选择电站区域",trigger:"change"},{min:2,max:128,message:"长度在 2 到 128 个字符",trigger:"blur"}],kwhPrc:[{type:"number",min:0,max:99999,message:"数字超出",trigger:"blur"}],msgDetail:[{pattern:/^[^<|>|(|)|+|-|*|/|%|=|{|}]*$/,message:"禁止< > ( ) + - * / % = { }等特殊字符",trigger:"blur"}],mainLine:[{type:"number",min:0,max:99999999,message:"错误的数字",trigger:"blur"}],auxLine:[{type:"number",min:0,max:99999999,message:"错误的数字",trigger:"blur"}],maxPower:[{type:"number",min:0,max:99999999,message:"错误的数字",trigger:"blur"}],stakeNumber:[{type:"number",min:0,max:999999999,message:"错误的数字",trigger:"blur"}]};var v=y,x=(0,n.Z)(v,p,b,!1,null,"53f3eab5",null),$=x.exports}}]);