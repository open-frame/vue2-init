"use strict";(self["webpackChunkiov_platform"]=self["webpackChunkiov_platform"]||[]).push([[4734],{6560:function(e,t,n){n(7658);const s="0.8.10",i="undefined"!==typeof window,o="undefined"!==typeof n.g?n.g:"undefined"!==typeof window?window:"undefined"!==typeof self?self:Function("return this")();function r(e){return void 0===e}function a(e){return"string"===typeof e}function c(e){return"boolean"===typeof e}function l(e){return"function"===typeof e}const h=Array.isArray;function u(e){return"[object Object]"===toString.call(e)}function p(e){return"[object Promise]"===toString.call(e)}function d(e){return l(e)&&0===e.name.indexOf("bound ")&&!e.hasOwnProperty("prototype")}function m(e){return"undefined"!==typeof ShadowRoot&&e instanceof ShadowRoot}const f=Object.defineProperty,_=Object.defineProperties,A=Object.prototype.hasOwnProperty;function b(e,t=null,...n){t&&a(t);a(e)}function g(e,t=null,...n){t&&a(t);a(e)}function w(e,...t){Promise.resolve().then(e.bind(null,...t))}function y(e){return e.startsWith("//")?`${location.protocol}${e}`:e}function E(e,t=null){if(!a(e)||!e)return"";try{const{origin:t,pathname:n,search:s}=new URL(y(e));if(/\.(\w+)$/.test(n))return`${t}${n}${s}`;const i=`${t}${n}/`.replace(/\/\/$/,"/");return/^https?:\/\//.test(i)?`${i}${s}`:""}catch(n){return b(n,t),""}}function v(e){return a(e)&&e?e.replace(/(^\d+)|([^\w\d-_])/gi,""):""}function N(e){const{origin:t,pathname:n}=new URL(e);if(/\.(\w+)$/.test(n)){const e=`${t}${n}`,s=e.split("/");return s.pop(),s.join("/")+"/"}return`${t}${n}/`.replace(/\/\/$/,"/")}function C(e,t){return!e||/^((((ht|f)tps?)|file):)?\/\//.test(e)||/^(data|blob):/.test(e)?e:new URL(e,N(y(t))).toString()}function R(e){const t=e.split("/");return t.pop(),y(t.join("/")+"/")}function D(e,t,n,s){let i=0;function o(){++i===e.length&&s&&s()}e.forEach(((e,s)=>{p(e)?e.then((e=>{t({data:e,index:s}),o()})).catch((e=>{n({error:e,index:s}),o()})):(t({data:e,index:s}),o())}))}function M(){const e=document.createElement("script");return"noModule"in e}function P(){return"inline-"+Math.random().toString(36).substr(2,15)}function O(e){return e.filter((function(e){return!(e in this)&&(this[e]=!0)}),Object.create(null))}const S=o.requestIdleCallback||function(e){const t=Date.now();return setTimeout((function(){e({didTimeout:!1,timeRemaining(){return Math.max(0,50-(Date.now()-t))}})}),50)};let I=null;function U(e){I=e}function x(e){I!==e&&(U(e),w((()=>{U(null)})))}function L(){return I}function T(){U(null)}function k(e,t){const n=document.createElement(e,t);return n.__MICRO_APP_NAME__&&delete n.__MICRO_APP_NAME__,n}function W(e,t,n){if(t.innerHTML="",n){const n=e.cloneNode(!0),s=document.createDocumentFragment();Array.from(n.childNodes).forEach((e=>{s.appendChild(e)})),t.appendChild(s)}else Array.from(e.childNodes).forEach((e=>{t.appendChild(e)}))}function F(e){return!e||/(^\d)|([^\w\d-_\u4e00-\u9fa5])/gi.test(e)}function B(e){return/^body$/i.test(e)||/^head$/i.test(e)||/^html$/i.test(e)}function $(e){return m(e)?e.host:e}function H(e){return e?e.replace(/^\s+|\s+$/g,""):""}function K(){return navigator.userAgent.indexOf("Firefox")>-1}var j,G,V,q;(function(e){e["NAME"]="name",e["URL"]="url"})(j||(j={})),function(e){e["NOT_LOADED"]="NOT_LOADED",e["LOADING_SOURCE_CODE"]="LOADING_SOURCE_CODE",e["LOAD_SOURCE_FINISHED"]="LOAD_SOURCE_FINISHED",e["LOAD_SOURCE_ERROR"]="LOAD_SOURCE_ERROR",e["MOUNTING"]="MOUNTING",e["MOUNTED"]="MOUNTED",e["UNMOUNT"]="UNMOUNT"}(G||(G={})),function(e){e["CREATED"]="created",e["BEFOREMOUNT"]="beforemount",e["MOUNTED"]="mounted",e["UNMOUNT"]="unmount",e["ERROR"]="error",e["BEFORESHOW"]="beforeshow",e["AFTERSHOW"]="aftershow",e["AFTERHIDDEN"]="afterhidden"}(V||(V={})),function(e){e["KEEP_ALIVE_SHOW"]="KEEP_ALIVE_SHOW",e["KEEP_ALIVE_HIDDEN"]="KEEP_ALIVE_HIDDEN"}(q||(q={}));const z="window,self,globalThis,Array,Object,String,Boolean,Math,Number,Symbol,Date,Promise,Function,Proxy,WeakMap,WeakSet,Set,Map,Reflect,Element,Node,Document,RegExp,Error,TypeError,JSON,isNaN,parseFloat,parseInt,performance,console,decodeURI,encodeURI,decodeURIComponent,encodeURIComponent,location,navigator,undefined";function Q(e,t=null,n={}){return l(Tt.fetch)?Tt.fetch(e,n,t):fetch(e,n).then((e=>e.text()))}class J{static getInstance(){return this.instance||(this.instance=new J),this.instance}run(e,t){const n=e.name,s=e.ssrUrl||e.url;Q(s,n,{cache:"no-cache"}).then((i=>{if(!i){const t="html is empty, please check in detail";return e.onerror(new Error(t)),b(t,n)}i=this.formatHTML(s,i,n),t(i,e)})).catch((t=>{b(`Failed to fetch data from ${e.url}, micro-app stop rendering`,n,t),e.onLoadError(t)}))}formatHTML(e,t,n){return this.processHtml(e,t,n,Tt.plugins).replace(/<head[^>]*>[\s\S]*?<\/head>/i,(e=>e.replace(/<head/i,"<micro-app-head").replace(/<\/head>/i,"</micro-app-head>"))).replace(/<body[^>]*>[\s\S]*?<\/body>/i,(e=>e.replace(/<body/i,"<micro-app-body").replace(/<\/body>/i,"</micro-app-body>")))}processHtml(e,t,n,s){var i;if(!s)return t;const o=[];return s.global&&o.push(...s.global),(null===(i=s.modules)||void 0===i?void 0:i[n])&&o.push(...s.modules[n]),o.length>0?o.reduce(((t,n)=>u(n)&&l(n.processHtml)?n.processHtml(t,e,n.options):t),t):t}}const X=/(^|\s+)(html|:root)(?=[\s>~[.#:]+|$)/,Y=/(^|\s+)((html[\s>~]+body)|body)(?=[\s>~[.#:]+|$)/;function Z(e,t){e=t?`${t} ${e}`:e;const n=new Error(e);throw n.reason=e,t&&(n.filename=t),n}class ee{constructor(){this.cssText="",this.prefix="",this.baseURI="",this.linkPath="",this.result="",this.scopecssDisable=!1,this.scopecssDisableSelectors=[],this.scopecssDisableNextLine=!1,this.mediaRule=this.createMatcherForAtRuleWithChildRule(/^@media *([^{]+)/,"media"),this.supportsRule=this.createMatcherForAtRuleWithChildRule(/^@supports *([^{]+)/,"supports"),this.documentRule=this.createMatcherForAtRuleWithChildRule(/^@([-\w]+)?document *([^{]+)/,"document"),this.hostRule=this.createMatcherForAtRuleWithChildRule(/^@host\s*/,"host"),this.importRule=this.createMatcherForNoneBraceAtRule("import"),this.charsetRule=this.createMatcherForNoneBraceAtRule("charset"),this.namespaceRule=this.createMatcherForNoneBraceAtRule("namespace")}exec(e,t,n,s){return this.cssText=e,this.prefix=t,this.baseURI=n,this.linkPath=s||"",this.matchRules(),K()?decodeURIComponent(this.result):this.result}reset(){this.cssText=this.prefix=this.baseURI=this.linkPath=this.result="",this.scopecssDisable=this.scopecssDisableNextLine=!1,this.scopecssDisableSelectors=[]}matchRules(){this.matchLeadingSpaces(),this.matchComments();while(this.cssText.length&&"}"!==this.cssText.charAt(0)&&(this.matchAtRule()||this.matchStyleRule()))this.matchComments()}matchStyleRule(){const e=this.formatSelector(!0);return this.scopecssDisableNextLine=!1,e?(this.recordResult(e),this.matchComments(),this.styleDeclarations(),this.matchLeadingSpaces(),!0):Z("selector missing",this.linkPath)}formatSelector(e){const t=this.commonMatch(/^([^{]+)/,e);return!!t&&t[0].replace(/(^|,[\n\s]*)([^,]+)/g,((e,t,n)=>(n=H(n),this.scopecssDisableNextLine||this.scopecssDisable&&(!this.scopecssDisableSelectors.length||this.scopecssDisableSelectors.includes(n))||X.test(n)||(n=Y.test(n)?n.replace(Y,this.prefix+" micro-app-body"):this.prefix+" "+n),t+n)))}styleDeclarations(){return this.matchOpenBrace()?(this.matchAllDeclarations(),!!this.matchCloseBrace()||Z("Declaration missing '}'",this.linkPath)):Z("Declaration missing '{'",this.linkPath)}matchAllDeclarations(){let e=this.commonMatch(/^(?:url\(["']?(?:[^)"'}]+)["']?\)|[^}/])*/,!0)[0];if(e&&(this.scopecssDisableNextLine||this.scopecssDisable&&!this.scopecssDisableSelectors.length||(e=e.replace(/url\(["']?([^)"']+)["']?\)/gm,((e,t)=>/^((data|blob):|#)/.test(t)||/^(https?:)?\/\//.test(t)?e:(/^((\.\.?\/)|[^/])/.test(t)&&this.linkPath&&(this.baseURI=R(this.linkPath)),`url("${C(t,this.baseURI)}")`)))),this.recordResult(e)),this.scopecssDisableNextLine=!1,this.cssText&&"}"!==this.cssText.charAt(0))return"/"===this.cssText.charAt(0)&&"*"===this.cssText.charAt(1)?this.matchComments():this.commonMatch(/\/+/),this.matchAllDeclarations()}matchAtRule(){return"@"===this.cssText[0]&&(this.scopecssDisableNextLine=!1,this.keyframesRule()||this.mediaRule()||this.customMediaRule()||this.supportsRule()||this.importRule()||this.charsetRule()||this.namespaceRule()||this.documentRule()||this.pageRule()||this.hostRule()||this.fontFaceRule())}keyframesRule(){if(!this.commonMatch(/^@([-\w]+)?keyframes\s*/))return!1;if(!this.commonMatch(/^([-\w]+)\s*/))return Z("@keyframes missing name",this.linkPath);if(this.matchComments(),!this.matchOpenBrace())return Z("@keyframes missing '{'",this.linkPath);this.matchComments();while(this.keyframeRule())this.matchComments();return this.matchCloseBrace()?(this.matchLeadingSpaces(),!0):Z("@keyframes missing '}'",this.linkPath)}keyframeRule(){let e;const t=[];while(e=this.commonMatch(/^((\d+\.\d+|\.\d+|\d+)%?|[a-z]+)\s*/))t.push(e[1]),this.commonMatch(/^,\s*/);return!!t.length&&(this.styleDeclarations(),this.matchLeadingSpaces(),!0)}customMediaRule(){return!!this.commonMatch(/^@custom-media\s+(--[^\s]+)\s*([^{;]+);/)&&(this.matchLeadingSpaces(),!0)}pageRule(){return!!this.commonMatch(/^@page */)&&(this.formatSelector(!1),this.scopecssDisableNextLine=!1,this.commonHandlerForAtRuleWithSelfRule("page"))}fontFaceRule(){return!!this.commonMatch(/^@font-face\s*/)&&this.commonHandlerForAtRuleWithSelfRule("font-face")}createMatcherForAtRuleWithChildRule(e,t){return()=>!!this.commonMatch(e)&&(this.matchOpenBrace()?(this.matchComments(),this.matchRules(),this.matchCloseBrace()?(this.matchLeadingSpaces(),!0):Z(`@${t} missing '}'`,this.linkPath)):Z(`@${t} missing '{'`,this.linkPath))}createMatcherForNoneBraceAtRule(e){const t=new RegExp("^@"+e+"\\s*([^;]+);");return()=>!!this.commonMatch(t)&&(this.matchLeadingSpaces(),!0)}commonHandlerForAtRuleWithSelfRule(e){return this.matchOpenBrace()?(this.matchAllDeclarations(),this.matchCloseBrace()?(this.matchLeadingSpaces(),!0):Z(`@${e} missing '}'`,this.linkPath)):Z(`@${e} missing '{'`,this.linkPath)}matchComments(){while(this.matchComment());}matchComment(){if("/"!==this.cssText.charAt(0)||"*"!==this.cssText.charAt(1))return!1;this.scopecssDisableNextLine=!1;let e=2;while(""!==this.cssText.charAt(e)&&("*"!==this.cssText.charAt(e)||"/"!==this.cssText.charAt(e+1)))++e;if(e+=2,""===this.cssText.charAt(e-1))return Z("End of comment missing",this.linkPath);let t=this.cssText.slice(2,e-2);if(this.recordResult(`/*${t}*/`),t=H(t.replace(/^\s*!/,"")),"scopecss-disable-next-line"===t)this.scopecssDisableNextLine=!0;else if(/^scopecss-disable/.test(t))if("scopecss-disable"===t)this.scopecssDisable=!0;else{this.scopecssDisable=!0;const e=t.replace("scopecss-disable","").split(",");e.forEach((e=>{this.scopecssDisableSelectors.push(H(e))}))}else"scopecss-enable"===t&&(this.scopecssDisable=!1,this.scopecssDisableSelectors=[]);return this.cssText=this.cssText.slice(e),this.matchLeadingSpaces(),!0}commonMatch(e,t=!1){const n=e.exec(this.cssText);if(!n)return;const s=n[0];return this.cssText=this.cssText.slice(s.length),t||this.recordResult(s),n}matchOpenBrace(){return this.commonMatch(/^{\s*/)}matchCloseBrace(){return this.commonMatch(/^}/)}matchLeadingSpaces(){this.commonMatch(/^\s*/)}recordResult(e){K()?this.result+=encodeURIComponent(e):this.result+=e}}function te(e,t,n,s,i){if(!e.__MICRO_APP_HAS_SCOPED__){e.__MICRO_APP_HAS_SCOPED__=!0;let r=null;try{r=ne.exec(e.textContent,n,s,i),ne.reset()}catch(o){ne.reset(),b("An error occurred while parsing CSS:\n",t,o)}r&&(e.textContent=r)}}let ne;function se(e,t){if(t.scopecss){const n=`${Tt.tagName}[name=${t.name}]`;if(ne||(ne=new ee),e.textContent)te(e,t.name,n,t.url,e.__MICRO_APP_LINK_PATH__);else{const s=new MutationObserver((function(){s.disconnect(),e.textContent&&!e.hasAttribute("data-styled")&&te(e,t.name,n,t.url,e.__MICRO_APP_LINK_PATH__)}));s.observe(e,{childList:!0})}}return e}function ie(e,t){Object.defineProperties(e,{currentTarget:{get(){return t}},srcElement:{get(){return t}},target:{get(){return t}}})}function oe(e){const t=new CustomEvent("load");ie(t,e),l(e.onload)?e.onload(t):e.dispatchEvent(t)}function re(e){const t=new CustomEvent("error");ie(t,e),l(e.onerror)?e.onerror(t):e.dispatchEvent(t)}const ae=new Map;function ce(e,t,n,s=!1){const i=e.getAttribute("rel");let o=e.getAttribute("href"),r=null;if("stylesheet"===i&&o){if(o=C(o,n.url),s)return{url:o,info:{code:"",isGlobal:e.hasAttribute("global")}};r=document.createComment(`link element with href=${o} move to micro-app-head as style element`),n.source.links.set(o,{code:"",placeholder:r,isGlobal:e.hasAttribute("global")})}else i&&["prefetch","preload","prerender","icon","apple-touch-icon"].includes(i)?s?r=document.createComment(`link element with rel=${i}${o?" & href="+o:""} removed by micro-app`):t.removeChild(e):o&&e.setAttribute("href",C(o,n.url));return s?{replaceComment:r}:r?t.replaceChild(r,e):void 0}function le(e,t,n){const s=Array.from(t.source.links.entries()),i=s.map((([e])=>ae.has(e)?ae.get(e):Q(e,t.name)));D(i,(e=>{he(s[e.index][0],s[e.index][1],e.data,n,t)}),(e=>{b(e,t.name)}),(()=>{t.onLoad(e)}))}function he(e,t,n,s,i){t.isGlobal&&!ae.has(e)&&ae.set(e,n);const o=k("style");o.textContent=n,o.__MICRO_APP_LINK_PATH__=e,o.setAttribute("data-origin-href",e),t.placeholder.parentNode?t.placeholder.parentNode.replaceChild(se(o,i),t.placeholder):s.appendChild(se(o,i)),t.placeholder=null,t.code=n}function ue(e,t,n,s,i){if(n.source.links.has(e))return i.textContent=n.source.links.get(e).code,se(i,n),void w((()=>oe(s)));if(ae.has(e)){const o=ae.get(e);return t.code=o,n.source.links.set(e,t),i.textContent=o,se(i,n),void w((()=>oe(s)))}Q(e,n.name).then((o=>{t.code=o,n.source.links.set(e,t),t.isGlobal&&ae.set(e,o),i.textContent=o,se(i,n),oe(s)})).catch((e=>{b(e,n.name),re(s)}))}const pe=new WeakMap;function de(e,t,n){if(t instanceof HTMLStyleElement){if(t.hasAttribute("exclude")){const e=document.createComment("style element with exclude attribute ignored by micro-app");return pe.set(t,e),e}return n.scopecss&&!t.hasAttribute("ignore")?se(t,n):t}if(t instanceof HTMLLinkElement){if(t.hasAttribute("exclude")||Fe(t.getAttribute("href"),n.name)){const e=document.createComment("link element with exclude attribute ignored by micro-app");return pe.set(t,e),e}if(t.hasAttribute("ignore")||Be(t.getAttribute("href"),n.name)||t.href&&l(Tt.excludeAssetFilter)&&Tt.excludeAssetFilter(t.href))return t;const{url:s,info:i,replaceComment:o}=ce(t,e,n,!0);if(s&&i){const e=k("style");return e.__MICRO_APP_LINK_PATH__=s,ue(s,i,n,t,e),pe.set(t,e),e}return o?(pe.set(t,o),o):t}if(t instanceof HTMLScriptElement){if(t.src&&l(Tt.excludeAssetFilter)&&Tt.excludeAssetFilter(t.src))return t;const{replaceComment:s,url:i,info:o}=ke(t,e,n,!0)||{};if(i&&o){if(o.isExternal){const e=Ge(i,o,n,t);return pe.set(t,e),e}{const e=je(i,n,o,!0);return pe.set(t,e),e}}return s?(pe.set(t,s),s):t}return t}function me(e,t,n,s,i){const o=Ae(n,e);return o?i&&!o.contains(i)?xe.rawAppendChild.call(o,s):t!==xe.rawRemoveChild||o.contains(s)?fe(t,o,s,i):n.contains(s)?t.call(n,s):s:fe(t,n,s,i)}function fe(e,t,n,s){return _e(e)?e.call(t,n):e.call(t,n,s)}function _e(e){return e===xe.rawAppend||e===xe.rawPrepend}function Ae(e,t){var n,s;return e===document.head?null===(n=null===t||void 0===t?void 0:t.container)||void 0===n?void 0:n.querySelector("micro-app-head"):e===document.body?null===(s=null===t||void 0===t?void 0:t.container)||void 0===s?void 0:s.querySelector("micro-app-body"):null}function be(e){var t;return null!==(t=pe.get(e))&&void 0!==t?t:e}function ge(e,t,n,s){if(null===t||void 0===t?void 0:t.__MICRO_APP_NAME__){const i=Dt.get(t.__MICRO_APP_NAME__);return(null===i||void 0===i?void 0:i.container)?me(i,s,e,de(e,t,i),n&&be(n)):s===xe.rawAppend||s===xe.rawPrepend?s.call(e,t):s.call(e,t,n)}if(s===xe.rawAppend||s===xe.rawPrepend){const n=L();if(!(t instanceof Node)&&n){const i=Dt.get(n);if(null===i||void 0===i?void 0:i.container){if(e===document.head)return s.call(i.container.querySelector("micro-app-head"),t);if(e===document.body)return s.call(i.container.querySelector("micro-app-body"),t)}}return s.call(e,t)}return s.call(e,t,n)}function we(){Ee(),Element.prototype.appendChild=function(e){return ge(this,e,null,xe.rawAppendChild)},Element.prototype.insertBefore=function(e,t){return ge(this,e,t,xe.rawInsertBefore)},Element.prototype.replaceChild=function(e,t){return ge(this,e,t,xe.rawReplaceChild)},Element.prototype.append=function(...e){let t=0;const n=e.length;while(t<n)ge(this,e[t],null,xe.rawAppend),t++},Element.prototype.prepend=function(...e){let t=e.length;while(t>0)ge(this,e[t-1],null,xe.rawPrepend),t--},Element.prototype.removeChild=function(e){if(null===e||void 0===e?void 0:e.__MICRO_APP_NAME__){const t=Dt.get(e.__MICRO_APP_NAME__);return(null===t||void 0===t?void 0:t.container)?me(t,xe.rawRemoveChild,this,be(e)):xe.rawRemoveChild.call(this,e)}return xe.rawRemoveChild.call(this,e)},Element.prototype.cloneNode=function(e){const t=xe.rawCloneNode.call(this,e);return this.__MICRO_APP_NAME__&&(t.__MICRO_APP_NAME__=this.__MICRO_APP_NAME__),t}}function ye(e){const t=L();return t&&(e.__MICRO_APP_NAME__=t),e}function Ee(){const e=xe.rawDocument;function t(t){var n,s,i;const o=L();return o&&t&&!B(t)&&e===this?null!==(i=null===(s=null===(n=Dt.get(o))||void 0===n?void 0:n.container)||void 0===s?void 0:s.querySelector(t))&&void 0!==i?i:null:xe.rawQuerySelector.call(this,t)}function n(t){var n,s,i;const o=L();return o&&t&&!B(t)&&e===this?null!==(i=null===(s=null===(n=Dt.get(o))||void 0===n?void 0:n.container)||void 0===s?void 0:s.querySelectorAll(t))&&void 0!==i?i:[]:xe.rawQuerySelectorAll.call(this,t)}Document.prototype.createElement=function(e,t){const n=xe.rawCreateElement.call(this,e,t);return ye(n)},Document.prototype.createElementNS=function(e,t,n){const s=xe.rawCreateElementNS.call(this,e,t,n);return ye(s)},Document.prototype.createDocumentFragment=function(){const e=xe.rawCreateDocumentFragment.call(this);return ye(e)},Document.prototype.querySelector=t,Document.prototype.querySelectorAll=n,Document.prototype.getElementById=function(e){if(!L()||F(e))return xe.rawGetElementById.call(this,e);try{return t.call(this,`#${e}`)}catch(n){return xe.rawGetElementById.call(this,e)}},Document.prototype.getElementsByClassName=function(e){if(!L()||F(e))return xe.rawGetElementsByClassName.call(this,e);try{return n.call(this,`.${e}`)}catch(t){return xe.rawGetElementsByClassName.call(this,e)}},Document.prototype.getElementsByTagName=function(e){var t;const s=L();if(!s||B(e)||F(e)||!(null===(t=Dt.get(s))||void 0===t?void 0:t.inline)&&/^script$/i.test(e))return xe.rawGetElementsByTagName.call(this,e);try{return n.call(this,e)}catch(i){return xe.rawGetElementsByTagName.call(this,e)}},Document.prototype.getElementsByName=function(e){if(!L()||F(e))return xe.rawGetElementsByName.call(this,e);try{return n.call(this,`[name=${e}]`)}catch(t){return xe.rawGetElementsByName.call(this,e)}}}let ve=!1;function Ne(){ve||(ve=!0,Element.prototype.setAttribute=function(e,t){if(/^micro-app(-\S+)?/i.test(this.tagName)&&"data"===e)if(u(t)){const e={};Object.getOwnPropertyNames(t).forEach((n=>{a(n)&&0===n.indexOf("__")||(e[n]=t[n])})),this.data=e}else"[object Object]"!==t&&g("property data must be an object",this.getAttribute("name"));else if((("src"===e||"srcset"===e)&&/^(img|script)$/i.test(this.tagName)||"href"===e&&/^link$/i.test(this.tagName))&&this.__MICRO_APP_NAME__&&Dt.has(this.__MICRO_APP_NAME__)){const n=Dt.get(this.__MICRO_APP_NAME__);xe.rawSetAttribute.call(this,e,C(t,n.url))}else xe.rawSetAttribute.call(this,e,t)})}function Ce(){ve=!1,Element.prototype.setAttribute=xe.rawSetAttribute}function Re(){Document.prototype.createElement=xe.rawCreateElement,Document.prototype.createElementNS=xe.rawCreateElementNS,Document.prototype.createDocumentFragment=xe.rawCreateDocumentFragment,Document.prototype.querySelector=xe.rawQuerySelector,Document.prototype.querySelectorAll=xe.rawQuerySelectorAll,Document.prototype.getElementById=xe.rawGetElementById,Document.prototype.getElementsByClassName=xe.rawGetElementsByClassName,Document.prototype.getElementsByTagName=xe.rawGetElementsByTagName,Document.prototype.getElementsByName=xe.rawGetElementsByName}function De(){U(null),Re(),Element.prototype.appendChild=xe.rawAppendChild,Element.prototype.insertBefore=xe.rawInsertBefore,Element.prototype.replaceChild=xe.rawReplaceChild,Element.prototype.removeChild=xe.rawRemoveChild,Element.prototype.append=xe.rawAppend,Element.prototype.prepend=xe.rawPrepend,Element.prototype.cloneNode=xe.rawCloneNode}let Me=!1;function Pe(){if(!Me){Me=!0;const e=k("style");xe.rawSetAttribute.call(e,"type","text/css"),e.textContent=`\n${Tt.tagName}, micro-app-body { display: block; } \nmicro-app-head { display: none; }`,xe.rawDocument.head.appendChild(e)}}class Oe{constructor(){this.appInstanceMap=Dt}static getInstance(){return this.instance||(this.instance=new Oe),this.instance}get(e){return this.appInstanceMap.get(e)}set(e,t){this.appInstanceMap.set(e,t)}getAll(){return Array.from(this.appInstanceMap.values())}clear(){this.appInstanceMap.clear()}}function Se(){Ue(),Oe.getInstance().getAll().forEach((e=>{e.container&&$(e.container).disconnectedCallback()})),!window.__MICRO_APP_UMD_MODE__&&Oe.getInstance().clear()}function Ie(){window.__MICRO_APP_ENVIRONMENT__&&window.addEventListener("unmount",Se,!1)}function Ue(){window.__MICRO_APP_ENVIRONMENT__&&window.removeEventListener("unmount",Se,!1)}const xe={};function Le(){if(i){const e=Element.prototype.setAttribute,t=Element.prototype.appendChild,n=Element.prototype.insertBefore,s=Element.prototype.replaceChild,i=Element.prototype.removeChild,o=Element.prototype.append,r=Element.prototype.prepend,a=Element.prototype.cloneNode,c=Document.prototype.createElement,l=Document.prototype.createElementNS,h=Document.prototype.createDocumentFragment,u=Document.prototype.querySelector,p=Document.prototype.querySelectorAll,d=Document.prototype.getElementById,m=Document.prototype.getElementsByClassName,f=Document.prototype.getElementsByTagName,_=Document.prototype.getElementsByName,A=new Proxy(Image,{construct(e,t){const n=new e(...t);return n.__MICRO_APP_NAME__=L(),n}}),b=Function("return window")(),g=Function("return document")(),w=M(),y=b.addEventListener,E=b.removeEventListener,v=b.setInterval,N=b.setTimeout,C=b.clearInterval,R=b.clearTimeout,D=g.addEventListener,P=g.removeEventListener;window.__MICRO_APP_BASE_APPLICATION__=!0,Object.assign(xe,{rawSetAttribute:e,rawAppendChild:t,rawInsertBefore:n,rawReplaceChild:s,rawRemoveChild:i,rawAppend:o,rawPrepend:r,rawCloneNode:a,rawCreateElement:c,rawCreateElementNS:l,rawCreateDocumentFragment:h,rawQuerySelector:u,rawQuerySelectorAll:p,rawGetElementById:d,rawGetElementsByClassName:m,rawGetElementsByTagName:f,rawGetElementsByName:_,ImageProxy:A,rawWindow:b,rawDocument:g,supportModuleScript:w,rawWindowAddEventListener:y,rawWindowRemoveEventListener:E,rawSetInterval:v,rawSetTimeout:N,rawClearInterval:C,rawClearTimeout:R,rawDocumentAddEventListener:D,rawDocumentRemoveEventListener:P}),Pe(),Ue(),Ie()}}const Te=new Map;function ke(e,t,n,s=!1){let i=null,o=e.getAttribute("src");if(o&&(o=C(o,n.url)),e.hasAttribute("exclude")||Fe(o,n.name))i=document.createComment("script element with exclude attribute removed by micro-app");else{if(e.type&&!["text/javascript","text/ecmascript","application/javascript","application/ecmascript","module","systemjs-module","systemjs-importmap"].includes(e.type)||e.hasAttribute("ignore")||Be(o,n.name))return null;if(xe.supportModuleScript&&e.noModule||!xe.supportModuleScript&&"module"===e.type)i=document.createComment((e.noModule?"noModule":"module")+" script ignored by micro-app");else if(o){const t={code:"",isExternal:!0,isDynamic:s,async:e.hasAttribute("async"),defer:e.defer||"module"===e.type,module:"module"===e.type,isGlobal:e.hasAttribute("global")};if(s)return{url:o,info:t};n.source.scripts.set(o,t),i=document.createComment(`script with src='${o}' extract by micro-app`)}else if(e.textContent){const t=P(),o={code:e.textContent,isExternal:!1,isDynamic:s,async:!1,defer:"module"===e.type,module:"module"===e.type};if(s)return{url:t,info:o};n.source.scripts.set(t,o),i=document.createComment("inline script extract by micro-app")}else s||(i=document.createComment("script element removed by micro-app"))}return s?{replaceComment:i}:t.replaceChild(i,e)}function We(e){var t,n,s;const i=(null===(t=Tt.plugins)||void 0===t?void 0:t.global)||[],o=(null===(s=null===(n=Tt.plugins)||void 0===n?void 0:n.modules)||void 0===s?void 0:s[e])||[];return[...i,...o]}function Fe(e,t){if(!e)return!1;const n=We(t)||[];return n.some((t=>!!t.excludeChecker&&t.excludeChecker(e)))}function Be(e,t){if(!e)return!1;const n=We(t)||[];return n.some((t=>!!t.ignoreChecker&&t.ignoreChecker(e)))}function $e(e,t){const n=Array.from(t.source.scripts.entries()),s=[],i=[];for(const[o,r]of n)if(r.isExternal){const e=Te.get(o);e?r.code=e:(!r.defer&&!r.async||t.isPrefetch)&&(s.push(Q(o,t.name)),i.push([o,r]))}s.length?D(s,(e=>{He(i[e.index][0],i[e.index][1],e.data)}),(e=>{b(e,t.name)}),(()=>{t.onLoad(e)})):t.onLoad(e)}function He(e,t,n){t.isGlobal&&!Te.has(e)&&Te.set(e,n),t.code=n}function Ke(e,t,n){const s=Array.from(e.entries()),i=[],o=[];for(const[r,a]of s)a.isDynamic||(a.defer||a.async?(a.isExternal&&!a.code?i.push(Q(r,t.name)):i.push(a.code),o.push([r,a]),a.module&&(n.moduleCount=n.moduleCount?++n.moduleCount:1)):(je(r,t,a,!1),n(!1)));i.length?D(i,(e=>{const t=o[e.index][1];t.code=t.code||e.data}),(e=>{n.errorCount=n.errorCount?++n.errorCount:1,b(e,t.name)}),(()=>{o.forEach((([e,s])=>{s.code&&(je(e,t,s,!1,n),!s.module&&n(!1))})),n(r(n.moduleCount)||n.errorCount===i.length)})):n(!0)}function je(e,t,n,s,i){var o;try{const r=ze(e,t,n.code,n);if(t.inline||n.module){const a=k("script");if(Ve(e,r,n.module,a,i),s)return a;null===(o=t.container)||void 0===o||o.querySelector("micro-app-body").appendChild(a)}else if(qe(r,n),s)return document.createComment("dynamic script extract by micro-app")}catch(r){}}function Ge(e,t,n,s){const i=()=>oe(s);if(n.source.scripts.has(e)){const t=n.source.scripts.get(e);return!t.module&&w(i),je(e,n,t,!0,i)}if(Te.has(e)){const s=Te.get(e);return t.code=s,n.source.scripts.set(e,t),!t.module&&w(i),je(e,n,t,!0,i)}let o;return o=n.inline||t.module?k("script"):document.createComment(`dynamic script with src='${e}' extract by micro-app`),Q(e,n.name).then((r=>{t.code=r,n.source.scripts.set(e,t),t.isGlobal&&Te.set(e,r);try{r=ze(e,n,r,t),n.inline||t.module?Ve(e,r,t.module,o,i):qe(r,t)}catch(a){}!t.module&&oe(s)})).catch((e=>{b(e,n.name),re(s)})),o}function Ve(e,t,n,s,i){if(n){const e=new Blob([t],{type:"text/javascript"});s.src=URL.createObjectURL(e),s.setAttribute("type","module"),i&&(i.moduleCount&&i.moduleCount--,s.onload=i.bind(s,0===i.moduleCount))}else s.textContent=t;e.startsWith("inline-")||s.setAttribute("data-origin-src",e)}function qe(e,t){t.code2Function||(t.code2Function=new Function(e)),t.code2Function.call(window)}function ze(e,t,n,s){return u(Tt.plugins)&&(n=Qe(e,n,t.name,Tt.plugins,s)),t.sandBox&&!s.module?(xe.rawWindow.__MICRO_APP_PROXY_WINDOW__=t.sandBox.proxyWindow,`;(function(proxyWindow){with(proxyWindow.__MICRO_APP_WINDOW__){(function(${z}){;${n}\n}).call(proxyWindow,${z})}})(window.__MICRO_APP_PROXY_WINDOW__);`):n}function Qe(e,t,n,s,i){var o;const r=Je(s.global,t,e,i);return Je(null===(o=s.modules)||void 0===o?void 0:o[n],r,e,i)}function Je(e,t,n,s){return h(e)?e.reduce(((e,t)=>u(t)&&l(t.loader)?t.loader(e,n,t.options,s):e),t):t}function Xe(e){const t=k("div");return t.innerHTML=e,t}function Ye(e,t,n){const s=Array.from(e.children);s.length&&s.forEach((e=>{Ye(e,t)}));for(const i of s)i instanceof HTMLLinkElement?i.hasAttribute("exclude")||Fe(i.getAttribute("href"),t.name)?e.replaceChild(document.createComment("link element with exclude attribute ignored by micro-app"),i):i.hasAttribute("ignore")||Be(i.getAttribute("href"),t.name)?i.hasAttribute("href")&&i.setAttribute("href",C(i.getAttribute("href"),t.url)):ce(i,e,t):i instanceof HTMLStyleElement?i.hasAttribute("exclude")?e.replaceChild(document.createComment("style element with exclude attribute ignored by micro-app"),i):t.scopecss&&!i.hasAttribute("ignore")&&se(i,t):i instanceof HTMLScriptElement?ke(i,e,t):i instanceof HTMLMetaElement||i instanceof HTMLTitleElement?e.removeChild(i):i instanceof HTMLImageElement&&i.hasAttribute("src")&&i.setAttribute("src",C(i.getAttribute("src"),t.url))}function Ze(e,t){const n=Xe(e),s=n.querySelector("micro-app-head"),i=n.querySelector("micro-app-body");if(!s||!i){const e=`element ${s?"body":"head"} is missing`;return t.onerror(new Error(e)),b(e,t.name)}Ye(n,t),t.source.links.size?le(n,t,s):t.onLoad(n),t.source.scripts.size?$e(n,t):t.onLoad(n)}class et{constructor(){this.eventList=new Map}isLegalName(e){return!!e||(b("event-center: Invalid name"),!1)}on(e,t,n=!1){if(this.isLegalName(e)){if(!l(t))return b("event-center: Invalid callback function");let s=this.eventList.get(e);s?n&&Object.getOwnPropertyNames(s.data).length&&t(s.data):(s={data:{},callbacks:new Set},this.eventList.set(e,s)),s.callbacks.add(t)}}off(e,t){if(this.isLegalName(e)){const n=this.eventList.get(e);n&&(l(t)?n.callbacks.delete(t):n.callbacks.clear())}}dispatch(e,t){if(this.isLegalName(e)){if(!u(t))return b("event-center: data must be object");let n=this.eventList.get(e);if(n){if(n.data!==t){n.data=t;for(const e of n.callbacks)e(t)}}else n={data:t,callbacks:new Set},this.eventList.set(e,n)}}getData(e){var t;const n=this.eventList.get(e);return null!==(t=null===n||void 0===n?void 0:n.data)&&void 0!==t?t:null}}const tt=new et;function nt(e,t){return a(e)&&e?t?`__from_base_app_${e}__`:`__from_micro_app_${e}__`:""}class st{addGlobalDataListener(e,t){const n=this.appName;n&&(e.__APP_NAME__=n,e.__AUTO_TRIGGER__=t),tt.on("global",e,t)}removeGlobalDataListener(e){l(e)&&tt.off("global",e)}setGlobalData(e){T(),tt.dispatch("global",e)}getGlobalData(){return tt.getData("global")}clearGlobalDataListener(){const e=this.appName,t=tt.eventList.get("global");if(t)for(const n of t.callbacks)(e&&e===n.__APP_NAME__||!e&&!n.__APP_NAME__)&&t.callbacks.delete(n)}}class it extends st{addDataListener(e,t,n){tt.on(nt(v(e),!1),t,n)}removeDataListener(e,t){l(t)&&tt.off(nt(v(e),!1),t)}getData(e,t=!1){return tt.getData(nt(v(e),t))}setData(e,t){tt.dispatch(nt(v(e),!0),t)}clearDataListener(e){tt.off(nt(v(e),!1))}}class ot extends st{constructor(e){super(),this.appName=v(e),!this.appName&&b(`Invalid appName ${e}`)}addDataListener(e,t){e.__AUTO_TRIGGER__=t,tt.on(nt(this.appName,!0),e,t)}removeDataListener(e){l(e)&&tt.off(nt(this.appName,!0),e)}getData(){return tt.getData(nt(this.appName,!0))}dispatch(e){T(),tt.dispatch(nt(this.appName,!1),e);const t=Dt.get(this.appName);if((null===t||void 0===t?void 0:t.container)&&u(e)){const n=new CustomEvent("datachange",{detail:{data:e}});$(t.container).dispatchEvent(n)}}clearDataListener(){tt.off(nt(this.appName,!0))}}function rt(e){const t=e.appName;e.umdDataListeners={global:new Set,normal:new Set};const n=tt.eventList.get("global");if(n)for(const i of n.callbacks)t===i.__APP_NAME__&&e.umdDataListeners.global.add(i);const s=tt.eventList.get(nt(t,!0));s&&(e.umdDataListeners.normal=new Set(s.callbacks))}function at(e){for(const t of e.umdDataListeners.global)e.addGlobalDataListener(t,t.__AUTO_TRIGGER__);for(const t of e.umdDataListeners.normal)e.addDataListener(t,t.__AUTO_TRIGGER__)}function ct(e){return c(e.__MICRO_APP_IS_BOUND_FUNCTION__)?e.__MICRO_APP_IS_BOUND_FUNCTION__:e.__MICRO_APP_IS_BOUND_FUNCTION__=d(e)}function lt(e){var t;if(c(e.__MICRO_APP_IS_CONSTRUCTOR__))return e.__MICRO_APP_IS_CONSTRUCTOR__;const n=e.toString(),s=(null===(t=e.prototype)||void 0===t?void 0:t.constructor)===e&&Object.getOwnPropertyNames(e.prototype).length>1||/^function\s+[A-Z]/.test(n)||/^class\s+/.test(n);return e.__MICRO_APP_IS_CONSTRUCTOR__=s}function ht(e,t){if(t.__MICRO_APP_BOUND_WINDOW_FUNCTION__)return t.__MICRO_APP_BOUND_WINDOW_FUNCTION__;if(!lt(t)&&!ct(t)){const n=t.bind(e);for(const e in t)n[e]=t[e];return t.hasOwnProperty("prototype")&&f(n,"prototype",{value:t.prototype,configurable:!0,enumerable:!1,writable:!0}),t.__MICRO_APP_BOUND_WINDOW_FUNCTION__=n}return t}const ut=new Map;let pt=!1;function dt(){if(pt=!0,Object.getOwnPropertyDescriptor(document,"onclick"))return g("Cannot redefine document property onclick");const e=document.onclick;document.onclick=null;let t=!1;function n(e){ut.forEach((t=>{l(t)&&t.call(document,e)}))}f(document,"onclick",{configurable:!0,enumerable:!0,get(){const e=L();return e?ut.get(e):ut.get("base")},set(e){const s=L();s?ut.set(s,e):ut.set("base",e),!t&&l(e)&&(t=!0,xe.rawDocumentAddEventListener.call(xe.rawDocument,"click",n,!1))}}),e&&(document.onclick=e)}const mt=new Map;function ft(){const{rawDocument:e,rawDocumentAddEventListener:t,rawDocumentRemoveEventListener:n}=xe;!pt&&dt(),document.addEventListener=function(n,s,i){var o;const r=L();if(r&&(!(null===(o=Dt.get(r))||void 0===o?void 0:o.umdMode)||!d(s))){const e=mt.get(r);if(e){const t=e.get(n);t?t.add(s):e.set(n,new Set([s]))}else mt.set(r,new Map([[n,new Set([s])]]));s&&(s.__MICRO_APP_MARK_OPTIONS__=i)}t.call(e,n,s,i)},document.removeEventListener=function(t,s,i){var o;const r=L();if(r&&(!(null===(o=Dt.get(r))||void 0===o?void 0:o.umdMode)||!d(s))){const e=mt.get(r);if(e){const n=e.get(t);(null===n||void 0===n?void 0:n.size)&&n.has(s)&&n.delete(s)}}n.call(e,t,s,i)}}function _t(){document.addEventListener=xe.rawDocumentAddEventListener,document.removeEventListener=xe.rawDocumentRemoveEventListener}const At=["unmount","appstate-change"];function bt(e,t){return At.includes(e)?`${e}-${t.__MICRO_APP_NAME__}`:e}function gt(e){const t=e.__MICRO_APP_NAME__,n=new Map,s=new Map,i=new Map,{rawWindow:o,rawDocument:r,rawWindowAddEventListener:a,rawWindowRemoveEventListener:c,rawSetInterval:l,rawSetTimeout:h,rawClearInterval:u,rawClearTimeout:p,rawDocumentRemoveEventListener:d}=xe;e.addEventListener=function(t,s,i){t=bt(t,e);const r=n.get(t);r?r.add(s):n.set(t,new Set([s])),s&&(s.__MICRO_APP_MARK_OPTIONS__=i),a.call(o,t,s,i)},e.removeEventListener=function(t,s,i){t=bt(t,e);const r=n.get(t);(null===r||void 0===r?void 0:r.size)&&r.has(s)&&r.delete(s),c.call(o,t,s,i)},e.setInterval=function(e,t,...n){const i=l.call(o,e,t,...n);return s.set(i,{handler:e,timeout:t,args:n}),i},e.setTimeout=function(e,t,...n){const s=h.call(o,e,t,...n);return i.set(s,{handler:e,timeout:t,args:n}),s},e.clearInterval=function(e){s.delete(e),u.call(o,e)},e.clearTimeout=function(e){i.delete(e),p.call(o,e)};const m=new Map,f=new Map;let _,A=new Map,b=new Map;const g=()=>{n.forEach(((e,t)=>{e.size&&m.set(t,new Set(e))})),s.size&&(A=new Map(s)),i.size&&(b=new Map(i)),_=ut.get(t);const e=mt.get(t);e&&e.forEach(((e,t)=>{e.size&&f.set(t,new Set(e))}))},w=()=>{m.forEach(((t,n)=>{for(const s of t)e.addEventListener(n,s,null===s||void 0===s?void 0:s.__MICRO_APP_MARK_OPTIONS__)})),A.forEach((t=>{e.setInterval(t.handler,t.timeout,...t.args)})),b.forEach((t=>{e.setTimeout(t.handler,t.timeout,...t.args)})),_&&ut.set(t,_),U(t),f.forEach(((e,t)=>{for(const n of e)document.addEventListener(t,n,null===n||void 0===n?void 0:n.__MICRO_APP_MARK_OPTIONS__)})),U(null)},y=()=>{n.size&&(n.forEach(((e,t)=>{for(const n of e)c.call(o,t,n)})),n.clear()),s.size&&(s.forEach(((e,t)=>{u.call(o,t)})),s.clear()),i.size&&(i.forEach(((e,t)=>{p.call(o,t)})),i.clear()),ut.delete(t);const e=mt.get(t);e&&(e.forEach(((e,t)=>{for(const n of e)d.call(r,t,n)})),e.clear())};return{recordUmdEffect:g,rebuildUmdEffect:w,releaseEffect:y}}const wt=["System","__cjsWrapper"],yt=["location"],Et=["window","self","globalThis"];class vt{constructor(e,t){this.scopeProperties=["webpackJsonp","Vue"],this.escapeProperties=[],this.injectedKeys=new Set,this.escapeKeys=new Set,this.active=!1,this.microAppWindow={},this.getSpecialProperties(e),this.proxyWindow=this.createProxyWindow(e),this.initMicroAppWindow(this.microAppWindow,e,t),Object.assign(this,gt(this.microAppWindow))}start(e){this.active||(this.active=!0,this.microAppWindow.__MICRO_APP_BASE_ROUTE__=this.microAppWindow.__MICRO_APP_BASE_URL__=e,xe.rawWindow._babelPolyfill&&(xe.rawWindow._babelPolyfill=!1),1===++vt.activeCount&&(ft(),we()))}stop(e){this.active&&(this.active=!1,this.releaseEffect(),this.microAppWindow.microApp.clearDataListener(),this.microAppWindow.microApp.clearGlobalDataListener(),e||(this.injectedKeys.forEach((e=>{Reflect.deleteProperty(this.microAppWindow,e)})),this.injectedKeys.clear(),this.escapeKeys.forEach((e=>{Reflect.deleteProperty(xe.rawWindow,e)})),this.escapeKeys.clear()),0===--vt.activeCount&&(_t(),De()))}recordUmdSnapshot(){this.microAppWindow.__MICRO_APP_UMD_MODE__=!0,this.recordUmdEffect(),rt(this.microAppWindow.microApp),this.recordUmdInjectedValues=new Map,this.injectedKeys.forEach((e=>{this.recordUmdInjectedValues.set(e,Reflect.get(this.microAppWindow,e))}))}rebuildUmdSnapshot(){this.recordUmdInjectedValues.forEach(((e,t)=>{Reflect.set(this.proxyWindow,t,e)})),this.rebuildUmdEffect(),at(this.microAppWindow.microApp)}getSpecialProperties(e){var t;u(Tt.plugins)&&(this.commonActionForSpecialProperties(Tt.plugins.global),this.commonActionForSpecialProperties(null===(t=Tt.plugins.modules)||void 0===t?void 0:t[e]))}commonActionForSpecialProperties(e){if(h(e))for(const t of e)u(t)&&(h(t.scopeProperties)&&(this.scopeProperties=this.scopeProperties.concat(t.scopeProperties)),h(t.escapeProperties)&&(this.escapeProperties=this.escapeProperties.concat(t.escapeProperties)))}createProxyWindow(e){const t=xe.rawWindow,n=new Map;return new Proxy(this.microAppWindow,{get:(n,s)=>{if(x(e),Reflect.has(n,s)||a(s)&&/^__MICRO_APP_/.test(s)||this.scopeProperties.includes(s))return Reflect.get(n,s);const i=Reflect.get(t,s);return l(i)?ht(t,i):i},set:(e,n,s)=>{if(this.active){if(yt.includes(n))Reflect.set(t,n,s);else if(A.call(e,n)||!A.call(t,n)||this.scopeProperties.includes(n))Reflect.set(e,n,s),this.injectedKeys.add(n);else{const i=Object.getOwnPropertyDescriptor(t,n),{configurable:o,enumerable:r,writable:a,set:c}=i;f(e,n,{value:s,configurable:o,enumerable:r,writable:null!==a&&void 0!==a?a:!!c}),this.injectedKeys.add(n)}(this.escapeProperties.includes(n)||wt.includes(n)&&!Reflect.has(t,n))&&!this.scopeProperties.includes(n)&&(Reflect.set(t,n,s),this.escapeKeys.add(n))}return!0},has:(e,n)=>this.scopeProperties.includes(n)?n in e:n in e||n in t,getOwnPropertyDescriptor:(e,s)=>{if(A.call(e,s))return n.set(s,"target"),Object.getOwnPropertyDescriptor(e,s);if(A.call(t,s)){n.set(s,"rawWindow");const e=Object.getOwnPropertyDescriptor(t,s);return e&&!e.configurable&&(e.configurable=!0),e}},defineProperty:(e,s,i)=>{const o=n.get(s);return"rawWindow"===o?Reflect.defineProperty(t,s,i):Reflect.defineProperty(e,s,i)},ownKeys:e=>O(Reflect.ownKeys(t).concat(Reflect.ownKeys(e))),deleteProperty:(e,n)=>!A.call(e,n)||(this.injectedKeys.has(n)&&this.injectedKeys.delete(n),this.escapeKeys.has(n)&&Reflect.deleteProperty(t,n),Reflect.deleteProperty(e,n))})}initMicroAppWindow(e,t,n){e.__MICRO_APP_ENVIRONMENT__=!0,e.__MICRO_APP_NAME__=t,e.__MICRO_APP_PUBLIC_PATH__=N(n),e.__MICRO_APP_WINDOW__=e,e.microApp=Object.assign(new ot(t),{removeDomScope:T,pureCreateElement:k}),e.rawWindow=xe.rawWindow,e.rawDocument=xe.rawDocument,e.hasOwnProperty=t=>A.call(e,t)||A.call(xe.rawWindow,t),this.setMappingPropertiesWithRawDescriptor(e),this.setHijackProperties(e,t)}setMappingPropertiesWithRawDescriptor(e){let t,n;const s=xe.rawWindow;s===s.parent?t=n=this.proxyWindow:(t=s.top,n=s.parent),f(e,"top",this.createDescriptorForMicroAppWindow("top",t)),f(e,"parent",this.createDescriptorForMicroAppWindow("parent",n)),Et.forEach((t=>{f(e,t,this.createDescriptorForMicroAppWindow(t,this.proxyWindow))}))}createDescriptorForMicroAppWindow(e,t){const{configurable:n=!0,enumerable:s=!0,writable:i,set:o}=Object.getOwnPropertyDescriptor(xe.rawWindow,e)||{writable:!0},r={value:t,configurable:n,enumerable:s,writable:null!==i&&void 0!==i?i:!!o};return r}setHijackProperties(e,t){let n,s;_(e,{document:{get(){return x(t),xe.rawDocument},configurable:!1,enumerable:!0},eval:{get(){return x(t),n||eval},set:e=>{n=e},configurable:!0,enumerable:!1},Image:{get(){return x(t),s||xe.ImageProxy},set:e=>{s=e},configurable:!0,enumerable:!1}})}}function Nt(e,t){Object.defineProperties(e,{currentTarget:{get(){return t}},target:{get(){return t}}})}function Ct(e,t,n,s){var i;if(!e)return b(`element does not exist in lifecycle ${n}`,t);e=$(e),T();const o=Object.assign({name:t,container:e},s&&{error:s}),r=new CustomEvent(n,{detail:o});Nt(r,e),l(null===(i=Tt.lifeCycles)||void 0===i?void 0:i[n])&&Tt.lifeCycles[n](r),e.dispatchEvent(r)}function Rt(e,t,n={}){const s=new CustomEvent(`${e}-${t}`,{detail:n});window.dispatchEvent(s)}vt.activeCount=0;const Dt=new Map;class Mt{constructor({name:e,url:t,ssrUrl:n,container:s,inline:i,scopecss:o,useSandbox:r,baseroute:a}){this.state=G.NOT_LOADED,this.keepAliveState=null,this.keepAliveContainer=null,this.loadSourceLevel=0,this.umdHookMount=null,this.umdHookUnmount=null,this.libraryName=null,this.umdMode=!1,this.isPrefetch=!1,this.prefetchResolve=null,this.container=null,this.baseroute="",this.sandBox=null,this.container=null!==s&&void 0!==s?s:null,this.inline=null!==i&&void 0!==i&&i,this.baseroute=null!==a&&void 0!==a?a:"",this.ssrUrl=null!==n&&void 0!==n?n:"",this.name=e,this.url=t,this.useSandbox=r,this.scopecss=this.useSandbox&&o,this.source={links:new Map,scripts:new Map},this.loadSourceCode(),this.useSandbox&&(this.sandBox=new vt(e,t))}loadSourceCode(){this.state=G.LOADING_SOURCE_CODE,J.getInstance().run(this,Ze)}onLoad(e){var t;2===++this.loadSourceLevel&&(this.source.html=e,this.isPrefetch?(null===(t=this.prefetchResolve)||void 0===t||t.call(this),this.prefetchResolve=null):G.UNMOUNT!==this.state&&(this.state=G.LOAD_SOURCE_FINISHED,this.mount()))}onLoadError(e){this.loadSourceLevel=-1,this.prefetchResolve&&(this.prefetchResolve(),this.prefetchResolve=null),G.UNMOUNT!==this.state&&(this.onerror(e),this.state=G.LOAD_SOURCE_ERROR)}mount(e,t,n){var s,i,o;if(c(t)&&t!==this.inline&&(this.inline=t),this.container=null!==(s=this.container)&&void 0!==s?s:e,this.baseroute=null!==n&&void 0!==n?n:this.baseroute,2!==this.loadSourceLevel)return void(this.state=G.LOADING_SOURCE_CODE);let r;if(Ct(this.container,this.name,V.BEFOREMOUNT),this.state=G.MOUNTING,W(this.source.html,this.container,!this.umdMode),null===(i=this.sandBox)||void 0===i||i.start(this.baseroute),this.umdMode){null===(o=this.sandBox)||void 0===o||o.rebuildUmdSnapshot();try{r=this.umdHookMount()}catch(a){b("an error occurred in the mount function \n",this.name,a)}this.handleMounted(r)}else{let e=!1;Ke(this.source.scripts,this,(t=>{var n;if(!this.umdMode){const{mount:e,unmount:t}=this.getUmdLibraryHooks();if(l(e)&&l(t)){this.umdHookMount=e,this.umdHookUnmount=t,this.umdMode=!0,null===(n=this.sandBox)||void 0===n||n.recordUmdSnapshot();try{r=this.umdHookMount()}catch(a){b("an error occurred in the mount function \n",this.name,a)}}}e||!0!==t&&!this.umdMode||(e=!0,this.handleMounted(r))}))}}handleMounted(e){p(e)?e.then((()=>this.dispatchMountedEvent())).catch((e=>this.onerror(e))):this.dispatchMountedEvent()}dispatchMountedEvent(){G.UNMOUNT!==this.state&&(this.state=G.MOUNTED,Ct(this.container,this.name,V.MOUNTED))}unmount(e,t){let n;if(this.state===G.LOAD_SOURCE_ERROR&&(e=!0),this.state=G.UNMOUNT,this.keepAliveState=null,this.keepAliveContainer=null,this.umdHookUnmount)try{n=this.umdHookUnmount()}catch(s){b("an error occurred in the unmount function \n",this.name,s)}Rt("unmount",this.name),this.handleUnmounted(e,n,t)}handleUnmounted(e,t,n){p(t)?t.then((()=>this.actionsForUnmount(e,n))).catch((()=>this.actionsForUnmount(e,n))):this.actionsForUnmount(e,n)}actionsForUnmount(e,t){var n;e?this.actionsForCompletelyDestroy():this.umdMode&&this.container.childElementCount&&W(this.container,this.source.html,!1),null===(n=this.sandBox)||void 0===n||n.stop(this.umdMode),xt().length||Ce(),Ct(this.container,this.name,V.UNMOUNT),this.container.innerHTML="",this.container=null,t&&t()}actionsForCompletelyDestroy(){!this.useSandbox&&this.umdMode&&delete window[this.libraryName],Dt.delete(this.name)}hiddenKeepAliveApp(){const e=this.container;W(this.container,this.keepAliveContainer?this.keepAliveContainer:this.keepAliveContainer=document.createElement("div"),!1),this.container=this.keepAliveContainer,this.keepAliveState=q.KEEP_ALIVE_HIDDEN,Rt("appstate-change",this.name,{appState:"afterhidden"}),Ct(e,this.name,V.AFTERHIDDEN)}showKeepAliveApp(e){Rt("appstate-change",this.name,{appState:"beforeshow"}),Ct(e,this.name,V.BEFORESHOW),W(this.container,e,!1),this.container=e,this.keepAliveState=q.KEEP_ALIVE_SHOW,Rt("appstate-change",this.name,{appState:"aftershow"}),Ct(this.container,this.name,V.AFTERSHOW)}onerror(e){Ct(this.container,this.name,V.ERROR,e)}getAppState(){return this.state}getKeepAliveState(){return this.keepAliveState}getUmdLibraryHooks(){var e,t;if(G.UNMOUNT!==this.state){const n=null!==(t=null===(e=this.sandBox)||void 0===e?void 0:e.proxyWindow)&&void 0!==t?t:xe.rawWindow;return this.libraryName=$(this.container).getAttribute("library")||`micro-app-${this.name}`,"object"===typeof n[this.libraryName]?n[this.libraryName]:{}}return{}}}function Pt(e){class t extends HTMLElement{constructor(){super(),this.isWaiting=!1,this.cacheData=null,this.hasConnected=!1,this.appName="",this.appUrl="",this.ssrUrl="",this.version=s,this.handleAttributeUpdate=()=>{this.isWaiting=!1;const e=v(this.getAttribute("name")),t=E(this.getAttribute("url"),this.appName);if(this.legalAttribute("name",e)&&this.legalAttribute("url",t)){const n=Dt.get(e);if(e!==this.appName&&n&&G.UNMOUNT!==n.getAppState()&&q.KEEP_ALIVE_HIDDEN!==n.getKeepAliveState()&&!n.isPrefetch)return this.setAttribute("name",this.appName),b(`app name conflict, an app named ${e} is running`,this.appName);e===this.appName&&t===this.appUrl||(e===this.appName?this.handleUnmount(!0,(()=>{this.actionsForAttributeChange(e,t,n)})):this.getKeepAliveModeResult()?(this.handleHiddenKeepAliveApp(),this.actionsForAttributeChange(e,t,n)):this.handleUnmount(this.getDestroyCompatibleResult(),(()=>{this.actionsForAttributeChange(e,t,n)})))}else e!==this.appName&&this.setAttribute("name",this.appName)},Ne()}static get observedAttributes(){return["name","url"]}connectedCallback(){this.hasConnected=!0,w((()=>Ct(this,this.appName,V.CREATED))),this.initialMount()}disconnectedCallback(){this.hasConnected=!1,this.getKeepAliveModeResult()?this.handleHiddenKeepAliveApp():this.handleUnmount(this.getDestroyCompatibleResult())}attributeChangedCallback(e,t,n){if(this.legalAttribute(e,n)&&this[e===j.NAME?"appName":"appUrl"]!==n)if(e!==j.URL||this.appUrl)if(e!==j.NAME||this.appName)this.isWaiting||(this.isWaiting=!0,w(this.handleAttributeUpdate));else{const e=v(n);if(!e)return b(`Invalid attribute name ${n}`,this.appName);this.cacheData&&(Tt.setData(e,this.cacheData),this.cacheData=null),this.appName=e,e!==n&&this.setAttribute("name",this.appName),this.handleInitialNameAndUrl()}else{if(n=E(n,this.appName),!n)return b(`Invalid attribute url ${n}`,this.appName);this.appUrl=n,this.handleInitialNameAndUrl()}}handleInitialNameAndUrl(){this.hasConnected&&this.initialMount()}initialMount(){if(this.appName&&this.appUrl)if(this.getDisposeResult("shadowDOM")&&!this.shadowRoot&&l(this.attachShadow)&&this.attachShadow({mode:"open"}),this.getDisposeResult("ssr")?this.ssrUrl=C(xe.rawWindow.location.pathname,this.appUrl):this.ssrUrl&&(this.ssrUrl=""),Dt.has(this.appName)){const e=Dt.get(this.appName),t=e.ssrUrl||e.url,n=this.ssrUrl||this.appUrl;e.getKeepAliveState()===q.KEEP_ALIVE_HIDDEN&&e.url===this.appUrl?this.handleShowKeepAliveApp(e):t!==n||!e.isPrefetch&&e.getAppState()!==G.UNMOUNT?e.isPrefetch||e.getAppState()===G.UNMOUNT?(g(`the ${e.isPrefetch?"prefetch":"unmounted"} app with url: ${t} is replaced by a new app`,this.appName),this.handleCreateApp()):b(`app name conflict, an app named ${this.appName} is running`,this.appName):this.handleAppMount(e)}else this.handleCreateApp()}actionsForAttributeChange(e,t,n){var s;this.getDisposeResult("ssr")?this.ssrUrl=C(xe.rawWindow.location.pathname,t):this.ssrUrl&&(this.ssrUrl=""),this.appName=e,this.appUrl=t,(null!==(s=this.shadowRoot)&&void 0!==s?s:this).innerHTML="",e!==this.getAttribute("name")&&this.setAttribute("name",this.appName),n?n.getKeepAliveState()===q.KEEP_ALIVE_HIDDEN?n.url===this.appUrl?this.handleShowKeepAliveApp(n):b(`app name conflict, an app named ${this.appName} is running`,this.appName):n.url===this.appUrl&&n.ssrUrl===this.ssrUrl?this.handleAppMount(n):this.handleCreateApp():this.handleCreateApp()}legalAttribute(e,t){return!(!a(t)||!t)||(b(`unexpected attribute ${e}, please check again`,this.appName),!1)}handleAppMount(e){e.isPrefetch=!1,w((()=>{var t;return e.mount(null!==(t=this.shadowRoot)&&void 0!==t?t:this,this.getDisposeResult("inline"),this.getBaseRouteCompatible())}))}handleCreateApp(){var e;Dt.has(this.appName)&&Dt.get(this.appName).actionsForCompletelyDestroy();const t=new Mt({name:this.appName,url:this.appUrl,ssrUrl:this.ssrUrl,container:null!==(e=this.shadowRoot)&&void 0!==e?e:this,inline:this.getDisposeResult("inline"),scopecss:!(this.getDisposeResult("disableScopecss")||this.getDisposeResult("shadowDOM")),useSandbox:!this.getDisposeResult("disableSandbox"),baseroute:this.getBaseRouteCompatible()});Dt.set(this.appName,t)}handleUnmount(e,t){const n=Dt.get(this.appName);n&&n.getAppState()!==G.UNMOUNT&&n.unmount(e,t)}handleHiddenKeepAliveApp(){const e=Dt.get(this.appName);e&&e.getAppState()!==G.UNMOUNT&&e.getKeepAliveState()!==q.KEEP_ALIVE_HIDDEN&&e.hiddenKeepAliveApp()}handleShowKeepAliveApp(e){w((()=>{var t;return e.showKeepAliveApp(null!==(t=this.shadowRoot)&&void 0!==t?t:this)}))}getDisposeResult(e){return(this.compatibleSpecialProperties(e)||Tt[e])&&this.compatibleDisableSpecialProperties(e)}compatibleSpecialProperties(e){return"disableScopecss"===e?this.hasAttribute("disableScopecss")||this.hasAttribute("disable-scopecss"):"disableSandbox"===e?this.hasAttribute("disableSandbox")||this.hasAttribute("disable-sandbox"):this.hasAttribute(e)}compatibleDisableSpecialProperties(e){return"disableScopecss"===e?"false"!==this.getAttribute("disableScopecss")&&"false"!==this.getAttribute("disable-scopecss"):"disableSandbox"===e?"false"!==this.getAttribute("disableSandbox")&&"false"!==this.getAttribute("disable-sandbox"):"false"!==this.getAttribute(e)}getBaseRouteCompatible(){var e,t;return null!==(t=null!==(e=this.getAttribute("baseroute"))&&void 0!==e?e:this.getAttribute("baseurl"))&&void 0!==t?t:""}getDestroyCompatibleResult(){return this.getDisposeResult("destroy")||this.getDisposeResult("destory")}getKeepAliveModeResult(){return this.getDisposeResult("keep-alive")&&!this.getDestroyCompatibleResult()}set data(e){this.appName?Tt.setData(this.appName,e):this.cacheData=e}get data(){return this.appName?Tt.getData(this.appName,!0):this.cacheData?this.cacheData:null}}window.customElements.define(e,t)}function Ot(e){if(!i)return b("preFetch is only supported in browser environment");S((()=>{l(e)&&(e=e()),h(e)&&e.reduce(((e,t)=>e.then((()=>St(t)))),Promise.resolve())}))}function St(e){return new Promise((t=>{S((()=>{var n,s;if(u(e)&&navigator.onLine)if(e.name=v(e.name),e.url=E(e.url,e.name),e.name&&e.url&&!Dt.has(e.name)){const i=new Mt({name:e.name,url:e.url,scopecss:!(null!==(n=e.disableScopecss)&&void 0!==n?n:Tt.disableScopecss),useSandbox:!(null!==(s=e.disableSandbox)&&void 0!==s?s:Tt.disableSandbox)});i.isPrefetch=!0,i.prefetchResolve=t,Dt.set(e.name,i)}else t();else t()}))}))}function It(e){u(e)&&S((()=>{Ut(e.js,"js",Te),Ut(e.css,"css",ae)}))}function Ut(e,t,n){if(h(e)){const s=e.filter((e=>a(e)&&e.includes(`.${t}`)&&!n.has(e))),i=s.map((e=>Q(e)));D(i,(e=>{const t=s[e.index];n.has(t)||n.set(t,e.data)}),(e=>{b(e)}))}}function xt(e){const t=[];return Dt.forEach(((n,s)=>{G.UNMOUNT===n.getAppState()||n.isPrefetch||e&&q.KEEP_ALIVE_HIDDEN===n.getKeepAliveState()||t.push(s)})),t}class Lt extends it{constructor(){super(...arguments),this.tagName="micro-app",this.preFetch=Ot}start(e){if(!i||!window.customElements)return b("micro-app is not supported in this environment");if(null===e||void 0===e?void 0:e.tagName){if(!/^micro-app(-\S+)?/.test(e.tagName))return b(`${e.tagName} is invalid tagName`);this.tagName=e.tagName}if(window.customElements.get(this.tagName))return g(`element ${this.tagName} is already defined`);if(Le(),e&&u(e)&&(this.shadowDOM=e.shadowDOM,this.destroy=e.destroy,this.destory=e.destory,this.inline=e.inline,this.disableScopecss=e.disableScopecss,this.disableSandbox=e.disableSandbox,this.ssr=e.ssr,l(e.fetch)&&(this.fetch=e.fetch),u(e.lifeCycles)&&(this.lifeCycles=e.lifeCycles),e.preFetchApps&&Ot(e.preFetchApps),e.globalAssets&&It(e.globalAssets),l(e.excludeAssetFilter)&&(this.excludeAssetFilter=e.excludeAssetFilter),u(e.plugins))){const t=e.plugins.modules;if(u(t))for(const e in t){const n=v(e);n&&e!==n&&(t[n]=t[e],delete t[e])}this.plugins=e.plugins}Pt(this.tagName)}}var Tt=new Lt;t.ZP=Tt}}]);