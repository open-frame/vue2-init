"use strict";(self["webpackChunkiov_platform"]=self["webpackChunkiov_platform"]||[]).push([[3509],{53509:function(t,e,o){o.r(e),o.d(e,{default:function(){return _}});var a=o(63598),n=o(71377),r=o(1985),s=o(75267),l=o(66654),i=o(67539),u=function(){var t=this,e=t._self._c;return e("el-card",{staticClass:"power-stations content"},[e(i.Z,{attrs:{loading:t.loading,btnSpan:20,getData:t.getData,queryReset:t.queryReset}},[e("el-col",{attrs:{span:4}},[e(s.Z,{attrs:{clearable:"",size:"medium",placeholder:"站编号"},on:{change:t.pageReset},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.getData.apply(null,arguments)}},model:{value:t.queryForm.stationNo,callback:function(e){t.$set(t.queryForm,"stationNo",e)},expression:"queryForm.stationNo"}})],1),e("el-col",{attrs:{span:4}},[e(s.Z,{attrs:{clearable:"",size:"medium",placeholder:"站名称"},on:{change:t.pageReset},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.getData.apply(null,arguments)}},model:{value:t.queryForm.stationName,callback:function(e){t.$set(t.queryForm,"stationName",e)},expression:"queryForm.stationName"}})],1),e("el-col",{attrs:{span:4}},[e(l.Z,{attrs:{animatLable:""},on:{change:t.pageReset},model:{value:t.queryForm.constructionUuid,callback:function(e){t.$set(t.queryForm,"constructionUuid",e)},expression:"queryForm.constructionUuid"}})],1),e("el-col",{attrs:{span:4}},[e(s.Z,{attrs:{clearable:"",size:"medium",placeholder:"站负责人"},on:{change:t.pageReset},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.getData.apply(null,arguments)}},model:{value:t.queryForm.leader,callback:function(e){t.$set(t.queryForm,"leader",e)},expression:"queryForm.leader"}})],1),e("el-col",{attrs:{span:4}},[e(r.Z,{attrs:{animatLable:"",placeholder:"筛选商户"},model:{value:t.queryForm.merchantNo,callback:function(e){t.$set(t.queryForm,"merchantNo",e)},expression:"queryForm.merchantNo"}})],1),e("el-col",{attrs:{span:4}},[e(n["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"站类别"},on:{change:t.pageReset},model:{value:t.queryForm.stationCatagory,callback:function(e){t.$set(t.queryForm,"stationCatagory",e)},expression:"queryForm.stationCatagory"}},t._l(t.dropdowns.stationCatagory,(function(t,o){return e("el-option",{key:o,attrs:{label:t.code_name,value:t.code_value}})})),1)],1),e("el-col",{attrs:{span:4}},[e(n["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"使用状态"},on:{change:t.pageReset},model:{value:t.queryForm.stationStatus,callback:function(e){t.$set(t.queryForm,"stationStatus",e)},expression:"queryForm.stationStatus"}},t._l(t.dropdowns.stationStatus,(function(t,o){return e("el-option",{key:o,attrs:{label:t.code_name,value:t.code_value}})})),1)],1)],1),e("el-divider"),t.stationsMap?e("div",[e("div",{staticClass:"flex flex-justify-between flex-items-end"},[e("el-button-group",[e("router-link",{directives:[{name:"permission",rawName:"v-permission",value:"function_edit",expression:"'function_edit'"}],attrs:{to:"/property/power-stations/detail"}},[e("el-button",{attrs:{size:"small",icon:"el-icon-plus"}},[t._v(" 新增 ")])],1),e("el-button",{attrs:{size:"small",icon:"el-icon-delete"},on:{click:function(e){return t.deleting("more")}}},[t._v("删除")]),e("el-dropdown",{attrs:{trigger:"click"},on:{command:t.exporting}},[e("el-button",{attrs:{size:"small"}},[t._v(" 导出"),e("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",{attrs:{command:"1"}},[t._v("导出本页")]),e("el-dropdown-item",{attrs:{command:"2"}},[t._v("导出全部")])],1)],1)],1),e("el-button",{attrs:{size:"small"},on:{click:function(e){t.stationsMap=!1}}},[t._v("数据表格")])],1),e("map-stations",{attrs:{show:t.stationsMap,loading:t.loading,data:t.tableData,total:t.total,"page-size":t.queryForm.pageSize,"current-page":t.queryForm.pageNum},on:{"size-change":t.dataSizeChange,"current-change":t.handleCurrentChange}})],1):e(a.Z,{ref:"table",attrs:{loading:t.loading,total:t.total,data:t.tableData,height:"510","row-key":"stationNo","page-size":t.queryForm.pageSize,"current-page":t.queryForm.pageNum,derive:t.exporting},on:{"selection-change":t.selectingData,"size-change":t.dataSizeChange,"current-change":t.handleCurrentChange},scopedSlots:t._u([{key:"left",fn:function(){return[e("router-link",{directives:[{name:"permission",rawName:"v-permission",value:"function_edit",expression:"'function_edit'"}],attrs:{to:"/property/power-stations/detail"}},[e("el-button",{attrs:{size:"small",icon:"el-icon-plus"}},[t._v(" 新增 ")])],1),e("el-button",{attrs:{size:"small",icon:"el-icon-delete"},on:{click:function(e){return t.deleting("more")}}},[t._v("删除")])]},proxy:!0},{key:"right",fn:function(){return[e("el-button",{attrs:{size:"small"},on:{click:function(e){t.stationsMap=!0,t.getData()}}},[t._v("地图模式")])]},proxy:!0},{key:"columns",fn:function(){return[e("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"站编号",prop:"stationNo",width:"140"}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"站名称",prop:"stationName"}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"站地址",prop:"address"},scopedSlots:t._u([{key:"default",fn:function(o){return e("span",{staticClass:"cursor-pointer text-muted",staticStyle:{"font-size":"12px",cursor:"pointer"},attrs:{type:"text"},on:{click:function(e){t.latAndLng=o.row.latAndLng}}},[t._v(" "+t._s(o.row.address)+" ")])}}])}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"隶属区域",prop:"constructionUuid"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("transfortext")(e.row.constructionUuid,t.dropdowns.constructionUuid,{name:"construction",value:"uuid"}))+" ")]}}])}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"运营时间",prop:"operationTime",width:"100"}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"负责人",prop:"leader",width:"100"}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"联系方式",prop:"phone",width:"100"}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"站类别",prop:"stationCatagory",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("transfortext")(e.row.stationCatagory,t.dropdowns.stationCatagory))+" ")]}}])}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"供电性质",prop:"powerType",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("transfortext")(e.row.powerType,t.dropdowns.powerType))+" ")]}}])}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"状态",prop:"stationStatus",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("transfortext")(e.row.stationStatus,t.dropdowns.stationStatus))+" ")]}}])}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"建站时间",prop:"createdAt",width:"150"}}),e("el-table-column",{attrs:{label:"操作",fixed:"right",width:"150"},scopedSlots:t._u([{key:"default",fn:function(o){return[e("el-button",{attrs:{plain:"",type:"primary",size:"mini"},on:{click:function(e){return t.seeDetail(o.row)}}},[t._v("详情")]),["3","14"].includes(o.row.stationStatus)?t._e():e("el-button",{attrs:{plain:"",type:"danger",size:"mini"},on:{click:function(e){return t.deleting("one",o.row)}}},[t._v("删除")])]}}])})]},proxy:!0}])}),e("station-location",{attrs:{latAndLng:t.latAndLng},on:{close:function(e){t.latAndLng=""}}})],1)},c=[],d=(o(57658),o(74713)),p=o(5376),m=o(24779),f=o(86867),h=o(90886),g=o(30741),y={name:"property-power-stations-index",mixins:[g.Q5,g.LI,g.I_,g.oA,g.vd],components:{"station-location":()=>o.e(4980).then(o.bind(o,14980)),"map-stations":()=>o.e(1879).then(o.bind(o,1879))},directives:{permission:f.rd},filters:{transfortext:h.h},data(){return{loading:!1,queryForm:{stationNo:"",stationName:"",constructionUuid:"",leader:"",merchantNo:"",stationCatagory:"",stationStatus:"",pageSize:this.$tableDataSize,pageNum:1,orderByColumn:"",isAsc:"desc"},dropdowns:{stationCatagory:[],status:[],powerType:[],constructionUuid:[]},tableData:[],total:0,selectedDate:[],isPowerStationrePetition:!1,organizationsTreeData:[],latAndLng:"",stationsMap:!1}},created(){this.getDropdowns()},methods:{getDropdowns(){(0,p.Wl)("3000").then((t=>{0===t.code&&(this.dropdowns.stationCatagory=t.data)})),(0,p.Wl)("3001").then((t=>{0===t.code&&(this.dropdowns.stationStatus=t.data)})),(0,p.Wl)("3008").then((t=>{0===t.code&&(this.dropdowns.powerType=t.data)})),(0,m.ao)({}).then((t=>{0===t.code&&(this.dropdowns.constructionUuid=t.rows)}))},selectingData(t){this.selectedDate=t},getData(){this.tableData=[],this.loading=!0,(0,d.cV)(this.queryForm).then((t=>{this.loading=!1,0===t.code&&(this.total=t.total,this.tableData=t.rows)})).catch((()=>{this.loading=!1}))},deleting(t,e){if(this.stationsMap=!1,"more"===t){if(this.selectedDate.length<1)return this.$message.warning("请选择删除项"),!1;const t=this.selectedDate[0].stationStatus,e=this.selectedDate.every((e=>e.stationStatus===t));if(!e)return this.$message.warning("存在状态不一样的站，请状态保持一致"),!1}this.$confirm("一旦删除不可恢复，确定删除？","删除提醒",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"放弃"}).then((()=>{let o=[];o="one"===t?[e.uuid]:this.selectedDate.map((t=>t.uuid)),(0,d.kP)(o).then((t=>{0===t.code&&(this.$message.success("删除成功"),this.getData(),this.$refs.table.clearSelection())}))})).catch((()=>{}))},seeDetail(t){this.$router.push({path:"/property/power-stations/detail",query:t})},async exporting(t){let e={...this.queryForm};"2"===t&&(e.pageSize=this.total,e.pageNum=1);const o=await(0,d.cV)(e);if(0===o.code){const t=this.$refs.table.getColumns(),e=o.rows.map((e=>{let o=t.map((t=>{let o;return"constructionUuid"===t.prop&&(o={name:"construction",value:"uuid"}),[t.label,`${(0,h.h)(e[t.prop],this.dropdowns[t.prop],o)}`]}));return Object.fromEntries(o)}));return e}}}},w=y,b=o(1001),v=(0,b.Z)(w,u,c,!1,null,"31502425",null),_=v.exports}}]);