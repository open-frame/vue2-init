"use strict";(self["webpackChunkiov_platform"]=self["webpackChunkiov_platform"]||[]).push([[9432],{59432:function(e,t,r){r.r(t),r.d(t,{default:function(){return k}});var o=r(63598),l=r(71377),a=r(75267),s=r(67539),i=function(){var e=this,t=e._self._c;return t("el-card",{staticClass:"role"},[t(s.Z,{attrs:{loading:e.loading,btnSpan:12,getData:e.getData,queryReset:e.queryReset}},[t("el-col",{attrs:{span:4}},[t(a.Z,{attrs:{clearable:"",size:"medium",placeholder:"角色名称"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.roleName,callback:function(t){e.$set(e.queryForm,"roleName",t)},expression:"queryForm.roleName"}})],1),t("el-col",{attrs:{span:4}},[t(a.Z,{attrs:{clearable:"",size:"medium",placeholder:"权限字符"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.roleKey,callback:function(t){e.$set(e.queryForm,"roleKey",t)},expression:"queryForm.roleKey"}})],1),t("el-col",{attrs:{span:4}},[t(l["default"],{attrs:{clearable:"",size:"medium",placeholder:"角色状态"},on:{change:e.pageReset},model:{value:e.queryForm.status,callback:function(t){e.$set(e.queryForm,"status",t)},expression:"queryForm.status"}},e._l(e.dropdowns.status,(function(e,r){return t("el-option",{key:r,attrs:{label:e.code_name,value:e.code_value}})})),1)],1)],1),t("el-divider"),t(o.Z,{ref:"table",attrs:{loading:e.loading,total:e.total,data:e.tableData,height:"550","row-key":"roleId","page-size":e.queryForm.pageSize,"current-page":e.queryForm.pageNum,derive:e.exporting},on:{"selection-change":e.selectedDate,"size-change":e.dataSizeChange,"current-change":e.handleCurrentChange},scopedSlots:e._u([{key:"left",fn:function(){return[t("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"function_edit",expression:"'function_edit'"}],attrs:{size:"small",icon:"el-icon-plus"},on:{click:function(t){return e.editing("add")}}},[e._v("新增")]),t("el-button",{attrs:{size:"small",icon:"el-icon-delete"},on:{click:function(t){return e.deleteing("more")}}},[e._v("删除")])]},proxy:!0},{key:"columns",fn:function(){return[t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"角色id",prop:"roleId"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"角色名称",prop:"roleName"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"权限字符",prop:"roleKey"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"角色状态",prop:"status"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.status,e.dropdowns.status))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"操作时间",prop:"createTime"}}),t("el-table-column",{attrs:{label:"操作",width:"160",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"function_edit",expression:"'function_edit'"}],attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.editing("modification",r.row)}}},[e._v("编辑")]),t("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.deleteing("one",r.row)}}},[e._v("删除")])]}}])})]},proxy:!0}])}),t("el-dialog",{attrs:{"close-on-click-modal":!1,"modal-append-to-body":!1,title:e.dialogText+"角色",visible:e.dialogVisible,"before-close":e.closeSeeDetail}},[t("el-form",{ref:"roleForm",attrs:{model:e.roleForm,rules:e.rules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"角色名称：",prop:"roleName"}},[t("el-input",{attrs:{clearable:""},model:{value:e.roleForm.roleName,callback:function(t){e.$set(e.roleForm,"roleName",t)},expression:"roleForm.roleName"}})],1),t("el-form-item",{attrs:{label:"权限字符：",prop:"roleKey"}},[t("el-input",{attrs:{clearable:"",readonly:"修改"===e.dialogText},model:{value:e.roleForm.roleKey,callback:function(t){e.$set(e.roleForm,"roleKey",t)},expression:"roleForm.roleKey"}})],1),t("el-form-item",{attrs:{label:"状态：",prop:"status"}},[t("el-select",{attrs:{filterable:"",clearable:"",size:"medium",placeholder:""},model:{value:e.roleForm.status,callback:function(t){e.$set(e.roleForm,"status",t)},expression:"roleForm.status"}},e._l(e.dropdowns.status,(function(e,r){return t("el-option",{key:r,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-form-item",{attrs:{label:"备注：",prop:"remark"}},[t("el-input",{attrs:{clearable:""},model:{value:e.roleForm.remark,callback:function(t){e.$set(e.roleForm,"remark",t)},expression:"roleForm.remark"}})],1),t("el-form-item",{attrs:{label:"分配权限：",prop:"menuIds"}},[t("el-input",{attrs:{clearable:"",placeholder:"输入关键字过滤"},model:{value:e.filterMenuTree,callback:function(t){e.filterMenuTree=t},expression:"filterMenuTree"}}),t("el-tree",{ref:"menuTree",staticStyle:{height:"330px","overflow-y":"auto"},attrs:{"show-checkbox":"","check-strictly":!0,"node-key":"menuId","default-checked-keys":e.roleForm.menuIds,"highlight-current":"",data:e.jurisdictionTreeData,props:{label:"menuName"},"filter-node-method":e.filterMenu},on:{check:e.checkMenu}})],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("roleForm")}}},[e._v("确 定")]),t("el-button",{on:{click:function(t){return e.closeSeeDetail("roleForm")}}},[e._v("取 消")])],1)],1)],1)},n=[],u=(r(57658),r(84984)),c=r(5376),d=r(90886),m=r(86867),p=r(30741),h={name:"system-role-index",mixins:[p.LI,p.I_,p.oA,p.vd],filters:{transfortext:d.h},directives:{permission:m.rd},data(){return this.rules=g,{loading:!1,queryForm:{roleName:"",roleKey:"",status:"",beginTime:"",endTime:"",pageSize:this.$tableDataSize,pageNum:1,orderByColumn:"",isAsc:"asc"},dropdowns:{status:[]},time:"",tableData:[],total:0,filterMenuTree:"",moreSelect:[],dialogVisible:!1,dialogText:"",roleForm:{roleName:"",roleKey:"",status:"",remark:"",menuIds:[]},jurisdictionTreeData:[]}},created(){this.getDropdowns()},watch:{filterMenuTree(e){this.$refs.menuTree.filter(e)}},methods:{getDropdowns(){(0,c.Wl)("626988").then((e=>{0===e.code&&(this.dropdowns.status=e.data)}))},selectedDate(e){this.moreSelect=e},async editing(e,t){const r=this.$loading({lock:!0,text:"正在查询",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),o=await(0,u.eT)({});r.close(),0===o.code&&(this.roleForm.menuIds=[o.data.find((e=>"home/index"===e.perms)).menuId],this.jurisdictionTreeData=o.data.map((e=>({...e,disabled:"home/index"===e.perms})))),this.dialogVisible=!0;const l=this;"add"===e?(this.dialogText="添加",delete this.roleForm.roleId):(this.dialogText="修改",this.$nextTick((()=>{(0,u.Rp)(t.roleId).then((e=>{0===e.code&&(l.roleForm.roleId=e.data.roleId,l.roleForm.roleName=e.data.roleName,l.roleForm.roleKey=e.data.roleKey,l.roleForm.status=e.data.status,l.roleForm.remark=e.data.remark,l.roleForm.menuIds=e.data.menuIds)}))})))},filterMenu(e,t){return!e||-1!==t.menuName.indexOf(e)},closeSeeDetail(e){this.dialogVisible=!1,this.$refs["roleForm"].resetFields()},getData(){this.loading=!0,this.tableData=[],(0,u.Uy)(this.queryForm).then((e=>{this.loading=!1,0===e.code&&(this.total=e.total,this.tableData=e.rows)})).catch((()=>{this.loading=!1}))},checkMenu(e,t){this.roleForm.menuIds=t.checkedKeys},submitForm(e){this.$refs[e].validate((e=>{if(e){const e={addRole:u._d,editRole:u.Aq};e["添加"===this.dialogText?"addRole":"editRole"](this.roleForm).then((e=>{0===e.code&&("添加"===this.dialogText?(this.$message.success("添加成功"),this.closeSeeDetail(),this.getData()):location.reload())}))}}))},deleteing(e,t){if("more"===e&&this.moreSelect.length<1)return this.$message.warning("请选择删除项"),!1;this.$confirm("一旦删除不可恢复，确定删除？","删除提醒",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"放弃"}).then((()=>{let r=[];if("one"===e)r.push(t.roleId);else for(let e of this.moreSelect)r.push(e.roleId);(0,u.Rd)({ids:r}).then((e=>{0===e.code&&(this.$message.success(e.msg),this.getData(),this.moreSelect=[])}))})).catch((()=>{}))},async exporting(e){let t={...this.queryForm};"2"===e&&(t.pageSize=this.total,t.pageNum=1);const r=await(0,u.Uy)(t);if(0===r.code){const e=this.$refs.table.getColumns(),t=r.rows.map((t=>{let r=e.map((e=>[e.label,`${(0,d.h)(t[e.prop],this.dropdowns[e.prop])}`]));return Object.fromEntries(r)}));return t}}}};const g={roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"},{min:2,max:12,message:"长度在 2 到 12 个字符",trigger:"blur"}],roleKey:[{required:!0,message:"请输入权限字符",trigger:"blur"},{pattern:/^[A-Za-z0-9-_]+$/,message:"只能为数字、字母、下划线",trigger:"blur"},{min:4,max:128,message:"长度在 4 到 128 个字符",trigger:"blur"}],status:[{required:!0,message:"请选择角色状态",trigger:"change"}],menuIds:[{type:"array",required:!0,message:"至少首页看盘应该赋予给该角色",trigger:"change"}]};var f=h,b=r(1001),y=(0,b.Z)(f,i,n,!1,null,"fb5bcf8c",null),k=y.exports}}]);