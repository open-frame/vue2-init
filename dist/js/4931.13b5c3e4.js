"use strict";(self["webpackChunkiov_platform"]=self["webpackChunkiov_platform"]||[]).push([[4931,5376,2453,1226,2335],{5376:function(e,a,t){t.d(a,{Jz:function(){return c},Wl:function(){return o},eL:function(){return s},hv:function(){return n},iS:function(){return i},oP:function(){return l}});t(57658);var r=t(92617);function o(e,a){return r.o.post("/select/box/selectBoxPoint",{codeType:e},a)}function l(e,a){return r.o.post("/system/dept/treeData",e,a)}async function s(e,a){const t=await r.o.post("/system/dept/treeData",e,a);let o=[];return 0===t.code&&function e(a){a.map((a=>{a.children&&e(a.children),o.push(a)}))}(t.data),o}function c(e,a){return r.o.post("/flow/monitor/getAssigneeList",e,a)}function i(){return r.o.get("/assetStake/getStationListByLoginUser")}function n(){return r.o.get("/system/user/add")}},94931:function(e,a,t){t.r(a),t.d(a,{default:function(){return d}});var r=t(19693),o=function(){var e=this,a=e._self._c;return a("el-dialog",{attrs:{"close-on-click-modal":!1,title:e.formData.propertyNo?"修改物业":"新增物业","append-to-body":!0,"before-close":e.close,"modal-append-to-body":!1,visible:e.show}},[a("el-form",{ref:"communityForm",attrs:{model:e.formData,rules:e.formRules,"label-width":"115px"}},[e.formData.propertyNo?a("el-form-item",{attrs:{label:"物业编号",prop:"propertyNo"}},[a("el-input",{attrs:{readonly:""},model:{value:e.formData.propertyNo,callback:function(a){e.$set(e.formData,"propertyNo",a)},expression:"formData.propertyNo"}})],1):e._e(),a("el-form-item",{attrs:{label:"物业全称",prop:"propertyName"}},[a("el-input",{attrs:{clearable:""},model:{value:e.formData.propertyName,callback:function(a){e.$set(e.formData,"propertyName",a)},expression:"formData.propertyName"}})],1),a("el-form-item",{attrs:{label:"物业简称",prop:"shortName"}},[a("el-input",{attrs:{clearable:""},model:{value:e.formData.shortName,callback:function(a){e.$set(e.formData,"shortName",a)},expression:"formData.shortName"}})],1),a("el-form-item",{attrs:{label:"社区名称",prop:"community"}},[a("el-input",{attrs:{clearable:""},model:{value:e.formData.community,callback:function(a){e.$set(e.formData,"community",a)},expression:"formData.community"}})],1),a("el-form-item",{attrs:{label:"联系人",prop:"name"}},[a("el-input",{attrs:{clearable:""},model:{value:e.formData.name,callback:function(a){e.$set(e.formData,"name",a)},expression:"formData.name"}})],1),a("el-form-item",{attrs:{label:"联系电话",prop:"tel"}},[a("el-input",{attrs:{clearable:""},model:{value:e.formData.tel,callback:function(a){e.$set(e.formData,"tel",a)},expression:"formData.tel"}})],1),a("el-form-item",{attrs:{label:"联系邮箱",prop:"email"}},[a("el-input",{attrs:{clearable:""},model:{value:e.formData.email,callback:function(a){e.$set(e.formData,"email",a)},expression:"formData.email"}})],1),a("el-form-item",{attrs:{label:"地址",prop:"address3"}},[a(r.Z,{model:{value:e.formData.address3,callback:function(a){e.$set(e.formData,"address3",a)},expression:"formData.address3"}})],1),a("el-form-item",{attrs:{label:"详细地址",prop:"propertyAddr"}},[a("el-input",{attrs:{clearable:""},model:{value:e.formData.propertyAddr,callback:function(a){e.$set(e.formData,"propertyAddr",a)},expression:"formData.propertyAddr"}})],1),a("el-form-item",{attrs:{label:"邮政编码",prop:"postalCode"}},[a("el-input",{attrs:{clearable:""},model:{value:e.formData.postalCode,callback:function(a){e.$set(e.formData,"postalCode",a)},expression:"formData.postalCode"}})],1),a("el-form-item",{attrs:{label:"法人代表",prop:"legalPerson"}},[a("el-input",{attrs:{clearable:""},model:{value:e.formData.legalPerson,callback:function(a){e.$set(e.formData,"legalPerson",a)},expression:"formData.legalPerson"}})],1),a("el-form-item",{attrs:{label:"注册地址",prop:"regAddr"}},[a("el-input",{attrs:{clearable:""},model:{value:e.formData.regAddr,callback:function(a){e.$set(e.formData,"regAddr",a)},expression:"formData.regAddr"}})],1),a("el-form-item",{attrs:{label:"注册资金",prop:"regCapital"}},[a("el-input",{attrs:{clearable:"",type:"number"},model:{value:e.formData.regCapital,callback:function(a){e.$set(e.formData,"regCapital",a)},expression:"formData.regCapital"}})],1),a("el-form-item",{attrs:{label:"增值税名",prop:"vatName"}},[a("el-input",{attrs:{clearable:""},model:{value:e.formData.vatName,callback:function(a){e.$set(e.formData,"vatName",a)},expression:"formData.vatName"}})],1),a("el-form-item",{attrs:{label:"增值税号",prop:"vatNo"}},[a("el-input",{attrs:{clearable:""},model:{value:e.formData.vatNo,callback:function(a){e.$set(e.formData,"vatNo",a)},expression:"formData.vatNo"}})],1),a("el-form-item",{attrs:{label:"电费收取周期",prop:"powerCycle"}},[a("el-select",{attrs:{filterable:"","default-first-option":"",clearable:"",placeholder:""},model:{value:e.formData.powerCycle,callback:function(a){e.$set(e.formData,"powerCycle",a)},expression:"formData.powerCycle"}},e._l(e.dropdowns.powerCycle,(function(e,t){return a("el-option",{key:t,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),a("el-form-item",{attrs:{label:"电价类别",prop:"prcType"}},[a("el-select",{attrs:{filterable:"","default-first-option":"",clearable:"",placeholder:""},model:{value:e.formData.prcType,callback:function(a){e.$set(e.formData,"prcType",a)},expression:"formData.prcType"}},e._l(e.dropdowns.prcType,(function(e,t){return a("el-option",{key:t,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),"1"===e.formData.prcType?[a("el-form-item",{attrs:{label:"电费",prop:"prc_elec"}},[a("el-input",{attrs:{type:"number",clearable:""},model:{value:e.formData.prc_elec,callback:function(a){e.$set(e.formData,"prc_elec",a)},expression:"formData.prc_elec"}},[a("template",{slot:"append"},[e._v("元")])],2)],1),a("el-form-item",{attrs:{label:"服务费",prop:"prc_service"}},[a("el-input",{attrs:{type:"number",clearable:""},model:{value:e.formData.prc_service,callback:function(a){e.$set(e.formData,"prc_service",a)},expression:"formData.prc_service"}},[a("template",{slot:"append"},[e._v("元")])],2)],1)]:e._e(),a("el-form-item",{attrs:{label:"电费单价",prop:"kwhPrc"}},[a("el-input-number",{attrs:{precision:2,"controls-position":"right",min:0,max:100},model:{value:e.formData.kwhPrc,callback:function(a){e.$set(e.formData,"kwhPrc",a)},expression:"formData.kwhPrc"}})],1),a("el-form-item",{attrs:{label:"抄表日期",prop:"powerReadDay"}},[a("el-select",{attrs:{filterable:"","default-first-option":"",clearable:"",placeholder:""},model:{value:e.formData.powerReadDay,callback:function(a){e.$set(e.formData,"powerReadDay",a)},expression:"formData.powerReadDay"}},e._l(31,(function(e){return a("el-option",{key:e,attrs:{label:"每月"+e+"日",value:e+""}})})),1)],1),a("el-form-item",{attrs:{label:"电费缴费日期",prop:"powerChargeDay"}},[a("el-input",{attrs:{clearable:""},model:{value:e.formData.powerChargeDay,callback:function(a){e.$set(e.formData,"powerChargeDay",a)},expression:"formData.powerChargeDay"}})],1),a("el-form-item",{attrs:{label:"开户行账号",prop:"vatAcct"}},[a("el-input",{attrs:{clearable:""},model:{value:e.formData.vatAcct,callback:function(a){e.$set(e.formData,"vatAcct",a)},expression:"formData.vatAcct"}})],1),a("el-form-item",{attrs:{label:"开户行",prop:"bankCode"}},[a("el-select",{attrs:{filterable:"","default-first-option":"",clearable:"",placeholder:""},model:{value:e.formData.bankCode,callback:function(a){e.$set(e.formData,"bankCode",a)},expression:"formData.bankCode"}},e._l(e.dropdowns.bankCode,(function(e,t){return a("el-option",{key:t,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),a("el-form-item",{attrs:{label:"是否有物业费",prop:"serviceChargeFlag"}},[a("el-select",{attrs:{filterable:"","default-first-option":"",clearable:"",placeholder:""},model:{value:e.formData.serviceChargeFlag,callback:function(a){e.$set(e.formData,"serviceChargeFlag",a)},expression:"formData.serviceChargeFlag"}},e._l(e.dropdowns.yesORno,(function(e,t){return a("el-option",{key:t,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),"1"===e.formData.serviceChargeFlag?[a("el-form-item",{attrs:{label:"物业费收取周期",prop:"serviceChargeCycle"}},[a("el-select",{attrs:{filterable:"","default-first-option":"",clearable:"",placeholder:""},model:{value:e.formData.serviceChargeCycle,callback:function(a){e.$set(e.formData,"serviceChargeCycle",a)},expression:"formData.serviceChargeCycle"}},e._l(e.dropdowns.serviceChargeCycle,(function(e,t){return a("el-option",{key:t,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),a("el-form-item",{attrs:{label:"物业费",prop:"serviceCharge"}},[a("el-input",{attrs:{clearable:""},model:{value:e.formData.serviceCharge,callback:function(a){e.$set(e.formData,"serviceCharge",a)},expression:"formData.serviceCharge"}})],1)]:e._e(),a("el-form-item",{attrs:{label:"合同编号",prop:"contractNo"}},[a("el-input",{attrs:{clearable:""},model:{value:e.formData.contractNo,callback:function(a){e.$set(e.formData,"contractNo",a)},expression:"formData.contractNo"}})],1),a("el-form-item",{attrs:{label:"合同信息",prop:"contractPic"}},[e.formData.propertyNo?e._e():a("el-upload",{ref:"upload-dpf",attrs:{accept:".pdf",headers:e.uploadHeaders,action:e.uploadURL,"on-success":e.uploadPDFsuccess,"on-error":e.uploadPDFerror,"on-remove":e.uploadPDFremove}},[a("el-button",{attrs:{size:"small",plain:""}},[e._v("点击上传")])],1),e.formData.contractPic?a("el-button",{attrs:{size:"small",plain:""},on:{click:e.seePDF}},[e._v("点击查看")]):e._e()],1),a("el-form-item",{attrs:{label:"合作期限",prop:"cooperationDeadline"}},[a("el-date-picker",{attrs:{size:"medium",type:"datetimerange",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"订单开始时间段"},on:{change:a=>{e.formData.contractBegin=a[0],e.formData.contractEnd=a[1]}},model:{value:e.formData.cooperationDeadline,callback:function(a){e.$set(e.formData,"cooperationDeadline",a)},expression:"formData.cooperationDeadline"}})],1),a("el-form-item",{attrs:{label:"公司简介",prop:"brief"}},[a("el-input",{attrs:{type:"textarea",clearable:""},model:{value:e.formData.brief,callback:function(a){e.$set(e.formData,"brief",a)},expression:"formData.brief"}})],1),a("el-form-item",{attrs:{label:"备注",prop:"remark"}},[a("el-input",{attrs:{clearable:""},model:{value:e.formData.remark,callback:function(a){e.$set(e.formData,"remark",a)},expression:"formData.remark"}})],1)],2),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v(" "+e._s(e.formData.propertyNo?"修改":"保存")+" ")]),a("el-button",{on:{click:e.close}},[e._v("关闭")])],1)],1)},l=[],s=t(24779),c=t(5376),i={name:"",data(){return this.formRules=n,{pickerOptions:{disabledDate(e){return e.getTime()<Date.now()-864e5}},uploadURL:"",uploadHeaders:{Authorization:`Bearer ${localStorage.getItem("token")}`},dropdowns:{yesORno:[],powerCycle:[],prcType:[],bankCode:[],serviceChargeCycle:[]},formData:{propertyNo:"",propertyName:"",shortName:"",community:"",type:"",people:"",creditLevelCode:"",name:"",tel:"",email:"",queryPwd:"",entepriseName:"",entepriseScale:"",brief:"",regCapital:"",propertyAddr:"",postalCode:"",legalPerson:"",vatId:"",vatName:"",vatNo:"",vatAcct:"",address3:[],bankCode:"",regAddr:"",serviceChargeFlag:"",serviceCharge:"",serviceChargeCycle:"",powerFlag:"",prcType:"",prcCode:"",prc_elec:"",prc_service:"",kwhPrc:"",powerCycle:"",powerReadDay:"",powerChargeDay:"",cooperationDeadline:[],contractNo:"",contractBegin:"",contractEnd:"",remark:"",updateBy:"",updateTime:"",deleteFlag:"",dataBy:"",provinceCode:"",cityCode:"",districtCode:"",contractPic:""}}},created(){this.uploadURL="https://clw.edo-iot.com/yscar/model/property/uploadContract"},props:{show:{type:Boolean,default:!1},data:{type:Object,default(){return{}}}},watch:{"formData.address3"(e){this.formData.provinceCode=e[0]||"",this.formData.cityCode=e[1]||"",this.formData.districtCode=e[2]||""},show(e){e&&this.getDropdowns()},data(e){e&&this.$nextTick((()=>{for(let a in this.formData)this.formData[a]=e[a];this.formData.cooperationDeadline=[e.contractBegin+" 00:00:00",e.contractEnd+" 00:00:00"],this.formData.address3=[e.provinceCode,e.cityCode,e.districtCode]}))},"formData.prc_elec"(e,a){this.changeprc_elec()},"formData.prc_service"(e,a){this.changeprc_elec()}},methods:{getDropdowns(){(0,c.Wl)("385325").then((e=>{0===e.code&&(this.dropdowns.powerCycle=e.data)})),(0,c.Wl)("031271").then((e=>{0===e.code&&(this.dropdowns.prcType=e.data)})),(0,c.Wl)("1009").then((e=>{0===e.code&&(this.dropdowns.bankCode=e.data)})),(0,c.Wl)("1036").then((e=>{0===e.code&&(this.dropdowns.yesORno=e.data)})),(0,c.Wl)("129734").then((e=>{0===e.code&&(this.dropdowns.serviceChargeCycle=e.data)}))},changeprc_elec(){const e=parseFloat(this.formData.prc_elec)||0,a=parseFloat(this.formData.prc_service)||0;this.formData.kwhPrc=e+a},submit(){this.$refs["communityForm"].validate((e=>{if(e){const e={updataCommunityInfo:s.QA,submitCommunityInfo:s.r3},a=this.formData.propertyNo?"updataCommunityInfo":"submitCommunityInfo";e[a](this.formData).then((e=>{0===e.code&&(!this.formData.propertyNo&&(this.formData.propertyNo=e.data),this.$emit("success"),this.$message.success(e.msg),this.close())}))}}))},uploadPDFsuccess(e){0===e.code&&(this.formData.contractPic=e.data,this.$message.success(e.msg))},uploadPDFerror(e){this.$message.error(e.msg),2001===e.code&&this.$store.commit("logout","1")},uploadPDFremove(){(0,s.lk)({contractPic:this.formData.contractPic}),this.formData.contractPic=""},seePDF(){const e="https://edo-iot.oss-cn-wulanchabu.aliyuncs.com/"+this.formData.contractPic,a=window.screen.width;window.open(e,"_blank",`location=no, status=no, menubar=no ,width=${a}`)},close(){this.$emit("close",!1),!this.formData.propertyNo&&this.formData.contractPic&&this.uploadPDFremove(),this.$refs["communityForm"].resetFields();try{this.$refs["upload-dpf"].clearFiles()}catch(e){}}}};const n={propertyName:[{required:!0,message:"请输入物业全称",trigger:"blur"},{pattern:/^[^<|>|-|*|/|=|{|}]*$/,message:"禁止< > - * / = { }等特殊字符",trigger:"blur"},{min:8,max:28,message:"长度在 8 到 28 个字符",trigger:"blur"}],shortName:[{pattern:/^[^<|>|-|*|/|=|{|}]*$/,message:"禁止< > - * / = { }等特殊字符",trigger:"blur"},{min:1,max:8,message:"长度在 1 到 8 个字符",trigger:"blur"}],community:[{required:!0,message:"请输入社区名称",trigger:"blur"},{pattern:/^[^<|>|-|*|/|=|{|}]*$/,message:"禁止< > - * / = { }等特殊字符",trigger:"blur"},{min:2,max:28,message:"长度在 2 到 28 个字符",trigger:"blur"}],name:[{required:!0,message:"请输入联系人",trigger:"blur"},{pattern:/^[^<|>|-|*|/|=|{|}]*$/,message:"禁止< > - * / = { }等特殊字符",trigger:"blur"},{min:2,max:28,message:"长度在 2 到 28 个字符",trigger:"blur"}],tel:[{required:!0,message:"请输入联系电话",trigger:"blur"},{pattern:/^[0-9|-]+$/,message:"只能为数字",trigger:"blur"},{min:7,max:18,message:"长度在 7 到 18 个字符",trigger:"blur"}],email:[{pattern:/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,message:"规则错误",trigger:"blur"},{min:5,max:48,message:"长度在 5 到 48 个字符",trigger:"blur"}],propertyAddr:[{pattern:/^[^<|>|-|*|/|=|{|}]*$/,message:"禁止< > - * / = { }等特殊字符",trigger:"blur"},{min:3,max:48,message:"长度在 3 到 48 个字符",trigger:"blur"}],postalCode:[{pattern:/^[0-9|-]+$/,message:"只能为数字",trigger:"blur"},{min:3,max:48,message:"长度在 3 到 48 个字符",trigger:"blur"}],legalPerson:[{pattern:/^[^<|>|-|*|/|=|{|}]*$/,message:"禁止< > - * / = { }等特殊字符",trigger:"blur"},{min:2,max:48,message:"长度在 2 到 48 个字符",trigger:"blur"}],vatName:[{pattern:/^[^<|>|-|*|/|=|{|}]*$/,message:"禁止< > - * / = { }等特殊字符",trigger:"blur"},{min:2,max:48,message:"长度在 2 到 48 个字符",trigger:"blur"}],kwhPrc:[{required:!0,message:"请输入电费的售卖单价",trigger:"change"}],regAddr:[{pattern:/^[^<|>|-|*|/|=|{|}]*$/,message:"禁止< > - * / = { }等特殊字符",trigger:"blur"},{min:2,max:48,message:"长度在 2 到 48 个字符",trigger:"blur"}],bankCode:[],prcType:[{required:!0,message:"请选择电价类别",trigger:"change"}],powerCycle:[],powerReadDay:[],cooperationDeadline:[{required:!0,message:"请选择合同有限期限",trigger:"change"}],brief:[{pattern:/^[^<|>|-|*|/|=|{|}]*$/,message:"禁止< > - * / = { }等特殊字符",trigger:"blur"}],remark:[{pattern:/^[^<|>|-|*|/|=|{|}]*$/,message:"禁止< > - * / = { }等特殊字符",trigger:"blur"}]};var m=i,p=t(1001),f=(0,p.Z)(m,o,l,!1,null,"e6c022be",null),d=f.exports}}]);