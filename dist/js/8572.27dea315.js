"use strict";(self["webpackChunkiov_platform"]=self["webpackChunkiov_platform"]||[]).push([[8572],{19596:function(e,t,r){r.d(t,{A6:function(){return a},Dk:function(){return m},Dm:function(){return y},HX:function(){return n},NI:function(){return c},V3:function(){return l},WO:function(){return i},eQ:function(){return p},sd:function(){return s},td:function(){return u},tu:function(){return d}});var o=r(92617);function a(e,t){return o.o.post("/cloud/charging/chargingElecOrder/list",e,t)}function n(e,t){return o.o.post("/cloud/charging/chargingElecOrder/queryOrderPowerList",e,t)}function s(e,t){return o.o.post("/cloud/charging/chargingElecOrder/queryVipModel",e,t)}function l(e,t){return o.o.post("/wechat/payScore/cancelServiceOrder",e,t)}function i(e,t){return o.o.post("/wechat/payScore/modifyServiceOrder",e,t)}function u(e,t){return o.o.post("/cloud/charging/chargingElecOrder/dunningOrder",e,t)}function c(e,t){return o.o.post("/cloud/charging/chargingElecOrder/updateTranStatus",e,t)}function d(e,t){return o.o.post("/cloud/charging/chargingElecOrder/queryCaculateMsg",e,t)}function p(e,t){return o.o.post("/cloud/charging/chargingElecOrder/queryExecptionUser",e,t)}function m(e,t){return o.o.post("/cloud/charging/chargingElecOrder/queryExecptionStake",e,t)}function y(e,t){return o.o.post("/cloud/charging/chargingElecOrder/stopOrderBackGround",e,t)}},38572:function(e,t,r){r.r(t),r.d(t,{default:function(){return T}});var o=r(63598),a=r(90649),n=r(71377),s=r(75267),l=r(1985),i=r(12025),u=r(66654),c=r(67539),d=function(){var e=this,t=e._self._c;return t("el-card",{staticClass:"order-manage"},[t(c.Z,{attrs:{loading:e.loading,getData:e.getData,queryReset:e.queryReset}},[t("el-col",{attrs:{span:4}},[t(s.Z,{attrs:{clearable:"",size:"medium",placeholder:"用户手机号"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.phoneNumber,callback:function(t){e.$set(e.queryForm,"phoneNumber",t)},expression:"queryForm.phoneNumber"}})],1),t("el-col",{attrs:{span:4}},[t(s.Z,{attrs:{clearable:"",size:"medium",placeholder:"用户账号"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.userId,callback:function(t){e.$set(e.queryForm,"userId",t)},expression:"queryForm.userId"}})],1),t("el-col",{attrs:{span:4}},[t(s.Z,{attrs:{clearable:"",size:"medium",placeholder:"订单编号"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.orderId,callback:function(t){e.$set(e.queryForm,"orderId",t)},expression:"queryForm.orderId"}})],1),t("el-col",{attrs:{span:4}},[t(u.Z,{attrs:{animatLable:"",placeholder:"隶属区域"},on:{change:e.pageReset},model:{value:e.queryForm.constructionUuid,callback:function(t){e.$set(e.queryForm,"constructionUuid",t)},expression:"queryForm.constructionUuid"}})],1),t("el-col",{attrs:{span:4}},[t(i.Z,{attrs:{animatLable:"",placeholder:"归属电站"},on:{change:e.pageReset},model:{value:e.queryForm.stationId,callback:function(t){e.$set(e.queryForm,"stationId",t)},expression:"queryForm.stationId"}})],1),t("el-col",{attrs:{span:4}},[t(s.Z,{attrs:{clearable:"",size:"medium",placeholder:"设备名称"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.stakeName,callback:function(t){e.$set(e.queryForm,"stakeName",t)},expression:"queryForm.stakeName"}})],1),e.expertQuery?[t("el-col",{attrs:{span:4}},[t(l.Z,{attrs:{animatLable:"","collapse-tags":""},model:{value:e.queryForm.deptCode,callback:function(t){e.$set(e.queryForm,"deptCode",t)},expression:"queryForm.deptCode"}})],1),t("el-col",{attrs:{span:4}},[t(n["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"订单数据筛查"},on:{change:e.pageReset},model:{value:e.queryForm.dataType,callback:function(t){e.$set(e.queryForm,"dataType",t)},expression:"queryForm.dataType"}},[t("el-option",{attrs:{label:"0元订单",value:"0"}}),t("el-option",{attrs:{label:"正常订单",value:"1"}})],1)],1),t("el-col",{attrs:{span:4}},[t(s.Z,{attrs:{clearable:"",size:"medium",placeholder:"设备编号"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.stakeNo,callback:function(t){e.$set(e.queryForm,"stakeNo",t)},expression:"queryForm.stakeNo"}})],1),t("el-col",{attrs:{span:4}},[t(s.Z,{attrs:{clearable:"",size:"medium",placeholder:"电站名称"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.stationName,callback:function(t){e.$set(e.queryForm,"stationName",t)},expression:"queryForm.stationName"}})],1),t("el-col",{attrs:{span:4}},[t(s.Z,{attrs:{clearable:"",size:"medium",placeholder:"交易号"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.tradeRecordId,callback:function(t){e.$set(e.queryForm,"tradeRecordId",t)},expression:"queryForm.tradeRecordId"}})],1),t("el-col",{attrs:{span:4}},[t(n["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"订单状态"},on:{change:e.pageReset},model:{value:e.queryForm.orderStatus,callback:function(t){e.$set(e.queryForm,"orderStatus",t)},expression:"queryForm.orderStatus"}},e._l(e.dropdowns.orderStatus,(function(e,r){return t("el-option",{key:r,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t(n["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"设备类型"},on:{change:e.pageReset},model:{value:e.queryForm.boatName,callback:function(t){e.$set(e.queryForm,"boatName",t)},expression:"queryForm.boatName"}},e._l(e.dropdowns.boatName,(function(e,r){return t("el-option",{key:r,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t(n["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"发票状态"},on:{change:e.pageReset},model:{value:e.queryForm.billStatus,callback:function(t){e.$set(e.queryForm,"billStatus",t)},expression:"queryForm.billStatus"}},e._l(e.dropdowns.invoiceStatus,(function(e,r){return t("el-option",{key:r,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t(n["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"清分状态"},on:{change:e.pageReset},model:{value:e.queryForm.clearStatus,callback:function(t){e.$set(e.queryForm,"clearStatus",t)},expression:"queryForm.clearStatus"}},e._l(e.dropdowns.clearIntegral,(function(e,r){return t("el-option",{key:r,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t(n["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"清分结算状态"},on:{change:e.pageReset},model:{value:e.queryForm.settleStatus,callback:function(t){e.$set(e.queryForm,"settleStatus",t)},expression:"queryForm.settleStatus"}},e._l(e.dropdowns.settleAccounts,(function(e,r){return t("el-option",{key:r,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t(s.Z,{attrs:{clearable:"",size:"medium",placeholder:"停电原因"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.stopElecReason,callback:function(t){e.$set(e.queryForm,"stopElecReason",t)},expression:"queryForm.stopElecReason"}})],1),t("el-col",{attrs:{span:4}},[t(n["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"用电结账状态"},on:{change:e.pageReset},model:{value:e.queryForm.payStatus,callback:function(t){e.$set(e.queryForm,"payStatus",t)},expression:"queryForm.payStatus"}},e._l(e.dropdowns.payStatus,(function(e,r){return t("el-option",{key:r,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t(n["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"有序订单"},on:{change:e.pageReset},model:{value:e.queryForm.orderly,callback:function(t){e.$set(e.queryForm,"orderly",t)},expression:"queryForm.orderly"}},[t("el-option",{attrs:{label:"是",value:"1"}}),t("el-option",{attrs:{label:"否",value:"0"}})],1)],1),t("el-col",{attrs:{span:4}},[t(a.Z,{attrs:{size:"medium",type:"datetimerange",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"订单开始时间段","picker-options":e.pickerOptions},on:{change:e.pageReset},model:{value:e.queryForm.startTimeSection,callback:function(t){e.$set(e.queryForm,"startTimeSection",t)},expression:"queryForm.startTimeSection"}})],1),t("el-col",{attrs:{span:4}},[t(a.Z,{attrs:{size:"medium",type:"datetimerange",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"订单结束时间段","picker-options":e.pickerOptions},on:{change:e.pageReset},model:{value:e.queryForm.endTimeSection,callback:function(t){e.$set(e.queryForm,"endTimeSection",t)},expression:"queryForm.endTimeSection"}})],1),t("el-col",{attrs:{span:4}},[t(a.Z,{attrs:{size:"medium",type:"datetimerange",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"订单支付时间段","picker-options":e.pickerOptions},on:{change:e.pageReset},model:{value:e.queryForm.payTimeSection,callback:function(t){e.$set(e.queryForm,"payTimeSection",t)},expression:"queryForm.payTimeSection"}})],1)]:e._e(),t("el-col",{staticClass:"text-end mt-3",attrs:{span:e.expertQuery?4:20}},[t("el-button",{staticClass:"text-warmgray",attrs:{size:"medium",type:"text"},on:{click:function(t){e.expertQuery=!e.expertQuery}}},[e._v(" "+e._s(e.expertQuery?"折叠":"展开")+"高级查询 ")])],1)],2),t("el-divider"),t(o.Z,{ref:"table",attrs:{loading:e.loading,total:e.total,data:e.tableData,height:"510","row-key":"orderId","page-size":e.queryForm.pageSize,"current-page":e.queryForm.pageNum,derive:e.exporting},on:{"current-change":e.handleCurrentChange,"size-change":e.dataSizeChange,"selection-change":e.selectingData},scopedSlots:e._u([{key:"left",fn:function(){return[t("el-button",{attrs:{size:"small"},on:{click:e.noPayUrged}},[e._v("催收扣款")])]},proxy:!0},{key:"columns",fn:function(){return[t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"orderId",label:"订单号",align:"center","min-width":"200"},scopedSlots:e._u([{key:"default",fn:function(r){return t("div",{directives:[{name:"copy",rawName:"v-copy",value:r.row.orderId,expression:"scope.row.orderId"}],staticClass:"text-end"},["1"===r.row.orderly?t("el-tag",{attrs:{type:"primay",size:"mini"}},[e._v("有序")]):e._e(),e._v(" "+e._s(r.row.orderId)+" ")],1)}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"userId",label:"用户账号"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"phoneNumber",label:"手机号",width:"110",align:"center"},scopedSlots:e._u([{key:"default",fn:function(r){return t("router-link",{staticClass:"text-black",attrs:{to:{name:"management-use-electric-index",params:{phonenumber:r.row.phoneNumber}}}},[e._v(" "+e._s(r.row.phoneNumber)+" ")])}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"stationId",label:"电站名称"},scopedSlots:e._u([{key:"default",fn:function(r){return t("span",{directives:[{name:"copy",rawName:"v-copy",value:r.row.stationId,expression:"scope.row.stationId"}]},[e._v(" "+e._s(e._f("transfortext")(r.row.stationId,e.dropdowns.stationId,{name:"stationName",value:"stationNo"}))+" ")])}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"construction",label:"隶属区域"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"stakeName",label:"设备名称"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"boatName",label:"设备类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.boatName,e.dropdowns.boatName))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"stakeNo",label:"设备编号","min-width":"155"},scopedSlots:e._u([{key:"default",fn:function(r){return t("router-link",{staticClass:"text-black",attrs:{to:{name:"operational-runing-index",params:{stakeNo:r.row.stakeNo}}}},[e._v(" "+e._s(r.row.stakeNo)+" ")])}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"djAccount",label:"预付金额",width:"82",align:"center"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"startTime",label:"开始时间",width:"110"},scopedSlots:e._u([{key:"default",fn:function(r){return t("span",{attrs:{title:r.row.startTime}},[e._v(" "+e._s(r.row.startTime.slice(5,r.row.startTime.length))+" ")])}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"createTime",label:"供电时间",width:"110"},scopedSlots:e._u([{key:"default",fn:function(r){return t("span",{attrs:{title:r.row.createTime}},[e._v(" "+e._s(r.row.createTime.slice(5,r.row.createTime.length))+" ")])}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"endTime",label:"结束时间",width:"110"},scopedSlots:e._u([{key:"default",fn:function(r){return t("span",{attrs:{title:r.row.endTime}},[e._v(" "+e._s(r.row.endTime.slice(5,r.row.endTime.length))+" ")])}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"payTime",label:"支付时间",width:"110"},scopedSlots:e._u([{key:"default",fn:function(r){return t("span",{attrs:{title:r.row.payTime}},[e._v(" "+e._s(r.row.payTime.slice(5,r.row.payTime.length))+" ")])}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"durationTime",label:"实充用时","min-width":"110",align:"right"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"djTime",label:"预充时长"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.djTime||"充满自停")+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"djTime",label:"等待时长"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.waitedTime)+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"totalElectric",label:"耗电",align:"right"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"rated",label:"核定功率",align:"right"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"conslAmountService",label:"服务费",align:"right"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"kdAmount",label:"电费单价",align:"right"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"amount",label:"订单总额",align:"right"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"balance",label:"实收",align:"right"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"orderStatus",label:"订单状态",align:"center"},scopedSlots:e._u([{key:"default",fn:function(r){return t("span",{class:["2"===r.row.orderStatus?"text-primary":""]},[e._v(" "+e._s(e._f("transfortext")(r.row.orderStatus,e.dropdowns.orderStatus))+" ")])}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"payStatus",label:"支付状态",align:"center"},scopedSlots:e._u([{key:"default",fn:function(r){return t("span",{class:["3"===r.row.orderStatus&&"1"===r.row.payStatus?"text-danger":""]},[e._v(" "+e._s(e._f("transfortext")(r.row.payStatus,e.dropdowns.payStatus))+" ")])}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"tranStatus",label:"结账方式",width:"110",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.tranStatus,e.dropdowns.tranStatus))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"refundType",label:"退款情况",width:"110",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.refundType,e.dropdowns.refundType))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"stopElecReason",label:"停电原因",align:"center"}}),t("el-table-column",{attrs:{label:"操作",width:"170",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-button",{attrs:{plain:"",size:"mini",type:"primary"},on:{click:function(t){return e.seeOrderDetail(r.row)}}},[e._v("详情")]),t("el-dropdown",{staticClass:"ms-2",on:{command:function(t){return e.moreHandles(t,r.row)}}},[t("el-button",{attrs:{size:"mini"}},[e._v(" 更多"),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:{fn:"seeBillingTemplate"}}},[e._v("计费模型")]),"1"===r.row.boatName?t("el-dropdown-item",{attrs:{command:{fn:"seePowerDetail"}}},[e._v("功率明细")]):e._e(),["2","3"].includes(r.row.boatName)?t("el-popover",{attrs:{"popper-class":"cost-detail",placement:"left",width:"200"}},[t("el-dropdown-item",{attrs:{slot:"reference"},slot:"reference"},[e._v("费用明细")]),t("div",{staticClass:"item"},[t("span",{staticClass:"text-warmgray inline-block text-end title"},[e._v("尖电量：")]),t("span",[e._v(e._s(r.row.spotElectric)+"度")])]),t("div",{staticClass:"item"},[t("span",{staticClass:"text-warmgray inline-block text-end title"},[e._v("峰电量：")]),t("span",[e._v(e._s(r.row.peakElectric)+"度")])]),t("div",{staticClass:"item"},[t("span",{staticClass:"text-warmgray inline-block text-end title"},[e._v("平电量：")]),t("span",[e._v(e._s(r.row.flatElectric)+"度")])]),t("div",{staticClass:"item"},[t("span",{staticClass:"text-warmgray text-end title"},[e._v("谷电量：")]),t("span",[e._v(e._s(r.row.valleyElectric)+"度")])]),t("hr",{staticClass:"mt-1 mb-1"}),t("div",{staticClass:"item"},[t("span",{staticClass:"text-warmgray inline-block text-end title"},[e._v("尖电费：")]),t("span",[e._v(e._s(r.row.spotAmountElectric)+"元")])]),t("div",{staticClass:"item"},[t("span",{staticClass:"text-warmgray inline-block text-end title"},[e._v("峰电费：")]),t("span",[e._v(e._s(r.row.peakAmountElectric)+"元")])]),t("div",{staticClass:"item"},[t("span",{staticClass:"text-warmgray inline-block text-end title"},[e._v("平电费：")]),t("span",[e._v(e._s(r.row.flatAmountElectric)+"元")])]),t("div",{staticClass:"item"},[t("span",{staticClass:"text-warmgray inline-block text-end title"},[e._v("谷电费：")]),t("span",[e._v(e._s(r.row.valleyAmountElectric)+"元")])]),t("hr",{staticClass:"mt-1 mb-1"}),t("div",{staticClass:"item"},[t("span",{staticClass:"text-warmgray inline-block text-end title"},[e._v("尖服务费：")]),t("span",[e._v(e._s(r.row.spotAmountService)+"元")])]),t("div",{staticClass:"item"},[t("span",{staticClass:"text-warmgray inline-block text-end title"},[e._v("峰服务费：")]),t("span",[e._v(e._s(r.row.peakAmountService)+"元")])]),t("div",{staticClass:"item"},[t("span",{staticClass:"text-warmgray inline-block text-end title"},[e._v("平服务费：")]),t("span",[e._v(e._s(r.row.flatAmountService)+"元")])]),t("div",{staticClass:"item"},[t("span",{staticClass:"text-warmgray inline-block text-end title"},[e._v("谷服务费：")]),t("span",[e._v(e._s(r.row.valleyAmountService)+"元")])]),t("hr"),t("div",{staticClass:"item"},[t("span",{staticClass:"text-warmgray inline-block text-end title"},[e._v("电费合计：")]),t("span",[e._v(e._s(r.row.consAmountElectric)+"元")])]),t("div",{staticClass:"item"},[t("span",{staticClass:"text-warmgray inline-block text-end title"},[e._v("服务费合计：")]),t("span",[e._v(e._s(r.row.conslAmountService)+"元")])])],1):e._e(),"2"===r.row.payStatus&&("1"!==r.row.refundType||"2"!==r.row.refundType)&&r.row.balance>0?t("el-dropdown-item",{attrs:{command:{fn:"refund"},divided:""}},[e._v("申请退款")]):e._e(),"2"===r.row.payStatus&&"0"!==r.row.refundType?t("el-dropdown-item",{attrs:{command:{fn:"refundHistory"}}},[e._v("退款记录")]):e._e(),"3"===r.row.orderStatus&&"1"===r.row.payStatus&&r.row.tranStatus?t("el-dropdown-item",{attrs:{command:{param:"handel",fn:"userPaying"}}},[e._v("让用户手动结账")]):e._e(),"2"===r.row.tranStatus&&"1"===r.row.payStatus?t("el-dropdown-item",{attrs:{command:{fn:"offPayCredit"},divided:""}},[e._v("取消订单")]):e._e(),"2"===r.row.tranStatus&&"1"===r.row.payStatus?t("el-dropdown-item",{attrs:{command:{fn:"modifyOderAmount"}}},[e._v("修改订单金额")]):e._e(),"1"===r.row.payStatus&&"3"===r.row.orderStatus?t("el-dropdown-item",{attrs:{command:{fn:"noPayUrged"}}},[e._v("催收扣款")]):e._e(),"1"===r.row.payStatus&&"1"===r.row.boatName?t("el-dropdown-item",{attrs:{command:{fn:"closeOrder"}}},[e._v("结束订单")]):e._e()],1)],1)]}}])})]},proxy:!0}])}),t(e.component,{tag:"component",attrs:{show:e.showComponent,orderInfo:e.orderInfo},on:{close:e.closeComponent}})],1)},p=[],m=r(19596),y=r(37662),f=r(25335),h=r(5376),w=r(90886),g=r(86867),b=r(30741),v={name:"orders-order-manage-index",mixins:[b.I_,b.LI,b.oA,b.vd],filters:{transfortext:w.h},directives:{copy:g.JG},components:{PowerDetail:()=>r.e(4001).then(r.bind(r,44001)),RefundRecord:()=>r.e(8318).then(r.bind(r,70664)),OrderDetail:()=>Promise.all([r.e(142),r.e(6450)]).then(r.bind(r,90142)),"total-drawer":()=>r.e(7888).then(r.bind(r,43893)),"billing-template":()=>r.e(3757).then(r.bind(r,73059))},data(){return{pickerOptions:{disabledDate(e){return e.getTime()>Date.now()}},expertQuery:!1,loading:!1,dropdowns:{orderStatus:[],stationId:[],invoiceStatus:[],clearIntegral:[],settleAccounts:[],payStatus:[],tranStatus:[],refundType:[],stopElecReason:[],boatName:[]},queryForm:{dataType:"",startTimeSection:[],endTimeSection:[],payTimeSection:[],userName:"",userId:"",deptCode:"",stakeName:"",phoneNumber:"",boatName:"",orderId:"",stationName:"",tradeRecordId:"",constructionUuid:"",stakeNo:"",orderly:"",stationId:"",stopElecReason:"",startTimeSerach:"",endTimeSerach:"",orderStatus:"",billStatus:"",clearStatus:"",settleStatus:"",payStatus:"",pageSize:this.$tableDataSize,pageNum:1,orderByColumn:"createtime",isAsc:"desc"},tableData:[],total:0,selectedDate:[],orderInfo:{},component:null,showComponent:!1}},created(){this.getDropdowns()},watch:{"queryForm.startTimeSection"(e){e?(this.queryForm.startTimeSerach=e[0],this.queryForm.endTimeSerach=e[1]):(this.queryForm.startTimeSerach="",this.queryForm.endTimeSerach="")},"queryForm.endTimeSection"(e){e?(this.queryForm.endTimeStart=e[0],this.queryForm.endTimeStop=e[1]):(this.queryForm.endTimeStart="",this.queryForm.endTimeStop="")},"queryForm.payTimeSection"(e){e?(this.queryForm.payTimeStart=e[0],this.queryForm.payTimeStop=e[1]):(this.queryForm.payTimeStart="",this.queryForm.payTimeStop="")}},methods:{getDropdowns(){(0,h.Wl)("1001").then((e=>{0===e.code&&(this.dropdowns.orderStatus=e.data)})),(0,h.Wl)("3004").then((e=>{0===e.code&&(this.dropdowns.boatName=e.data)})),(0,h.Wl)("3010").then((e=>{0===e.code&&(this.dropdowns.chargePort=e.data)})),(0,h.Wl)("3014").then((e=>{0===e.code&&(this.dropdowns.invoiceStatus=e.data)})),(0,h.Wl)("3015").then((e=>{0===e.code&&(this.dropdowns.clearIntegral=e.data)})),(0,h.Wl)("3016").then((e=>{0===e.code&&(this.dropdowns.settleAccounts=e.data)})),(0,h.Wl)("1004").then((e=>{0===e.code&&(this.dropdowns.payStatus=e.data)})),(0,h.Wl)("852616").then((e=>{0===e.code&&(this.dropdowns.tranStatus=e.data)})),(0,h.Wl)("004788").then((e=>{0===e.code&&(this.dropdowns.refundType=e.data)})),(0,h.iS)().then((e=>{0===e.code&&(this.dropdowns.stationId=e.data)}))},getData(){this.tableData=[],this.loading=!0,(0,m.A6)(this.queryForm).then((e=>{if(this.loading=!1,0===e.code){this.total=e.total;const t=this;this.tableData=e.rows.map((e=>({...e,durationTime:t.durationTime(e),waitedTime:t.waitedTime(e)})))}})).catch((()=>{this.loading=!1}))},durationTime(e){return["3","2"].includes(e.orderStatus)?(0,y.I6)(e.createTime,e.endTime||this.getNowTime()):""},waitedTime(e){return"1"!==e.orderly?"":"5"===e.orderStatus?(0,y.I6)(e.createTime,this.getNowTime()):(0,y.I6)(e.startTime,e.createTime)},getNowTime(){const e={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1},t=new Intl.DateTimeFormat("zh",e).format(new Date).replace(/[/]/g,"-");return t},selectingData(e){this.selectedDate=e},moreHandles(e,t){this[e.fn](t,e.param)},seePowerDetail(e){this.orderInfo=e,this.component="PowerDetail",setTimeout((()=>{this.showComponent=!0}),400)},refundHistory(e){this.orderInfo=e,this.component="RefundRecord",setTimeout((()=>{this.showComponent=!0}),400)},seeOrderDetail(e){this.orderInfo=e,this.component="OrderDetail",setTimeout((()=>{this.showComponent=!0}),400)},openTotalDrawer(){this.component="total-drawer",setTimeout((()=>{this.showComponent=!0}),400)},seeBillingTemplate(e){this.orderInfo=e,this.component="billing-template",setTimeout((()=>{this.showComponent=!0}),400)},closeComponent(){this.showComponent=!1,this.orderInfo={}},offPayCredit(e,t){(0,m.V3)({orderId:e.orderId}).then((r=>{0===r.code&&(this.$message.success("取消成功"),t||this.userPaying(e))}))},modifyOderAmount(e){const t=this;this.$prompt("","修改支付分订单金额",{confirmButtonText:"修改",cancelButtonText:"取消",inputType:"number",inputValue:0,beforeClose(r,o,a){if("confirm"===r){if("2"===e.payStatus&&parseFloat(o.inputValue)>e.balance)return t.$message.error("退款额超出"),!1;if("1"===e.payStatus&&parseFloat(o.inputValue)>e.amount)return t.$message.error("退款额超出"),!1;if(parseFloat(o.inputValue)<.01)return t.$message.error("退款额错误"),!1}a()}}).then((t=>{(0,m.WO)({orderId:e.orderId,modifyAmount:t.value}).then((e=>{0===e.code&&(this.$message.success("修改成功"),this.getData())}))})).catch((()=>{}))},noPayUrged(e){let t;if(e.orderId)t=[e.orderId];else{if(this.selectedDate.length<1)return this.$message.warning("请选择催收项"),!1;const e=this.selectedDate.every((e=>"1"===e.payStatus));if(!e)return this.$message.warning("所选项存在非未付订单");const r=this.selectedDate.every((e=>"3"===e.orderStatus));if(!r)return this.$message.warning("所选项存在未结束的订单");t=this.selectedDate.map((e=>e.orderId))}(0,m.td)({orderIds:t}).then((e=>{0===e.code&&(this.$message.success("催款成功"),this.getData(),this.selectedDate=[],this.$refs["table"].clearSelection())}))},userPaying(e,t){(0,m.NI)({orderId:e.orderId}).then((r=>{0===r.code&&(this.$message.success("设置成功"),"handel"===t&&this.offPayCredit(e,"handel"),this.getData())}))},refund(e){const t=this;this.$prompt("","退款金额",{confirmButtonText:"退款",cancelButtonText:"取消",inputType:"number",inputValue:e.balance,beforeClose(r,o,a){if("confirm"===r){if(Number(o.inputValue)>e.balance)return t.$message.error("退款额超出"),!1;if(Number(o.inputValue)<.01)return t.$message.error("退款额错误"),!1}a()}}).then((r=>{(0,f.U4)({orderId:e.orderId,userId:e.userId,phoneNumber:e.phoneNumber,receiveMoney:e.balance,backMoney:r.value,transactionId:e.tradeRecordId,dataResource:"1"}).then((e=>{0===e.code&&(t.$message.success("申请提交"),t.getData())}))})).catch((()=>{}))},closeOrder(e){(0,m.Dm)({orderId:e.orderId}).then((e=>{0===e.code&&(this.$message.success(e.msg),this.getData())}))},closeBillingTemplateDialog(e){this.billingTemplateDialog=e,this.orderDetail={}},async exporting(e){let t={...this.queryForm};"2"===e&&(t.pageSize=this.total,t.pageNum=1);const r=await(0,m.A6)(t);if(0===r.code){const e=this.$refs.table.getColumns(),t=this,o=r.rows.map((r=>{r.durationTime=t.durationTime(r),r.waitedTime=t.waitedTime(r);let o=e.map((e=>{let t;return"stationId"===e.prop&&(t={name:"stationName",value:"stationNo"}),[e.label,`${(0,w.h)(r[e.prop],this.dropdowns[e.prop],t)}`]}));return Object.fromEntries(o)}));return o}}}},_=v,k=r(1001),S=(0,k.Z)(_,d,p,!1,null,"797c0516",null),T=S.exports}}]);