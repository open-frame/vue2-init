"use strict";(self["webpackChunkiov_platform"]=self["webpackChunkiov_platform"]||[]).push([[8923],{58923:function(e,t,o){o.r(t),o.d(t,{default:function(){return y}});var r=o(63598),a=o(75267),s=o(66654),i=o(12025),l=o(90649),n=o(67539),c=function(){var e=this,t=e._self._c;return t("div",{},[t(n.Z,{attrs:{loading:e.tableLoading,getData:e.getData,queryReset:e.queryReset}},[t("el-col",{attrs:{span:4}},[t(l.Z,{attrs:{size:"medium",type:"datetimerange",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"充值时间段","picker-options":e.pickerOptions},on:{change:e.pageReset},model:{value:e.queryForm.rechargePeriod,callback:function(t){e.$set(e.queryForm,"rechargePeriod",t)},expression:"queryForm.rechargePeriod"}})],1),t("el-col",{attrs:{span:4}},[t(i.Z,{attrs:{animatLable:""},on:{change:e.pageReset},model:{value:e.queryForm.stationNo,callback:function(t){e.$set(e.queryForm,"stationNo",t)},expression:"queryForm.stationNo"}})],1),t("el-col",{attrs:{span:4}},[t(s.Z,{attrs:{animatLable:""},on:{change:e.pageReset},model:{value:e.queryForm.constructionUuid,callback:function(t){e.$set(e.queryForm,"constructionUuid",t)},expression:"queryForm.constructionUuid"}})],1),t("el-col",{attrs:{span:4}},[t(a.Z,{attrs:{animatLable:"",placeholder:"收款单位"},model:{value:e.queryForm.construction,callback:function(t){e.$set(e.queryForm,"construction",t)},expression:"queryForm.construction"}})],1),t("el-col",{attrs:{span:4}},[t(a.Z,{attrs:{animatLable:"",placeholder:"小于可用天数",type:"number"},model:{value:e.queryForm.expectDay,callback:function(t){e.$set(e.queryForm,"expectDay",t)},expression:"queryForm.expectDay"}})],1)],1),t("el-divider"),t(r.Z,{ref:"table",attrs:{name:"缴费管理",loading:e.tableLoading,total:e.total,data:e.tableData,height:"500","row-key":"prepaidMeterId","page-size":e.queryForm.pageSize,"current-page":e.queryForm.pageNum,derive:e.exporting},on:{"selection-change":e.selectingData,"size-change":e.dataSizeChange,"current-change":e.handleCurrentChange},scopedSlots:e._u([{key:"left",fn:function(){return[t("el-button",{attrs:{size:"small"},on:{click:e.openFormDialog}},[e._v("添加电表")]),t("el-button",{attrs:{size:"small"},on:{click:e.openRechargeFormDialog}},[e._v("批量充值")])]},proxy:!0},{key:"columns",fn:function(){return[t("el-table-column",{attrs:{label:"预付费电表编号",prop:"prepaidMeterNo","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"预付费电表名称",prop:"prepaidMeterName","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"电费单价",prop:"unitPrice","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"收款单位",prop:"construction","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"关联电表数量",prop:"countMeter","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"累计充值电量",prop:"accumElec","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"累计充值金额",prop:"accumAmount","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"当前剩余电量",prop:"residueElec","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"当前剩余金额",prop:"residueAmount","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"日均耗电",prop:"averageDay","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"预计可用天数",prop:"expectDay","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(o){return[t("span",{class:o.row.expectDay>0?"":"text-danger fw-bolder animate-bounce-in animate-count-4 animate-duration-0.5s"},[e._v(" "+e._s(o.row.expectDay)+" ")])]}}])}),t("el-table-column",{attrs:{label:"运行状态",prop:"status","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.status,e.dropdowns.status))+" ")]}}])}),t("el-table-column",{attrs:{label:"操作",width:"230"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-button",{attrs:{plain:"",size:"mini",type:"primary"},on:{click:function(t){return e.openFormDialog(o.row)}}},[e._v("详情")]),t("el-button",{attrs:{plain:"",size:"mini"},on:{click:function(t){return e.openRechargeFormDialog(o.row)}}},[e._v("充值")]),t("el-dropdown",{staticClass:"ms-2",on:{command:function(t){return e.moreHandles(t,o)}}},[t("el-button",{attrs:{size:"mini"}},[e._v(" 更多"),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"1"}},[e._v("充值记录")]),"1"===o.row.status?t("el-dropdown-item",{attrs:{command:"2",divided:""}},[e._v("停用")]):e._e(),"2"===o.row.status?t("el-dropdown-item",{attrs:{command:"3",divided:""}},[e._v("恢复")]):e._e(),t("el-dropdown-item",{attrs:{command:"0"}},[e._v("删除")]),"1"===o.row.status?t("el-dropdown-item",{attrs:{command:"4",divided:""}},[e._v("修正剩余电量")]):e._e(),"1"===o.row.status?t("el-dropdown-item",{attrs:{command:"5"}},[e._v("电量修正记录")]):e._e(),"1"===o.row.status?t("el-dropdown-item",{attrs:{command:"6",divided:""}},[e._v("日耗电记录")]):e._e()],1)],1)]}}])})]},proxy:!0}])}),t("ammeter-form",{attrs:{show:e.ammeterFormDialog,data:e.ammeterForm},on:{close:e.closeFormDialog,success:e.getData}}),t("recharge-form",{attrs:{show:e.rechargeformDialog,prepaidMeterIds:e.prepaidMeterIds},on:{close:e.closeRechargeFormDialog,success:e.getData}}),t("recharge-record",{attrs:{show:e.rechargeRecordDialog,prepaidMeterId:e.prepaidMeterId},on:{close:e.closeRechargeRecordDialog}}),t("amend-record",{attrs:{show:e.amendHistoryDialog,prepaidMeterId:e.prepaidMeterId},on:{close:e.closeAmendHistoryDialog}}),t("day-power-consumption-records",{attrs:{show:e.dayPowerConsumptionRecordDialog,prepaidMeterId:e.prepaidMeterId},on:{close:e.closeDayPowerConsumptionRecordDialogDialog}})],1)},d=[],p=o(74713),m=o(5376),u=o(90886),h=o(30741),g={name:"",mixins:[h.LI,h.I_,h.oA,h.vd],filters:{transfortext:u.h},components:{"ammeter-form":()=>Promise.all([o.e(1377),o.e(7280),o.e(3148)]).then(o.bind(o,17280)),"recharge-record":()=>o.e(6841).then(o.bind(o,86841)),"recharge-form":()=>o.e(6537).then(o.bind(o,26537)),"amend-record":()=>o.e(5230).then(o.bind(o,15230)),"day-power-consumption-records":()=>o.e(8872).then(o.bind(o,88872))},data(){return{pickerOptions:{disabledDate(e){return e.getTime()>Date.now()}},tableLoading:!1,queryForm:{constructionUuid:"",rechargePeriod:[],rechargeStartTime:"",rechargeEndTime:"",construction:"",stationNo:"",prepaidMeterNo:"",pageSize:this.$tableDataSize,pageNum:1},dropdowns:{status:[],constructionUuid:[]},tableData:[],total:0,ammeterFormDialog:!1,ammeterForm:{},rechargeRecordDialog:!1,prepaidMeterId:"",rechargeformDialog:!1,prepaidMeterIds:[],selectedDate:[],amendHistoryDialog:!1,dayPowerConsumptionRecordDialog:!1}},created(){this.getDropdowns()},watch:{"queryForm.rechargePeriod"(e){e?(this.queryForm.rechargeStartTime=e[0],this.queryForm.rechargeEndTime=e[1]):(this.queryForm.rechargeStartTime="",this.queryForm.rechargeEndTime="")}},methods:{getData(){this.tableData=[],this.tableLoading=!0,(0,p.bX)(this.queryForm).then((e=>{this.tableLoading=!1,0===e.code&&(this.total=e.total,this.tableData=e.rows)})).catch((()=>{this.tableLoading=!1}))},getDropdowns(){(0,m.Wl)("3006").then((e=>{0===e.code&&(this.dropdowns.status=e.data)}))},openFormDialog(e){e.prepaidMeterId&&(this.ammeterForm={...e}),this.ammeterFormDialog=!0},closeFormDialog(){this.ammeterForm={},this.ammeterFormDialog=!1},selectingData(e){this.selectedDate=e},moreHandles(e,t){switch(e){case"1":this.openRechargeRecordDialog(t.row);break;case"2":this.changeStaus(t.row,{status:"2"});break;case"0":this.changeStaus(t.row,{delflag:"1"});break;case"3":this.changeStaus(t.row,{status:"1"});break;case"4":this.modifyOderAmount(t.row);break;case"5":this.prepaidMeterId=t.row.prepaidMeterId,this.amendHistoryDialog=!0;break;case"6":this.prepaidMeterId=t.row.prepaidMeterId,this.dayPowerConsumptionRecordDialog=!0;break}},modifyOderAmount(e){const t=this;this.$prompt("","修正剩余电量",{confirmButtonText:"修正",cancelButtonText:"取消",inputType:"number",beforeClose(e,o,r){if("confirm"===e&&parseFloat(o.inputValue)<.01)return t.$message.error("数据错误"),!1;r()}}).then((t=>{(0,p.NA)({prepaidMeterId:e.prepaidMeterId,averageDay:e.averageDay,residueElec:t.value}).then((e=>{0===e.code&&(this.$message.success("修改成功"),this.getData())}))})).catch((()=>{}))},openRechargeRecordDialog(e){this.prepaidMeterId=e.prepaidMeterId,this.rechargeRecordDialog=!0},closeRechargeRecordDialog(){this.prepaidMeterId="",this.rechargeRecordDialog=!1},closeAmendHistoryDialog(){this.prepaidMeterId="",this.amendHistoryDialog=!1},closeDayPowerConsumptionRecordDialogDialog(){this.prepaidMeterId="",this.dayPowerConsumptionRecordDialog=!1},openRechargeFormDialog(e){if(e.prepaidMeterId){if(e.countMeter<=0)return void this.$message.warning("未关联电表");this.prepaidMeterIds=[e.prepaidMeterId]}else{if(0===this.selectedDate.length)return void this.$message.warning("请选择要充值的电表");this.prepaidMeterIds=this.selectedDate.map((e=>e.prepaidMeterId))}this.rechargeformDialog=!0},closeRechargeFormDialog(){this.$refs.table.clearSelection(),this.prepaidMeterIds=[],this.rechargeformDialog=!1},changeStaus(e,t){(0,p.Qf)({prepaidMeterId:e.prepaidMeterId,...t}).then((e=>{0===e.code&&this.getData()}))},async exporting(e){let t={...this.queryForm};"2"===e&&(t.pageSize=this.total,t.pageNum=1);const o=await(0,p.bX)(t);if(0===o.code){const e=this.$refs.table.getColumns(),t=o.rows.map((t=>{let o=e.map((e=>[e.label,`${(0,u.h)(t[e.prop],this.dropdowns[e.prop])}`]));return Object.fromEntries(o)}));return t}}}},w=g,b=o(1001),f=(0,b.Z)(w,c,d,!1,null,"6b9f8d8e",null),y=f.exports}}]);