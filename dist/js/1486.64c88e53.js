"use strict";(self["webpackChunkiov_platform"]=self["webpackChunkiov_platform"]||[]).push([[1486],{44693:function(e,t,o){o.d(t,{JN:function(){return n},Nx:function(){return r},cT:function(){return a}});var s=o(92617);function a(e,t){return s.o.post("/flow/monitor/myTask",e,t)}function r(e,t){return s.o.post("/flow/monitor/setTaskAssignee",e,t)}function n(e,t){return s.o.post("/flow/monitor/myCompletedTask",e,t)}},31486:function(e,t,o){o.r(t),o.d(t,{default:function(){return k}});var s=o(63598),a=o(8398),r=o(90649),n=o(71377),l=o(81018),i=o(67539),c=function(){var e=this,t=e._self._c;return t("el-card",{},[t(i.Z,{attrs:{loading:e.loading,btnSpan:24,getData:e.getData,queryReset:e.queryReset}},[t("el-col",{attrs:{span:4}},[t(l.Z,{attrs:{animatLable:""},on:{change:e.pageReset},model:{value:e.queryForm.processDefinitionKey,callback:function(t){e.$set(e.queryForm,"processDefinitionKey",t)},expression:"queryForm.processDefinitionKey"}})],1),t("el-col",{attrs:{span:4}},[t(n["default"],{attrs:{disabled:""===e.queryForm.processDefinitionKey,filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:e.queryForm.processDefinitionKey?"当前任务":"先选择流程名称"},on:{change:e.pageReset},model:{value:e.queryForm.currentTask,callback:function(t){e.$set(e.queryForm,"currentTask",t)},expression:"queryForm.currentTask"}},e._l(e.dropdowns.currentTask,(function(e,o){return t("el-option",{key:o,attrs:{label:e.taskName,value:e.sid}})})),1)],1),t("el-col",{attrs:{span:4}},[t(n["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"是否结束"},on:{change:e.pageReset},model:{value:e.queryForm.ended,callback:function(t){e.$set(e.queryForm,"ended",t)},expression:"queryForm.ended"}},e._l(e.dropdowns.yesORno,(function(e,o){return t("el-option",{key:o,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t(n["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"是否超时"},on:{change:e.pageReset},model:{value:e.queryForm.taskTimeout,callback:function(t){e.$set(e.queryForm,"taskTimeout",t)},expression:"queryForm.taskTimeout"}},e._l(e.dropdowns.yesORno,(function(e,o){return t("el-option",{key:o,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t(r.Z,{attrs:{size:"medium",type:"datetimerange",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"流程开始时间段","picker-options":e.pickerOptions},on:{change:e.pageReset},model:{value:e.queryForm.startTimeQuantum,callback:function(t){e.$set(e.queryForm,"startTimeQuantum",t)},expression:"queryForm.startTimeQuantum"}})],1),t("el-col",{attrs:{span:4}},[t(a.Z,{attrs:{animatLable:"",placeholder:"处理人"},on:{change:e.pageReset},model:{value:e.queryForm.assignee,callback:function(t){e.$set(e.queryForm,"assignee",t)},expression:"queryForm.assignee"}})],1)],1),t("el-divider"),t(s.Z,{ref:"table",attrs:{loading:e.loading,total:e.total,data:e.tableData,height:"560","row-key":"orderId","page-size":e.queryForm.pageSize,"current-page":e.queryForm.pageNum,derive:e.exporting},on:{"current-change":e.handleCurrentChange,"size-change":e.dataSizeChange},scopedSlots:e._u([{key:"columns",fn:function(){return[t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"processInstanceId",label:"流程id"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"processDefinitionName",label:"流程名称"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"startTime",label:"流程开始时间"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"endTime",label:"流程结束时间"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"ended",label:"流程是否结束"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.ended,e.dropdowns.yesORno))+" ")]}}])}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"currentTask",label:"当前任务"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"assignee",label:"处理人"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"durationTime",label:"流程耗时"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"dueDate",label:"超时时间"}}),t("el-table-column",{attrs:{label:"操作",width:"246"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-button",{on:{click:function(t){return e.openProcessDetailDialog(o.row)}}},[e._v("处理记录")]),t("el-button",{attrs:{plain:"",type:"primary"},on:{click:function(t){return e.openProsess(o.row)}}},[e._v("流程图")]),"0"===o.row.ended?[t("el-dropdown",{staticClass:"ms-2",on:{command:function(t){return e.moreHandles(t,o.row)}}},[t("el-button",{attrs:{size:"small"}},[e._v(" 更多"),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"closed"}},[e._v("结束")]),t("el-dropdown-item",{attrs:{command:"entrust"}},[e._v("委托")]),t("el-dropdown-item",{attrs:{command:"sendBack"}},[e._v("退回")])],1)],1)]:e._e()]}}])})]},proxy:!0}])}),t("examine-history",{attrs:{show:e.processDetailDialog,data:e.thisData},on:{close:function(t){e.processDetailDialog=!1}}}),t("send-back",{attrs:{show:e.sendBackDialog,data:e.thisData},on:{close:function(t){e.sendBackDialog=!1},success:e.getData}}),t("el-dialog",{attrs:{"close-on-click-modal":!1,"append-to-body":!0,"modal-append-to-body":!1,visible:""!==e.processImg,"show-close":!1}},[t("img",{attrs:{src:e.processImg,alt:"流程图",srcset:""}}),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.closeProsess}},[e._v("关闭")])],1)])],1)},u=[],d=o(83693),m=o(44693),p=o(90886),h=o(5376),f=o(30741),g={name:"process-list-index",filters:{transfortext:p.h},mixins:[f.I_,f.LI,f.oA,f.vd],components:{"examine-history":()=>o.e(1311).then(o.bind(o,41311)),"send-back":()=>o.e(6351).then(o.bind(o,46351))},data(){return{loading:!1,pickerOptions:{disabledDate(e){return e.getTime()>Date.now()}},dropdowns:{yesORno:[],currentTask:[]},queryForm:{startTimeQuantum:[],startTime:"",endTime:"",assignee:"",currentTask:"",ended:"",taskTimeout:"",processDefinitionKey:"",pageSize:this.$tableDataSize,pageNum:1},tableData:[],total:0,processImg:"",thisData:{},processDetailDialog:!1,sendBackDialog:!1}},created(){this.getDropdowns()},watch:{"queryForm.startTimeQuantum"(e){e?(this.queryForm.startTime=e[0],this.queryForm.endTime=e[1]):(this.queryForm.startTime="",this.queryForm.endTime="")},"queryForm.processDefinitionKey"(e){this.queryForm.currentTask="",e&&(0,d.ts)({processDefinitionKey:e}).then((e=>{0===e.code&&e.data&&(this.dropdowns.currentTask=e.data)}))},processDetailDialog(e){e||(this.thisData={})},sendBackDialog(e){e||(this.thisData={})}},methods:{getDropdowns(){(0,h.Wl)("1036").then((e=>{0===e.code&&(this.dropdowns.yesORno=e.data)}))},getData(){this.loading=!0,this.tableData=[],(0,d.rJ)(this.queryForm).then((e=>{this.loading=!1,0===e.code&&e.rows&&(this.total=e.total,this.tableData=e.rows)})).catch((()=>{this.loading=!1}))},openProsess(e){(0,d.IR)({processInstanceId:e.processInstanceId}).then((e=>{const t=new Blob([e]);this.processImg=URL.createObjectURL(t)}))},closeProsess(){URL.revokeObjectURL(this.processImg),this.processImg=""},openProcessDetailDialog(e){this.thisData=e,this.processDetailDialog=!0},moreHandles(e,t){this[e](t)},closed(e){(0,d.Hf)({processInstanceId:e.processInstanceId}).then((e=>{0===e.code&&(this.$message.success(e.msg),this.getData())}))},entrust(e){const t=this.$createElement;let o="";this.$msgbox({title:"选择委托办理人",message:t("div",{key:e.taskId},[t(a.Z,{attrs:{key:e.taskId},on:{change:e=>{o=e}}})]),confirmButtonText:"确定",beforeClose:(t,s,a)=>{if("confirm"===t){if(!o)return void this.$message.error("请选择委托办理人");s.confirmButtonLoading=!0,s.confirmButtonText="执行中...",(0,m.Nx)({assignee:o,taskId:e.taskId}).then((e=>{0===e.code&&(a(),this.getData(),this.$message.success(e.msg))})).finally((()=>{s.confirmButtonLoading=!1}))}else a()}})},sendBack(e){this.thisData=e,this.sendBackDialog=!0},async exporting(e){let t={...this.queryForm};"2"===e&&(t.pageSize=this.total,t.pageNum=1);const o=await(0,d.rJ)(t);if(0===o.code){const e=this.$refs.table.getColumns(),t=o.rows.map((t=>{let o=e.map((e=>[e.label,`${(0,p.h)(t[e.prop],this.dropdowns[e.prop])}`]));return Object.fromEntries(o)}));return t}}}},y=g,b=o(1001),w=(0,b.Z)(y,c,u,!1,null,"e2d566ec",null),k=w.exports}}]);