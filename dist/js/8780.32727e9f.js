"use strict";(self["webpackChunkiov_platform"]=self["webpackChunkiov_platform"]||[]).push([[8780],{68780:function(t,e,o){o.r(e),o.d(e,{default:function(){return _}});var a=o(48103),l=o(63598),r=o(71377),i=o(90649),s=o(1985),n=o(67539),c=function(){var t=this,e=t._self._c;return e("el-card",{},[e(n.Z,{attrs:{loading:t.tableLoading,btnSpan:12,getData:t.getData,queryReset:t.queryReset}},[e("el-col",{attrs:{span:4}},[e(s.Z,{attrs:{animatLable:"",placeholder:"筛选商户"},model:{value:t.queryForm.merchantNo,callback:function(e){t.$set(t.queryForm,"merchantNo",e)},expression:"queryForm.merchantNo"}})],1),e("el-col",{attrs:{span:4}},[e(i.Z,{attrs:{size:"medium",clearable:!1,type:"monthrange","value-format":"yyyy-MM",placeholder:"清分月份","picker-options":t.pickerOptions},on:{change:t.selectTime},model:{value:t.time,callback:function(e){t.time=e},expression:"time"}})],1),e("el-col",{attrs:{span:4}},[e(r["default"],{attrs:{clearable:"",size:"medium",placeholder:"状态"},model:{value:t.queryForm.status,callback:function(e){t.$set(t.queryForm,"status",e)},expression:"queryForm.status"}},t._l(t.dropdowns.status,(function(t,o){return e("el-option",{key:o,attrs:{label:t.code_name,value:t.code_value}})})),1)],1)],1),e("el-divider"),e(l.Z,{ref:"table",attrs:{loading:t.tableLoading,total:t.total,data:t.tableData,height:"550","row-key":"id","page-size":t.queryForm.pageSize,"current-page":t.queryForm.pageNum,derive:t.exporting},on:{"size-change":t.dataSizeChange,"current-change":t.handleCurrentChange},scopedSlots:t._u([{key:"left",fn:function(){return[e("el-popover",{attrs:{"popper-class":"final-detail",width:"200"},on:{show:t.seeTotalData}},[e("div",{staticClass:"item"},[e("span",{staticClass:"text-warmgray inline-block text-end title"},[t._v("追收金额：")]),e("span",[t._v(t._s(t.totalData.allLastMoney)+"元")])]),e("div",{staticClass:"item"},[e("span",{staticClass:"text-warmgray inline-block text-end title"},[t._v("退款金额：")]),e("span",[t._v(t._s(t.totalData.allbackMoney)+"元")])]),e("div",{staticClass:"item"},[e("span",{staticClass:"text-warmgray inline-block text-end title"},[t._v("清分金额：")]),e("span",[t._v(t._s(t.totalData.allOrderMoney)+"元")])]),e("div",{staticClass:"item"},[e("span",{staticClass:"text-warmgray inline-block text-end title"},[t._v("总金额：")]),e("span",[t._v(t._s(t.totalData.allTotalMoney)+"元")])]),e("el-button",{attrs:{slot:"reference",size:"small"},slot:"reference"},[t._v("总计")])],1)]},proxy:!0},{key:"columns",fn:function(){return[e("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"清分单号",prop:"clearNo"}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"清分月份",prop:"clearMon"}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"商户名称",prop:"merchantName"}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"订单数量",prop:"orderNum"}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"退款数量",prop:"backNum"}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"追收数量",prop:"lastNum"}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"订单金额",prop:"orderMoney"}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"退款金额",prop:"backMoney"}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"追收金额",prop:"lastMoney"}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"结算金额",prop:"totalMoney"}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"运营审核",prop:"operateOk"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("transfortext")(e.row.operateOk,t.dropdowns.dataStatus))+" ")]}}])}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"财务审核",prop:"financeOk"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("transfortext")(e.row.financeOk,t.dropdowns.dataStatus))+" ")]}}])}),e("el-table-column",{attrs:{width:"130",label:"发票",prop:"invoiceUrl"},scopedSlots:t._u([{key:"default",fn:function(o){return[o.row.invoiceUrl||"3"!==o.row.status?t._e():e("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"function_upload_invoice",expression:"'function_upload_invoice'"}],staticClass:"text-danger",attrs:{type:"text"},on:{click:function(e){return t.openUploadPictrueDialog(o)}}},[t._v("未上传")]),o.row.invoiceUrl?[e("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(e){return t.seePictrue(o.row.invoiceUrl)}}},[t._v("查看")]),e("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"function_upload_invoice",expression:"'function_upload_invoice'"}],attrs:{type:"text",size:"mini"},on:{click:function(e){return t.openUploadPictrueDialog(o)}}},[t._v("替换")])]:t._e()]}}])}),e("el-table-column",{attrs:{width:"130",label:"回单",prop:"paymentUrl"},scopedSlots:t._u([{key:"default",fn:function(o){return[o.row.paymentUrl||"4"!==o.row.status?t._e():e("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"function_upload_receipt",expression:"'function_upload_receipt'"}],staticClass:"text-danger",attrs:{type:"text"},on:{click:function(e){return t.openUploadPictrueDialog(o)}}},[t._v("未上传")]),o.row.paymentUrl?[e("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(e){return t.seePictrue(o.row.paymentUrl)}}},[t._v("查看")]),e("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"function_upload_receipt",expression:"'function_upload_receipt'"}],attrs:{type:"text",size:"mini"},on:{click:function(e){return t.openUploadPictrueDialog(o)}}},[t._v("替换")])]:t._e()]}}])}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"状态",prop:"status"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("transfortext")(e.row.status,t.dropdowns.status))+" ")]}}])}),e("el-table-column",{attrs:{label:"操作",width:"170",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(o){return["总计"!==o.row.clearNo?[e("el-button",{attrs:{plain:"",type:"primary",size:"mini"},on:{click:function(e){return t.seeDetail(o.row)}}},[t._v("明细")]),e("el-dropdown",{staticClass:"ms-2",on:{command:function(e){return t.moreHandles(e,o.row)}}},[e("el-button",{attrs:{size:"mini"}},[t._v(" 更多"),e("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",{directives:[{name:"permission",rawName:"v-permission",value:"function_audit",expression:"'function_audit'"}],attrs:{command:"1"}},[t._v("审核")]),"0"!==o.row.operateOk&&"0"!==o.row.financeOk?e("el-dropdown-item",{attrs:{command:"2"}},[t._v("审核记录")]):t._e(),"2"===o.row.financeOk||"2"===o.row.operateOk?e("el-dropdown-item",{attrs:{command:"3"}},[t._v("重新清分")]):t._e(),["4","5"].includes(o.row.status)?e("el-dropdown-item",{attrs:{command:"4"}},[t._v("打印")]):t._e()],1)],1)]:t._e()]}}])})]},proxy:!0}])}),e("clear-detail",{attrs:{show:t.clearSettleListVisible,clearNo:t.clearNo},on:{close:t.clsoeClearSettleListDialog}}),e("audit-dialog",{attrs:{show:t.auditVisible,detail:t.auditDetail,success:t.getData},on:{close:t.clsoeAuditDetailDialog}}),e("audit-logging",{attrs:{show:t.auditlogVisible,clearNo:t.clearNo},on:{close:t.closeAuditlogVisible}}),e(a.Z,{ref:"upload-pictrue",attrs:{height:"280px",width:"460px",data:{clearNo:t.clearNo},show:t.uploadVisible,title:t.uploadDialogText,placeholder:"",url:"/model/clearingBill/uploadFile"},on:{success:t.getData,"before-close":t.closeUploadPictrueDialog}}),e("div",{staticStyle:{transform:"translateY(10000px)"}},[e("print-order",{ref:"print-order",attrs:{clearNo:t.clearNo,show:t.printPrderDialog},on:{show:e=>{t.printPrderDialog=e}}})],1)],1)},u=[],p=o(30741),d=o(86867),m=o(25335),h=o(5376),b=o(90886),f={name:"settlement-distribution-final-index",mixins:[p.oA,p.I_,p.LI,p.vd],filters:{transfortext:b.h},components:{"audit-dialog":()=>o.e(2139).then(o.bind(o,72056)),"clear-detail":()=>Promise.all([o.e(5267),o.e(2025),o.e(3122),o.e(8303)]).then(o.bind(o,93122)),"audit-logging":()=>o.e(7241).then(o.bind(o,47241)),"print-order":()=>Promise.all([o.e(9113),o.e(5106),o.e(7405),o.e(4631)]).then(o.bind(o,7405))},directives:{permission:d.rd},data(){return{time:"",userInfo:{},pickerOptions:{disabledDate(t){return t.getTime()>Date.now()}},dropdowns:{status:[],dataStatus:[]},queryForm:{startMon:"",endMon:"",status:"",merchantNo:"",pageSize:this.$tableDataSize,pageNum:1},totalData:{},tableLoading:!1,tableData:[],total:0,clearSettleListVisible:!1,clearNo:"",printPrderDialog:!1,auditVisible:!1,auditlogVisible:!1,auditDetail:{},uploadVisible:!1,uploadDialogText:""}},created(){this.getDropdowns(),this.userInfo=this.$store.state.userInfo},methods:{getDropdowns(){(0,h.Wl)("296554").then((t=>{0===t.code&&(this.dropdowns.status=t.data)})),(0,h.Wl)("401007").then((t=>{0===t.code&&(this.dropdowns.dataStatus=t.data)}))},selectTime(t){this.queryForm.pageNum=1,t?(this.queryForm.startMon=t[0],this.queryForm.endMon=t[1]):(this.queryForm.startMon="",this.queryForm.endMon="")},getData(){this.tableLoading=!0,this.tableData=[],(0,m.F9)(this.queryForm).then((t=>{0===t.code&&(this.tableData=t.rows,this.total=t.total),this.tableLoading=!1})).catch((()=>{this.tableLoading=!1}))},seeTotalData(){(0,m.JR)(this.queryForm).then((t=>{0===t.code&&(this.totalData=t.data)}))},moreHandles(t,e){switch(t){case"0":break;case"1":this.openAuditdialog(e);break;case"2":this.auditLogs(e.clearNo);break;case"3":this.resetClearn(e);break;case"4":this.printOrder(e.clearNo);break}},seeDetail(t){this.clearNo=t.clearNo,this.clearSettleListVisible=!0},openAuditdialog(t){this.auditVisible=!0,this.auditDetail=t},auditLogs(t){this.clearNo=t,this.auditlogVisible=!0},resetClearn(t){const e=this;this.$confirm("确定将该要重新清分吗？").then((()=>{(0,m.ey)({merchantId:t.merchantNo,clearNo:t.clearNo}).then((t=>{0===t.code&&e.$message.success(t.msg)}))})).catch((()=>{}))},openUploadPictrueDialog(t){this.uploadVisible=!0,this.clearNo=t.row.clearNo,this.uploadDialogText=`上传${t.row.merchantName}的`+("paymentUrl"===t.column.property?"回单":"发票")},closeUploadPictrueDialog(t){this.uploadVisible=t},seePictrue(t){window.open("https://edo-iot.oss-cn-wulanchabu.aliyuncs.com/"+t,"_blank","location=no, status=no, menubar=no")},closeAuditlogVisible(t){this.auditlogVisible=t},clsoeClearSettleListDialog(t){this.clearSettleListVisible=t},clsoeAuditDetailDialog(t){this.auditVisible=t},printOrder(t){this.clearNo=t,this.printPrderDialog=!0,this.$refs["print-order"].getDropdowns()},async exporting(t){let e={...this.queryForm};"2"===t&&(e.pageSize=this.total,e.pageNum=1);const o=await(0,m.F9)(e);if(0===o.code){const t=this.$refs.table.getColumns(),e=o.rows.map((e=>{let o=t.map((t=>"invoiceUrl"===t.prop&&e[t.prop]||"paymentUrl"===t.prop&&e[t.prop]?[t.label,`https://edo-iot.oss-cn-wulanchabu.aliyuncs.com/${e[t.prop]}`]:[t.label,`${(0,b.h)(e[t.prop],this.dropdowns[t.prop])}`]));return Object.fromEntries(o)}));return e}}}},w=f,g=o(1001),v=(0,g.Z)(w,c,u,!1,null,"8dfe37fe",null),_=v.exports}}]);