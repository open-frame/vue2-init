"use strict";(self["webpackChunkiov_platform"]=self["webpackChunkiov_platform"]||[]).push([[1075],{81075:function(e,t,a){a.r(t),a.d(t,{default:function(){return f}});var o=a(63598),r=a(75267),l=a(71377),n=a(90649),s=a(67539),i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"order"},[t(s.Z,{attrs:{loading:e.tableLoading,btnSpan:12,getData:e.getData,queryReset:e.queryReset}},[t("el-col",{attrs:{span:4}},[t(n.Z,{attrs:{size:"medium",type:"datetimerange",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"支付时间段","picker-options":e.pickerOptions},on:{change:e.selecTime},model:{value:e.time,callback:function(t){e.time=t},expression:"time"}})],1),t("el-col",{attrs:{span:4}},[t(n.Z,{attrs:{size:"medium",type:"date",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",placeholder:"支付时间","picker-options":e.pickerOptions},model:{value:e.queryForm.payTime,callback:function(t){e.$set(e.queryForm,"payTime",t)},expression:"queryForm.payTime"}})],1),t("el-col",{attrs:{span:4}},[t(r.Z,{attrs:{clearable:"",size:"medium",placeholder:"支付账号"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.userId,callback:function(t){e.$set(e.queryForm,"userId",t)},expression:"queryForm.userId"}})],1),t("el-col",{attrs:{span:4}},[t(r.Z,{attrs:{clearable:"",size:"medium",placeholder:"平台单号"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.orderId,callback:function(t){e.$set(e.queryForm,"orderId",t)},expression:"queryForm.orderId"}})],1),t("el-col",{attrs:{span:4}},[t(l["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"支付方式"},on:{change:e.pageReset},model:{value:e.queryForm.payMode,callback:function(t){e.$set(e.queryForm,"payMode",t)},expression:"queryForm.payMode"}},e._l(e.dropdowns.payType,(function(e,a){return t("el-option",{key:a,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t(l["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"业务类型"},on:{change:e.pageReset},model:{value:e.queryForm.payType,callback:function(t){e.$set(e.queryForm,"payType",t)},expression:"queryForm.payType"}},e._l(e.dropdowns.businessType,(function(e,a){return t("el-option",{key:a,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t(l["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"对账状态"},on:{change:e.pageReset},model:{value:e.queryForm.checkStatus,callback:function(t){e.$set(e.queryForm,"checkStatus",t)},expression:"queryForm.checkStatus"}},e._l(e.dropdowns.statementStatus,(function(e,a){return t("el-option",{key:a,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t(l["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"款式类型"},on:{change:e.pageReset},model:{value:e.queryForm.conditon,callback:function(t){e.$set(e.queryForm,"conditon",t)},expression:"queryForm.conditon"}},e._l(e.dropdowns.conditons,(function(e,a){return t("el-option",{key:a,attrs:{label:e.code_name,value:e.code_value}})})),1)],1),t("el-col",{attrs:{span:4}},[t(r.Z,{attrs:{clearable:"",size:"medium",placeholder:"交易号"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.transactionId,callback:function(t){e.$set(e.queryForm,"transactionId",t)},expression:"queryForm.transactionId"}})],1)],1),t("el-divider"),t(o.Z,{ref:"table",attrs:{name:"支付对账",loading:e.tableLoading,total:e.total,data:e.tableData,height:"550","show-index":!0,"page-size":e.queryForm.pageSize,"current-page":e.queryForm.pageNum,derive:e.exporting},on:{"size-change":e.dataSizeChange,"current-change":e.handleCurrentChange},scopedSlots:e._u([{key:"left",fn:function(){return[t("el-button",{attrs:{size:"small"},on:{click:function(t){e.totalDrawer=!0}}},[e._v("总计")])]},proxy:!0},{key:"columns",fn:function(){return[t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"userId",label:"账号"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"payTime",label:"支付时间",width:"170"}}),t("el-table-column",{attrs:{prop:"transactionId",label:"支付单号",width:"200","show-overflow-tooltip":!0}}),t("el-table-column",{attrs:{prop:"orderId",label:"系统订单号",width:"200","show-overflow-tooltip":!0}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"amount",label:"系统订单金额",width:"140",sortable:""}}),t("el-table-column",{attrs:{prop:"checkAmount",label:"支付平台金额",width:"140",sortable:""}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"fee",label:"手续费",width:"100",sortable:""}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"payMode",label:"支付方式"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"payType",label:"业务类型"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"checkStatus",label:"对账状态"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"conditon",label:"对账结果"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"reason",label:"备注"}}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.addNote(a.row)}}},[e._v(" 备注 ")])]}}])})]},proxy:!0}])}),t("el-drawer",{staticClass:"total-drawer",attrs:{modal:!1,"append-to-body":!0,"modal-append-to-body":!1,"with-header":!1,"before-close":e.handleClose,visible:e.totalDrawer}},[t("el-descriptions",{staticClass:"m-5",attrs:{title:"数据总览",column:1,border:""}},[t("el-button",{attrs:{slot:"extra",plain:"",type:"primary",size:"small"},on:{click:e.exportTotal},slot:"extra"},[e._v("导出")]),e._l(e.totalData,(function(a,o){return t("el-descriptions-item",{key:o,attrs:{label:a.name}},[e._v(" "+e._s(a.value)+" ")])}))],2)],1)],1)},u=[],p=a(25335),c=a(5376),d=a(30741),m={name:"",mixins:[d.LI,d.I_,d.oA,d.vd],data(){return{pickerOptions:{disabledDate(e){return e.getTime()>Date.now()}},tableLoading:!1,time:"",dropdowns:{payType:[],businessType:[],statementStatus:[],conditons:[]},queryForm:{payTime:"",pageNum:1,pageSize:this.$tableDataSize,userId:"",orderId:"",payType:"",payMode:"",beginTime:"",endTime:"",conditon:"",checkStatus:"",transactionId:""},tableData:[],totalData:[],total:0,moreSelect:[],totalDrawer:!1}},created(){this.getDropdowns()},methods:{getDropdowns(){(0,c.Wl)("3026").then((e=>{0===e.code&&(this.dropdowns.businessType=e.data)})),(0,c.Wl)("3025").then((e=>{0===e.code&&(this.dropdowns.payType=e.data)})),(0,c.Wl)("3041").then((e=>{0===e.code&&(this.dropdowns.conditons=e.data)})),(0,c.Wl)("3040").then((e=>{0===e.code&&(this.dropdowns.statementStatus=e.data)}))},selecTime(e){e?(this.queryForm.beginTime=e[0],this.queryForm.endTime=e[1]):(this.queryForm.beginTime="",this.queryForm.endTime="")},getData(){this.getTotal(),this.getStatData()},getStatData(e){if(e)switch(this.queryForm.payTime=e.payTime,e.type){case"chongZhiMoney":this.queryForm.payType="1";break;case"WeiXinPay":this.queryForm.payType="2";break;case"refundMoney":this.queryForm.payType="3";break;case"userTiXian":this.queryForm.payType="4";break}this.tableLoading=!0,this.tableData=[],this.$nextTick((()=>{(0,p.wD)(this.queryForm).then((e=>{this.tableLoading=!1,0===e.code&&(this.tableData=e.rows,this.total=e.total)}))})).catch((()=>{this.tableLoading=!1}))},getTotal(){(0,p.Cc)(this.queryForm).then((e=>{0===e.code&&(this.totalData=[{name:"未对账数量",value:e.rows[0].NotDuiZhangNum+"笔"},{name:"系统比支付平台多的合计金额",value:e.rows[0].changKuanAmount+"元"},{name:"系统比支付平台多的数量",value:e.rows[0].changKuanNum+"笔"},{name:"系统比支付平台少的合计金额",value:e.rows[0].duanKuanAmount+"元"},{name:"系统比支付平台少的数量",value:e.rows[0].duanKuanNum+"笔"},{name:"系统订单合计金额",value:e.rows[0].pingTaiAmount+"元"},{name:"系统订单数量",value:e.rows[0].pingTaiNum+"笔"},{name:"支付平台订单合计金额",value:e.rows[0].totalAmount+"元"},{name:"支付平台合计金额",value:e.rows[0].totalNum+"元"},{name:"已对账数量",value:e.rows[0].yiDuiZhangNum+"笔"}])}))},checking(e){},statementing(e,t){if("more"===e&&this.moreSelect.length<1)return this.$message.warning("请选择删除项"),!1},addNote(e){const t=this;this.$prompt("","添加备注",{beforeClose(e,a,o){if("confirm"===e&&!a.inputValue)return t.$message.error("请输入备注"),!1;o()}}).then((a=>{(0,p._J)({reason:a.value,userId:e.userId,transactionId:e.transactionId}).then((e=>{0===e.code&&t.getStatData()}))})).catch((()=>{}))},async exporting(e){let t={...this.queryForm};"2"===e&&(t.pageSize=this.total,t.pageNum=1);const a=await(0,p.wD)(t);if(0===a.code){const e=this.$refs.table.getColumns(),t=a.rows.map((t=>{let a=e.map((e=>[e.label,t[e.prop]]));return Object.fromEntries(a)}));return t}},exportTotal(){const e=this.totalData.map((e=>({"名目":e.name,"数据":e.value})));this.$refs.table.exportExcel(e)},handleClose(e){this.totalDrawer=!1}}},y=m,h=a(1001),b=(0,h.Z)(y,i,u,!1,null,"59512218",null),f=b.exports}}]);