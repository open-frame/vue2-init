"use strict";(self["webpackChunkiov_platform"]=self["webpackChunkiov_platform"]||[]).push([[3136],{73136:function(t,e,o){o.r(e),o.d(e,{default:function(){return _}});var a=o(63598),s=o(71377),r=o(1985),l=o(67539),n=function(){var t=this,e=t._self._c;return e("el-card",{},[e(l.Z,{attrs:{loading:t.tableLoading,btnSpan:16,getData:t.getData,queryReset:t.queryReset}},[e("el-col",{attrs:{span:4}},[e(r.Z,{attrs:{animatLable:"",placeholder:"筛选商户"},model:{value:t.queryForm.merchantNo,callback:function(e){t.$set(t.queryForm,"merchantNo",e)},expression:"queryForm.merchantNo"}})],1),e("el-col",{attrs:{span:4}},[e(s["default"],{attrs:{size:"medium",filterable:"","default-first-option":"",clearable:"",placeholder:"执行状态"},model:{value:t.queryForm.status,callback:function(e){t.$set(t.queryForm,"status",e)},expression:"queryForm.status"}},t._l(t.dropdowns.status,(function(t,o){return e("el-option",{key:o,attrs:{label:t.code_name,value:t.code_value}})})),1)],1)],1),e("el-divider"),e(a.Z,{ref:"table",attrs:{loading:t.tableLoading,total:t.total,data:t.tableData,height:"550","row-key":"deptId","show-index":!0,"page-size":t.queryForm.pageSize,"current-page":t.queryForm.pageNum,derive:t.exporting},on:{"size-change":t.dataSizeChange,"current-change":t.handleCurrentChange},scopedSlots:t._u([{key:"left",fn:function(){return[e("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"function_add_setting",expression:"'function_add_setting'"}],attrs:{size:"small",icon:"el-icon-plus"},on:{click:t.showRuleSettingsDialog}},[t._v("新增清分设置")])]},proxy:!0},{key:"columns",fn:function(){return[e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"ruleNo",label:"清分规则编号"}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"merchantName",label:"商户名称"}}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"clearType",label:"清分类型"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("transfortext")(e.row.clearType,t.dropdowns.clearType))+" ")]}}])}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"clearCycle",label:"清分周期"},scopedSlots:t._u([{key:"default",fn:function(o){return[o.row.clearCycle?e("span",[t._v(" "+t._s("每月 "+o.row.clearCycle+" 日")+" ")]):t._e()]}}])}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"clearRule",label:"清分原则"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("transfortext")(e.row.clearRule,t.dropdowns.clearRule))+" ")]}}])}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"merchantCode",label:"清分模式"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("transfortext")(e.row.merchantCode,t.dropdowns.merchantCode))+" ")]}}])}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"approvalStatus",label:"审核状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("transfortext")(e.row.approvalStatus,t.dropdowns.approvalStatus))+" ")]}}])}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"status",label:"执行状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("transfortext")(e.row.status,t.dropdowns.status))+" ")]}}])}),e("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"enableTime",label:"执行时间"}}),e("el-table-column",{attrs:{label:"操作",width:"190",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(o){return[e("el-button",{attrs:{plain:"",type:"primary",size:"mini"},on:{click:function(e){return t.showRuleSettingsDialog(o.row)}}},[t._v("详情")]),"0"===o.row.approvalStatus&&"1"===o.row.status?e("el-dropdown",{directives:[{name:"permission",rawName:"v-permission",value:"function_audit",expression:"'function_audit'"}],staticClass:"ms-2",on:{command:function(e){return t.auditRules(e,o.row)}}},[e("el-button",{attrs:{size:"mini"}},[t._v(" 审核"),e("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.dropdowns.auditResult,(function(o){return e("el-dropdown-item",{key:o.code_value,attrs:{command:o.code_value}},[t._v(t._s(o.code_name))])})),1)],1):t._e(),"1"===o.row.status&&"1"===o.row.approvalStatus?e("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"function_execute",expression:"'function_execute'"}],attrs:{size:"mini"},on:{click:function(e){return t.executeIt(o.row)}}},[t._v("启用")]):t._e()]}}])})]},proxy:!0}])}),e("rule-settings-dialog",{attrs:{show:t.ruleSettingsSwitch,data:t.ruleSettingsForm},on:{success:t.getData,close:t.closeRuleSettingsDialog}}),e("audit-logging-dialog",{attrs:{show:t.auditLoggingSwitch,data:t.auditLoggingData},on:{close:t.closeAuditloggingDialog}})],1)},i=[],u=o(25335),c=o(5376),d=o(86867),p=o(90886),g=o(30741),h={name:"settlement-distribution-settings-index",mixins:[g.oA,g.I_,g.LI,g.vd],filters:{transfortext:p.h},components:{ruleSettingsDialog:()=>Promise.all([o.e(4779),o.e(4713),o.e(6654),o.e(849)]).then(o.bind(o,80849)),auditLoggingDialog:()=>o.e(8197).then(o.bind(o,88197))},directives:{permission:d.rd},data(){return{dropdowns:{approvalStatus:[],status:[],clearType:[],clearRule:[],merchantCode:[],auditResult:[]},tableLoading:!1,queryForm:{pageSize:this.$tableDataSize,pageNum:1,merchantNo:"",status:""},tableData:[],total:0,ruleSettingsSwitch:!1,ruleSettingsForm:{},auditLoggingSwitch:!1,auditLoggingData:[]}},created(){this.getDropdowns()},methods:{getDropdowns(){(0,c.Wl)("357131").then((t=>{0===t.code&&(this.dropdowns.clearType=t.data)})),(0,c.Wl)("758195").then((t=>{0===t.code&&(this.dropdowns.clearRule=t.data)})),(0,c.Wl)("978251").then((t=>{0===t.code&&(this.dropdowns.merchantCode=t.data)})),(0,c.Wl)("531538").then((t=>{0===t.code&&(this.dropdowns.status=t.data)})),(0,c.Wl)("401007").then((t=>{0===t.code&&(this.dropdowns.approvalStatus=t.data)})),(0,c.Wl)("426807").then((t=>{0===t.code&&(this.dropdowns.auditResult=t.data)}))},getData(){this.tableData=[],this.tableLoading=!0,(0,u.TO)(this.queryForm).then((t=>{this.tableLoading=!1,0===t.code&&(this.tableData=t.rows,this.total=t.total)})).catch((()=>{this.tableLoading=!1}))},showRuleSettingsDialog(t){this.ruleSettingsSwitch=!0,t.id&&t.ruleNo&&(this.ruleSettingsForm={...t})},closeRuleSettingsDialog(t){this.ruleSettingsSwitch=t,this.ruleSettingsForm={}},showAuditLogging(){this.auditLoggingSwitch=!0},closeAuditloggingDialog(t){this.auditLoggingSwitch=t},auditRules(t,e){const o=this;this.$confirm("确定 "+("1"===t?"通过":"驳回")+" 该审核？").then((()=>{(0,u.xt)({id:e.id,approvalStatus:t}).then((t=>{0===t.code&&(this.$message.success(t.msg),o.getData())}))})).catch((()=>{}))},executeIt(t){const e=this;this.$confirm("确定启用 "+t.merchantName+" 的清分规则吗？").then((()=>{(0,u.xt)({id:t.id,ruleNo:t.ruleNo,status:"2",approvalStatus:t.approvalStatus}).then((t=>{0===t.code&&(e.$message.success(t.msg),e.getData())}))})).catch((()=>{}))},async exporting(t){let e={...this.queryForm};"2"===t&&(e.pageSize=this.total,e.pageNum=1);const o=await(0,u.TO)(e);if(0===o.code){const t=this.$refs.table.getColumns(),e=o.rows.map((e=>{let o=t.map((t=>[t.label,`${(0,p.h)(e[t.prop],this.dropdowns[t.prop])}`]));return Object.fromEntries(o)}));return e}}}},m=h,f=o(1001),w=(0,f.Z)(m,n,i,!1,null,"1638fe06",null),_=w.exports}}]);