"use strict";(self["webpackChunkiov_platform"]=self["webpackChunkiov_platform"]||[]).push([[7142],{97142:function(e,t,a){a.r(t),a.d(t,{default:function(){return k}});var o=a(63598),r=a(71377),l=a(66654),n=a(12025),s=a(75267),i=a(90649),d=a(67539),u=function(){var e=this,t=e._self._c;return t("div",{},[t(d.Z,{attrs:{loading:e.tableLoading,getData:e.getData,queryReset:e.queryReset}},[t("el-col",{attrs:{span:4}},[t(i.Z,{attrs:{type:"date",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",placeholder:"抄表日期","picker-options":e.pickerOptions},model:{value:e.queryForm.dataDate,callback:function(t){e.$set(e.queryForm,"dataDate",t)},expression:"queryForm.dataDate"}})],1),t("el-col",{attrs:{span:4}},[t(s.Z,{attrs:{clearable:"",size:"medium",placeholder:"电表编号"},on:{change:e.pageReset},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getData.apply(null,arguments)}},model:{value:e.queryForm.deviceName,callback:function(t){e.$set(e.queryForm,"deviceName",t)},expression:"queryForm.deviceName"}})],1),t("el-col",{attrs:{span:4}},[t(n.Z,{attrs:{animatLable:""},on:{change:e.pageReset},model:{value:e.queryForm.stationNo,callback:function(t){e.$set(e.queryForm,"stationNo",t)},expression:"queryForm.stationNo"}})],1),t("el-col",{attrs:{span:4}},[t(l.Z,{attrs:{animatLable:"",placeholder:"归属区域"},on:{change:e.pageReset},model:{value:e.queryForm.deviceAddr,callback:function(t){e.$set(e.queryForm,"deviceAddr",t)},expression:"queryForm.deviceAddr"}})],1),t("el-col",{attrs:{span:4}},[t(r["default"],{attrs:{filterable:"","default-first-option":"",clearable:"",size:"medium",placeholder:"抄表状态"},on:{change:e.pageReset},model:{value:e.queryForm.chaoStatus,callback:function(t){e.$set(e.queryForm,"chaoStatus",t)},expression:"queryForm.chaoStatus"}},e._l(e.dropdowns.status,(function(e,a){return t("el-option",{key:a,attrs:{label:e.code_name,value:e.code_value}})})),1)],1)],1),t("el-divider"),t(o.Z,{ref:"table",attrs:{name:"抄表记录",loading:e.tableLoading,total:e.total,data:e.tableData,height:"500","row-key":"deviceName","page-size":e.queryForm.pageSize,"current-page":e.queryForm.pageNum,derive:e.exporting},on:{"size-change":e.dataSizeChange,"current-change":e.handleCurrentChange},scopedSlots:e._u([{key:"columns",fn:function(){return[t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"电表编号",prop:"deviceName"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"今日示数",prop:"papR"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"昨日示数",prop:"yesR"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"昨日电量",prop:"tdelec"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"归属区域",prop:"deviceAddr"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.deviceAddr,e.dropdowns.deviceAddr,{name:"construction",value:"uuid"}))+" ")]}}])}),t("el-table-column",{attrs:{label:"归属电站","show-overflow-tooltip":"",prop:"deviceStationNo"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.deviceStationNo,e.dropdowns.deviceStationNo,{name:"stationName",value:"stationNo"}))+" ")]}}])}),t("el-table-column",{attrs:{label:"详细地址","show-overflow-tooltip":"",prop:"deviceAddrDetail"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"抄表状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("transfortext")(t.row.chaoStatus,e.dropdowns.status))+" ")]}}])}),t("el-table-column",{attrs:{label:"抄表日期",prop:"dataDate","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return["1"!==a.row.chaoStatus?t("el-button",{attrs:{plain:"",size:"mini"},on:{click:function(t){return e.replenishCopy(a.row)}}},[e._v("补抄")]):e._e()]}}])})]},proxy:!0}])})],1)},c=[],p=a(74713),m=a(5376),h=a(24779),f=a(90886),v=a(30741),y={name:"",mixins:[v.LI,v.I_,v.oA,v.vd],filters:{transfortext:f.h},data(){return{pickerOptions:{disabledDate(e){return e.getTime()>Date.now()}},tableLoading:!1,queryForm:{dataDate:"",deviceName:"",deviceAddr:"",stationNo:"",chaoStatus:"",pageSize:this.$tableDataSize,pageNum:1},dropdowns:{deviceStationNo:[],status:[],deviceAddr:[]},tableData:[],total:0}},created(){this.getDropdowns()},methods:{getData(){this.tableLoading=!0,this.tableData=[],(0,p.SR)(this.queryForm).then((e=>{this.tableLoading=!1,0===e.code&&(this.total=e.total,this.tableData=e.rows)})).catch((()=>{this.tableLoading=!1}))},getDropdowns(){(0,m.Wl)("3061").then((e=>{0===e.code&&(this.dropdowns.status=e.data)})),(0,h.ao)({}).then((e=>{0===e.code&&(this.dropdowns.deviceAddr=e.rows)})),(0,m.iS)().then((e=>{this.dropdowns.deviceStationNo=e.data}))},replenishCopy(e){if(!this.queryForm.dataDate)return this.$message.info("请选择抄表日期");(0,p.Qx)({deviceName:e.deviceName,dataDate:this.queryForm.dataDate+" 00:00:00"}).then((e=>{this.$message.info(e.msg),this.getData()}))},async exporting(e){let t={...this.queryForm};"2"===e&&(t.pageSize=this.total,t.pageNum=1);const a=await(0,p.SR)(t);if(0===a.code){const e=this.$refs.table.getColumns(),t=a.rows.map((t=>{let a=e.map((e=>[e.label,`${(0,f.h)(t[e.prop],this.dropdowns[e.prop])}`]));return Object.fromEntries(a)}));return t}}}},b=y,g=a(1001),w=(0,g.Z)(b,u,c,!1,null,"c71cc036",null),k=w.exports}}]);