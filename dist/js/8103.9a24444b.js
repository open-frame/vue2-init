"use strict";(self["webpackChunkiov_platform"]=self["webpackChunkiov_platform"]||[]).push([[8103],{48103:function(e,t,s){s.d(t,{Z:function(){return d}});var a=function(){var e=this,t=e._self._c;return t("el-dialog",{staticClass:"edit-events-dialog",attrs:{"close-on-click-modal":!1,"close-on-press-escape":!1,"append-to-body":!0,"modal-append-to-body":!1,title:e.title,visible:e.show,"before-close":e.close}},[t("el-upload",{directives:[{name:"loading",rawName:"v-loading",value:e.submitBtnStatus,expression:"submitBtnStatus"}],ref:"uploadEventPictrue",staticClass:"text-center",attrs:{drag:"","auto-upload":!1,action:e.uploadEventPictrueURL,headers:e.uploadEventPictrueHeaders,"show-file-list":!1,accept:"image/*",data:e.data,"on-change":e.onChange,"on-progress":e.onProgress,"on-success":e.onSuccess,"on-error":e.onLoadingClose,"before-upload":e.beforeUpload,"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"}},[e.eventImage?t("img",{style:{width:e.width},attrs:{src:e.eventImage,alt:"图例"}}):t("div",{staticClass:"flex flex-justify-center flex-items-center",style:{height:e.height,width:e.width}},[t("div",[t("i",{staticClass:"el-icon-upload m-0"}),t("div",{staticClass:"el-upload__text"},[e._v("将图片拖到此处，或"),t("em",[e._v("点击上传")])]),t("div",{staticClass:"text-center text-warmgray"},[e._v(" 仅支持png、jpeg、jpg或gif格式 ")])])])]),e.placeholder?t("div",{staticClass:"text-center mt-5"},[e._v(e._s(e.placeholder))]):e._e(),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.close}},[e._v("关 闭")]),t("el-button",{attrs:{type:"primary",disabled:!e.eventImage,loading:e.submitBtnStatus},on:{click:e.uploading}},[e._v("上 传")])],1)],1)},i=[],o=s(57758),n=s.n(o),r={name:"upload-pictrue",data(){return{uploadEventPictrueURL:"",uploadEventPictrueHeaders:{Authorization:`Bearer ${localStorage.getItem("token")}`},eventImage:"",submitBtnStatus:!1}},props:{show:{type:Boolean,default:!1},url:{type:String,required:!0},title:{type:String,default:"上传图片"},height:{type:String,default:"160px"},width:{type:String,default:"360px"},placeholder:{type:String,default(){return`请上传${this.height}×${this.width}的图片`}},data:{type:Object,default(){return{}}}},watch:{show(e){e&&(this.uploadEventPictrueURL=`https://clw.edo-iot.com/yscar${this.url}`)}},methods:{onChange(e,t){const s=this;new(n())(e.raw,{success(e){s.eventImage=URL.createObjectURL(e)}})},beforeUpload(e){const t="image/png"===e.type||"image/jpeg";if(!t)return this.$message.error("只能上传图片")},uploading(){if(!this.eventImage)return this.$message.info("请选择图片");this.$refs.uploadEventPictrue.submit()},onProgress(){this.submitBtnStatus=!0},onSuccess(e,t,s){if(2001===e.code)return this.$store.commit("logout","1");this.submitBtnStatus=!1,0===e.code?(this.$message.success("上传成功"),this.close(),this.$emit("success",e)):this.$message({type:"error",duration:4e3,message:e.msg})},onLoadingClose(e,t,s){this.submitBtnStatus=!1},clearUploadInfo(){this.eventImage="",this.$refs.uploadEventPictrue.clearFiles(),this.submitBtnStatus=!1},close(){this.submitBtnStatus&&this.$refs.uploadEventPictrue.abort(),this.$emit("before-close",!1),URL.revokeObjectURL(this.eventImage),this.clearUploadInfo()}}},l=r,u=s(1001),c=(0,u.Z)(l,a,i,!1,null,"17dee3db",null),d=c.exports}}]);